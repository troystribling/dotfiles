"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertMarkdownToOutput = exports.clearResults = exports.clearResult = exports.importResult = exports.createResult = void 0;
const result_view_1 = __importDefault(require("./components/result-view"));
const output_area_1 = __importDefault(require("./panes/output-area"));
const watches_1 = __importDefault(require("./panes/watches"));
const utils_1 = require("./utils");
function createResult({ editor, kernel, markers, }, { code, row, cellType, }) {
    if (!editor || !kernel || !markers) {
        return;
    }
    if (atom.workspace.getActivePaneItem() instanceof watches_1.default) {
        kernel.watchesStore.run();
        return;
    }
    const globalOutputStore = atom.config.get("Hydrogen.outputAreaDefault") ||
        atom.workspace.getPaneItems().find((item) => item instanceof output_area_1.default)
        ? kernel.outputStore
        : null;
    if (globalOutputStore) {
        utils_1.openOrShowDock(utils_1.OUTPUT_AREA_URI);
    }
    const { outputStore } = new result_view_1.default(markers, kernel, editor, row, !globalOutputStore || cellType == "markdown");
    if (code.search(/\S/) != -1) {
        switch (cellType) {
            case "markdown":
                if (globalOutputStore) {
                    globalOutputStore.appendOutput(convertMarkdownToOutput(code));
                }
                else {
                    outputStore.appendOutput(convertMarkdownToOutput(code));
                }
                outputStore.appendOutput({
                    data: "ok",
                    stream: "status",
                });
                break;
            case "codecell":
                kernel.execute(code, (result) => {
                    outputStore.appendOutput(result);
                    if (globalOutputStore) {
                        globalOutputStore.appendOutput(result);
                    }
                });
                break;
        }
    }
    else {
        outputStore.appendOutput({
            data: "ok",
            stream: "status",
        });
    }
}
exports.createResult = createResult;
function importResult({ editor, markers, }, { outputs, row, }) {
    if (!editor || !markers) {
        return;
    }
    const { outputStore } = new result_view_1.default(markers, null, editor, row, true);
    for (const output of outputs) {
        outputStore.appendOutput(output);
    }
}
exports.importResult = importResult;
function clearResult({ editor, markers, }) {
    if (!editor || !markers) {
        return;
    }
    const [startRow, endRow] = editor.getLastSelection().getBufferRowRange();
    for (let row = startRow; row <= endRow; row++) {
        markers.clearOnRow(row);
    }
}
exports.clearResult = clearResult;
function clearResults({ kernel, markers, }) {
    if (markers) {
        markers.clear();
    }
    if (!kernel) {
        return;
    }
    kernel.outputStore.clear();
}
exports.clearResults = clearResults;
function convertMarkdownToOutput(markdownString) {
    return {
        output_type: "display_data",
        data: {
            "text/markdown": markdownString,
        },
        metadata: {},
    };
}
exports.convertMarkdownToOutput = convertMarkdownToOutput;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vbGliL3Jlc3VsdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSwyRUFBa0Q7QUFDbEQsc0VBQTZDO0FBQzdDLDhEQUEwQztBQUMxQyxtQ0FBMEQ7QUFpQjFELFNBQWdCLFlBQVksQ0FDMUIsRUFDRSxNQUFNLEVBQ04sTUFBTSxFQUNOLE9BQU8sR0FLUCxFQUNGLEVBQ0UsSUFBSSxFQUNKLEdBQUcsRUFDSCxRQUFRLEdBS1Q7SUFFRCxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQ2xDLE9BQU87S0FDUjtJQUVELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxZQUFZLGlCQUFXLEVBQUU7UUFDN0QsTUFBTSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMxQixPQUFPO0tBQ1I7SUFFRCxNQUFNLGlCQUFpQixHQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQztRQUM3QyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxZQUFZLHFCQUFVLENBQUM7UUFDdEUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXO1FBQ3BCLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDWCxJQUFJLGlCQUFpQixFQUFFO1FBQ3JCLHNCQUFjLENBQUMsdUJBQWUsQ0FBQyxDQUFDO0tBQ2pDO0lBQ0QsTUFBTSxFQUFFLFdBQVcsRUFBRSxHQUFHLElBQUkscUJBQVUsQ0FDcEMsT0FBTyxFQUNQLE1BQU0sRUFDTixNQUFNLEVBQ04sR0FBRyxFQUNILENBQUMsaUJBQWlCLElBQUksUUFBUSxJQUFJLFVBQVUsQ0FDN0MsQ0FBQztJQUVGLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtRQUMzQixRQUFRLFFBQVEsRUFBRTtZQUNoQixLQUFLLFVBQVU7Z0JBQ2IsSUFBSSxpQkFBaUIsRUFBRTtvQkFDckIsaUJBQWlCLENBQUMsWUFBWSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7aUJBQy9EO3FCQUFNO29CQUNMLFdBQVcsQ0FBQyxZQUFZLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztpQkFDekQ7Z0JBQ0QsV0FBVyxDQUFDLFlBQVksQ0FBQztvQkFDdkIsSUFBSSxFQUFFLElBQUk7b0JBQ1YsTUFBTSxFQUFFLFFBQVE7aUJBQ2pCLENBQUMsQ0FBQztnQkFDSCxNQUFNO1lBRVIsS0FBSyxVQUFVO2dCQUNiLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUU7b0JBQzlCLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ2pDLElBQUksaUJBQWlCLEVBQUU7d0JBQ3JCLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztxQkFDeEM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsTUFBTTtTQUNUO0tBQ0Y7U0FBTTtRQUNMLFdBQVcsQ0FBQyxZQUFZLENBQUM7WUFDdkIsSUFBSSxFQUFFLElBQUk7WUFDVixNQUFNLEVBQUUsUUFBUTtTQUNqQixDQUFDLENBQUM7S0FDSjtBQUNILENBQUM7QUExRUQsb0NBMEVDO0FBWUQsU0FBZ0IsWUFBWSxDQUMxQixFQUNFLE1BQU0sRUFDTixPQUFPLEdBSVIsRUFDRCxFQUNFLE9BQU8sRUFDUCxHQUFHLEdBSUo7SUFFRCxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQ3ZCLE9BQU87S0FDUjtJQUNELE1BQU0sRUFBRSxXQUFXLEVBQUUsR0FBRyxJQUFJLHFCQUFVLENBQ3BDLE9BQU8sRUFDUCxJQUFJLEVBQ0osTUFBTSxFQUNOLEdBQUcsRUFDSCxJQUFJLENBQ0wsQ0FBQztJQUVGLEtBQUssTUFBTSxNQUFNLElBQUksT0FBTyxFQUFFO1FBQzVCLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDbEM7QUFDSCxDQUFDO0FBOUJELG9DQThCQztBQWNELFNBQWdCLFdBQVcsQ0FBQyxFQUMxQixNQUFNLEVBQ04sT0FBTyxHQUlQO0lBQ0EsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRTtRQUN2QixPQUFPO0tBQ1I7SUFDRCxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFFekUsS0FBSyxJQUFJLEdBQUcsR0FBRyxRQUFRLEVBQUUsR0FBRyxJQUFJLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUM3QyxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ3pCO0FBQ0gsQ0FBQztBQWZELGtDQWVDO0FBU0QsU0FBZ0IsWUFBWSxDQUFDLEVBQzNCLE1BQU0sRUFDTixPQUFPLEdBSVA7SUFDQSxJQUFJLE9BQU8sRUFBRTtRQUNYLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztLQUNqQjtJQUNELElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxPQUFPO0tBQ1I7SUFDRCxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQzdCLENBQUM7QUFkRCxvQ0FjQztBQVVELFNBQWdCLHVCQUF1QixDQUFDLGNBQXNCO0lBQzVELE9BQU87UUFDTCxXQUFXLEVBQUUsY0FBYztRQUMzQixJQUFJLEVBQUU7WUFDSixlQUFlLEVBQUUsY0FBYztTQUNoQztRQUNELFFBQVEsRUFBRSxFQUFFO0tBQ2IsQ0FBQztBQUNKLENBQUM7QUFSRCwwREFRQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRleHRFZGl0b3IgfSBmcm9tIFwiYXRvbVwiO1xuaW1wb3J0IFJlc3VsdFZpZXcgZnJvbSBcIi4vY29tcG9uZW50cy9yZXN1bHQtdmlld1wiO1xuaW1wb3J0IE91dHB1dFBhbmUgZnJvbSBcIi4vcGFuZXMvb3V0cHV0LWFyZWFcIjtcbmltcG9ydCBXYXRjaGVzUGFuZSBmcm9tIFwiLi9wYW5lcy93YXRjaGVzXCI7XG5pbXBvcnQgeyBPVVRQVVRfQVJFQV9VUkksIG9wZW5PclNob3dEb2NrIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB0eXBlIE1hcmtlclN0b3JlIGZyb20gXCIuL3N0b3JlL21hcmtlcnNcIjtcbmltcG9ydCB0eXBlIEtlcm5lbCBmcm9tIFwiLi9rZXJuZWxcIjtcbmltcG9ydCB0eXBlIHsgSHlkcm9nZW5DZWxsVHlwZSB9IGZyb20gXCIuL2h5ZHJvZ2VuXCI7XG5cbi8qKlxuICogQ3JlYXRlcyBhbmQgcmVuZGVycyBhIFJlc3VsdFZpZXcuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHN0b3JlIC0gR2xvYmFsIEh5ZHJvZ2VuIFN0b3JlXG4gKiBAcGFyYW0ge1RleHRFZGl0b3J9IHN0b3JlLmVkaXRvciAtIFRleHRFZGl0b3IgYXNzb2NpYXRlZCB3aXRoIHRoZSByZXN1bHQuXG4gKiBAcGFyYW0ge0tlcm5lbH0gc3RvcmUua2VybmVsIC0gS2VybmVsIHRvIHJ1biBjb2RlIGFuZCBhc3NvY2lhdGUgd2l0aCB0aGUgcmVzdWx0LlxuICogQHBhcmFtIHtNYXJrZXJTdG9yZX0gc3RvcmUubWFya2VycyAtIE1hcmtlclN0b3JlIHRoYXQgYmVsb25ncyB0byBgc3RvcmUuZWRpdG9yYC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBjb2RlQmxvY2sgLSBBIEh5ZHJvZ2VuIENlbGwuXG4gKiBAcGFyYW0ge1N0cmluZ30gY29kZUJsb2NrLmNvZGUgLSBTb3VyY2Ugc3RyaW5nIG9mIHRoZSBjZWxsLlxuICogQHBhcmFtIHtOdW1iZXJ9IGNvZGVCbG9jay5yb3cgLSBSb3cgdG8gZGlzcGxheSB0aGUgcmVzdWx0IG9uLlxuICogQHBhcmFtIHtIeWRyb2dlbkNlbGxUeXBlfSBjb2RlQmxvY2suY2VsbFR5cGUgLSBDZWxsIHR5cGUgb2YgdGhlIGNlbGwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXN1bHQoXG4gIHtcbiAgICBlZGl0b3IsXG4gICAga2VybmVsLFxuICAgIG1hcmtlcnMsXG4gIH06IFJlYWRvbmx5PHtcbiAgICBlZGl0b3I6IFRleHRFZGl0b3IgfCBudWxsIHwgdW5kZWZpbmVkO1xuICAgIGtlcm5lbDogS2VybmVsIHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgICBtYXJrZXJzOiBNYXJrZXJTdG9yZSB8IG51bGwgfCB1bmRlZmluZWQ7XG4gIH0+LFxuICB7XG4gICAgY29kZSxcbiAgICByb3csXG4gICAgY2VsbFR5cGUsXG4gIH06IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgcm93OiBudW1iZXI7XG4gICAgY2VsbFR5cGU6IEh5ZHJvZ2VuQ2VsbFR5cGU7XG4gIH1cbikge1xuICBpZiAoIWVkaXRvciB8fCAha2VybmVsIHx8ICFtYXJrZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVBhbmVJdGVtKCkgaW5zdGFuY2VvZiBXYXRjaGVzUGFuZSkge1xuICAgIGtlcm5lbC53YXRjaGVzU3RvcmUucnVuKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgZ2xvYmFsT3V0cHV0U3RvcmUgPVxuICAgIGF0b20uY29uZmlnLmdldChcIkh5ZHJvZ2VuLm91dHB1dEFyZWFEZWZhdWx0XCIpIHx8XG4gICAgYXRvbS53b3Jrc3BhY2UuZ2V0UGFuZUl0ZW1zKCkuZmluZCgoaXRlbSkgPT4gaXRlbSBpbnN0YW5jZW9mIE91dHB1dFBhbmUpXG4gICAgICA/IGtlcm5lbC5vdXRwdXRTdG9yZVxuICAgICAgOiBudWxsO1xuICBpZiAoZ2xvYmFsT3V0cHV0U3RvcmUpIHtcbiAgICBvcGVuT3JTaG93RG9jayhPVVRQVVRfQVJFQV9VUkkpO1xuICB9XG4gIGNvbnN0IHsgb3V0cHV0U3RvcmUgfSA9IG5ldyBSZXN1bHRWaWV3KFxuICAgIG1hcmtlcnMsXG4gICAga2VybmVsLFxuICAgIGVkaXRvcixcbiAgICByb3csXG4gICAgIWdsb2JhbE91dHB1dFN0b3JlIHx8IGNlbGxUeXBlID09IFwibWFya2Rvd25cIlxuICApO1xuXG4gIGlmIChjb2RlLnNlYXJjaCgvXFxTLykgIT0gLTEpIHtcbiAgICBzd2l0Y2ggKGNlbGxUeXBlKSB7XG4gICAgICBjYXNlIFwibWFya2Rvd25cIjpcbiAgICAgICAgaWYgKGdsb2JhbE91dHB1dFN0b3JlKSB7XG4gICAgICAgICAgZ2xvYmFsT3V0cHV0U3RvcmUuYXBwZW5kT3V0cHV0KGNvbnZlcnRNYXJrZG93blRvT3V0cHV0KGNvZGUpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvdXRwdXRTdG9yZS5hcHBlbmRPdXRwdXQoY29udmVydE1hcmtkb3duVG9PdXRwdXQoY29kZSkpO1xuICAgICAgICB9XG4gICAgICAgIG91dHB1dFN0b3JlLmFwcGVuZE91dHB1dCh7XG4gICAgICAgICAgZGF0YTogXCJva1wiLFxuICAgICAgICAgIHN0cmVhbTogXCJzdGF0dXNcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiY29kZWNlbGxcIjpcbiAgICAgICAga2VybmVsLmV4ZWN1dGUoY29kZSwgKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIG91dHB1dFN0b3JlLmFwcGVuZE91dHB1dChyZXN1bHQpO1xuICAgICAgICAgIGlmIChnbG9iYWxPdXRwdXRTdG9yZSkge1xuICAgICAgICAgICAgZ2xvYmFsT3V0cHV0U3RvcmUuYXBwZW5kT3V0cHV0KHJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIG91dHB1dFN0b3JlLmFwcGVuZE91dHB1dCh7XG4gICAgICBkYXRhOiBcIm9rXCIsXG4gICAgICBzdHJlYW06IFwic3RhdHVzXCIsXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGlubGluZSByZXN1bHRzIGZyb20gS2VybmVsIFJlc3BvbnNlcyB3aXRob3V0IGEgdGllIHRvIGEga2VybmVsLlxuICpcbiAqIEBwYXJhbSB7U3RvcmV9IHN0b3JlIC0gSHlkcm9nZW4gc3RvcmVcbiAqIEBwYXJhbSB7VGV4dEVkaXRvcn0gc3RvcmUuZWRpdG9yIC0gVGhlIGVkaXRvciB0byBkaXNwbGF5IHRoZSByZXN1bHRzIGluLlxuICogQHBhcmFtIHtNYXJrZXJTdG9yZX0gc3RvcmUubWFya2VycyAtIFNob3VsZCBhbG1vc3QgYWx3YXlzIGJlIHRoZSBlZGl0b3IncyBgTWFya2VyU3RvcmVgXG4gKiBAcGFyYW0ge09iamVjdH0gYnVuZGxlIC0gVGhlIGJ1bmRsZSB0byBkaXNwbGF5LlxuICogQHBhcmFtIHtPYmplY3RbXX0gYnVuZGxlLm91dHB1dHMgLSBUaGUgS2VybmVsIFJlc3BvbnNlcyB0byBkaXNwbGF5LlxuICogQHBhcmFtIHtOdW1iZXJ9IGJ1bmRsZS5yb3cgLSBUaGUgZWRpdG9yIHJvdyB0byBkaXNwbGF5IHRoZSByZXN1bHRzIG9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW1wb3J0UmVzdWx0KFxuICB7XG4gICAgZWRpdG9yLFxuICAgIG1hcmtlcnMsXG4gIH06IHtcbiAgICBlZGl0b3I6IFRleHRFZGl0b3IgfCBudWxsIHwgdW5kZWZpbmVkO1xuICAgIG1hcmtlcnM6IE1hcmtlclN0b3JlIHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgfSxcbiAge1xuICAgIG91dHB1dHMsXG4gICAgcm93LFxuICB9OiB7XG4gICAgb3V0cHV0czogQXJyYXk8UmVjb3JkPHN0cmluZywgYW55Pj47XG4gICAgcm93OiBudW1iZXI7XG4gIH1cbikge1xuICBpZiAoIWVkaXRvciB8fCAhbWFya2Vycykge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB7IG91dHB1dFN0b3JlIH0gPSBuZXcgUmVzdWx0VmlldyhcbiAgICBtYXJrZXJzLFxuICAgIG51bGwsXG4gICAgZWRpdG9yLFxuICAgIHJvdyxcbiAgICB0cnVlIC8vIEFsd2F5cyBzaG93IGlubGluZVxuICApO1xuXG4gIGZvciAoY29uc3Qgb3V0cHV0IG9mIG91dHB1dHMpIHtcbiAgICBvdXRwdXRTdG9yZS5hcHBlbmRPdXRwdXQob3V0cHV0KTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFycyBhIFJlc3VsdFZpZXcgb3Igc2VsZWN0aW9uIG9mIFJlc3VsdFZpZXdzLiBUbyBzZWxlY3QgYSByZXN1bHQgdG8gY2xlYXIsXG4gKiBwdXQgeW91ciBjdXJzb3Igb24gdGhlIHJvdyBvbiB0aGUgUmVzdWx0Vmlldy4gVG8gc2VsZWN0IG11bHRpcGxlIFJlc3VsdFZpZXdzLFxuICogc2VsZWN0IHRleHQgc3RhcnRpbmcgb24gdGhlIHJvdyBvZiB0aGUgZmlyc3QgUmVzdWx0VmlldyB0byByZW1vdmUgYWxsIHRoZSB3YXlcbiAqIHRvIHRleHQgb24gdGhlIHJvdyBvZiB0aGUgbGFzdCBSZXN1bHRWaWV3IHRvIHJlbW92ZS4gKlRoaXMgbXVzdCBiZSBvbmVcbiAqIHNlbGVjdGlvbiBhbmQgdGhlIGxhc3Qgc2VsZWN0aW9uIG1hZGUqXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHN0b3JlIC0gR2xvYmFsIEh5ZHJvZ2VuIFN0b3JlXG4gKiBAcGFyYW0ge1RleHRFZGl0b3J9IHN0b3JlLmVkaXRvciAtIFRleHRFZGl0b3IgYXNzb2NpYXRlZCB3aXRoIHRoZSBSZXN1bHRWaWV3LlxuICogQHBhcmFtIHtNYXJrZXJTdG9yZX0gc3RvcmUubWFya2VycyAtIE1hcmtlclN0b3JlIHRoYXQgYmVsb25ncyB0b1xuICogICBgc3RvcmUuZWRpdG9yYCBhbmQgdGhlIFJlc3VsdFZpZXcuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclJlc3VsdCh7XG4gIGVkaXRvcixcbiAgbWFya2Vycyxcbn06IFJlYWRvbmx5PHtcbiAgZWRpdG9yOiBUZXh0RWRpdG9yIHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgbWFya2VyczogTWFya2VyU3RvcmUgfCBudWxsIHwgdW5kZWZpbmVkO1xufT4pIHtcbiAgaWYgKCFlZGl0b3IgfHwgIW1hcmtlcnMpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgW3N0YXJ0Um93LCBlbmRSb3ddID0gZWRpdG9yLmdldExhc3RTZWxlY3Rpb24oKS5nZXRCdWZmZXJSb3dSYW5nZSgpO1xuXG4gIGZvciAobGV0IHJvdyA9IHN0YXJ0Um93OyByb3cgPD0gZW5kUm93OyByb3crKykge1xuICAgIG1hcmtlcnMuY2xlYXJPblJvdyhyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ2xlYXJzIGFsbCBSZXN1bHRWaWV3cyBvZiBhIE1hcmtlclN0b3JlLiBJdCBhbHNvIGNsZWFycyB0aGUgY3VycmVjdCBrZXJuZWwgcmVzdWx0cy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gc3RvcmUgLSBHbG9iYWwgSHlkcm9nZW4gU3RvcmVcbiAqIEBwYXJhbSB7S2VybmVsfSBzdG9yZS5rZXJuZWwgLSBLZXJuZWwgdG8gY2xlYXIgb3V0cHV0cy5cbiAqIEBwYXJhbSB7TWFya2VyU3RvcmV9IHN0b3JlLm1hcmtlcnMgLSBNYXJrZXJTdG9yZSB0byBjbGVhci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyUmVzdWx0cyh7XG4gIGtlcm5lbCxcbiAgbWFya2Vycyxcbn06IFJlYWRvbmx5PHtcbiAga2VybmVsOiBLZXJuZWwgfCBudWxsIHwgdW5kZWZpbmVkO1xuICBtYXJrZXJzOiBNYXJrZXJTdG9yZSB8IG51bGwgfCB1bmRlZmluZWQ7XG59Pikge1xuICBpZiAobWFya2Vycykge1xuICAgIG1hcmtlcnMuY2xlYXIoKTtcbiAgfVxuICBpZiAoIWtlcm5lbCkge1xuICAgIHJldHVybjtcbiAgfVxuICBrZXJuZWwub3V0cHV0U3RvcmUuY2xlYXIoKTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHN0cmluZyBvZiByYXcgbWFya2Rvd24gdG8gYSBkaXNwbGF5X2RhdGEgS2VybmVsIFJlc3BvbnNlLiBUaGlzXG4gKiBhbGxvd3MgZm9yIGh5ZHJvZ2VuIHRvIGRpc3BsYXkgbWFya2Rvd24gdGV4dCBhcyBpZiBpcyB3YXMgYW55IG5vcm1hbCByZXN1bHRcbiAqIHRoYXQgY2FtZSBiYWNrIGZyb20gdGhlIGtlcm5lbC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbWFya2Rvd25TdHJpbmcgLSBBIHN0cmluZyBvZiByYXcgbWFya2Rvd24gY29kZS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IEEgZmFrZSBkaXNwbGF5X2RhdGEgS2VybmVsIFJlc3BvbnNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY29udmVydE1hcmtkb3duVG9PdXRwdXQobWFya2Rvd25TdHJpbmc6IHN0cmluZykge1xuICByZXR1cm4ge1xuICAgIG91dHB1dF90eXBlOiBcImRpc3BsYXlfZGF0YVwiLFxuICAgIGRhdGE6IHtcbiAgICAgIFwidGV4dC9tYXJrZG93blwiOiBtYXJrZG93blN0cmluZyxcbiAgICB9LFxuICAgIG1ldGFkYXRhOiB7fSxcbiAgfTtcbn1cbiJdfQ==