{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../services/src/builder/index.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport {\n  PageConfig, URLExt\n} from '@jupyterlab/coreutils';\n\nimport {\n  ServerConnection\n} from '../serverconnection';\n\n\n/**\n * The url for the lab build service.\n */\nconst BUILD_SETTINGS_URL = 'lab/api/build';\n\n\n/**\n * The static namespace for `BuildManager`.\n */\nexport\nclass BuildManager {\n  /**\n   * Create a new setting manager.\n   */\n  constructor(options: BuildManager.IOptions = { }) {\n    this.serverSettings = options.serverSettings ||\n      ServerConnection.makeSettings();\n  }\n\n  /**\n   * The server settings used to make API requests.\n   */\n  readonly serverSettings: ServerConnection.ISettings;\n\n  /**\n   * Test whether the build service is available.\n   */\n  get isAvailable(): boolean {\n    return PageConfig.getOption('buildAvailable').toLowerCase() === 'true';\n  }\n\n  /**\n   * Test whether to check build status automatically.\n   */\n  get shouldCheck(): boolean {\n    return PageConfig.getOption('buildCheck').toLowerCase() === 'true';\n  }\n\n  /**\n   * Get whether the application should be built.\n   */\n  getStatus(): Promise<BuildManager.IStatus> {\n    const base = this.serverSettings.baseUrl;\n    const url = URLExt.join(base, BUILD_SETTINGS_URL);\n    const request = { method: 'GET', url };\n    const { serverSettings } = this;\n    const promise = ServerConnection.makeRequest(request, serverSettings);\n\n    return promise.then(response => {\n      const { status } = response.xhr;\n\n      if (status !== 200) {\n        throw ServerConnection.makeError(response);\n      }\n\n      let data = response.data as BuildManager.IStatus;\n      if (typeof data.status !== 'string') {\n        throw ServerConnection.makeError(response, 'Invalid data');\n      }\n      if (typeof data.message !== 'string') {\n        throw ServerConnection.makeError(response, 'Invalid data');\n      }\n      return data;\n\n    }).catch(reason => { throw ServerConnection.makeError(reason); });\n  }\n\n  /**\n   * Build the application.\n   */\n  build(): Promise<void> {\n    const base = this.serverSettings.baseUrl;\n    const url = URLExt.join(base, BUILD_SETTINGS_URL);\n    const request = { method: 'POST', url, contentType: 'application/json' };\n    const { serverSettings } = this;\n    const promise = ServerConnection.makeRequest(request, serverSettings);\n\n    return promise.then(response => {\n      const { status } = response.xhr;\n\n      if (status !== 200) {\n        throw ServerConnection.makeError(response);\n      }\n\n    }).catch(reason => {\n      let message = 'Build failed, please run `jupyter lab build` on the server for full output';\n      if (reason.xhr.status === 400) {\n        message = 'Build aborted';\n      }\n      throw ServerConnection.makeError(reason, message);\n    });\n  }\n\n  /**\n   * Cancel an active build.\n   */\n  cancel(): Promise<void> {\n    const base = this.serverSettings.baseUrl;\n    const url = URLExt.join(base, BUILD_SETTINGS_URL);\n    const request = { method: 'DELETE', url };\n    const { serverSettings } = this;\n    const promise = ServerConnection.makeRequest(request, serverSettings);\n\n    return promise.then(response => {\n      const { status } = response.xhr;\n\n      if (status !== 204) {\n        throw ServerConnection.makeError(response);\n      }\n\n    }).catch(reason => { throw ServerConnection.makeError(reason); });\n  }\n}\n\n\n/**\n * A namespace for `BuildManager` statics.\n */\nexport\nnamespace BuildManager {\n  /**\n   * The instantiation options for a setting manager.\n   */\n  export\n  interface IOptions {\n    /**\n     * The server settings used to make API requests.\n     */\n    serverSettings?: ServerConnection.ISettings;\n  }\n\n  /**\n   * The build status response from the server.\n   */\n  export\n  interface IStatus {\n    /**\n     * Whether a build is needed.\n     */\n    readonly status: 'stable' | 'needed' | 'building';\n\n    /**\n     * The message associated with the build status.\n     */\n    readonly message: string;\n  }\n}\n\n\n/**\n * A namespace for builder API interfaces.\n */\nexport\nnamespace Builder {\n  /**\n   * The interface for the build manager.\n   */\n  export\n  interface IManager extends BuildManager { }\n}\n"]}