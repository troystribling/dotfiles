"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var vega_util_1 = require("vega-util");
var compositemark_1 = require("./compositemark");
var index_1 = require("./compositemark/index");
var guide_1 = require("./guide");
var legend_1 = require("./legend");
var mark_1 = require("./mark");
var mark = tslib_1.__importStar(require("./mark"));
var scale_1 = require("./scale");
var selection_1 = require("./selection");
var title_1 = require("./title");
var util_1 = require("./util");
exports.defaultViewConfig = {
    width: 200,
    height: 200
};
exports.defaultConfig = {
    padding: 5,
    timeFormat: '',
    countTitle: 'Number of Records',
    invalidValues: 'filter',
    view: exports.defaultViewConfig,
    mark: mark.defaultMarkConfig,
    area: {},
    bar: mark.defaultBarConfig,
    circle: {},
    geoshape: {},
    line: {},
    point: {},
    rect: {},
    rule: { color: 'black' },
    square: {},
    text: { color: 'black' },
    tick: mark.defaultTickConfig,
    trail: {},
    box: { size: 14, extent: 1.5 },
    boxWhisker: {},
    boxMid: { color: 'white' },
    scale: scale_1.defaultScaleConfig,
    projection: {},
    axis: {},
    axisX: {},
    axisY: { minExtent: 30 },
    axisLeft: {},
    axisRight: {},
    axisTop: {},
    axisBottom: {},
    axisBand: {},
    legend: legend_1.defaultLegendConfig,
    selection: selection_1.defaultConfig,
    style: {},
    title: {},
};
function initConfig(config) {
    return util_1.mergeDeep(util_1.duplicate(exports.defaultConfig), config);
}
exports.initConfig = initConfig;
var MARK_STYLES = ['view'].concat(mark_1.PRIMITIVE_MARKS, compositemark_1.COMPOSITE_MARK_STYLES);
var VL_ONLY_CONFIG_PROPERTIES = [
    'padding', 'numberFormat', 'timeFormat', 'countTitle',
    'stack', 'scale', 'selection', 'invalidValues',
    'overlay' // FIXME: Redesign and unhide this
];
var VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX = tslib_1.__assign({ view: ['width', 'height'] }, mark_1.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX, index_1.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);
function stripAndRedirectConfig(config) {
    config = util_1.duplicate(config);
    for (var _i = 0, VL_ONLY_CONFIG_PROPERTIES_1 = VL_ONLY_CONFIG_PROPERTIES; _i < VL_ONLY_CONFIG_PROPERTIES_1.length; _i++) {
        var prop = VL_ONLY_CONFIG_PROPERTIES_1[_i];
        delete config[prop];
    }
    // Remove Vega-Lite only axis/legend config
    if (config.axis) {
        for (var _a = 0, VL_ONLY_GUIDE_CONFIG_1 = guide_1.VL_ONLY_GUIDE_CONFIG; _a < VL_ONLY_GUIDE_CONFIG_1.length; _a++) {
            var prop = VL_ONLY_GUIDE_CONFIG_1[_a];
            delete config.axis[prop];
        }
    }
    if (config.legend) {
        for (var _b = 0, VL_ONLY_GUIDE_CONFIG_2 = guide_1.VL_ONLY_GUIDE_CONFIG; _b < VL_ONLY_GUIDE_CONFIG_2.length; _b++) {
            var prop = VL_ONLY_GUIDE_CONFIG_2[_b];
            delete config.legend[prop];
        }
    }
    // Remove Vega-Lite only generic mark config
    if (config.mark) {
        for (var _c = 0, VL_ONLY_MARK_CONFIG_PROPERTIES_1 = mark_1.VL_ONLY_MARK_CONFIG_PROPERTIES; _c < VL_ONLY_MARK_CONFIG_PROPERTIES_1.length; _c++) {
            var prop = VL_ONLY_MARK_CONFIG_PROPERTIES_1[_c];
            delete config.mark[prop];
        }
    }
    for (var _d = 0, MARK_STYLES_1 = MARK_STYLES; _d < MARK_STYLES_1.length; _d++) {
        var markType = MARK_STYLES_1[_d];
        // Remove Vega-Lite-only mark config
        for (var _e = 0, VL_ONLY_MARK_CONFIG_PROPERTIES_2 = mark_1.VL_ONLY_MARK_CONFIG_PROPERTIES; _e < VL_ONLY_MARK_CONFIG_PROPERTIES_2.length; _e++) {
            var prop = VL_ONLY_MARK_CONFIG_PROPERTIES_2[_e];
            delete config[markType][prop];
        }
        // Remove Vega-Lite only mark-specific config
        var vlOnlyMarkSpecificConfigs = VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[markType];
        if (vlOnlyMarkSpecificConfigs) {
            for (var _f = 0, vlOnlyMarkSpecificConfigs_1 = vlOnlyMarkSpecificConfigs; _f < vlOnlyMarkSpecificConfigs_1.length; _f++) {
                var prop = vlOnlyMarkSpecificConfigs_1[_f];
                delete config[markType][prop];
            }
        }
        // Redirect mark config to config.style so that mark config only affect its own mark type
        // without affecting other marks that share the same underlying Vega marks.
        // For example, config.rect should not affect bar marks.
        redirectConfig(config, markType);
    }
    // Redirect config.title -- so that title config do not
    // affect header labels, which also uses `title` directive to implement.
    redirectConfig(config, 'title', 'group-title');
    // Remove empty config objects
    for (var prop in config) {
        if (vega_util_1.isObject(config[prop]) && util_1.keys(config[prop]).length === 0) {
            delete config[prop];
        }
    }
    return util_1.keys(config).length > 0 ? config : undefined;
}
exports.stripAndRedirectConfig = stripAndRedirectConfig;
function redirectConfig(config, prop, toProp) {
    var propConfig = prop === 'title' ? title_1.extractTitleConfig(config.title).mark : config[prop];
    if (prop === 'view') {
        toProp = 'cell'; // View's default style is "cell"
    }
    var style = tslib_1.__assign({}, propConfig, config.style[prop]);
    // set config.style if it is not an empty object
    if (util_1.keys(style).length > 0) {
        config.style[toProp || prop] = style;
    }
    delete config[prop];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1Q0FBbUM7QUFFbkMsaURBQXNEO0FBQ3RELCtDQUEySTtBQUMzSSxpQ0FBNkM7QUFDN0MsbUNBQTJEO0FBQzNELCtCQUE0STtBQUM1SSxtREFBK0I7QUFFL0IsaUNBQXdEO0FBQ3hELHlDQUFxRjtBQUVyRixpQ0FBMkM7QUFFM0MsK0JBQWtEO0FBb0ZyQyxRQUFBLGlCQUFpQixHQUFlO0lBQzNDLEtBQUssRUFBRSxHQUFHO0lBQ1YsTUFBTSxFQUFFLEdBQUc7Q0FDWixDQUFDO0FBNEhXLFFBQUEsYUFBYSxHQUFXO0lBQ25DLE9BQU8sRUFBRSxDQUFDO0lBQ1YsVUFBVSxFQUFFLEVBQUU7SUFDZCxVQUFVLEVBQUUsbUJBQW1CO0lBRS9CLGFBQWEsRUFBRSxRQUFRO0lBRXZCLElBQUksRUFBRSx5QkFBaUI7SUFFdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUI7SUFDNUIsSUFBSSxFQUFFLEVBQUU7SUFDUixHQUFHLEVBQUUsSUFBSSxDQUFDLGdCQUFnQjtJQUMxQixNQUFNLEVBQUUsRUFBRTtJQUNWLFFBQVEsRUFBRSxFQUFFO0lBQ1osSUFBSSxFQUFFLEVBQUU7SUFDUixLQUFLLEVBQUUsRUFBRTtJQUNULElBQUksRUFBRSxFQUFFO0lBQ1IsSUFBSSxFQUFFLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQztJQUN0QixNQUFNLEVBQUUsRUFBRTtJQUNWLElBQUksRUFBRSxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUM7SUFDdEIsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUI7SUFDNUIsS0FBSyxFQUFFLEVBQUU7SUFFVCxHQUFHLEVBQUUsRUFBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUM7SUFDNUIsVUFBVSxFQUFFLEVBQUU7SUFDZCxNQUFNLEVBQUUsRUFBQyxLQUFL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Syx3QkFDTixVQUFVLEVBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FDdEIsQ0FBQztJQUNGLGdEQUFnRDtJQUNoRCxJQUFJLFdBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztLQUN0QztJQUNELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2lzT2JqZWN0fSBmcm9tICd2ZWdhLXV0aWwnO1xuaW1wb3J0IHtBeGlzQ29uZmlnTWl4aW5zfSBmcm9tICcuL2F4aXMnO1xuaW1wb3J0IHtDT01QT1NJVEVfTUFSS19TVFlMRVN9IGZyb20gJy4vY29tcG9zaXRlbWFyayc7XG5pbXBvcnQge0NvbXBvc2l0ZU1hcmtDb25maWdNaXhpbnMsIENvbXBvc2l0ZU1hcmtTdHlsZSwgVkxfT05MWV9DT01QT1NJVEVfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVh9IGZyb20gJy4vY29tcG9zaXRlbWFyay9pbmRleCc7XG5pbXBvcnQge1ZMX09OTFlfR1VJREVfQ09ORklHfSBmcm9tICcuL2d1aWRlJztcbmltcG9ydCB7ZGVmYXVsdExlZ2VuZENvbmZpZywgTGVnZW5kQ29uZmlnfSBmcm9tICcuL2xlZ2VuZCc7XG5pbXBvcnQge01hcmssIE1hcmtDb25maWdNaXhpbnMsIFBSSU1JVElWRV9NQVJLUywgVkxfT05MWV9NQVJLX0NPTkZJR19QUk9QRVJUSUVTLCBWTF9PTkxZX01BUktfU1BFQ0lGSUNfQ09ORklHX1BST1BFUlRZX0lOREVYfSBmcm9tICcuL21hcmsnO1xuaW1wb3J0ICogYXMgbWFyayBmcm9tICcuL21hcmsnO1xuaW1wb3J0IHtQcm9qZWN0aW9uQ29uZmlnfSBmcm9tICcuL3Byb2plY3Rpb24nO1xuaW1wb3J0IHtkZWZhdWx0U2NhbGVDb25maWcsIFNjYWxlQ29uZmlnfSBmcm9tICcuL3NjYWxlJztcbmltcG9ydCB7ZGVmYXVsdENvbmZpZyBhcyBkZWZhdWx0U2VsZWN0aW9uQ29uZmlnLCBTZWxlY3Rpb25Db25maWd9IGZyb20gJy4vc2VsZWN0aW9uJztcbmltcG9ydCB7U3RhY2tPZmZzZXR9IGZyb20gJy4vc3RhY2snO1xuaW1wb3J0IHtleHRyYWN0VGl0bGVDb25maWd9IGZyb20gJy4vdGl0bGUnO1xuaW1wb3J0IHtUb3BMZXZlbFByb3BlcnRpZXN9IGZyb20gJy4vdG9wbGV2ZWxwcm9wcyc7XG5pbXBvcnQge2R1cGxpY2F0ZSwga2V5cywgbWVyZ2VEZWVwfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHtWZ01hcmtDb25maWcsIFZnU2NoZW1lLCBWZ1RpdGxlQ29uZmlnfSBmcm9tICcuL3ZlZ2Euc2NoZW1hJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIFZpZXdDb25maWcge1xuICAvKipcbiAgICogVGhlIGRlZmF1bHQgd2lkdGggb2YgdGhlIHNpbmdsZSBwbG90IG9yIGVhY2ggcGxvdCBpbiBhIHRyZWxsaXMgcGxvdCB3aGVuIHRoZSB2aXN1YWxpemF0aW9uIGhhcyBhIGNvbnRpbnVvdXMgKG5vbi1vcmRpbmFsKSB4LXNjYWxlIG9yIG9yZGluYWwgeC1zY2FsZSB3aXRoIGByYW5nZVN0ZXBgID0gYG51bGxgLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gYDIwMGBcbiAgICpcbiAgICovXG4gIHdpZHRoPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgZGVmYXVsdCBoZWlnaHQgb2YgdGhlIHNpbmdsZSBwbG90IG9yIGVhY2ggcGxvdCBpbiBhIHRyZWxsaXMgcGxvdCB3aGVuIHRoZSB2aXN1YWxpemF0aW9uIGhhcyBhIGNvbnRpbnVvdXMgKG5vbi1vcmRpbmFsKSB5LXNjYWxlIHdpdGggYHJhbmdlU3RlcGAgPSBgbnVsbGAuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyBgMjAwYFxuICAgKlxuICAgKi9cbiAgaGVpZ2h0PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB2aWV3IHNob3VsZCBiZSBjbGlwcGVkLlxuICAgKi9cbiAgY2xpcD86IGJvb2xlYW47XG5cbiAgLy8gRklMTF9TVFJPS0VfQ09ORklHXG4gIC8qKlxuICAgKiBUaGUgZmlsbCBjb2xvci5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIChub25lKVxuICAgKlxuICAgKi9cbiAgZmlsbD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpbGwgb3BhY2l0eSAodmFsdWUgYmV0d2VlbiBbMCwxXSkuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIGZpbGxPcGFjaXR5PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgc3Ryb2tlIGNvbG9yLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gKG5vbmUpXG4gICAqXG4gICAqL1xuICBzdHJva2U/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJva2Ugb3BhY2l0eSAodmFsdWUgYmV0d2VlbiBbMCwxXSkuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIHN0cm9rZU9wYWNpdHk/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJva2Ugd2lkdGgsIGluIHBpeGVscy5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIChub25lKVxuICAgKlxuICAgKi9cbiAgc3Ryb2tlV2lkdGg/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEFuIGFycmF5IG9mIGFsdGVybmF0aW5nIHN0cm9rZSwgc3BhY2UgbGVuZ3RocyBmb3IgY3JlYXRpbmcgZGFzaGVkIG9yIGRvdHRlZCBsaW5lcy5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIChub25lKVxuICAgKlxuICAgKi9cbiAgc3Ryb2tlRGFzaD86IG51bWJlcltdO1xuXG4gIC8qKlxuICAgKiBUaGUgb2Zmc2V0IChpbiBwaXhlbHMpIGludG8gd2hpY2ggdG8gYmVnaW4gZHJhd2luZyB3aXRoIHRoZSBzdHJva2UgZGFzaCBhcnJheS5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIChub25lKVxuICAgKlxuICAgKi9cbiAgc3Ryb2tlRGFzaE9mZnNldD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRWaWV3Q29uZmlnOiBWaWV3Q29uZmlnID0ge1xuICB3aWR0aDogMjAwLFxuICBoZWlnaHQ6IDIwMFxufTtcblxuZXhwb3J0IHR5cGUgUmFuZ2VDb25maWdWYWx1ZSA9IChudW1iZXJ8c3RyaW5nKVtdIHwgVmdTY2hlbWUgfCB7c3RlcDogbnVtYmVyfTtcblxuZXhwb3J0IHR5cGUgUmFuZ2VDb25maWcgPSBSYW5nZUNvbmZpZ1Byb3BzICYge1tuYW1lOiBzdHJpbmddOiBSYW5nZUNvbmZpZ1ZhbHVlfTtcblxuZXhwb3J0IGludGVyZmFjZSBSYW5nZUNvbmZpZ1Byb3BzIHtcbiAgLyoqXG4gICAqIERlZmF1bHQgcmFuZ2UgZm9yIF9ub21pbmFsXyAoY2F0ZWdvcmljYWwpIGZpZWxkcy5cbiAgICovXG4gIGNhdGVnb3J5Pzogc3RyaW5nW10gfCBWZ1NjaGVtZTtcblxuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBmb3IgZGl2ZXJnaW5nIF9xdWFudGl0YXRpdmVfIGZpZWxkcy5cbiAgICovXG4gIGRpdmVyZ2luZz86IHN0cmluZ1tdIHwgVmdTY2hlbWU7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgcmFuZ2UgZm9yIF9xdWFudGl0YXRpdmVfIGhlYXRtYXBzLlxuICAgKi9cbiAgaGVhdG1hcD86IHN0cmluZ1tdIHwgVmdTY2hlbWU7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgcmFuZ2UgZm9yIF9vcmRpbmFsXyBmaWVsZHMuXG4gICAqL1xuICBvcmRpbmFsPzogc3RyaW5nW10gfCBWZ1NjaGVtZTtcblxuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBmb3IgX3F1YW50aXRhdGl2ZV8gYW5kIF90ZW1wb3JhbF8gZmllbGRzLlxuICAgKi9cbiAgcmFtcD86IHN0cmluZ1tdIHwgVmdTY2hlbWU7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgcmFuZ2UgcGFsZXR0ZSBmb3IgdGhlIGBzaGFwZWAgY2hhbm5lbC5cbiAgICovXG4gIHN5bWJvbD86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZMT25seUNvbmZpZyB7XG4gIC8qKlxuICAgKiBEZWZhdWx0IGF4aXMgYW5kIGxlZ2VuZCB0aXRsZSBmb3IgY291bnQgZmllbGRzLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gYCdOdW1iZXIgb2YgUmVjb3JkcydgLlxuICAgKlxuICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgKi9cbiAgY291bnRUaXRsZT86IHN0cmluZztcblxuICAvKipcbiAgICogRGVmaW5lcyBob3cgVmVnYS1MaXRlIHNob3VsZCBoYW5kbGUgaW52YWxpZCB2YWx1ZXMgKGBudWxsYCBhbmQgYE5hTmApLlxuICAgKiAtIElmIHNldCB0byBgXCJmaWx0ZXJcImAgKGRlZmF1bHQpLCBhbGwgZGF0YSBpdGVtcyB3aXRoIG51bGwgdmFsdWVzIHdpbGwgYmUgc2tpcHBlZCAoZm9yIGxpbmUsIHRyYWlsLCBhbmQgYXJlYSBtYXJrcykgb3IgZmlsdGVyZWQgKGZvciBvdGhlciBtYXJrcykuXG4gICAqIC0gSWYgYG51bGxgLCBhbGwgZGF0YSBpdGVtcyBhcmUgaW5jbHVkZWQuIEluIHRoaXMgY2FzZSwgaW52YWxpZCB2YWx1ZXMgd2lsbCBiZSBpbnRlcnByZXRlZCBhcyB6ZXJvZXMuXG4gICAqL1xuICBpbnZhbGlkVmFsdWVzPzogJ2ZpbHRlcicgfCBudWxsO1xuXG4gIC8qKlxuICAgKiBEZWZpbmVzIGhvdyBWZWdhLUxpdGUgZ2VuZXJhdGVzIHRpdGxlIGZvciBmaWVsZHMuICBUaGVyZSBhcmUgdGhyZWUgcG9zc2libGUgc3R5bGVzOlxuICAgKiAtIGBcInZlcmJhbFwiYCAoRGVmYXVsdCkgLSBkaXNwbGF5cyBmdW5jdGlvbiBpbiBhIHZlcmJhbCBzdHlsZSAoZS5nLiwgXCJTdW0gb2YgZmllbGRcIiwgXCJZZWFyLW1vbnRoIG9mIGRhdGVcIiwgXCJmaWVsZCAoYmlubmVkKVwiKS5cbiAgICogLSBgXCJmdW5jdGlvblwiYCAtIGRpc3BsYXlzIGZ1bmN0aW9uIHVzaW5nIHBhcmVudGhlc2VzIGFuZCBjYXBpdGFsaXplZCB0ZXh0cyAoZS5nLiwgXCJTVU0oZmllbGQpXCIsIFwiWUVBUk1PTlRIKGRhdGUpXCIsIFwiQklOKGZpZWxkKVwiKS5cbiAgICogLSBgXCJwbGFpblwiYCAtIGRpc3BsYXlzIG9ubHkgdGhlIGZpZWxkIG5hbWUgd2l0aG91dCBmdW5jdGlvbnMgKGUuZy4sIFwiZmllbGRcIiwgXCJkYXRlXCIsIFwiZmllbGRcIikuXG4gICAqL1xuICBmaWVsZFRpdGxlPzogJ3ZlcmJhbCcgfCAnZnVuY3Rpb25hbCcgfCAncGxhaW4nO1xuXG4gIC8qKlxuICAgKiBEMyBOdW1iZXIgZm9ybWF0IGZvciBheGlzIGxhYmVscyBhbmQgdGV4dCB0YWJsZXMuIEZvciBleGFtcGxlIFwic1wiIGZvciBTSSB1bml0cy4gVXNlIFtEMydzIG51bWJlciBmb3JtYXQgcGF0dGVybl0oaHR0cHM6Ly9naXRodWIuY29tL2QzL2QzLWZvcm1hdCNsb2NhbGVfZm9ybWF0KS5cbiAgICovXG4gIG51bWJlckZvcm1hdD86IHN0cmluZztcblxuICAvKipcbiAgICogRGVmYXVsdCBkYXRldGltZSBmb3JtYXQgZm9yIGF4aXMgYW5kIGxlZ2VuZCBsYWJlbHMuIFRoZSBmb3JtYXQgY2FuIGJlIHNldCBkaXJlY3RseSBvbiBlYWNoIGF4aXMgYW5kIGxlZ2VuZC4gVXNlIFtEMydzIHRpbWUgZm9ybWF0IHBhdHRlcm5dKGh0dHBzOi8vZ2l0aHViLmNvbS9kMy9kMy10aW1lLWZvcm1hdCNsb2NhbGVfZm9ybWF0KS5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIGAnJ2AgKFRoZSBmb3JtYXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGRldGVybWluZWQpLlxuICAgKlxuICAgKi9cbiAgdGltZUZvcm1hdD86IHN0cmluZztcblxuXG4gIC8qKiBEZWZhdWx0IHByb3BlcnRpZXMgZm9yIFtzaW5nbGUgdmlldyBwbG90c10oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zcGVjLmh0bWwjc2luZ2xlKS4gKi9cbiAgdmlldz86IFZpZXdDb25maWc7XG5cbiAgLyoqXG4gICAqIFNjYWxlIGNvbmZpZ3VyYXRpb24gZGV0ZXJtaW5lcyBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGFsbCBbc2NhbGVzXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NjYWxlLmh0bWwpLiBGb3IgYSBmdWxsIGxpc3Qgb2Ygc2NhbGUgY29uZmlndXJhdGlvbiBvcHRpb25zLCBwbGVhc2Ugc2VlIHRoZSBbY29ycmVzcG9uZGluZyBzZWN0aW9uIG9mIHRoZSBzY2FsZSBkb2N1bWVudGF0aW9uXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NjYWxlLmh0bWwjY29uZmlnKS5cbiAgICovXG4gIHNjYWxlPzogU2NhbGVDb25maWc7XG5cbiAgLyoqIEFuIG9iamVjdCBoYXNoIGZvciBkZWZpbmluZyBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGVhY2ggdHlwZSBvZiBzZWxlY3Rpb25zLiAqL1xuICBzZWxlY3Rpb24/OiBTZWxlY3Rpb25Db25maWc7XG5cbiAgLyoqIERlZmF1bHQgc3RhY2sgb2Zmc2V0IGZvciBzdGFja2FibGUgbWFyay4gKi9cbiAgc3RhY2s/OiBTdGFja09mZnNldDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdHlsZUNvbmZpZ0luZGV4IHtcbiAgW3N0eWxlOiBzdHJpbmddOiBWZ01hcmtDb25maWc7XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWcgZXh0ZW5kcyBUb3BMZXZlbFByb3BlcnRpZXMsIFZMT25seUNvbmZpZywgTWFya0NvbmZpZ01peGlucywgQ29tcG9zaXRlTWFya0NvbmZpZ01peGlucywgQXhpc0NvbmZpZ01peGlucyB7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBoYXNoIHRoYXQgZGVmaW5lcyBkZWZhdWx0IHJhbmdlIGFycmF5cyBvciBzY2hlbWVzIGZvciB1c2luZyB3aXRoIHNjYWxlcy5cbiAgICogRm9yIGEgZnVsbCBsaXN0IG9mIHNjYWxlIHJhbmdlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucywgcGxlYXNlIHNlZSB0aGUgW2NvcnJlc3BvbmRpbmcgc2VjdGlvbiBvZiB0aGUgc2NhbGUgZG9jdW1lbnRhdGlvbl0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zY2FsZS5odG1sI2NvbmZpZykuXG4gICAqL1xuICByYW5nZT86IFJhbmdlQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBMZWdlbmQgY29uZmlndXJhdGlvbiwgd2hpY2ggZGV0ZXJtaW5lcyBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGFsbCBbbGVnZW5kc10oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9sZWdlbmQuaHRtbCkuIEZvciBhIGZ1bGwgbGlzdCBvZiBsZWdlbmQgY29uZmlndXJhdGlvbiBvcHRpb25zLCBwbGVhc2Ugc2VlIHRoZSBbY29ycmVzcG9uZGluZyBzZWN0aW9uIG9mIGluIHRoZSBsZWdlbmQgZG9jdW1lbnRhdGlvbl0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9sZWdlbmQuaHRtbCNjb25maWcpLlxuICAgKi9cbiAgbGVnZW5kPzogTGVnZW5kQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBUaXRsZSBjb25maWd1cmF0aW9uLCB3aGljaCBkZXRlcm1pbmVzIGRlZmF1bHQgcHJvcGVydGllcyBmb3IgYWxsIFt0aXRsZXNdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3MvdGl0bGUuaHRtbCkuIEZvciBhIGZ1bGwgbGlzdCBvZiB0aXRsZSBjb25maWd1cmF0aW9uIG9wdGlvbnMsIHBsZWFzZSBzZWUgdGhlIFtjb3JyZXNwb25kaW5nIHNlY3Rpb24gb2YgdGhlIHRpdGxlIGRvY3VtZW50YXRpb25dKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3MvdGl0bGUuaHRtbCNjb25maWcpLlxuICAgKi9cbiAgdGl0bGU/OiBWZ1RpdGxlQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBQcm9qZWN0aW9uIGNvbmZpZ3VyYXRpb24sIHdoaWNoIGRldGVybWluZXMgZGVmYXVsdCBwcm9wZXJ0aWVzIGZvciBhbGwgW3Byb2plY3Rpb25zXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3Byb2plY3Rpb24uaHRtbCkuIEZvciBhIGZ1bGwgbGlzdCBvZiBwcm9qZWN0aW9uIGNvbmZpZ3VyYXRpb24gb3B0aW9ucywgcGxlYXNlIHNlZSB0aGUgW2NvcnJlc3BvbmRpbmcgc2VjdGlvbiBvZiB0aGUgcHJvamVjdGlvbiBkb2N1bWVudGF0aW9uXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3Byb2plY3Rpb24uaHRtbCNjb25maWcpLlxuICAgKi9cbiAgcHJvamVjdGlvbj86IFByb2plY3Rpb25Db25maWc7XG5cbiAgLyoqIEFuIG9iamVjdCBoYXNoIHRoYXQgZGVmaW5lcyBrZXktdmFsdWUgbWFwcGluZ3MgdG8gZGV0ZXJtaW5lIGRlZmF1bHQgcHJvcGVydGllcyBmb3IgbWFya3Mgd2l0aCBhIGdpdmVuIFtzdHlsZV0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9tYXJrLmh0bWwjbWFyay1kZWYpLiAgVGhlIGtleXMgcmVwcmVzZW50IHN0eWxlcyBuYW1lczsgdGhlIHZhbHVlcyBoYXZlIHRvIGJlIHZhbGlkIFttYXJrIGNvbmZpZ3VyYXRpb24gb2JqZWN0c10oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9tYXJrLmh0bWwjY29uZmlnKS4gICovXG4gIHN0eWxlPzogU3R5bGVDb25maWdJbmRleDtcbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb25maWc6IENvbmZpZyA9IHtcbiAgcGFkZGluZzogNSxcbiAgdGltZUZvcm1hdDogJycsXG4gIGNvdW50VGl0bGU6ICdOdW1iZXIgb2YgUmVjb3JkcycsXG5cbiAgaW52YWxpZFZhbHVlczogJ2ZpbHRlcicsXG5cbiAgdmlldzogZGVmYXVsdFZpZXdDb25maWcsXG5cbiAgbWFyazogbWFyay5kZWZhdWx0TWFya0NvbmZpZyxcbiAgYXJlYToge30sXG4gIGJhcjogbWFyay5kZWZhdWx0QmFyQ29uZmlnLFxuICBjaXJjbGU6IHt9LFxuICBnZW9zaGFwZToge30sXG4gIGxpbmU6IHt9LFxuICBwb2ludDoge30sXG4gIHJlY3Q6IHt9LFxuICBydWxlOiB7Y29sb3I6ICdibGFjayd9LCAvLyBOZWVkIHRoaXMgdG8gb3ZlcnJpZGUgZGVmYXVsdCBjb2xvciBpbiBtYXJrIGNvbmZpZ1xuICBzcXVhcmU6IHt9LFxuICB0ZXh0OiB7Y29sb3I6ICdibGFjayd9LCAvLyBOZWVkIHRoaXMgdG8gb3ZlcnJpZGUgZGVmYXVsdCBjb2xvciBpbiBtYXJrIGNvbmZpZ1xuICB0aWNrOiBtYXJrLmRlZmF1bHRUaWNrQ29uZmlnLFxuICB0cmFpbDoge30sXG5cbiAgYm94OiB7c2l6ZTogMTQsIGV4dGVudDogMS41fSxcbiAgYm94V2hpc2tlcjoge30sXG4gIGJveE1pZDoge2NvbG9yOiAnd2hpdGUnfSxcblxuICBzY2FsZTogZGVmYXVsdFNjYWxlQ29uZmlnLFxuICBwcm9qZWN0aW9uOiB7fSxcbiAgYXhpczoge30sXG4gIGF4aXNYOiB7fSxcbiAgYXhpc1k6IHttaW5FeHRlbnQ6IDMwfSxcbiAgYXhpc0xlZnQ6IHt9LFxuICBheGlzUmlnaHQ6IHt9LFxuICBheGlzVG9wOiB7fSxcbiAgYXhpc0JvdHRvbToge30sXG4gIGF4aXNCYW5kOiB7fSxcbiAgbGVnZW5kOiBkZWZhdWx0TGVnZW5kQ29uZmlnLFxuXG4gIHNlbGVjdGlvbjogZGVmYXVsdFNlbGVjdGlvbkNvbmZpZyxcbiAgc3R5bGU6IHt9LFxuXG4gIHRpdGxlOiB7fSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0Q29uZmlnKGNvbmZpZzogQ29uZmlnKSB7XG4gIHJldHVybiBtZXJnZURlZXAoZHVwbGljYXRlKGRlZmF1bHRDb25maWcpLCBjb25maWcpO1xufVxuXG5jb25zdCBNQVJLX1NUWUxFUyA9IFsndmlldyddLmNvbmNhdChQUklNSVRJVkVfTUFSS1MsIENPTVBPU0lURV9NQVJLX1NUWUxFUykgYXMgKCd2aWV3JyB8IE1hcmsgfCBDb21wb3NpdGVNYXJrU3R5bGUpW107XG5cblxuY29uc3QgVkxfT05MWV9DT05GSUdfUFJPUEVSVElFUzogKGtleW9mIENvbmZpZylbXSA9IFtcbiAgJ3BhZGRpbmcnLCAnbnVtYmVyRm9ybWF0JywgJ3RpbWVGb3JtYXQnLCAnY291bnRUaXRsZScsXG4gICdzdGFjaycsICdzY2FsZScsICdzZWxlY3Rpb24nLCAnaW52YWxpZFZhbHVlcycsXG4gICdvdmVybGF5JyBhcyBrZXlvZiBDb25maWcgLy8gRklYTUU6IFJlZGVzaWduIGFuZCB1bmhpZGUgdGhpc1xuXTtcblxuY29uc3QgVkxfT05MWV9BTExfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVggPSB7XG4gIHZpZXc6IFsnd2lkdGgnLCAnaGVpZ2h0J10sXG4gIC4uLlZMX09OTFlfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVgsXG4gIC4uLlZMX09OTFlfQ09NUE9TSVRFX01BUktfU1BFQ0lGSUNfQ09ORklHX1BST1BFUlRZX0lOREVYXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBBbmRSZWRpcmVjdENvbmZpZyhjb25maWc6IENvbmZpZykge1xuICBjb25maWcgPSBkdXBsaWNhdGUoY29uZmlnKTtcblxuICBmb3IgKGNvbnN0IHByb3Agb2YgVkxfT05MWV9DT05GSUdfUFJPUEVSVElFUykge1xuICAgIGRlbGV0ZSBjb25maWdbcHJvcF07XG4gIH1cblxuICAvLyBSZW1vdmUgVmVnYS1MaXRlIG9ubHkgYXhpcy9sZWdlbmQgY29uZmlnXG4gIGlmIChjb25maWcuYXhpcykge1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBWTF9PTkxZX0dVSURFX0NPTkZJRykge1xuICAgICAgZGVsZXRlIGNvbmZpZy5heGlzW3Byb3BdO1xuICAgIH1cbiAgfVxuICBpZiAoY29uZmlnLmxlZ2VuZCkge1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBWTF9PTkxZX0dVSURFX0NPTkZJRykge1xuICAgICAgZGVsZXRlIGNvbmZpZy5sZWdlbmRbcHJvcF07XG4gICAgfVxuICB9XG5cbiAgLy8gUmVtb3ZlIFZlZ2EtTGl0ZSBvbmx5IGdlbmVyaWMgbWFyayBjb25maWdcbiAgaWYgKGNvbmZpZy5tYXJrKSB7XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIFZMX09OTFlfTUFSS19DT05GSUdfUFJPUEVSVElFUykge1xuICAgICAgZGVsZXRlIGNvbmZpZy5tYXJrW3Byb3BdO1xuICAgIH1cbiAgfVxuXG4gIGZvciAoY29uc3QgbWFya1R5cGUgb2YgTUFSS19TVFlMRVMpIHtcbiAgICAvLyBSZW1vdmUgVmVnYS1MaXRlLW9ubHkgbWFyayBjb25maWdcbiAgICBmb3IgKGNvbnN0IHByb3Agb2YgVkxfT05MWV9NQVJLX0NPTkZJR19QUk9QRVJUSUVTKSB7XG4gICAgICBkZWxldGUgY29uZmlnW21hcmtUeXBlXVtwcm9wXTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgVmVnYS1MaXRlIG9ubHkgbWFyay1zcGVjaWZpYyBjb25maWdcbiAgICBjb25zdCB2bE9ubHlNYXJrU3BlY2lmaWNDb25maWdzID0gVkxfT05MWV9BTExfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVhbbWFya1R5cGVdO1xuICAgIGlmICh2bE9ubHlNYXJrU3BlY2lmaWNDb25maWdzKSB7XG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgdmxPbmx5TWFya1NwZWNpZmljQ29uZmlncykge1xuICAgICAgICBkZWxldGUgY29uZmlnW21hcmtUeXBlXVtwcm9wXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZWRpcmVjdCBtYXJrIGNvbmZpZyB0byBjb25maWcuc3R5bGUgc28gdGhhdCBtYXJrIGNvbmZpZyBvbmx5IGFmZmVjdCBpdHMgb3duIG1hcmsgdHlwZVxuICAgIC8vIHdpdGhvdXQgYWZmZWN0aW5nIG90aGVyIG1hcmtzIHRoYXQgc2hhcmUgdGhlIHNhbWUgdW5kZXJseWluZyBWZWdhIG1hcmtzLlxuICAgIC8vIEZvciBleGFtcGxlLCBjb25maWcucmVjdCBzaG91bGQgbm90IGFmZmVjdCBiYXIgbWFya3MuXG4gICAgcmVkaXJlY3RDb25maWcoY29uZmlnLCBtYXJrVHlwZSk7XG4gIH1cblxuICAvLyBSZWRpcmVjdCBjb25maWcudGl0bGUgLS0gc28gdGhhdCB0aXRsZSBjb25maWcgZG8gbm90XG4gIC8vIGFmZmVjdCBoZWFkZXIgbGFiZWxzLCB3aGljaCBhbHNvIHVzZXMgYHRpdGxlYCBkaXJlY3RpdmUgdG8gaW1wbGVtZW50LlxuICByZWRpcmVjdENvbmZpZyhjb25maWcsICd0aXRsZScsICdncm91cC10aXRsZScpO1xuXG4gIC8vIFJlbW92ZSBlbXB0eSBjb25maWcgb2JqZWN0c1xuICBmb3IgKGNvbnN0IHByb3AgaW4gY29uZmlnKSB7XG4gICAgaWYgKGlzT2JqZWN0KGNvbmZpZ1twcm9wXSkgJiYga2V5cyhjb25maWdbcHJvcF0pLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZGVsZXRlIGNvbmZpZ1twcm9wXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ga2V5cyhjb25maWcpLmxlbmd0aCA+IDAgPyBjb25maWcgOiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHJlZGlyZWN0Q29uZmlnKGNvbmZpZzogQ29uZmlnLCBwcm9wOiBNYXJrIHwgQ29tcG9zaXRlTWFya1N0eWxlIHwgJ3RpdGxlJyB8ICd2aWV3JywgdG9Qcm9wPzogc3RyaW5nKSB7XG4gIGNvbnN0IHByb3BDb25maWc6IFZnTWFya0NvbmZpZyA9IHByb3AgPT09ICd0aXRsZScgPyBleHRyYWN0VGl0bGVDb25maWcoY29uZmlnLnRpdGxlKS5tYXJrIDogY29uZmlnW3Byb3BdO1xuXG4gIGlmIChwcm9wID09PSAndmlldycpIHtcbiAgICB0b1Byb3AgPSAnY2VsbCc7IC8vIFZpZXcncyBkZWZhdWx0IHN0eWxlIGlzIFwiY2VsbFwiXG4gIH1cblxuICBjb25zdCBzdHlsZTogVmdNYXJrQ29uZmlnID0ge1xuICAgIC4uLnByb3BDb25maWcsXG4gICAgLi4uY29uZmlnLnN0eWxlW3Byb3BdXG4gIH07XG4gIC8vIHNldCBjb25maWcuc3R5bGUgaWYgaXQgaXMgbm90IGFuIGVtcHR5IG9iamVjdFxuICBpZiAoa2V5cyhzdHlsZSkubGVuZ3RoID4gMCkge1xuICAgIGNvbmZpZy5zdHlsZVt0b1Byb3AgfHwgcHJvcF0gPSBzdHlsZTtcbiAgfVxuICBkZWxldGUgY29uZmlnW3Byb3BdO1xufVxuIl19