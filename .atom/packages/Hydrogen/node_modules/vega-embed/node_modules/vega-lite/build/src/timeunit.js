"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var datetime_1 = require("./datetime");
var log = tslib_1.__importStar(require("./log"));
var util_1 = require("./util");
var TimeUnit;
(function (TimeUnit) {
    TimeUnit.YEAR = 'year';
    TimeUnit.MONTH = 'month';
    TimeUnit.DAY = 'day';
    TimeUnit.DATE = 'date';
    TimeUnit.HOURS = 'hours';
    TimeUnit.MINUTES = 'minutes';
    TimeUnit.SECONDS = 'seconds';
    TimeUnit.MILLISECONDS = 'milliseconds';
    TimeUnit.YEARMONTH = 'yearmonth';
    TimeUnit.YEARMONTHDATE = 'yearmonthdate';
    TimeUnit.YEARMONTHDATEHOURS = 'yearmonthdatehours';
    TimeUnit.YEARMONTHDATEHOURSMINUTES = 'yearmonthdatehoursminutes';
    TimeUnit.YEARMONTHDATEHOURSMINUTESSECONDS = 'yearmonthdatehoursminutesseconds';
    // MONTHDATE always include 29 February since we use year 0th (which is a leap year);
    TimeUnit.MONTHDATE = 'monthdate';
    TimeUnit.HOURSMINUTES = 'hoursminutes';
    TimeUnit.HOURSMINUTESSECONDS = 'hoursminutesseconds';
    TimeUnit.MINUTESSECONDS = 'minutesseconds';
    TimeUnit.SECONDSMILLISECONDS = 'secondsmilliseconds';
    TimeUnit.QUARTER = 'quarter';
    TimeUnit.YEARQUARTER = 'yearquarter';
    TimeUnit.QUARTERMONTH = 'quartermonth';
    TimeUnit.YEARQUARTERMONTH = 'yearquartermonth';
    TimeUnit.UTCYEAR = 'utcyear';
    TimeUnit.UTCMONTH = 'utcmonth';
    TimeUnit.UTCDAY = 'utcday';
    TimeUnit.UTCDATE = 'utcdate';
    TimeUnit.UTCHOURS = 'utchours';
    TimeUnit.UTCMINUTES = 'utcminutes';
    TimeUnit.UTCSECONDS = 'utcseconds';
    TimeUnit.UTCMILLISECONDS = 'utcmilliseconds';
    TimeUnit.UTCYEARMONTH = 'utcyearmonth';
    TimeUnit.UTCYEARMONTHDATE = 'utcyearmonthdate';
    TimeUnit.UTCYEARMONTHDATEHOURS = 'utcyearmonthdatehours';
    TimeUnit.UTCYEARMONTHDATEHOURSMINUTES = 'utcyearmonthdatehoursminutes';
    TimeUnit.UTCYEARMONTHDATEHOURSMINUTESSECONDS = 'utcyearmonthdatehoursminutesseconds';
    // MONTHDATE always include 29 February since we use year 0th (which is a leap year);
    TimeUnit.UTCMONTHDATE = 'utcmonthdate';
    TimeUnit.UTCHOURSMINUTES = 'utchoursminutes';
    TimeUnit.UTCHOURSMINUTESSECONDS = 'utchoursminutesseconds';
    TimeUnit.UTCMINUTESSECONDS = 'utcminutesseconds';
    TimeUnit.UTCSECONDSMILLISECONDS = 'utcsecondsmilliseconds';
    TimeUnit.UTCQUARTER = 'utcquarter';
    TimeUnit.UTCYEARQUARTER = 'utcyearquarter';
    TimeUnit.UTCQUARTERMONTH = 'utcquartermonth';
    TimeUnit.UTCYEARQUARTERMONTH = 'utcyearquartermonth';
})(TimeUnit = exports.TimeUnit || (exports.TimeUnit = {}));
/** Time Unit that only corresponds to only one part of Date objects. */
var LOCAL_SINGLE_TIMEUNIT_INDEX = {
    year: 1,
    quarter: 1,
    month: 1,
    day: 1,
    date: 1,
    hours: 1,
    minutes: 1,
    seconds: 1,
    milliseconds: 1
};
exports.TIMEUNIT_PARTS = util_1.flagKeys(LOCAL_SINGLE_TIMEUNIT_INDEX);
function isLocalSingleTimeUnit(timeUnit) {
    return !!LOCAL_SINGLE_TIMEUNIT_INDEX[timeUnit];
}
exports.isLocalSingleTimeUnit = isLocalSingleTimeUnit;
var UTC_SINGLE_TIMEUNIT_INDEX = {
    utcyear: 1,
    utcquarter: 1,
    utcmonth: 1,
    utcday: 1,
    utcdate: 1,
    utchours: 1,
    utcminutes: 1,
    utcseconds: 1,
    utcmilliseconds: 1
};
function isUtcSingleTimeUnit(timeUnit) {
    return !!UTC_SINGLE_TIMEUNIT_INDEX[timeUnit];
}
exports.isUtcSingleTimeUnit = isUtcSingleTimeUnit;
var LOCAL_MULTI_TIMEUNIT_INDEX = {
    yearquarter: 1,
    yearquartermonth: 1,
    yearmonth: 1,
    yearmonthdate: 1,
    yearmonthdatehours: 1,
    yearmonthdatehoursminutes: 1,
    yearmonthdatehoursminutesseconds: 1,
    quartermonth: 1,
    monthdate: 1,
    hoursminutes: 1,
    hoursminutesseconds: 1,
    minutesseconds: 1,
    secondsmilliseconds: 1
};
var UTC_MULTI_TIMEUNIT_INDEX = {
    utcyearquarter: 1,
    utcyearquartermonth: 1,
    utcyearmonth: 1,
    utcyearmonthdate: 1,
    utcyearmonthdatehours: 1,
    utcyearmonthdatehoursminutes: 1,
    utcyearmonthdatehoursminutesseconds: 1,
    utcquartermonth: 1,
    utcmonthdate: 1,
    utchoursminutes: 1,
    utchoursminutesseconds: 1,
    utcminutesseconds: 1,
    utcsecondsmilliseconds: 1
};
var UTC_TIMEUNIT_INDEX = tslib_1.__assign({}, UTC_SINGLE_TIMEUNIT_INDEX, UTC_MULTI_TIMEUNIT_INDEX);
function isUTCTimeUnit(t) {
    return !!UTC_TIMEUNIT_INDEX[t];
}
exports.isUTCTimeUnit = isUTCTimeUnit;
function getLocalTimeUnit(t) {
    return t.substr(3);
}
exports.getLocalTimeUnit = getLocalTimeUnit;
var TIMEUNIT_INDEX = tslib_1.__assign({}, LOCAL_SINGLE_TIMEUNIT_INDEX, UTC_SINGLE_TIMEUNIT_INDEX, LOCAL_MULTI_TIMEUNIT_INDEX, UTC_MULTI_TIMEUNIT_INDEX);
exports.TIMEUNITS = util_1.flagKeys(TIMEUNIT_INDEX);
function isTimeUnit(t) {
    return !!TIMEUNIT_INDEX[t];
}
exports.isTimeUnit = isTimeUnit;
var SET_DATE_METHOD = {
    year: 'setFullYear',
    month: 'setMonth',
    date: 'setDate',
    hours: 'setHours',
    minutes: 'setMinutes',
    seconds: 'setSeconds',
    milliseconds: 'setMilliseconds',
    // Day and quarter have their own special cases
    quarter: null,
    day: null,
};
/**
 * Converts a date to only have the measurements relevant to the specified unit
 * i.e. ('yearmonth', '2000-12-04 07:58:14') -> '2000-12-01 00:00:00'
 * Note: the base date is Jan 01 1900 00:00:00
 */
function convert(unit, date) {
    var isUTC = isUTCTimeUnit(unit);
    var result = isUTC ?
        // start with uniform date
        new Date(Date.UTC(0, 0, 1, 0, 0, 0, 0)) :
        new Date(0, 0, 1, 0, 0, 0, 0);
    for (var _i = 0, TIMEUNIT_PARTS_1 = exports.TIMEUNIT_PARTS; _i < TIMEUNIT_PARTS_1.length; _i++) {
        var timeUnitPart = TIMEUNIT_PARTS_1[_i];
        if (containsTimeUnit(unit, timeUnitPart)) {
            switch (timeUnitPart) {
                case TimeUnit.DAY:
                    throw new Error('Cannot convert to TimeUnits containing \'day\'');
                case TimeUnit.QUARTER: {
                    var _a = dateMethods('month', isUTC), getDateMethod_1 = _a.getDateMethod, setDateMethod_1 = _a.setDateMethod;
                    // indicate quarter by setting month to be the first of the quarter i.e. may (4) -> april (3)
                    result[setDateMethod_1]((Math.floor(date[getDateMethod_1]() / 3)) * 3);
                    break;
                }
                default:
                    var _b = dateMethods(timeUnitPart, isUTC), getDateMethod = _b.getDateMethod, setDateMethod = _b.setDateMethod;
                    result[setDateMethod](date[getDateMethod]());
            }
        }
    }
    return result;
}
exports.convert = convert;
function dateMethods(singleUnit, isUtc) {
    var rawSetDateMethod = SET_DATE_METHOD[singleUnit];
    var setDateMethod = isUtc ? 'setUTC' + rawSetDateMethod.substr(3) : rawSetDateMethod;
    var getDateMethod = 'get' + (isUtc ? 'UTC' : '') + rawSetDateMethod.substr(3);
    return { setDateMethod: setDateMethod, getDateMethod: getDateMethod };
}
function getTimeUnitParts(timeUnit) {
    return exports.TIMEUNIT_PARTS.reduce(function (parts, part) {
        if (containsTimeUnit(timeUnit, part)) {
            return parts.concat(part);
        }
        return parts;
    }, []);
}
exports.getTimeUnitParts = getTimeUnitParts;
/** Returns true if fullTimeUnit contains the timeUnit, false otherwise. */
function containsTimeUnit(fullTimeUnit, timeUnit) {
    var index = fullTimeUnit.indexOf(timeUnit);
    return index > -1 &&
        (timeUnit !== TimeUnit.SECONDS ||
            index === 0 ||
            fullTimeUnit.charAt(index - 1) !== 'i' // exclude milliseconds
        );
}
exports.containsTimeUnit = containsTimeUnit;
/**
 * Returns Vega expresssion for a given timeUnit and fieldRef
 */
function fieldExpr(fullTimeUnit, field) {
    var fieldRef = util_1.accessPathWithDatum(field);
    var utc = isUTCTimeUnit(fullTimeUnit) ? 'utc' : '';
    function func(timeUnit) {
        if (timeUnit === TimeUnit.QUARTER) {
            // quarter starting at 0 (0,3,6,9).
            return "(" + utc + "quarter(" + fieldRef + ")-1)";
        }
        else {
            return "" + utc + timeUnit + "(" + fieldRef + ")";
        }
    }
    var d = exports.TIMEUNIT_PARTS.reduce(function (dateExpr, tu) {
        if (containsTimeUnit(fullTimeUnit, tu)) {
            dateExpr[tu] = func(tu);
        }
        return dateExpr;
    }, {});
    return datetime_1.dateTimeExpr(d);
}
exports.fieldExpr = fieldExpr;
/**
 * returns the signal expression used for axis labels for a time unit
 */
function formatExpression(timeUnit, field, shortTimeLabels, isUTCScale) {
    if (!timeUnit) {
        return undefined;
    }
    var dateComponents = [];
    var expression = '';
    var hasYear = containsTimeUnit(timeUnit, TimeUnit.YEAR);
    if (containsTimeUnit(timeUnit, TimeUnit.QUARTER)) {
        // special expression for quarter as prefix
        expression = "'Q' + quarter(" + field + ")";
    }
    if (containsTimeUnit(timeUnit, TimeUnit.MONTH)) {
        // By default use short month name
        dateComponents.push(shortTimeLabels !== false ? '%b' : '%B');
    }
    if (containsTimeUnit(timeUnit, TimeUnit.DAY)) {
        dateComponents.push(shortTimeLabels ? '%a' : '%A');
    }
    else if (containsTimeUnit(timeUnit, TimeUnit.DATE)) {
        dateComponents.push('%d' + (hasYear ? ',' : '')); // add comma if there is year
    }
    if (hasYear) {
        dateComponents.push(shortTimeLabels ? '%y' : '%Y');
    }
    var timeComponents = [];
    if (containsTimeUnit(timeUnit, TimeUnit.HOURS)) {
        timeComponents.push('%H');
    }
    if (containsTimeUnit(timeUnit, TimeUnit.MINUTES)) {
        timeComponents.push('%M');
    }
    if (containsTimeUnit(timeUnit, TimeUnit.SECONDS)) {
        timeComponents.push('%S');
    }
    if (containsTimeUnit(timeUnit, TimeUnit.MILLISECONDS)) {
        timeComponents.push('%L');
    }
    var dateTimeComponents = [];
    if (dateComponents.length > 0) {
        dateTimeComponents.push(dateComponents.join(' '));
    }
    if (timeComponents.length > 0) {
        dateTimeComponents.push(timeComponents.join(':'));
    }
    if (dateTimeComponents.length > 0) {
        if (expression) {
            // Add space between quarter and main time format
            expression += " + ' ' + ";
        }
        // We only use utcFormat for utc scale
        // For utc time units, the data is already converted as a part of timeUnit transform.
        // Thus, utc time units should use timeFormat to avoid shifting the time twice.
        if (isUTCScale) {
            expression += "utcFormat(" + field + ", '" + dateTimeComponents.join(' ') + "')";
        }
        else {
            expression += "timeFormat(" + field + ", '" + dateTimeComponents.join(' ') + "')";
        }
    }
    // If expression is still an empty string, return undefined instead.
    return expression || undefined;
}
exports.formatExpression = formatExpression;
function normalizeTimeUnit(timeUnit) {
    if (timeUnit !== 'day' && timeUnit.indexOf('day') >= 0) {
        log.warn(log.message.dayReplacedWithDate(timeUnit));
        return timeUnit.replace('day', 'date');
    }
    return timeUnit;
}
exports.normalizeTimeUnit = normalizeTimeUnit;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXVuaXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGltZXVuaXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQXNEO0FBQ3RELGlEQUE2QjtBQUM3QiwrQkFBMkQ7QUFFM0QsSUFBaUIsUUFBUSxDQWlEeEI7QUFqREQsV0FBaUIsUUFBUTtJQUNWLGFBQUksR0FBVyxNQUFNLENBQUM7SUFDdEIsY0FBSyxHQUFZLE9BQU8sQ0FBQztJQUN6QixZQUFHLEdBQVUsS0FBSyxDQUFDO0lBQ25CLGFBQUksR0FBVyxNQUFNLENBQUM7SUFDdEIsY0FBSyxHQUFZLE9BQU8sQ0FBQztJQUN6QixnQkFBTyxHQUFjLFNBQVMsQ0FBQztJQUMvQixnQkFBTyxHQUFjLFNBQVMsQ0FBQztJQUMvQixxQkFBWSxHQUFtQixjQUFjLENBQUM7SUFDOUMsa0JBQVMsR0FBZ0IsV0FBVyxDQUFDO0lBQ3JDLHNCQUFhLEdBQW9CLGVBQWUsQ0FBQztJQUNqRCwyQkFBa0IsR0FBeUIsb0JBQW9CLENBQUM7SUFDaEUsa0NBQXlCLEdBQWdDLDJCQUEyQixDQUFDO0lBQ3JGLHlDQUFnQyxHQUF1QyxrQ0FBa0MsQ0FBQztJQUV2SCxxRkFBcUY7SUFDeEUsa0JBQVMsR0FBZ0IsV0FBVyxDQUFDO0lBQ3JDLHFCQUFZLEdBQW1CLGNBQWMsQ0FBQztJQUM5Qyw0QkFBbUIsR0FBMEIscUJBQXFCLENBQUM7SUFDbkUsdUJBQWMsR0FBcUIsZ0JBQWdCLENBQUM7SUFDcEQsNEJBQW1CLEdBQTBCLHFCQUFxQixDQUFDO0lBQ25FLGdCQUFPLEdBQWMsU0FBUyxDQUFDO0lBQy9CLG9CQUFXLEdBQWtCLGFBQWEsQ0FBQztJQUMzQyxxQkFBWSxHQUFtQixjQUFjLENBQUM7SUFDOUMseUJBQWdCLEdBQXVCLGtCQUFrQixDQUFDO0lBQzFELGdCQUFPLEdBQWMsU0FBUyxDQUFDO0lBQy9CLGlCQUFRLEdBQWUsVUFBVSxDQUFDO0lBQ2xDLGVBQU0sR0FBYSxRQUFR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LDRDQXNFQztBQUVELDJCQUFrQyxRQUFrQjtJQUNsRCxJQUFJLFFBQVEsS0FBSyxLQUFLLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdEQsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDcEQsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQWEsQ0FBQztLQUNwRDtJQUNELE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFORCw4Q0FNQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RGF0ZVRpbWVFeHByLCBkYXRlVGltZUV4cHJ9IGZyb20gJy4vZGF0ZXRpbWUnO1xuaW1wb3J0ICogYXMgbG9nIGZyb20gJy4vbG9nJztcbmltcG9ydCB7YWNjZXNzUGF0aFdpdGhEYXR1bSwgRmxhZywgZmxhZ0tleXN9IGZyb20gJy4vdXRpbCc7XG5cbmV4cG9ydCBuYW1lc3BhY2UgVGltZVVuaXQge1xuICBleHBvcnQgY29uc3QgWUVBUjogJ3llYXInID0gJ3llYXInO1xuICBleHBvcnQgY29uc3QgTU9OVEg6ICdtb250aCcgPSAnbW9udGgnO1xuICBleHBvcnQgY29uc3QgREFZOiAnZGF5JyA9ICdkYXknO1xuICBleHBvcnQgY29uc3QgREFURTogJ2RhdGUnID0gJ2RhdGUnO1xuICBleHBvcnQgY29uc3QgSE9VUlM6ICdob3VycycgPSAnaG91cnMnO1xuICBleHBvcnQgY29uc3QgTUlOVVRFUzogJ21pbnV0ZXMnID0gJ21pbnV0ZXMnO1xuICBleHBvcnQgY29uc3QgU0VDT05EUzogJ3NlY29uZHMnID0gJ3NlY29uZHMnO1xuICBleHBvcnQgY29uc3QgTUlMTElTRUNPTkRTOiAnbWlsbGlzZWNvbmRzJyA9ICdtaWxsaXNlY29uZHMnO1xuICBleHBvcnQgY29uc3QgWUVBUk1PTlRIOiAneWVhcm1vbnRoJyA9ICd5ZWFybW9udGgnO1xuICBleHBvcnQgY29uc3QgWUVBUk1PTlRIREFURTogJ3llYXJtb250aGRhdGUnID0gJ3llYXJtb250aGRhdGUnO1xuICBleHBvcnQgY29uc3QgWUVBUk1PTlRIREFURUhPVVJTOiAneWVhcm1vbnRoZGF0ZWhvdXJzJyA9ICd5ZWFybW9udGhkYXRlaG91cnMnO1xuICBleHBvcnQgY29uc3QgWUVBUk1PTlRIREFURUhPVVJTTUlOVVRFUzogJ3llYXJtb250aGRhdGVob3Vyc21pbnV0ZXMnID0gJ3llYXJtb250aGRhdGVob3Vyc21pbnV0ZXMnO1xuICBleHBvcnQgY29uc3QgWUVBUk1PTlRIREFURUhPVVJTTUlOVVRFU1NFQ09ORFM6ICd5ZWFybW9udGhkYXRlaG91cnNtaW51dGVzc2Vjb25kcycgPSAneWVhcm1vbnRoZGF0ZWhvdXJzbWludXRlc3NlY29uZHMnO1xuXG4gIC8vIE1PTlRIREFURSBhbHdheXMgaW5jbHVkZSAyOSBGZWJydWFyeSBzaW5jZSB3ZSB1c2UgeWVhciAwdGggKHdoaWNoIGlzIGEgbGVhcCB5ZWFyKTtcbiAgZXhwb3J0IGNvbnN0IE1PTlRIREFURTogJ21vbnRoZGF0ZScgPSAnbW9udGhkYXRlJztcbiAgZXhwb3J0IGNvbnN0IEhPVVJTTUlOVVRFUzogJ2hvdXJzbWludXRlcycgPSAnaG91cnNtaW51dGVzJztcbiAgZXhwb3J0IGNvbnN0IEhPVVJTTUlOVVRFU1NFQ09ORFM6ICdob3Vyc21pbnV0ZXNzZWNvbmRzJyA9ICdob3Vyc21pbnV0ZXNzZWNvbmRzJztcbiAgZXhwb3J0IGNvbnN0IE1JTlVURVNTRUNPTkRTOiAnbWludXRlc3NlY29uZHMnID0gJ21pbnV0ZXNzZWNvbmRzJztcbiAgZXhwb3J0IGNvbnN0IFNFQ09ORFNNSUxMSVNFQ09ORFM6ICdzZWNvbmRzbWlsbGlzZWNvbmRzJyA9ICdzZWNvbmRzbWlsbGlzZWNvbmRzJztcbiAgZXhwb3J0IGNvbnN0IFFVQVJURVI6ICdxdWFydGVyJyA9ICdxdWFydGVyJztcbiAgZXhwb3J0IGNvbnN0IFlFQVJRVUFSVEVSOiAneWVhcnF1YXJ0ZXInID0gJ3llYXJxdWFydGVyJztcbiAgZXhwb3J0IGNvbnN0IFFVQVJURVJNT05USDogJ3F1YXJ0ZXJtb250aCcgPSAncXVhcnRlcm1vbnRoJztcbiAgZXhwb3J0IGNvbnN0IFlFQVJRVUFSVEVSTU9OVEg6ICd5ZWFycXVhcnRlcm1vbnRoJyA9ICd5ZWFycXVhcnRlcm1vbnRoJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVI6ICd1dGN5ZWFyJyA9ICd1dGN5ZWFyJztcbiAgZXhwb3J0IGNvbnN0IFVUQ01PTlRIOiAndXRjbW9udGgnID0gJ3V0Y21vbnRoJztcbiAgZXhwb3J0IGNvbnN0IFVUQ0RBWTogJ3V0Y2RheScgPSAndXRjZGF5JztcbiAgZXhwb3J0IGNvbnN0IFVUQ0RBVEU6ICd1dGNkYXRlJyA9ICd1dGNkYXRlJztcbiAgZXhwb3J0IGNvbnN0IFVUQ0hPVVJTOiAndXRjaG91cnMnID0gJ3V0Y2hvdXJzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ01JTlVURVM6ICd1dGNtaW51dGVzJyA9ICd1dGNtaW51dGVzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1NFQ09ORFM6ICd1dGNzZWNvbmRzJyA9ICd1dGNzZWNvbmRzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ01JTExJU0VDT05EUzogJ3V0Y21pbGxpc2Vjb25kcycgPSAndXRjbWlsbGlzZWNvbmRzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVJNT05USDogJ3V0Y3llYXJtb250aCcgPSAndXRjeWVhcm1vbnRoJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVJNT05USERBVEU6ICd1dGN5ZWFybW9udGhkYXRlJyA9ICd1dGN5ZWFybW9udGhkYXRlJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVJNT05USERBVEVIT1VSUzogJ3V0Y3llYXJtb250aGRhdGVob3VycycgPSAndXRjeWVhcm1vbnRoZGF0ZWhvdXJzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVJNT05USERBVEVIT1VSU01JTlVURVM6ICd1dGN5ZWFybW9udGhkYXRlaG91cnNtaW51dGVzJyA9ICd1dGN5ZWFybW9udGhkYXRlaG91cnNtaW51dGVzJztcbiAgZXhwb3J0IGNvbnN0IFVUQ1lFQVJNT05USERBVEVIT1VSU01JTlVURVNTRUNPTkRTOiAndXRjeWVhcm1vbnRoZGF0ZWhvdXJzbWludXRlc3NlY29uZHMnID0gJ3V0Y3llYXJtb250aGRhdGVob3Vyc21pbnV0ZXNzZWNvbmRzJztcblxuICAvLyBNT05USERBVEUgYWx3YXlzIGluY2x1ZGUgMjkgRmVicnVhcnkgc2luY2Ugd2UgdXNlIHllYXIgMHRoICh3aGljaCBpcyBhIGxlYXAgeWVhcik7XG4gIGV4cG9ydCBjb25zdCBVVENNT05USERBVEU6ICd1dGNtb250aGRhdGUnID0gJ3V0Y21vbnRoZGF0ZSc7XG4gIGV4cG9ydCBjb25zdCBVVENIT1VSU01JTlVURVM6ICd1dGNob3Vyc21pbnV0ZXMnID0gJ3V0Y2hvdXJzbWludXRlcyc7XG4gIGV4cG9ydCBjb25zdCBVVENIT1VSU01JTlVURVNTRUNPTkRTOiAndXRjaG91cnNtaW51dGVzc2Vjb25kcycgPSAndXRjaG91cnNtaW51dGVzc2Vjb25kcyc7XG4gIGV4cG9ydCBjb25zdCBVVENNSU5VVEVTU0VDT05EUzogJ3V0Y21pbnV0ZXNzZWNvbmRzJyA9ICd1dGNtaW51dGVzc2Vjb25kcyc7XG4gIGV4cG9ydCBjb25zdCBVVENTRUNPTkRTTUlMTElTRUNPTkRTOiAndXRjc2Vjb25kc21pbGxpc2Vjb25kcycgPSAndXRjc2Vjb25kc21pbGxpc2Vjb25kcyc7XG4gIGV4cG9ydCBjb25zdCBVVENRVUFSVEVSOiAndXRjcXVhcnRlcicgPSAndXRjcXVhcnRlcic7XG4gIGV4cG9ydCBjb25zdCBVVENZRUFSUVVBUlRFUjogJ3V0Y3llYXJxdWFydGVyJyA9ICd1dGN5ZWFycXVhcnRlcic7XG4gIGV4cG9ydCBjb25zdCBVVENRVUFSVEVSTU9OVEg6ICd1dGNxdWFydGVybW9udGgnID0gJ3V0Y3F1YXJ0ZXJtb250aCc7XG4gIGV4cG9ydCBjb25zdCBVVENZRUFSUVVBUlRFUk1PTlRIOiAndXRjeWVhcnF1YXJ0ZXJtb250aCcgPSAndXRjeWVhcnF1YXJ0ZXJtb250aCc7XG59XG5cbmV4cG9ydCB0eXBlIExvY2FsU2luZ2xlVGltZVVuaXQgPVxuICB0eXBlb2YgVGltZVVuaXQuWUVBUiB8XG4gIHR5cGVvZiBUaW1lVW5pdC5RVUFSVEVSIHxcbiAgdHlwZW9mIFRpbWVVbml0Lk1PTlRIIHxcbiAgdHlwZW9mIFRpbWVVbml0LkRBWSB8XG4gIHR5cGVvZiBUaW1lVW5pdC5EQVRFIHxcbiAgdHlwZW9mIFRpbWVVbml0LkhPVVJTIHxcbiAgdHlwZW9mIFRpbWVVbml0Lk1JTlVURVMgfFxuICB0eXBlb2YgVGltZVVuaXQuU0VDT05EUyB8XG4gIHR5cGVvZiBUaW1lVW5pdC5NSUxMSVNFQ09ORFM7XG5cbi8qKiBUaW1lIFVuaXQgdGhhdCBvbmx5IGNvcnJlc3BvbmRzIHRvIG9ubHkgb25lIHBhcnQgb2YgRGF0ZSBvYmplY3RzLiAqL1xuY29uc3QgTE9DQUxfU0lOR0xFX1RJTUVVTklUX0lOREVYOiBGbGFnPExvY2FsU2luZ2xlVGltZVVuaXQ+ID0ge1xuICB5ZWFyOiAxLFxuICBxdWFydGVyOiAxLFxuICBtb250aDogMSxcbiAgZGF5OiAxLFxuICBkYXRlOiAxLFxuICBob3VyczogMSxcbiAgbWludXRlczogMSxcbiAgc2Vjb25kczogMSxcbiAgbWlsbGlzZWNvbmRzOiAxXG59O1xuXG5leHBvcnQgY29uc3QgVElNRVVOSVRfUEFSVFMgPSBmbGFnS2V5cyhMT0NBTF9TSU5HTEVfVElNRVVOSVRfSU5ERVgpO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNMb2NhbFNpbmdsZVRpbWVVbml0KHRpbWVVbml0OiBzdHJpbmcpOiB0aW1lVW5pdCBpcyBMb2NhbFNpbmdsZVRpbWVVbml0IHtcbiAgcmV0dXJuICEhTE9DQUxfU0lOR0xFX1RJTUVVTklUX0lOREVYW3RpbWVVbml0XTtcbn1cblxuZXhwb3J0IHR5cGUgVXRjU2luZ2xlVGltZVVuaXQgPVxuICB0eXBlb2YgVGltZVVuaXQuVVRDWUVBUiB8XG4gIHR5cGVvZiBUaW1lVW5pdC5VVENRVUFSVEVSIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ01PTlRIIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ0RBWSB8XG4gIHR5cGVvZiBUaW1lVW5pdC5VVENEQVRFIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ0hPVVJTIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ01JTlVURVMgfFxuICB0eXBlb2YgVGltZVVuaXQuVVRDU0VDT05EUyB8XG4gIHR5cGVvZiBUaW1lVW5pdC5VVENNSUxMSVNFQ09ORFM7XG5cbmNvbnN0IFVUQ19TSU5HTEVfVElNRVVOSVRfSU5ERVg6IEZsYWc8VXRjU2luZ2xlVGltZVVuaXQ+ID0ge1xuICB1dGN5ZWFyOiAxLFxuICB1dGNxdWFydGVyOiAxLFxuICB1dGNtb250aDogMSxcbiAgdXRjZGF5OiAxLFxuICB1dGNkYXRlOiAxLFxuICB1dGNob3VyczogMSxcbiAgdXRjbWludXRlczogMSxcbiAgdXRjc2Vjb25kczogMSxcbiAgdXRjbWlsbGlzZWNvbmRzOiAxXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gaXNVdGNTaW5nbGVUaW1lVW5pdCh0aW1lVW5pdDogc3RyaW5nKTogdGltZVVuaXQgaXMgVXRjU2luZ2xlVGltZVVuaXQge1xuICByZXR1cm4gISFVVENfU0lOR0xFX1RJTUVVTklUX0lOREVYW3RpbWVVbml0XTtcbn1cblxuZXhwb3J0IHR5cGUgU2luZ2xlVGltZVVuaXQgPSBMb2NhbFNpbmdsZVRpbWVVbml0IHwgVXRjU2luZ2xlVGltZVVuaXQ7XG5cbmV4cG9ydCB0eXBlIExvY2FsTXVsdGlUaW1lVW5pdCA9XG4gIC8vIExvY2FsIFRpbWVcbiAgdHlwZW9mIFRpbWVVbml0LllFQVJRVUFSVEVSIHwgdHlwZW9mIFRpbWVVbml0LllFQVJRVUFSVEVSTU9OVEggfFxuICB0eXBlb2YgVGltZVVuaXQuWUVBUk1PTlRIIHwgdHlwZW9mIFRpbWVVbml0LllFQVJNT05USERBVEUgfCB0eXBlb2YgVGltZVVuaXQuWUVBUk1PTlRIREFURUhPVVJTIHwgdHlwZW9mIFRpbWVVbml0LllFQVJNT05USERBVEVIT1VSU01JTlVURVN8IHR5cGVvZiBUaW1lVW5pdC5ZRUFSTU9OVEhEQVRFSE9VUlNNSU5VVEVTU0VDT05EUyB8XG4gIHR5cGVvZiBUaW1lVW5pdC5RVUFSVEVSTU9OVEggfFxuICB0eXBlb2YgVGltZVVuaXQuTU9OVEhEQVRFIHxcbiAgdHlwZW9mIFRpbWVVbml0LkhPVVJTTUlOVVRFUyB8IHR5cGVvZiBUaW1lVW5pdC5IT1VSU01JTlVURVNTRUNPTkRTIHxcbiAgdHlwZW9mIFRpbWVVbml0Lk1JTlVURVNTRUNPTkRTIHxcbiAgdHlwZW9mIFRpbWVVbml0LlNFQ09ORFNNSUxMSVNFQ09ORFM7XG5cbmNvbnN0IExPQ0FMX01VTFRJX1RJTUVVTklUX0lOREVYOiBGbGFnPExvY2FsTXVsdGlUaW1lVW5pdD4gPSB7XG4gIHllYXJxdWFydGVyOiAxLFxuICB5ZWFycXVhcnRlcm1vbnRoOiAxLFxuXG4gIHllYXJtb250aDogMSxcbiAgeWVhcm1vbnRoZGF0ZTogMSxcbiAgeWVhcm1vbnRoZGF0ZWhvdXJzOiAxLFxuICB5ZWFybW9udGhkYXRlaG91cnNtaW51dGVzOiAxLFxuICB5ZWFybW9udGhkYXRlaG91cnNtaW51dGVzc2Vjb25kczogMSxcblxuICBxdWFydGVybW9udGg6IDEsXG5cbiAgbW9udGhkYXRlOiAxLFxuXG4gIGhvdXJzbWludXRlczogMSxcbiAgaG91cnNtaW51dGVzc2Vjb25kczogMSxcblxuICBtaW51dGVzc2Vjb25kczogMSxcblxuICBzZWNvbmRzbWlsbGlzZWNvbmRzOiAxXG59O1xuXG5leHBvcnQgdHlwZSBVdGNNdWx0aVRpbWVVbml0ID1cbiAgdHlwZW9mIFRpbWVVbml0LlVUQ1lFQVJRVUFSVEVSIHwgdHlwZW9mIFRpbWVVbml0LlVUQ1lFQVJRVUFSVEVSTU9OVEggfFxuICB0eXBlb2YgVGltZVVuaXQuVVRDWUVBUk1PTlRIIHwgdHlwZW9mIFRpbWVVbml0LlVUQ1lFQVJNT05USERBVEUgfCB0eXBlb2YgVGltZVVuaXQuVVRDWUVBUk1PTlRIREFURUhPVVJTIHwgdHlwZW9mIFRpbWVVbml0LlVUQ1lFQVJNT05USERBVEVIT1VSU01JTlVURVN8IHR5cGVvZiBUaW1lVW5pdC5VVENZRUFSTU9OVEhEQVRFSE9VUlNNSU5VVEVTU0VDT05EUyB8XG4gIHR5cGVvZiBUaW1lVW5pdC5VVENRVUFSVEVSTU9OVEggfFxuICB0eXBlb2YgVGltZVVuaXQuVVRDTU9OVEhEQVRFIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ0hPVVJTTUlOVVRFUyB8IHR5cGVvZiBUaW1lVW5pdC5VVENIT1VSU01JTlVURVNTRUNPTkRTIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ01JTlVURVNTRUNPTkRTIHxcbiAgdHlwZW9mIFRpbWVVbml0LlVUQ1NFQ09ORFNNSUxMSVNFQ09ORFM7XG5cbmNvbnN0IFVUQ19NVUxUSV9USU1FVU5JVF9JTkRFWDogRmxhZzxVdGNNdWx0aVRpbWVVbml0PiA9IHtcbiAgdXRjeWVhcnF1YXJ0ZXI6IDEsXG4gIHV0Y3llYXJxdWFydGVybW9udGg6IDEsXG5cbiAgdXRjeWVhcm1vbnRoOiAxLFxuICB1dGN5ZWFybW9udGhkYXRlOiAxLFxuICB1dGN5ZWFybW9udGhkYXRlaG91cnM6IDEsXG4gIHV0Y3llYXJtb250aGRhdGVob3Vyc21pbnV0ZXM6IDEsXG4gIHV0Y3llYXJtb250aGRhdGVob3Vyc21pbnV0ZXNzZWNvbmRzOiAxLFxuXG4gIHV0Y3F1YXJ0ZXJtb250aDogMSxcblxuICB1dGNtb250aGRhdGU6IDEsXG5cbiAgdXRjaG91cnNtaW51dGVzOiAxLFxuICB1dGNob3Vyc21pbnV0ZXNzZWNvbmRzOiAxLFxuXG4gIHV0Y21pbnV0ZXNzZWNvbmRzOiAxLFxuXG4gIHV0Y3NlY29uZHNtaWxsaXNlY29uZHM6IDFcbn07XG5cbmV4cG9ydCB0eXBlIE11bHRpVGltZVVuaXQgPSBMb2NhbE11bHRpVGltZVVuaXQgfCBVdGNNdWx0aVRpbWVVbml0O1xuXG5cbmV4cG9ydCB0eXBlIExvY2FsVGltZVVuaXQgPSBMb2NhbFNpbmdsZVRpbWVVbml0IHwgTG9jYWxNdWx0aVRpbWVVbml0O1xuZXhwb3J0IHR5cGUgVXRjVGltZVVuaXQgPSBVdGNTaW5nbGVUaW1lVW5pdCB8IFV0Y011bHRpVGltZVVuaXQ7XG5cbmNvbnN0IFVUQ19USU1FVU5JVF9JTkRFWDogRmxhZzxVdGNUaW1lVW5pdD4gPSB7XG4gIC4uLlVUQ19TSU5HTEVfVElNRVVOSVRfSU5ERVgsXG4gIC4uLlVUQ19NVUxUSV9USU1FVU5JVF9JTkRFWFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzVVRDVGltZVVuaXQodDogc3RyaW5nKTogdCBpcyBVdGNUaW1lVW5pdCB7XG4gIHJldHVybiAhIVVUQ19USU1FVU5JVF9JTkRFWFt0XTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvY2FsVGltZVVuaXQodDogVXRjVGltZVVuaXQpOiBMb2NhbFRpbWVVbml0IHtcbiAgcmV0dXJuIHQuc3Vic3RyKDMpIGFzIExvY2FsVGltZVVuaXQ7XG59XG5cbmV4cG9ydCB0eXBlIFRpbWVVbml0ID0gU2luZ2xlVGltZVVuaXQgfCBNdWx0aVRpbWVVbml0O1xuXG5jb25zdCBUSU1FVU5JVF9JTkRFWDogRmxhZzxUaW1lVW5pdD4gPSB7XG4gIC4uLkxPQ0FMX1NJTkdMRV9USU1FVU5JVF9JTkRFWCxcbiAgLi4uVVRDX1NJTkdMRV9USU1FVU5JVF9JTkRFWCxcbiAgLi4uTE9DQUxfTVVMVElfVElNRVVOSVRfSU5ERVgsXG4gIC4uLlVUQ19NVUxUSV9USU1FVU5JVF9JTkRFWFxufTtcblxuZXhwb3J0IGNvbnN0IFRJTUVVTklUUyA9IGZsYWdLZXlzKFRJTUVVTklUX0lOREVYKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzVGltZVVuaXQodDogc3RyaW5nKTogdCBpcyBUaW1lVW5pdCB7XG4gIHJldHVybiAhIVRJTUVVTklUX0lOREVYW3RdO1xufVxuXG50eXBlIERhdGVNZXRob2ROYW1lID0ga2V5b2YgRGF0ZTtcblxuY29uc3QgU0VUX0RBVEVfTUVUSE9EOiBSZWNvcmQ8TG9jYWxTaW5nbGVUaW1lVW5pdCwgRGF0ZU1ldGhvZE5hbWU+ID0ge1xuICB5ZWFyOiAnc2V0RnVsbFllYXInLFxuICBtb250aDogJ3NldE1vbnRoJyxcbiAgZGF0ZTogJ3NldERhdGUnLFxuICBob3VyczogJ3NldEhvdXJzJyxcbiAgbWludXRlczogJ3NldE1pbnV0ZXMnLFxuICBzZWNvbmRzOiAnc2V0U2Vjb25kcycsXG4gIG1pbGxpc2Vjb25kczogJ3NldE1pbGxpc2Vjb25kcycsXG4gIC8vIERheSBhbmQgcXVhcnRlciBoYXZlIHRoZWlyIG93biBzcGVjaWFsIGNhc2VzXG4gIHF1YXJ0ZXI6IG51bGwsXG4gIGRheTogbnVsbCxcbn07XG5cbi8qKlxuICogQ29udmVydHMgYSBkYXRlIHRvIG9ubHkgaGF2ZSB0aGUgbWVhc3VyZW1lbnRzIHJlbGV2YW50IHRvIHRoZSBzcGVjaWZpZWQgdW5pdFxuICogaS5lLiAoJ3llYXJtb250aCcsICcyMDAwLTEyLTA0IDA3OjU4OjE0JykgLT4gJzIwMDAtMTItMDEgMDA6MDA6MDAnXG4gKiBOb3RlOiB0aGUgYmFzZSBkYXRlIGlzIEphbiAwMSAxOTAwIDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0KHVuaXQ6IFRpbWVVbml0LCBkYXRlOiBEYXRlKTogRGF0ZSB7XG4gIGNvbnN0IGlzVVRDID0gaXNVVENUaW1lVW5pdCh1bml0KTtcbiAgY29uc3QgcmVzdWx0OiBEYXRlID0gaXNVVEMgP1xuICAgIC8vIHN0YXJ0IHdpdGggdW5pZm9ybSBkYXRlXG4gICAgbmV3IERhdGUoRGF0ZS5VVEMoMCwgMCwgMSwgMCwgMCwgMCwgMCkpIDpcbiAgICBuZXcgRGF0ZSgwLCAwLCAxLCAwLCAwLCAwLCAwKTtcbiAgICBmb3IgKGNvbnN0IHRpbWVVbml0UGFydCBvZiBUSU1FVU5JVF9QQVJUUykge1xuICAgIGlmIChjb250YWluc1RpbWVVbml0KHVuaXQsIHRpbWVVbml0UGFydCkpIHtcbiAgICAgIHN3aXRjaCAodGltZVVuaXRQYXJ0KSB7XG4gICAgICAgIGNhc2UgVGltZVVuaXQuREFZOlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNvbnZlcnQgdG8gVGltZVVuaXRzIGNvbnRhaW5pbmcgXFwnZGF5XFwnJyk7XG4gICAgICAgIGNhc2UgVGltZVVuaXQuUVVBUlRFUjoge1xuICAgICAgICAgIGNvbnN0IHtnZXREYXRlTWV0aG9kLCBzZXREYXRlTWV0aG9kfSA9IGRhdGVNZXRob2RzKCdtb250aCcsIGlzVVRDKTtcbiAgICAgICAgICAvLyBpbmRpY2F0ZSBxdWFydGVyIGJ5IHNldHRpbmcgbW9udGggdG8gYmUgdGhlIGZpcnN0IG9mIHRoZSBxdWFydGVyIGkuZS4gbWF5ICg0KSAtPiBhcHJpbCAoMylcbiAgICAgICAgICByZXN1bHRbc2V0RGF0ZU1ldGhvZF0oKE1hdGguZmxvb3IoZGF0ZVtnZXREYXRlTWV0aG9kXSgpIC8gMykpICogMyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb25zdCB7Z2V0RGF0ZU1ldGhvZCwgc2V0RGF0ZU1ldGhvZH0gPSBkYXRlTWV0aG9kcyh0aW1lVW5pdFBhcnQsIGlzVVRDKTtcbiAgICAgICAgICByZXN1bHRbc2V0RGF0ZU1ldGhvZF0oZGF0ZVtnZXREYXRlTWV0aG9kXSgpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gZGF0ZU1ldGhvZHMoc2luZ2xlVW5pdDogU2luZ2xlVGltZVVuaXQsIGlzVXRjOiBib29sZWFuKSB7XG4gIGNvbnN0IHJhd1NldERhdGVNZXRob2QgPSBTRVRfREFURV9NRVRIT0Rbc2luZ2xlVW5pdF07XG4gIGNvbnN0IHNldERhdGVNZXRob2QgPSBpc1V0YyA/ICdzZXRVVEMnICsgcmF3U2V0RGF0ZU1ldGhvZC5zdWJzdHIoMykgOiByYXdTZXREYXRlTWV0aG9kO1xuICBjb25zdCBnZXREYXRlTWV0aG9kID0gJ2dldCcgKyAoaXNVdGMgPyAnVVRDJyA6ICcnKSArIHJhd1NldERhdGVNZXRob2Quc3Vic3RyKDMpO1xuICByZXR1cm4ge3NldERhdGVNZXRob2QsIGdldERhdGVNZXRob2R9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGltZVVuaXRQYXJ0cyh0aW1lVW5pdDogVGltZVVuaXQpIHtcbiAgcmV0dXJuIFRJTUVVTklUX1BBUlRTLnJlZHVjZSgocGFydHMsIHBhcnQpID0+IHtcbiAgICBpZiAoY29udGFpbnNUaW1lVW5pdCh0aW1lVW5pdCwgcGFydCkpIHtcbiAgICAgIHJldHVybiBwYXJ0cy5jb25jYXQocGFydCk7XG4gICAgfVxuICAgIHJldHVybiBwYXJ0cztcbiAgfSwgW10pO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGZ1bGxUaW1lVW5pdCBjb250YWlucyB0aGUgdGltZVVuaXQsIGZhbHNlIG90aGVyd2lzZS4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb250YWluc1RpbWVVbml0KGZ1bGxUaW1lVW5pdDogVGltZVVuaXQsIHRpbWVVbml0OiBUaW1lVW5pdCkge1xuICBjb25zdCBpbmRleCA9IGZ1bGxUaW1lVW5pdC5pbmRleE9mKHRpbWVVbml0KTtcbiAgcmV0dXJuIGluZGV4ID4gLTEgJiZcbiAgICAoXG4gICAgICB0aW1lVW5pdCAhPT0gVGltZVVuaXQuU0VDT05EUyB8fFxuICAgICAgaW5kZXggPT09IDAgfHxcbiAgICAgIGZ1bGxUaW1lVW5pdC5jaGFyQXQoaW5kZXgtMSkgIT09ICdpJyAvLyBleGNsdWRlIG1pbGxpc2Vjb25kc1xuICAgICk7XG59XG5cbi8qKlxuICogUmV0dXJucyBWZWdhIGV4cHJlc3NzaW9uIGZvciBhIGdpdmVuIHRpbWVVbml0IGFuZCBmaWVsZFJlZlxuICovXG5leHBvcnQgZnVuY3Rpb24gZmllbGRFeHByKGZ1bGxUaW1lVW5pdDogVGltZVVuaXQsIGZpZWxkOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBmaWVsZFJlZiA9IGFjY2Vzc1BhdGhXaXRoRGF0dW0oZmllbGQpO1xuXG4gIGNvbnN0IHV0YyA9IGlzVVRDVGltZVVuaXQoZnVsbFRpbWVVbml0KSA/ICd1dGMnIDogJyc7XG4gIGZ1bmN0aW9uIGZ1bmModGltZVVuaXQ6IFRpbWVVbml0KSB7XG4gICAgaWYgKHRpbWVVbml0ID09PSBUaW1lVW5pdC5RVUFSVEVSKSB7XG4gICAgICAvLyBxdWFydGVyIHN0YXJ0aW5nIGF0IDAgKDAsMyw2LDkpLlxuICAgICAgcmV0dXJuIGAoJHt1dGN9cXVhcnRlcigke2ZpZWxkUmVmfSktMSlgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7dXRjfSR7dGltZVVuaXR9KCR7ZmllbGRSZWZ9KWA7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgZCA9IFRJTUVVTklUX1BBUlRTLnJlZHVjZSgoZGF0ZUV4cHI6IERhdGVUaW1lRXhwciwgdHU6IFRpbWVVbml0KSA9PiB7XG4gICAgaWYgKGNvbnRhaW5zVGltZVVuaXQoZnVsbFRpbWVVbml0LCB0dSkpIHtcbiAgICAgIGRhdGVFeHByW3R1XSA9IGZ1bmModHUpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0ZUV4cHI7XG4gIH0sIHt9IGFzIHtba2V5IGluIFNpbmdsZVRpbWVVbml0XTogc3RyaW5nfSk7XG5cbiAgcmV0dXJuIGRhdGVUaW1lRXhwcihkKTtcbn1cblxuLyoqXG4gKiByZXR1cm5zIHRoZSBzaWduYWwgZXhwcmVzc2lvbiB1c2VkIGZvciBheGlzIGxhYmVscyBmb3IgYSB0aW1lIHVuaXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEV4cHJlc3Npb24odGltZVVuaXQ6IFRpbWVVbml0LCBmaWVsZDogc3RyaW5nLCBzaG9ydFRpbWVMYWJlbHM6IGJvb2xlYW4sIGlzVVRDU2NhbGU6IGJvb2xlYW4pOiBzdHJpbmcge1xuICBpZiAoIXRpbWVVbml0KSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGNvbnN0IGRhdGVDb21wb25lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgZXhwcmVzc2lvbiA9ICcnO1xuICBjb25zdCBoYXNZZWFyID0gY29udGFpbnNUaW1lVW5pdCh0aW1lVW5pdCwgVGltZVVuaXQuWUVBUik7XG5cbiAgaWYgKGNvbnRhaW5zVGltZVVuaXQodGltZVVuaXQsIFRpbWVVbml0LlFVQVJURVIpKSB7XG4gICAvLyBzcGVjaWFsIGV4cHJlc3Npb24gZm9yIHF1YXJ0ZXIgYXMgcHJlZml4XG4gICAgZXhwcmVzc2lvbiA9IGAnUScgKyBxdWFydGVyKCR7ZmllbGR9KWA7XG4gIH1cblxuICBpZiAoY29udGFpbnNUaW1lVW5pdCh0aW1lVW5pdCwgVGltZVVuaXQuTU9OVEgpKSB7XG4gICAgLy8gQnkgZGVmYXVsdCB1c2Ugc2hvcnQgbW9udGggbmFtZVxuICAgIGRhdGVDb21wb25lbnRzLnB1c2goc2hvcnRUaW1lTGFiZWxzICE9PSBmYWxzZSA/ICclYicgOiAnJUInKTtcbiAgfVxuXG4gIGlmIChjb250YWluc1RpbWVVbml0KHRpbWVVbml0LCBUaW1lVW5pdC5EQVkpKSB7XG4gICAgZGF0ZUNvbXBvbmVudHMucHVzaChzaG9ydFRpbWVMYWJlbHMgPyAnJWEnIDogJyVBJyk7XG4gIH0gZWxzZSBpZiAoY29udGFpbnNUaW1lVW5pdCh0aW1lVW5pdCwgVGltZVVuaXQuREFURSkpIHtcbiAgICBkYXRlQ29tcG9uZW50cy5wdXNoKCclZCcgKyAoaGFzWWVhciA/ICcsJyA6ICcnKSk7IC8vIGFkZCBjb21tYSBpZiB0aGVyZSBpcyB5ZWFyXG4gIH1cblxuICBpZiAoaGFzWWVhcikge1xuICAgIGRhdGVDb21wb25lbnRzLnB1c2goc2hvcnRUaW1lTGFiZWxzID8gJyV5JyA6ICclWScpO1xuICB9XG5cbiAgY29uc3QgdGltZUNvbXBvbmVudHM6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKGNvbnRhaW5zVGltZVVuaXQodGltZVVuaXQsIFRpbWVVbml0LkhPVVJTKSkge1xuICAgIHRpbWVDb21wb25lbnRzLnB1c2goJyVIJyk7XG4gIH1cbiAgaWYgKGNvbnRhaW5zVGltZVVuaXQodGltZVVuaXQsIFRpbWVVbml0Lk1JTlVURVMpKSB7XG4gICAgdGltZUNvbXBvbmVudHMucHVzaCgnJU0nKTtcbiAgfVxuICBpZiAoY29udGFpbnNUaW1lVW5pdCh0aW1lVW5pdCwgVGltZVVuaXQuU0VDT05EUykpIHtcbiAgICB0aW1lQ29tcG9uZW50cy5wdXNoKCclUycpO1xuICB9XG4gIGlmIChjb250YWluc1RpbWVVbml0KHRpbWVVbml0LCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpKSB7XG4gICAgdGltZUNvbXBvbmVudHMucHVzaCgnJUwnKTtcbiAgfVxuXG4gIGNvbnN0IGRhdGVUaW1lQ29tcG9uZW50czogc3RyaW5nW10gPSBbXTtcbiAgaWYgKGRhdGVDb21wb25lbnRzLmxlbmd0aCA+IDApIHtcbiAgICBkYXRlVGltZUNvbXBvbmVudHMucHVzaChkYXRlQ29tcG9uZW50cy5qb2luKCcgJykpO1xuICB9XG4gIGlmICh0aW1lQ29tcG9uZW50cy5sZW5ndGggPiAwKSB7XG4gICAgZGF0ZVRpbWVDb21wb25lbnRzLnB1c2godGltZUNvbXBvbmVudHMuam9pbignOicpKTtcbiAgfVxuXG4gIGlmIChkYXRlVGltZUNvbXBvbmVudHMubGVuZ3RoID4gMCkge1xuICAgIGlmIChleHByZXNzaW9uKSB7XG4gICAgICAvLyBBZGQgc3BhY2UgYmV0d2VlbiBxdWFydGVyIGFuZCBtYWluIHRpbWUgZm9ybWF0XG4gICAgICBleHByZXNzaW9uICs9IGAgKyAnICcgKyBgO1xuICAgIH1cblxuICAgIC8vIFdlIG9ubHkgdXNlIHV0Y0Zvcm1hdCBmb3IgdXRjIHNjYWxlXG4gICAgLy8gRm9yIHV0YyB0aW1lIHVuaXRzLCB0aGUgZGF0YSBpcyBhbHJlYWR5IGNvbnZlcnRlZCBhcyBhIHBhcnQgb2YgdGltZVVuaXQgdHJhbnNmb3JtLlxuICAgIC8vIFRodXMsIHV0YyB0aW1lIHVuaXRzIHNob3VsZCB1c2UgdGltZUZvcm1hdCB0byBhdm9pZCBzaGlmdGluZyB0aGUgdGltZSB0d2ljZS5cbiAgICBpZiAoaXNVVENTY2FsZSkge1xuICAgICAgZXhwcmVzc2lvbiArPSBgdXRjRm9ybWF0KCR7ZmllbGR9LCAnJHtkYXRlVGltZUNvbXBvbmVudHMuam9pbignICcpfScpYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZXhwcmVzc2lvbiArPSBgdGltZUZvcm1hdCgke2ZpZWxkfSwgJyR7ZGF0ZVRpbWVDb21wb25lbnRzLmpvaW4oJyAnKX0nKWA7XG4gICAgfVxuICB9XG5cbiAgLy8gSWYgZXhwcmVzc2lvbiBpcyBzdGlsbCBhbiBlbXB0eSBzdHJpbmcsIHJldHVybiB1bmRlZmluZWQgaW5zdGVhZC5cbiAgcmV0dXJuIGV4cHJlc3Npb24gfHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplVGltZVVuaXQodGltZVVuaXQ6IFRpbWVVbml0KTogVGltZVVuaXQge1xuICBpZiAodGltZVVuaXQgIT09ICdkYXknICYmIHRpbWVVbml0LmluZGV4T2YoJ2RheScpID49IDApIHtcbiAgICBsb2cud2Fybihsb2cubWVzc2FnZS5kYXlSZXBsYWNlZFdpdGhEYXRlKHRpbWVVbml0KSk7XG4gICAgcmV0dXJuIHRpbWVVbml0LnJlcGxhY2UoJ2RheScsICdkYXRlJykgYXMgVGltZVVuaXQ7XG4gIH1cbiAgcmV0dXJuIHRpbWVVbml0O1xufVxuIl19