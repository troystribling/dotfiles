!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vl=e()}}(function(){return function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n||e)},u,u.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o,s="boolean"==typeof t.cycles&&t.cycles,l=t.replacer||function(e,t){return t},c=t.cmp&&(o=t.cmp,function(e){return function(t,n){var r={key:t,value:e[t]},i={key:n,value:e[n]};return o(r,i)}}),u=[];return function e(t,o,f,d){var p=n?"\n"+new Array(d+1).join(n):"",g=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),void 0!==(f=l.call(t,o,f))){if("object"!=typeof f||null===f)return r.stringify(f);if(i(f)){for(var m=[],h=0;h<f.length;h++){var v=e(f,h,f[h],d+1)||r.stringify(null);m.push(p+n+v)}return"["+m.join(",")+p+"]"}if(-1!==u.indexOf(f)){if(s)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(f);var y=a(f).sort(c&&c(f));for(m=[],h=0;h<y.length;h++){var b=e(f,o=y[h],f[o],d+1);if(b){var _=r.stringify(o)+g+b;m.push(p+n+_)}}return u.splice(u.indexOf(f),1),"{"+m.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:2}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var r,i,a,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:r,text:a}},c=function(e){return e&&e!==i&&l("Expected '"+e+"' instead of '"+i+"'"),i=a.charAt(r),r+=1,i},u=function(){var e,t="";for("-"===i&&(t="-",c("-"));i>="0"&&i<="9";)t+=i,c();if("."===i)for(t+=".";c()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,c(),"-"!==i&&"+"!==i||(t+=i,c());i>="0"&&i<="9";)t+=i,c();if(e=+t,isFinite(e))return e;l("Bad number")},f=function(){var e,t,n,r="";if('"'===i)for(;c();){if('"'===i)return c(),r;if("\\"===i)if(c(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(c(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof s[i])break;r+=s[i]}else r+=i}l("Bad string")},d=function(){for(;i&&i<=" ";)c()};o=function(){switch(d(),i){case"{":return function(){var e,t={};if("{"===i){if(c("{"),d(),"}"===i)return c("}"),t;for(;i;){if(e=f(),d(),c(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===i)return c("}"),t;c(","),d()}}l("Bad object")}();case"[":return function(){var e=[];if("["===i){if(c("["),d(),"]"===i)return c("]"),e;for(;i;){if(e.push(o()),d(),"]"===i)return c("]"),e;c(","),d()}}l("Bad array")}();case'"':return f();case"-":return u();default:return i>="0"&&i<="9"?u():function(){switch(i){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}l("Unexpected '"+i+"'")}()}},t.exports=function(e,t){var n;return a=e,r=0,i=" ",n=o(),d(),i&&l("Syntax error"),"function"==typeof t?function e(n,r){var i,a,o=n[r];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(a=e(o,i))?o[i]=a:delete o[i]);return t.call(n,r,o)}({"":n},""):n}},{}],4:[function(e,t,n){var r,i,a,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function l(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}t.exports=function(e,t,n){var o;if(r="",i="","number"==typeof n)for(o=0;o<n;o+=1)i+=" ";else"string"==typeof n&&(i=n);if(a=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,n){var o,s,c,u,f,d=r,p=n[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),"function"==typeof a&&(p=a.call(n,t,p)),typeof p){case"string":return l(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(r+=i,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(u=p.length,o=0;o<u;o+=1)f[o]=e(o,p)||"null";return c=0===f.length?"[]":r?"[\n"+r+f.join(",\n"+r)+"\n"+d+"]":"["+f.join(",")+"]",r=d,c}if(a&&"object"==typeof a)for(u=a.length,o=0;o<u;o+=1)"string"==typeof(s=a[o])&&(c=e(s,p))&&f.push(l(s)+(r?": ":":")+c);else for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(c=e(s,p))&&f.push(l(s)+(r?": ":":")+c);return c=0===f.length?"{}":r?"{\n"+r+f.join(",\n"+r)+"\n"+d+"}":"{"+f.join(",")+"}",r=d,c}}("",{"":e})}},{}],5:[function(e,t,n){var r,i,a=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,u=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?u=c.concat(u):d=-1,u.length&&g())}function g(){if(!f){var e=l(p);f=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,f=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||f||l(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],6:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],7:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(e,t,n){(function(t,r){var i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),l=r[n];n<a;l=r[++n])m(l)||!_(l)?o+=" "+l:o+=" "+s(l);return o},n.deprecate=function(e,i){if(y(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return function(){if(!a){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),a=!0}return e.apply(this,arguments)}};var a,o={};function s(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(t)?r.showHidden=t:t&&n._extend(r,t),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(h(t))return e.stylize(""+t,"number");if(g(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,t);if(a)return a;var o,s=Object.keys(t),l=(o={},s.forEach(function(e,t){o[e]=!0}),o);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),S(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(t);if(0===s.length){if(E(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(O(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return f(t)}var _,x="",w=!1,N=["{","}"];(p(t)&&(w=!0,N=["[","]"]),E(t))&&(x=" [Function"+(t.name?": "+t.name:"")+"]");return b(t)&&(x=" "+RegExp.prototype.toString.call(t)),O(t)&&(x=" "+Date.prototype.toUTCString.call(t)),S(t)&&(x=" "+f(t)),0!==s.length||w&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),_=w?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)T(t,String(o))?a.push(d(e,t,n,r,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(d(e,t,n,r,i,!0))}),a}(e,t,r,l,s):s.map(function(n){return d(e,t,r,l,n,w)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(_,x,N)):N[0]+x+N[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),T(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function p(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function h(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===x(e)}function _(e){return"object"==typeof e&&null!==e}function O(e){return _(e)&&"[object Date]"===x(e)}function S(e){return _(e)&&("[object Error]"===x(e)||e instanceof Error)}function E(e){return"function"==typeof e}function x(e){return Object.prototype.toString.call(e)}function w(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(a)&&(a=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=t.pid;o[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else o[e]=function(){};return o[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=g,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=h,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=b,n.isObject=_,n.isDate=O,n.isError=S,n.isFunction=E,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[w(e.getHours()),w(e.getMinutes()),w(e.getSeconds())].join(":"),[e.getDate(),N[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}],9:[function(e,t,n){var r;r=this,function(e){"use strict";var t,n,r="view",i="[",a="]",o="{",s="}",l=":",c=",",u="@",f=">",d=/[[\]{}]/,p={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function g(e,t,n,r,i){for(var a,o=0,s=e.length;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function m(e){for(var t=[],n=0,r=e.length,l=0;l<r;)l=g(e,l,c,i+o,a+s),t.push(e.substring(n,l).trim()),n=++l;if(0===t.length)throw"Empty event selector: "+e;return t}function h(e){return"["===e[0]?function(e){var t,n,r=e.length,o=1;if((o=g(e,o,a,i,a))===r)throw"Empty between selector: "+e;if(2!==(t=m(e.substring(1,o))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(o+1).trim())[0]!==f)throw"Expected '>' after between selector: "+e;{if(t=t.map(h),(n=h(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t}return n}(e):function(e){var r,f,p={source:t},m=[],h=[0,0],v=0,y=0,b=e.length,_=0;if(e[b-1]===s){if(!((_=e.lastIndexOf(o))>=0))throw"Unmatched right brace: "+e;try{h=function(e){var t=e.split(c);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!=n)throw e;return n})}(e.substring(_+1,b-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,_).trim(),b=e.length,_=0}if(!b)throw e;e[0]===u&&(v=++_);(r=g(e,_,l))<b&&(m.push(e.substring(y,r).trim()),y=_=++r);if((_=g(e,_,i))===b)m.push(e.substring(y,b).trim());else if(m.push(e.substring(y,_).trim()),f=[],(y=++_)===b)throw"Unmatched left bracket: "+e;for(;_<b;){if((_=g(e,_,a))===b)throw"Unmatched left bracket: "+e;if(f.push(e.substring(y,_).trim()),_<b-1&&e[++_]!==i)throw"Expected left bracket: "+e;y=++_}if(!(b=m.length)||d.test(m[b-1]))throw"Invalid event selector: "+e;b>1?(p.type=m[1],v?p.markname=m[0].slice(1):(O=m[0],n.hasOwnProperty(O)?p.marktype=m[0]:p.source=m[0])):p.type=m[0];var O;"!"===p.type.slice(-1)&&(p.consume=!0,p.type=p.type.slice(0,-1));null!=f&&(p.filter=f);h[0]&&(p.throttle=h[0]);h[1]&&(p.debounce=h[1]);return p}(e)}e.selector=function(e,i,a){return t=i||r,n=a||p,m(e.trim()).map(h)},Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:r.vega=r.vega||{})},{}],10:[function(e,t,n){var r;r=this,function(e){"use strict";var t=function(e,t,n){return e.fields=t||[],e.fname=n,e};function n(e){return null==e?null:e.fields}var r=function(e){throw Error(e)},i=function(e){var t,n,i,a=[],o=null,s=0,l=e.length,c="";function u(){a.push(c+e.substring(t,n)),c="",t=n+1}for(e+="",t=n=0;n<l;++n)if("\\"===(i=e[n]))c+=e.substring(t,n),t=++n;else if(i===o)u(),o=null,s=-1;else{if(o)continue;t===s&&'"'===i?(t=n+1,o=i):t===s&&"'"===i?(t=n+1,o=i):"."!==i||s?"["===i?(n>t&&u(),s=t=n+1):"]"===i&&(s||r("Access path missing open bracket: "+e),s>0&&u(),s=0,t=n+1):n>t?u():t=n+1}return s&&r("Access path missing closing bracket: "+e),o&&r("Access path missing closing quote: "+e),n>t&&(n++,u()),a},a=Array.isArray,o=function(e){return e===Object(e)},s=function(e){return"string"==typeof e};function l(e){return a(e)?"["+e.map(l)+"]":o(e)||s(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var c=function(e,n){var r=i(e),a="return _["+r.map(l).join("][")+"];";return t(Function("_",a),[e=1===r.length?r[0]:e],n||e)},u=[],f=c("id"),d=t(function(e){return e},u,"identity"),p=t(function(){return 0},u,"zero"),g=t(function(){return 1},u,"one"),m=t(function(){return!0},u,"true"),h=t(function(){return!1},u,"false");function v(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var y=function(e){return e[e.length-1]},b=function(e){return null==e||""===e?null:+e};function _(e){return function(t){return e*Math.exp(t)}}function O(e){return function(t){return Math.log(e*t)}}function S(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function E(e,t,n,r){var i=n(e[0]),a=n(y(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function x(e,t,n,r,i){var a=r(e[0]),o=r(y(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}var w=function(e){return null!=e?a(e)?e:[e]:[]},N=function(e){return"function"==typeof e},T={},P=function(e){return"[object Date]"===Object.prototype.toString.call(e)},D=function(e){return"number"==typeof e},k=function(e,t){for(var n="";--t>=0;)n+=e;return n};function j(e){return D(e)?e:P(e)?e:Date.parse(e)}e.accessor=t,e.accessorName=function(e){return null==e?null:e.fname},e.accessorFields=n,e.id=f,e.identity=d,e.zero=p,e.one=g,e.truthy=m,e.falsy=h,e.logger=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return t>=1&&v("error","ERROR",arguments),this},warn:function(){return t>=2&&v("warn","WARN",arguments),this},info:function(){return t>=3&&v("log","INFO",arguments),this},debug:function(){return t>=4&&v("log","DEBUG",arguments),this}}},e.None=0,e.Error=1,e.Warn=2,e.Info=3,e.Debug=4,e.panLinear=function(e,t){return E(e,t,b,d)},e.panLog=function(e,t){var n=Math.sign(e[0]);return E(e,t,O(n),_(n))},e.panPow=function(e,t,n){return E(e,t,S(n),S(1/n))},e.zoomLinear=function(e,t,n){return x(e,t,n,b,d)},e.zoomLog=function(e,t,n){var r=Math.sign(e[0]);return x(e,t,n,O(r),_(r))},e.zoomPow=function(e,t,n,r){return x(e,t,n,S(r),S(1/r))},e.array=w,e.compare=function(e,r){var a,o,s,c,u,f,d,p,g,m=[],h=(e=w(e)).map(function(e,t){return null==e?null:(m.push(t),N(e)?e:i(e).map(l).join("]["))}),v=m.length-1,y=w(r),b="var u,v;return ";if(v<0)return null;for(o=0;o<=v;++o)s=h[a=m[o]],N(s)?(c="(u=this."+(f="f"+a)+"(a))",u="(v=this."+f+"(b))",(d=d||{})[f]=s):(c="(u=a["+s+"])",u="(v=b["+s+"])"),f="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==y[a]?(g=1,p=-1):(g=-1,p=1),b+="("+c+"<"+u+"||u==null)&&v!=null?"+p+":(u>v||v==null)&&u!=null?"+g+":"+f+"!==u&&v===v?"+p+":v!==v&&u===u?"+g+(a<v?":":":0");return s=Function("a","b",b+";"),d&&(s=s.bind(d)),e=e.reduce(function(e,t){return N(t)?(n(t)||[]).forEach(function(t){e[t]=1}):null!=t&&(e[t+""]=1),e},{}),t(s,Object.keys(e))},e.constant=function(e){return N(e)?e:function(){return e}},e.debounce=function(e,t){var n,r;function i(){t(r),n=r=null}return function(t){r=t,n&&clearTimeout(n),n=setTimeout(i,e)}},e.error=r,e.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r])e[n]=t[n];return e},e.extentIndex=function(e,t){var n,r,i,a,o,s=-1,l=e.length;if(null==t){for(;++s<l;)if(null!=(r=e[s])&&r>=r){n=i=r;break}for(a=o=s;++s<l;)null!=(r=e[s])&&(n>r&&(n=r,a=s),i<r&&(i=r,o=s))}else{for(;++s<l;)if(null!=(r=t(e[s],s,e))&&r>=r){n=i=r;break}for(a=o=s;++s<l;)null!=(r=t(e[s],s,e))&&(n>r&&(n=r,a=s),i<r&&(i=r,o=s))}return[a,o]},e.fastmap=function(e){var t,n,r={};function i(e){return r.hasOwnProperty(e)&&r[e]!==T}return t={size:0,empty:0,object:r,has:i,get:function(e){return i(e)?r[e]:void 0},set:function(e,n){return i(e)||(++t.size,r[e]===T&&--t.empty),r[e]=n,this},delete:function(e){return i(e)&&(--t.size,++t.empty,r[e]=T),this},clear:function(){t.size=t.empty=0,t.object=r={}},test:function(e){return arguments.length?(n=e,t):n},clean:function(){var e,i,a={},o=0;for(e in r)(i=r[e])===T||n&&n(i)||(a[e]=i,++o);t.size=o,t.empty=0,t.object=r=a}},e&&Object.keys(e).forEach(function(n){t.set(n,e[n])}),t},e.field=c,e.inherits=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},e.isArray=a,e.isBoolean=function(e){return"boolean"==typeof e},e.isDate=P,e.isFunction=N,e.isNumber=D,e.isObject=o,e.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},e.isString=s,e.key=function(e,n){e&&(e=n?w(e).map(function(e){return e.replace(/\\(.)/g,"$1")}):w(e));var r=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+(n?l(e):i(e).map(l).join("]["))+"]"}).join("+'|'+")+";"):function(){return""};return t(r,e,"key")},e.merge=function(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),s=0,l=0,c=0;s<i&&l<a;++c)o[c]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++c)o[c]=t[s];for(;l<a;++l,++c)o[c]=n[l];return o},e.pad=function(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?k(i,o)+a:"center"===r?k(i,~~(o/2))+a+k(i,Math.ceil(o/2)):a+k(i,o)},e.peek=y,e.repeat=k,e.splitAccessPath=i,e.stringValue=l,e.toBoolean=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)},e.toDate=function(e,t){return t=t||j,null==e||""===e?null:t(e)},e.toNumber=b,e.toString=function(e){return null==e||""===e?null:e+""},e.toSet=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},e.truncate=function(e,t,n,r){var i=null!=r?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i},e.visitArray=function(e,t,n){if(e){var r,i=0,a=e.length;if(t)for(;i<a;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}},Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof n&&void 0!==t?n:r.vega=r.vega||{})},{}],11:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.1.2",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/index.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",types:"typings/vega-lite.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",tsc:"tsc",prebuild:"mkdir -p build/site build/test-gallery",build:"npm run build:only","build:only":"npm run tsc && cp package.json build && browserify src/index.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"node node_modules/uglify-js/bin/uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && npm run build:only && npm run build:examples-only","build:examples-only":"npm run build:example && npm run build:examples-normalized","build:examples-normalized":"rm -f examples/specs/normalized/*.vl.json && scripts/build-normalized-examples","build:example":"TZ=America/Los_Angeles scripts/build-examples.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts)' -delete && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' -type f -exec rm -f {} +",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"ts-json-schema-generator --path tsconfig.json --type TopLevelExtendedSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run prebuild && npm run data && npm run build:site && npm run build:toc && npm run build:versions && scripts/create-example-pages",site:"bundle exec jekyll serve --incremental",lint:"tslint -p .",test:"npm run build:only && npm run test:only && npm run test:runtime && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run test:runtime && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:runtime":"TZ=America/Los_Angeles wdio wdio.conf.js","test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","test:debug":"npm run tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/index.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:tsc":"npm run tsc -- -w","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.1.2","@types/d3":"^4.12.0","@types/highlight.js":"^9.12.2","@types/mkdirp":"^0.5.2","@types/mocha":"^2.2.47","@types/node":"^9.3.0","@types/webdriverio":"^4.8.8",ajv:"^6.0.1","browser-sync":"^2.23.6","browserify-shim":"^3.8.14",browserify:"^15.2.0",chai:"^4.1.2",cheerio:"^1.0.0-rc.2",chromedriver:"^2.35.0",codecov:"^3.0.0",d3:"^4.12.2",exorcist:"^1.0.0","highlight.js":"^9.12.0",mkdirp:"^0.5.1",mocha:"^5.0.0",nodemon:"^1.14.11",nyc:"^11.4.1","source-map-support":"^0.5.3","svg2png-many":"^0.0.7","ts-json-schema-generator":"^0.18.0","ts-node":"^4.1.0",tsify:"^3.0.4","tslint-eslint-rules":"^4.1.1",tslint:"5.9.1",typescript:"^2.6.2","uglify-js":"^3.3.8","vega-datasets":"^1.11.0","vega-embed":"^3.0.0","vega-tooltip":"^0.5.1",vega:"^3.0.10",watchify:"^3.9.0","wdio-chromedriver-service":"^0.1.2","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.12","wdio-static-server-service":"^1.0.1",webdriverio:"^4.10.1","yaml-front-matter":"^3.4.0"},dependencies:{"@types/json-stable-stringify":"^1.0.32","json-stable-stringify":"^1.0.1",tslib:"^1.9.0","vega-event-selector":"^2.0.0","vega-util":"^1.6.2",yargs:"^11.0.0"}}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util"),i={values:1,count:1,valid:1,missing:1,distinct:1,sum:1,mean:1,average:1,variance:1,variancep:1,stdev:1,stdevp:1,median:1,q1:1,q3:1,ci0:1,ci1:1,min:1,max:1,argmin:1,argmax:1};n.AGGREGATE_OPS=r.flagKeys(i),n.isAggregateOp=function(e){return!!i[e]},n.COUNTING_OPS=["count","valid","missing","distinct"],n.isCountingAggregateOp=function(e){return e&&r.contains(n.COUNTING_OPS,e)},n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=r.toSet(n.SHARED_DOMAIN_OPS)},{"./util":125}],13:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util");n.AXIS_PROPERTY_TYPE={grid:"grid",labelOverlap:"main",offset:"main",title:"main"};var a={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},o=r({},a,{encoding:1,labelAngle:1,titleMaxLength:1}),s=r({scale:1},a,{gridScale:1,encode:1});n.isAxisProperty=function(e){return!!o[e]},n.VG_AXIS_PROPERTIES=i.flagKeys(s),n.AXIS_PROPERTIES=i.flagKeys(o)},{"./util":125}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./channel"),i=e("./util");n.binToString=function(e){return i.isBoolean(e)?"bin":"bin"+i.keys(e).map(function(t){return("_"+t+"_"+e[t]).replace(",","_")}).join("")},n.autoMaxBins=function(e){switch(e){case r.ROW:case r.COLUMN:case r.SIZE:case r.COLOR:case r.OPACITY:case r.SHAPE:return 6;default:return 10}}},{"./channel":15,"./util":125}],15:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a,o,s=e("./util");(o=a=n.Channel||(n.Channel={})).ROW="row",o.COLUMN="column",o.X="x",o.Y="y",o.X2="x2",o.Y2="y2",o.COLOR="color",o.SHAPE="shape",o.SIZE="size",o.OPACITY="opacity",o.TEXT="text",o.ORDER="order",o.DETAIL="detail",o.TOOLTIP="tooltip",o.HREF="href",n.X=a.X,n.Y=a.Y,n.X2=a.X2,n.Y2=a.Y2,n.ROW=a.ROW,n.COLUMN=a.COLUMN,n.SHAPE=a.SHAPE,n.SIZE=a.SIZE,n.COLOR=a.COLOR,n.TEXT=a.TEXT,n.DETAIL=a.DETAIL,n.ORDER=a.ORDER,n.OPACITY=a.OPACITY,n.TOOLTIP=a.TOOLTIP,n.HREF=a.HREF;var l={x:1,y:1,x2:1,y2:1,size:1,shape:1,color:1,order:1,opacity:1,text:1,detail:1,tooltip:1,href:1},c=r({},l,{row:1,column:1});n.CHANNELS=s.flagKeys(c);c.order,c.detail;var u=i(c,["order","detail"]);n.SINGLE_DEF_CHANNELS=s.flagKeys(u),n.isChannel=function(e){return!!c[e]},n.UNIT_CHANNELS=s.flagKeys(l);var f=i(l,["x","y","x2","y2"]);n.NONPOSITION_CHANNELS=s.flagKeys(f);var d={x:1,y:1};n.POSITION_SCALE_CHANNELS=s.flagKeys(d);f.text,f.tooltip,f.href,f.detail,f.order;var p=i(f,["text","tooltip","href","detail","order"]);n.NONPOSITION_SCALE_CHANNELS=s.flagKeys(p);var g=r({},d,p);function m(e){switch(e){case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.HREF:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0,geoshape:!0};case n.X:case n.Y:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0,geoshape:!0};case n.TEXT:return{text:!0}}}n.SCALE_CHANNELS=s.flagKeys(g),n.isScaleChannel=function(e){return!!g[e]},n.supportMark=function(e,t){return t in m(e)},n.getSupportedMark=m,n.rangeType=function(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:case n.HREF:return"discrete";case n.COLOR:return"flexible";case n.DETAIL:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}},{"./util":125}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=a("main"),i=a("grid");function a(e){return function(t,n){return n[e]&&t.push(n[e].combine()),t}}n.assembleAxes=function(e){return[].concat(e.x?[].concat(e.x.reduce(r,[]),e.x.reduce(i,[])):[],e.y?[].concat(e.y.reduce(r,[]),e.y.reduce(i,[])):[])}},{}],17:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e("../split").Split);n.AxisComponentPart=a},{"../split":95}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getAxisConfig=function(e,t,n,r,i){void 0===r&&(r="");for(var a=0,o=("band"===i?["axisBand"]:[]).concat(["x"===n?"axisX":"axisY","axis"+r.substr(0,1).toUpperCase()+r.substr(1),"axis"]);a<o.length;a++){var s=o[a];if(t[s]&&void 0!==t[s][e])return t[s][e]}}},{}],19:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../fielddef"),o=e("../../scale"),s=e("../../type"),l=e("../../util"),c=e("../common"),u=e("./config");function f(e,t,n){return void 0!==e.labelAngle?(e.labelAngle%360+360)%360:t===i.X&&l.contains([s.NOMINAL,s.ORDINAL],n.type)?270:void 0}function d(e,t){if(e>0){if(e%360>180)return"top"===t?"left":"right";if(e%360<180)return"top"===t?"right":"left"}else if(e<0)return d(e%360+360,t)}n.labels=function(e,t,n,i){var s=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),p=e.axis(t),g=e.config,m={};if(a.isTimeFieldDef(s)){var h=e.getScaleComponent(t).get("type")===o.ScaleType.UTC;m.text={signal:c.timeFormatExpression("datum.value",s.timeUnit,p.format,g.axis.shortTimeLabels,g.timeFormat,h)}}var v=u.getAxisConfig("labelAngle",e.config,t,i,e.getScaleComponent(t).get("type"));if(void 0===v&&(v=f(p,t,s))&&(m.angle={value:v}),void 0!==v&&"x"===t){var y=d(v,i);y&&(m.align={value:y}),l.contains([90,270],v)&&(m.baseline={value:"middle"})}return m=r({},m,n),0===l.keys(m).length?void 0:m},n.labelAngle=f,n.labelAlign=d},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../type":124,"../../util":125,"../common":24,"./config":18}],20:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../axis"),a=e("../../channel"),o=e("../../util"),s=e("../common"),l=e("../resolve"),c=e("../split"),u=e("./component"),f=e("./config"),d=e("./encode"),p=e("./properties"),g=["domain","grid","labels","ticks","title"];n.parseUnitAxis=function(e){return a.POSITION_SCALE_CHANNELS.reduce(function(t,n){if(e.component.scales[n]&&e.axis(n)){var r={},i=O(n,e);i&&y(i)&&(r.main=i);var a=_(n,e);a&&y(a)&&(r.grid=a),t[n]=[r]}return t},{})};var m={bottom:"top",top:"bottom",left:"right",right:"left"};function h(e,t){if(!e)return t.map(function(e){return r({},e.main?{main:e.main.clone()}:{},e.grid?{grid:e.grid.clone()}:{})});if(e.length===t.length){for(var n=e.length,i=0;i<n;i++){var a=e[i].main,o=t[i].main;if(!!a!=!!o)return;if(a&&o){var s=a.getWithExplicit("orient"),l=o.getWithExplicit("orient");if(s.explicit&&l.explicit&&s.value!==l.value)return;e[i].main=v(a,o)}var c=e[i].grid,u=t[i].grid;if(!!c!=!!u)return;c&&u&&(e[i].grid=v(c,u))}return e}}function v(e,t){for(var n=function(n){var r=c.mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return s.titleMerger(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return c.defaultTieBreaker(e,t,n,"axis")});e.setWithExplicit(n,r)},r=0,a=i.VG_AXIS_PROPERTIES;r<a.length;r++){n(a[r])}return e}function y(e){return o.some(g,function(t){return b(e,t)})}function b(e,t){return"axis"===t||("grid"===t||"title"===t?!!e.get(t):!(!1===(n=e.get(t))||null===n));var n}function _(e,t){return S(e,t,!0)}function O(e,t){return S(e,t,!1)}function S(e,t,n){var r=t.axis(e),a=new u.AxisComponentPart;i.VG_AXIS_PROPERTIES.forEach(function(o){var l=function(e,t,n,r,a){var o=r.fieldDef(n);if(a&&"main"===i.AXIS_PROPERTY_TYPE[e]||!a&&"grid"===i.AXIS_PROPERTY_TYPE[e])return;switch(e){case"scale":return r.scaleName(n);case"gridScale":return p.gridScale(r,n,a);case"domain":return p.domain(e,t,a,n);case"format":return s.numberFormat(o,t.format,r.config);case"grid":var l=r.getScaleComponent(n).get("type");return s.getSpecifiedOrDefaultValue(t.grid,p.grid(l,o));case"labels":return!a&&t.labels;case"labelFlush":return p.labelFlush(o,n,t,a);case"labelOverlap":var l=r.getScaleComponent(n).get("type");return p.labelOverlap(o,t,n,l);case"minExtent":return p.minMaxExtent(t.minExtent,a);case"maxExtent":return p.minMaxExtent(t.maxExtent,a);case"orient":return s.getSpecifiedOrDefaultValue(t.orient,p.orient(n));case"tickCount":var l=r.getScaleComponent(n).get("type"),c="x"===n?"width":"y"===n?"height":void 0,u=c?r.getSizeSignalRef(c):void 0;return s.getSpecifiedOrDefaultValue(t.tickCount,p.tickCount(n,o,l,u));case"ticks":return p.ticks(e,t,a,n);case"title":return s.getSpecifiedOrDefaultValue(t.title,p.title(t.titleMaxLength,o,r.config));case"values":return p.values(t,r,o);case"zindex":return s.getSpecifiedOrDefaultValue(t.zindex,p.zindex(a))}return i.isAxisProperty(e)?t[e]:void 0}(o,r,e,t,n);if(void 0!==l){var c="values"===o?!!r.values:"encode"===o?!!r.encoding||!!r.labelAngle:l===r[o],u=f.getAxisConfig(o,t.config,e,a.get("orient"),t.getScaleComponent(e).get("type"));(c||void 0===u||n)&&a.set(o,l,c)}});var l=r.encoding||{},c=g.reduce(function(n,r){if(!b(a,r))return n;var i="labels"===r?d.labels(t,e,l.labels||{},a.get("orient")):l[r]||{};return void 0!==i&&o.keys(i).length>0&&(n[r]={update:i}),n},{});return o.keys(c).length>0&&a.set("encode",c,!!r.encoding||!!r.labelAngle),a}n.parseLayerAxis=function(e){for(var t=e.component,n=t.axes,r=t.resolve,i={top:0,bottom:0,right:0,left:0},a=0,s=e.children;a<s.length;a++){(y=s[a]).parseAxisAndHeader();for(var c=0,u=o.keys(y.component.axes);c<u.length;c++){var f=u[c];r.axis[f]=l.parseGuideResolve(e.component.resolve,f),"shared"===r.axis[f]&&(n[f]=h(n[f],y.component.axes[f]),n[f]||(r.axis[f]="independent",delete n[f]))}}for(var d=0,p=["x","y"];d<p.length;d++){f=p[d];for(var g=0,v=e.children;g<v.length;g++){var y;if((y=v[g]).component.axes[f]){if("independent"===r.axis[f]){n[f]=(n[f]||[]).concat(y.component.axes[f]);for(var b=0,_=y.component.axes[f];b<_.length;b++){var O=_[b],S=O.main.getWithExplicit("orient"),E=S.value,x=S.explicit;if(i[E]>0&&!x){var w=m[E];i[E]>i[w]&&O.main.set("orient",w,!1)}i[E]++}}delete y.component.axes[f]}}}},n.parseGridAxis=_,n.parseMainAxis=O},{"../../axis":13,"../../channel":15,"../../util":125,"../common":24,"../resolve":75,"../split":95,"./component":17,"./config":18,"./encode":19,"./properties":21}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../bin"),i=e("../../channel"),a=e("../../datetime"),o=e("../../fielddef"),s=e("../../log"),l=e("../../scale"),c=e("../../type"),u=e("../../util");function f(e,t,n,r){return!n&&t[e]}n.domainAndTicks=f,n.domain=f,n.ticks=f,n.grid=function(e,t){return!l.hasDiscreteDomain(e)&&!t.bin},n.gridScale=function(e,t,n){if(n){var r="x"===t?"y":"x";if(e.getScaleComponent(r))return e.scaleName(r)}},n.labelFlush=function(e,t,n,r){if(!r)return void 0!==n.labelFlush?n.labelFlush:!("x"!==t||!u.contains(["quantitative","temporal"],e.type))||void 0},n.labelOverlap=function(e,t,n,r){return void 0!==t.labelOverlap?t.labelOverlap:"nominal"!==e.type?"log"!==r||"greedy":void 0},n.minMaxExtent=function(e,t){return t?0:e},n.orient=function(e){switch(e){case i.X:return"bottom";case i.Y:return"left"}throw new Error(s.message.INVALID_CHANNEL_FOR_AXIS)},n.tickCount=function(e,t,n,r){if(!l.hasDiscreteDomain(n)&&"log"!==n&&!u.contains(["month","hours","day","quarter"],t.timeUnit))return t.bin?{signal:"ceil("+r.signal+"/20)"}:{signal:"ceil("+r.signal+"/40)"}},n.title=function(e,t,n){var r=o.title(t,n);return e?u.truncate(r,e):r},n.values=function(e,t,n){var i=e.values;if(e.values&&a.isDateTime(i[0]))return i.map(function(e){return{signal:a.dateTimeExpr(e,!0)}});if(!i&&n.bin&&n.type===c.QUANTITATIVE){var o=t.getName(r.binToString(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+o+".start, "+o+".stop + "+o+".step, "+o+".step)"}}return i},n.zindex=function(e){return e?0:1}},{"../../bin":14,"../../channel":15,"../../datetime":103,"../../fielddef":106,"../../log":110,"../../scale":115,"../../type":124,"../../util":125}],22:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../util"),s=e("./data/parse"),l=e("./layoutsize/assemble"),c=function(e){function t(t,n,r,i,a){return e.call(this,t,n,r,i,a)||this}return i(t,e),t.prototype.parseData=function(){this.component.data=s.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=function(t){t.parseSelection(),o.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})},n=0,r=this.children;n<r.length;n++){t(r[n])}},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},l.assembleLayoutSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleLayoutSize();return a({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})},t}(e("./model").Model);n.BaseConcatModel=c},{"../util":125,"./data/parse":42,"./layoutsize/assemble":49,"./model":69}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../log"),i=e("../spec"),a=e("./concat"),o=e("./facet"),s=e("./layer"),l=e("./repeat"),c=e("./unit");n.buildModel=function(e,t,n,u,f,d,p){if(i.isFacetSpec(e))return new o.FacetModel(e,t,n,f,d);if(i.isLayerSpec(e))return new s.LayerModel(e,t,n,u,f,d,p);if(i.isUnitSpec(e))return new c.UnitModel(e,t,n,u,f,d,p);if(i.isRepeatSpec(e))return new l.RepeatModel(e,t,n,f,d);if(i.isConcatSpec(e))return new a.ConcatModel(e,t,n,f,d);throw new Error(r.message.INVALID_SPEC)}},{"../log":110,"../spec":118,"./concat":26,"./facet":46,"./layer":47,"./repeat":73,"./unit":96}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../channel"),i=e("../fielddef"),a=e("../scale"),o=e("../timeunit"),s=e("../type"),l=e("../util");function c(e){return[].concat(e.type,e.style||[])}function u(e,t,n){var r=n.mark[e],i=n[t.type];void 0!==i[e]&&(r=i[e]);for(var a=0,o=c(t);a<o.length;a++){var s=o[a],l=n.style[s],u=e;l&&void 0!==l[u]&&(r=l[u])}return r}function f(e,t,n){if(e.type===s.QUANTITATIVE)return t||n.numberFormat}function d(e,t){return"format("+e+', "'+(t||"")+'")'}function p(e,t,n){return d(e,t||n.numberFormat)}function g(e,t,n,r){return e+" === null || isNaN("+e+') ? "null" : '+p(e,n,r)+' + " - " + '+p(t,n,r)}function m(e,t,n,r,i,a){if(!t||n){var s=n||i;return a?"utcFormat("+e+", '"+s+"')":"timeFormat("+e+", '"+s+"')"}return o.formatExpression(t,e,r,a)}n.applyConfig=function(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],o=t[a];void 0!==o&&(e[a]={value:o})}return e},n.applyMarkConfig=function(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],o=u(a,t.markDef,t.config);void 0!==o&&(e[a]={value:o})}return e},n.getStyles=c,n.getMarkConfig=u,n.formatSignalRef=function(e,t,n,r){var o=f(e,t,r);if(e.bin)return{signal:g(i.vgField(e,{expr:n}),i.vgField(e,{expr:n,binSuffix:"end"}),o,r)};if("quantitative"===e.type)return{signal:""+d(i.vgField(e,{expr:n}),o)};if(i.isTimeFieldDef(e)){var s=i.isScaleFieldDef(e)&&e.scale&&e.scale.type===a.ScaleType.UTC;return{signal:m(i.vgField(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat,s)}}return{signal:"''+"+i.vgField(e,{expr:n})}},n.getSpecifiedOrDefaultValue=function(e,t){return void 0!==e?e:t},n.numberFormat=f,n.numberFormatExpr=p,n.binFormatExpression=g,n.timeFormatExpression=m,n.sortParams=function(e,t){return(l.isArray(e)?e:[e]).reduce(function(e,n){return e.field.push(i.vgField(n,t)),e.order.push(n.sort||"ascending"),e},{field:[],order:[]})},n.titleMerger=function(e,t){return{explicit:e.explicit,value:e.value===t.value?e.value:e.value+", "+t.value}},n.binRequiresRange=function(e,t){return e.bin?r.isScaleChannel(t)&&l.contains(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}},{"../channel":15,"../fielddef":106,"../scale":115,"../timeunit":120,"../type":124,"../util":125}],25:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../config"),a=e("../fielddef"),o=e("../log"),s=e("../spec"),l=e("../toplevelprops"),c=e("../util"),u=e("./buildmodel"),f=e("./data/assemble"),d=e("./data/optimize");n.compile=function(e,t){void 0===t&&(t={}),t.logger&&o.set(t.logger),t.fieldTitle&&a.setTitleFormatter(t.fieldTitle);try{var n=i.initConfig(c.mergeDeep({},t.config,e.config)),p=s.normalize(e,n),g=l.normalizeAutoSize(e.autosize,n.autosize,s.isLayerSpec(p)||s.isUnitSpec(p)),m=u.buildModel(p,null,"",void 0,void 0,n,"fit"===g.type);return m.parse(),d.optimizeDataflow(m.component.data),h=m,x=e,w=n,N=g,v=r({autosize:1===c.keys(N).length&&N.type?N.type:N},l.extractTopLevelProperties(w),l.extractTopLevelProperties(x)),y=h.config?i.stripAndRedirectConfig(h.config):void 0,b=[].concat(h.assembleSelectionData([]),f.assembleRootData(h.component.data)),_=h.assembleProjections(),O=h.assembleTitle(),S=h.assembleGroupStyle(),E=(E=h.assembleLayoutSignals()).filter(function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(v[e.name]=+e.value,!1)}),{spec:r({$schema:"https://vega.github.io/schema/vega/v3.0.json"},h.description?{description:h.description}:{},v,O?{title:O}:{},S?{style:S}:{},{data:b},_.length>0?{projections:_}:{},h.assembleGroup(E.concat(h.assembleSelectionTopLevelSignals([]))),y?{config:y}:{})}}finally{t.logger&&o.reset(),t.fieldTitle&&a.resetTitleFormatter()}var h,v,y,b,_,O,S,E,x,w,N}},{"../config":101,"../fielddef":106,"../log":110,"../spec":118,"../toplevelprops":122,"../util":125,"./buildmodel":23,"./data/assemble":28,"./data/optimize":40}],26:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../log"),s=e("../spec"),l=e("./baseconcat"),c=e("./buildmodel"),u=e("./layoutsize/parse"),f=function(e){function t(t,n,r,i,a){var l=e.call(this,t,n,r,a,t.resolve)||this;return l.type="concat",t.resolve&&t.resolve.axis&&("shared"===t.resolve.axis.x||"shared"===t.resolve.axis.y)&&o.warn(o.message.CONCAT_CANNOT_SHARE_AXIS),l.isVConcat=s.isVConcatSpec(t),l.children=(s.isVConcatSpec(t)?t.vconcat:t.hconcat).map(function(e,t){return c.buildModel(e,l,l.getName("concat_"+t),void 0,i,a,!1)}),l}return i(t,e),t.prototype.parseLayoutSize=function(){u.parseConcatLayoutSize(this)},t.prototype.parseAxisGroup=function(){return null},t.prototype.assembleLayout=function(){return a({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},t}(l.BaseConcatModel);n.ConcatModel=f},{"../log":110,"../spec":118,"./baseconcat":22,"./buildmodel":23,"./layoutsize/parse":50}],27:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),c=e("../../util"),u=e("../common");var f=function(e){function t(t,n){var r=e.call(this)||this;return r.dimensions=t,r.measures=n,r}return i(t,e),t.prototype.clone=function(){return new t(a({},this.dimensions),c.duplicate(this.measures))},t.makeFromEncoding=function(e){var n=!1;e.forEachFieldDef(function(e){e.aggregate&&(n=!0)});var r={},i={};return n?(e.forEachFieldDef(function(t,n){var a,l,c;t.aggregate?"count"===t.aggregate?(r["*"]=r["*"]||{},r["*"].count=s.vgField(t,{aggregate:"count"})):(r[t.field]=r[t.field]||{},r[t.field][t.aggregate]=s.vgField(t),o.isScaleChannel(n)&&"unaggregated"===e.scaleDomain(n)&&(r[t.field].min=s.vgField(t,{aggregate:"min"}),r[t.field].max=s.vgField(t,{aggregate:"max"}))):(a=i,l=n,(c=t).bin?(a[s.vgField(c,{})]=!0,a[s.vgField(c,{binSuffix:"end"})]=!0,u.binRequiresRange(c,l)&&(a[s.vgField(c,{binSuffix:"range"})]=!0)):a[s.vgField(c)]=!0)}),c.keys(i).length+c.keys(r).length===0?null:new t(i,r)):null},t.makeFromTransform=function(e){for(var n={},r={},i=0,a=e.aggregate;i<a.length;i++){(u=a[i]).op&&("count"===u.op?(r["*"]=r["*"]||{},r["*"].count=u.as||s.vgField(u)):(r[u.field]=r[u.field]||{},r[u.field][u.op]=u.as||s.vgField(u)))}for(var o=0,l=e.groupby;o<l.length;o++){var u;n[u=l[o]]=!0}return c.keys(n).length+c.keys(r).length===0?null:new t(n,r)},t.prototype.merge=function(e){c.differ(this.dimensions,e.dimensions)?l.debug("different dimensions, cannot merge"):(!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=r[i]:e[n]={op:r[i]})}}(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return c.keys(this.dimensions).forEach(function(t){return e[t]=!0}),c.keys(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return c.keys(this.measures).forEach(function(n){c.keys(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){for(var e=[],t=[],n=[],r=0,i=c.keys(this.measures);r<i.length;r++)for(var a=i[r],o=0,s=c.keys(this.measures[a]);o<s.length;o++){var l=s[o];n.push(this.measures[a][l]),e.push(l),t.push(a)}return{type:"aggregate",groupby:c.keys(this.dimensions),ops:e,fields:t,as:n}},t}(e("./dataflow").DataFlowNode);n.AggregateNode=f},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../util":125,"../common":24,"./dataflow":31}],28:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../data"),a=e("../../util"),o=e("./aggregate"),s=e("./bin"),l=e("./calculate"),c=e("./dataflow"),u=e("./facet"),f=e("./filter"),d=e("./filterinvalid"),p=e("./formatparse"),g=e("./geojson"),m=e("./geopoint"),h=e("./indentifier"),v=e("./lookup"),y=e("./source"),b=e("./stack"),_=e("./timeunit");function O(e){var t=0;return function n(a,O){a instanceof y.SourceNode&&(i.isUrlData(a.data)||(e.push(O),O={name:null,source:O.name,transform:[]}));if(a instanceof p.ParseNode&&(a.parent instanceof y.SourceNode&&!O.source?O.format=r({},O.format||{},{parse:a.assembleFormatParse()}):O.transform=O.transform.concat(a.assembleTransforms())),a instanceof u.FacetNode)return O.name||(O.name="data_"+t++),!O.source||O.transform.length>0?(e.push(O),a.data=O.name):a.data=O.source,void a.assemble().forEach(function(t){return e.push(t)});(a instanceof f.FilterNode||a instanceof l.CalculateNode||a instanceof m.GeoPointNode||a instanceof g.GeoJSONNode||a instanceof o.AggregateNode||a instanceof v.LookupNode||a instanceof h.IdentifierNode)&&O.transform.push(a.assemble()),(a instanceof d.FilterInvalidNode||a instanceof s.BinNode||a instanceof _.TimeUnitNode||a instanceof b.StackNode)&&(O.transform=O.transform.concat(a.assemble())),a instanceof o.AggregateNode&&(O.name||(O.name="data_"+t++)),a instanceof c.OutputNode&&(O.source&&0===O.transform.length?a.setSource(O.source):a.parent instanceof c.OutputNode?a.setSource(O.name):(O.name||(O.name="data_"+t++),a.setSource(O.name),1===a.numChildren()&&(e.push(O),O={name:null,source:O.name,transform:[]})));switch(a.numChildren()){case 0:a instanceof c.OutputNode&&(!O.source||O.transform.length>0)&&e.push(O);break;case 1:n(a.children[0],O);break;default:O.name||(O.name="data_"+t++);var S=O.name;!O.source||O.transform.length>0?e.push(O):S=O.source,a.children.forEach(function(e){n(e,{name:null,source:S,transform:[]})})}}}n.assembleFacetData=function(e){var t=[],n=O(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t},n.assembleRootData=function(e){var t=a.vals(e.sources),n=[],r=O(n),i=0;t.forEach(function(e){e.hasName()||(e.dataName="source_"+i++);var t=e.assemble();r(e,t)}),n.forEach(function(e){0===e.transform.length&&delete e.transform}),n.sort(function(e,t){return 0===(e.transform||[]).length?-1:0===(t.transform||[]).length?1:0});for(var o=0,s=n;o<s.length;o++)for(var l=0,c=s[o].transform||[];l<c.length;l++){var u=c[l];"lookup"===u.type&&(u.from=e.outputNodes[u.from].getSource())}return n}},{"../../data":102,"../../util":125,"./aggregate":27,"./bin":29,"./calculate":30,"./dataflow":31,"./facet":32,"./filter":33,"./filterinvalid":34,"./formatparse":35,"./geojson":36,"./geopoint":37,"./indentifier":38,"./lookup":39,"./source":43,"./stack":44,"./timeunit":45}],29:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../bin"),s=e("../../fielddef"),l=e("../../util"),c=e("../common"),u=e("../model");function f(e,t){var n;n="as"in e?[e.as,e.as+"_end"]:[s.vgField(e,{}),s.vgField(e,{binSuffix:"end"})];var r,i,l=s.normalizeBin(e.bin,void 0)||{},c=(r=l,i=e.field,o.binToString(r)+"_"+i),u=function(e,t){if(e.model){var n=e.model;return{signal:n.getName(t+"_bins"),extentSignal:n.getName(t+"_extent")}}return e}(t,c),f=u.signal,d=u.extentSignal;return{key:c,binComponent:a({bin:l,field:e.field,as:n},f?{signal:f}:{},d?{extentSignal:d}:{})}}var d=function(e){function t(t){var n=e.call(this)||this;return n.bins=t,n}return i(t,e),t.prototype.clone=function(){return new t(l.duplicate(this.bins))},t.makeBinFromEncoding=function(e){var n=e.reduceFieldDef(function(t,n,r){if(n.bin){var i=f(n,{model:e}),o=i.key,l=i.binComponent;t[o]=a({},l,t[o],function(e,t,n,r){if(c.binRequiresRange(t,n)){var i=u.isUnitModel(e)&&(e.axis(n)||e.legend(n))||{},a=s.vgField(t,{expr:"datum"}),o=s.vgField(t,{expr:"datum",binSuffix:"end"});return{formulaAs:s.vgField(t,{binSuffix:"range"}),formula:c.binFormatExpression(a,o,i.format,r)}}return{}}(e,n,r,e.config))}return t},{});return 0===l.keys(n).length?null:new t(n)},t.makeFromTransform=function(e,n){var r,i=f(e,n),a=i.key,o=i.binComponent;return new t(((r={})[a]=o,r))},t.prototype.merge=function(e){this.bins=a({},this.bins,e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return l.vals(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return l.vals(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return l.flatten(l.vals(this.bins).map(function(e){var t=[],n=a({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(e("./dataflow").DataFlowNode);n.BinNode=d},{"../../bin":14,"../../fielddef":106,"../../util":125,"../common":24,"../model":69,"./dataflow":31}],30:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../util"),o=function(e){function t(t){var n=e.call(this)||this;return n.transform=t,n}return i(t,e),t.prototype.clone=function(){return new t(a.duplicate(this.transform))},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(e("./dataflow").DataFlowNode);n.CalculateNode=o},{"../../util":125,"./dataflow":31}],31:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e){this.debugName=e,this._children=[],this._parent=null}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++){t[e].parent=this._parent}this._parent.removeChild(this)},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,r=this._children;n<r.length;n++){r[n].parent=e}this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}();n.DataFlowNode=a;var o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.type=n,i.refCounts=r,i._source=i._name=t,!i.refCounts||i._name in i.refCounts||(i.refCounts[i._name]=0),i}return i(t,e),t.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},t.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},t.prototype.isRequired=function(){return!!this.refCounts[this._name]},t.prototype.setSource=function(e){this._source=e},t}(a);n.OutputNode=o},{}],32:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../log"),l=e("../../scale"),c=e("../../vega.schema"),u=e("../scale/domain"),f=function(e){function t(t,n,r){var i=e.call(this)||this;return i.model=t,i.name=n,i.data=r,t.facet.column&&(i.columnFields=[t.vgField(o.COLUMN)],i.columnName=t.getName("column_domain"),t.fieldDef(o.COLUMN).bin&&i.columnFields.push(t.vgField(o.COLUMN,{binSuffix:"end"}))),t.facet.row&&(i.rowFields=[t.vgField(o.ROW)],i.rowName=t.getName("row_domain"),t.fieldDef(o.ROW).bin&&i.rowFields.push(t.vgField(o.ROW,{binSuffix:"end"}))),i.childModel=t.child,i}return i(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){var e=[];return this.columnFields&&(e=e.concat(this.columnFields)),this.rowFields&&(e=e.concat(this.rowFields)),e},enumerable:!0,configurable:!0}),t.prototype.getSource=function(){return this.name},t.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var r=n[t],i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type"),o=i.get("range");if(l.hasDiscreteDomain(a)&&c.isVgRangeStep(o)){var f=u.assembleDomain(this.childModel,r),d=u.getFieldFromDomain(f);d?e[r]=d:s.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},t.prototype.assembleRowColumnData=function(e,t,n){var r={},i="row"===e?"y":"x";return n[i]&&(r=t?{fields:["distinct_"+n[i]],ops:["max"],as:["distinct_"+n[i]]}:{fields:[n[i]],ops:["distinct"]}),{name:"row"===e?this.rowName:this.columnName,source:t||this.data,transform:[a({type:"aggregate",groupby:"row"===e?this.rowFields:this.columnFields},r)]}},t.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(n.x||n.y)){t="cross_"+this.columnName+"_"+this.rowName;var r=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),i=r.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:r,ops:i}]})}return this.columnName&&e.push(this.assembleRowColumnData("column",t,n)),this.rowName&&e.push(this.assembleRowColumnData("row",t,n)),e},t}(e("./dataflow").DataFlowNode);n.FacetNode=f},{"../../channel":15,"../../log":110,"../../scale":115,"../../vega.schema":127,"../scale/domain":78,"./dataflow":31}],33:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../predicate"),o=e("../../util"),s=function(e){function t(t,n){var r=e.call(this)||this;return r.model=t,r.filter=n,r.expr=a.expression(r.model,r.filter,r),r}return i(t,e),t.prototype.clone=function(){return new t(this.model,o.duplicate(this.filter))},t.prototype.assemble=function(){return{type:"filter",expr:this.expr}},t}(e("./dataflow").DataFlowNode);n.FilterNode=s},{"../../predicate":113,"../../util":125,"./dataflow":31}],34:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../fielddef"),l=e("../../scale"),c=e("../../util"),u=function(e){function t(t){var n=e.call(this)||this;return n.fieldDefs=t,n}return i(t,e),t.prototype.clone=function(){return new t(a({},this.fieldDefs))},t.make=function(e){if("filter"!==e.config.invalidValues)return null;var n=e.reduceFieldDef(function(t,n,r){var i=o.isScaleChannel(r)&&e.getScaleComponent(r);if(i){var a=i.get("type");l.hasContinuousDomain(a)&&!n.aggregate&&(t[n.field]=n)}return t},{});return c.keys(n).length?new t(n):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this,t=c.keys(this.filter).reduce(function(t,n){var r=e.fieldDefs[n],i=s.vgField(r,{expr:"datum"});return null!==r&&(t.push(i+" !== null"),t.push("!isNaN("+i+")")),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(e("./dataflow").DataFlowNode);n.FilterInvalidNode=u},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../util":125,"./dataflow":31}],35:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../aggregate"),s=e("../../fielddef"),l=e("../../log"),c=e("../../logical"),u=e("../../predicate"),f=e("../../transform"),d=e("../../util"),p=e("../model");var g=function(e){function t(t){var n=e.call(this)||this;return n._parse={},n._parse=t,n}return i(t,e),t.prototype.clone=function(){return new t(d.duplicate(this.parse))},t.make=function(e){var n={},r={};(e.transforms||[]).forEach(function(e){f.isCalculate(e)?r[e.as]=!0:f.isFilter(e)&&c.forEachLeave(e.filter,function(e){u.isFieldPredicate(e)&&e.timeUnit&&(n[e.field]="date")})},{}),(p.isUnitModel(e)||p.isFacetModel(e))&&e.forEachFieldDef(function(e){if(s.isTimeFieldDef(e))n[e.field]="date";else if(s.isNumberFieldDef(e)){if(r[e.field]||o.isCountingAggregateOp(e.aggregate))return;n[e.field]="number"}});var i=e.data;if(i&&i.format&&i.format.parse){var a=i.format.parse;d.keys(a).forEach(function(e){n[e]=a[e]})}var g=e.component.data.ancestorParse;return d.keys(g).forEach(function(e){n[e]!==g[e]?l.warn(l.message.differentParse(e,n[e],g[e])):delete n[e]}),0===d.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=a({},this._parse,e.parse),e.remove()},t.prototype.assembleFormatParse=function(){return this._parse},t.prototype.producedFields=function(){return d.toSet(d.keys(this.parse))},t.prototype.dependentFields=function(){return d.toSet(d.keys(this.parse))},t.prototype.assembleTransforms=function(){var e=this;return d.keys(this._parse).map(function(t){var n,r,i,a=(n=t,r=e._parse[t],i="datum"+d.accessPath(n),"number"===r?"toNumber("+i+")":"boolean"===r?"toBoolean("+i+")":"string"===r?"toString("+i+")":"date"===r?"toDate("+i+")":0===r.indexOf("date:")?"timeParse("+i+","+r.slice(5,r.length)+")":0===r.indexOf("utc:")?"utcParse("+i+","+r.slice(4,r.length)+")":(l.warn(l.message.unrecognizedParse(r)),null));return a?{type:"formula",expr:a,as:t}:null}).filter(function(e){return null!==e})},t}(e("./dataflow").DataFlowNode);n.ParseNode=g},{"../../aggregate":12,"../../fielddef":106,"../../log":110,"../../logical":111,"../../predicate":113,"../../transform":123,"../../util":125,"../model":69,"./dataflow":31}],36:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../type"),l=e("../../util"),c=function(e){function t(t,n,r){var i=e.call(this)||this;return i.fields=t,i.geojson=n,i.signal=r,i}return i(t,e),t.prototype.clone=function(){return new t(l.duplicate(this.fields),this.geojson,this.signal)},t.makeAll=function(e){for(var n=[],r=0,i=[[o.X,o.Y],[o.X2,o.Y2]];r<i.length;r++){for(var a={},c=0,u=i[r];c<u.length;c++){var f=u[c];if(e.channelHasField(f)){var d=e.fieldDef(f);l.contains([s.LATITUDE,s.LONGITUDE],d.type)&&(a[d.type]=d.field)}}(s.LONGITUDE in a||s.LATITUDE in a)&&n.push(new t([a[s.LONGITUDE],a[s.LATITUDE]],null,e.getName("geojson_"+n.length)))}e.channelHasField(o.SHAPE)&&((d=e.fieldDef(o.SHAPE)).type===s.GEOJSON&&n.push(new t(null,d.field,e.getName("geojson_"+n.length))));return n},t.prototype.assemble=function(){return a({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})},t}(e("./dataflow").DataFlowNode);n.GeoJSONNode=c},{"../../channel":15,"../../type":124,"../../util":125,"./dataflow":31}],37:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../type"),s=e("../../util"),l=function(e){function t(t,n,r){var i=e.call(this)||this;return i.projection=t,i.fields=n,i.as=r,i}return i(t,e),t.prototype.clone=function(){return new t(this.projection,s.duplicate(this.fields),s.duplicate(this.as))},t.makeAll=function(e){var n=[];if(!e.projectionName())return n;for(var r=0,i=[[a.X,a.Y],[a.X2,a.Y2]];r<i.length;r++){for(var l={},c=0,u=i[r];c<u.length;c++){var f=u[c];if(e.channelHasField(f)){var d=e.fieldDef(f);s.contains([o.LATITUDE,o.LONGITUDE],d.type)&&(l[d.type]=d.field)}}(o.LONGITUDE in l||o.LATITUDE in l)&&n.push(new t(e.projectionName(),[l[o.LONGITUDE],l[o.LATITUDE]],[l[o.LONGITUDE]+"_geo",l[o.LATITUDE]+"_geo"]))}return n},t.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}},t}(e("./dataflow").DataFlowNode);n.GeoPointNode=l},{"../../channel":15,"../../type":124,"../../util":125,"./dataflow":31}],38:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../selection"),o=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.clone=function(){return new t},t.prototype.producedFields=function(){return(e={})[a.SELECTION_ID]=!0,e;var e},t.prototype.assemble=function(){return{type:"identifier",as:a.SELECTION_ID}},t}(e("./dataflow").DataFlowNode);n.IdentifierNode=o},{"../../selection":116,"./dataflow":31}],39:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-util"),s=e("../../log"),l=e("./dataflow"),c=e("./source"),u=function(e){function t(t,n){var r=e.call(this)||this;return r.transform=t,r.secondary=n,r}return i(t,e),t.make=function(e,n,r){var i=e.component.data.sources,a=new c.SourceNode(n.from.data),o=i[a.hash()];o||(i[a.hash()]=a,o=a);var s=e.getName("lookup_"+r),u=new l.OutputNode(s,"lookup",e.component.data.outputNodeRefCounts);return u.parent=o,e.component.data.outputNodes[s]=u,new t(n,u.getSource())},t.prototype.producedFields=function(){return o.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},t.prototype.assemble=function(){var e;if(this.transform.from.fields)e=a({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;o.isString(t)||(s.warn(s.message.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return a({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},t}(l.DataFlowNode);n.LookupNode=u},{"../../log":110,"./dataflow":31,"./source":43,"vega-util":10}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../data"),i=e("../../util"),a=e("./aggregate"),o=e("./dataflow"),s=e("./facet"),l=e("./filterinvalid"),c=e("./optimizers"),u=e("./stack");function f(e){if(e instanceof s.FacetNode)if(1!==e.numChildren()||e.children[0]instanceof o.OutputNode){!function e(t){if(t instanceof o.OutputNode&&t.type===r.MAIN&&1===t.numChildren()){var n=t.children[0];n instanceof s.FacetNode||(n.swapWithParent(),e(t))}}(e.model.component.data.main),i.flatten(e.children.map((l=e,function e(t){if(!(t instanceof s.FacetNode)){var r=t.clone();if(r instanceof o.OutputNode){var c=n.FACET_SCALE_PREFIX+r.getSource();r.setSource(c),l.model.component.data.outputNodes[c]=r}else(r instanceof a.AggregateNode||r instanceof u.StackNode)&&r.addDimensions(l.fields);return i.flatten(t.children.map(e)).forEach(function(e){return e.parent=r}),[r]}return i.flatten(t.children.map(e))}))).forEach(function(t){return t.parent=e.model.component.data.main})}else{var t=e.children[0];(t instanceof a.AggregateNode||t instanceof u.StackNode)&&t.addDimensions(e.fields),t.swapWithParent(),f(e)}else e.children.forEach(f);var l}function d(e){e instanceof l.FilterInvalidNode&&i.every(i.vals(e.filter),function(e){return null===e})&&e.remove(),e instanceof o.OutputNode&&!e.isRequired()&&e.remove(),e.children.forEach(d)}function p(e){var t=[];return e.forEach(function e(n){0===n.numChildren()?t.push(n):n.children.forEach(e)}),t}n.FACET_SCALE_PREFIX="scale_",n.optimizeDataflow=function(e){var t=i.vals(e.sources);t.forEach(d),p(t=t.filter(function(e){return e.numChildren()>0})).forEach(c.iterateFromLeaves(c.removeUnusedSubtrees)),p(t=t.filter(function(e){return e.numChildren()>0})).forEach(c.iterateFromLeaves(c.moveParseUp)),p(t).forEach(c.removeDuplicateTimeUnits),t.forEach(f),i.keys(e.sources).forEach(function(t){0===e.sources[t].numChildren()&&delete e.sources[t]})}},{"../../data":102,"../../util":125,"./aggregate":27,"./dataflow":31,"./facet":32,"./filterinvalid":34,"./optimizers":41,"./stack":44}],41:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../util"),a=e("./dataflow"),o=e("./facet"),s=e("./formatparse"),l=e("./source"),c=e("./timeunit");function u(e){return function t(n){if(!(n instanceof l.SourceNode)){var r=n.parent;e(n)&&t(r)}}}n.iterateFromLeaves=u,n.moveParseUp=function(e){var t=e.parent;if(e instanceof s.ParseNode){if(t instanceof l.SourceNode)return!1;if(t.numChildren()>1)return!0;if(t instanceof s.ParseNode)t.merge(e);else{if(i.hasIntersection(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0},n.removeUnusedSubtrees=function(e){return!(e instanceof a.OutputNode||e.numChildren()>0||e instanceof o.FacetNode||(e.remove(),0))},n.removeDuplicateTimeUnits=function(e){var t={};return u(function(e){if(e instanceof c.TimeUnitNode){var n=e.producedFields();i.keys(n).every(function(e){return!!t[e]})?e.remove():t=r({},t,n)}return!0})(e)}},{"../../util":125,"./dataflow":31,"./facet":32,"./formatparse":35,"./source":43,"./timeunit":45}],42:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),a=e("../../data"),o=e("../../datetime"),s=e("../../log"),l=e("../../predicate"),c=e("../../transform"),u=e("../../util"),f=e("../model"),d=e("../selection/selection"),p=e("./aggregate"),g=e("./bin"),m=e("./calculate"),h=e("./dataflow"),v=e("./facet"),y=e("./filter"),b=e("./filterinvalid"),_=e("./formatparse"),O=e("./geojson"),S=e("./geopoint"),E=e("./indentifier"),x=e("./lookup"),w=e("./source"),N=e("./stack"),T=e("./timeunit");function P(e){var t,n,r=null,a=0;function f(e){r?e.parent?n.insertAsParentOf(e):e.parent=n:r=e.parent||e,n=e}return e.transforms.forEach(function(n){if(c.isCalculate(n))t=new m.CalculateNode(n);else if(c.isFilter(n)){var r={},h=n.filter,v=null;if(l.isFieldEqualPredicate(h)?v=h.equal:l.isFieldRangePredicate(h)?v=h.range[0]:l.isFieldOneOfPredicate(h)&&(v=(h.oneOf||h.in)[0]),v&&(o.isDateTime(v)?r[h.field]="date":i.isNumber(v)?r[h.field]="number":i.isString(v)&&(r[h.field]="string")),u.keys(r).length>0)f(new _.ParseNode(r));t=new y.FilterNode(e,n.filter)}else if(c.isBin(n))t=g.BinNode.makeFromTransform(n,{model:e});else if(c.isTimeUnit(n))t=T.TimeUnitNode.makeFromTransform(n);else if(c.isAggregate(n))t=p.AggregateNode.makeFromTransform(n),d.requiresSelectionId(e)&&(f(t),t=new E.IdentifierNode);else{if(!c.isLookup(n))return void s.warn(s.message.invalidTransformIgnored(n));t=x.LookupNode.make(e,n,a++)}f(t)}),{first:r,last:t}}n.parseTransformArray=P,n.parseData=function(e){var t=function(e,t){if(e.data||!e.parent){var n=new w.SourceNode(e.data),r=n.hash();return r in t?t[r]:(t[r]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources),n=e.component.data.outputNodes,i=e.component.data.outputNodeRefCounts,o=t;d.requiresSelectionId(e)&&!e.parent&&((I=new E.IdentifierNode).parent=o,o=I);var s=e.parent&&f.isLayerModel(e.parent);if((f.isUnitModel(e)||f.isFacetModel(e))&&s&&(y=g.BinNode.makeBinFromEncoding(e))&&(y.parent=o,o=y),e.transforms.length>0){var l=P(e),c=l.first,u=l.last;c.parent=o,o=u}var m=_.ParseNode.make(e);if(m&&(m.parent=o,o=m),f.isUnitModel(e)||f.isFacetModel(e)){var y;s||(y=g.BinNode.makeBinFromEncoding(e))&&(y.parent=o,o=y);for(var x=0,D=O.GeoJSONNode.makeAll(e);x<D.length;x++){var k=D[x];k.parent=o,o=k}for(var j=0,A=S.GeoPointNode.makeAll(e);j<A.length;j++){var C=A[j];C.parent=o,o=C}var M=T.TimeUnitNode.makeFromEncoding(e);M&&(M.parent=o,o=M)}var R=e.getName(a.RAW),F=new h.OutputNode(R,a.RAW,i);if(n[R]=F,F.parent=o,o=F,f.isUnitModel(e)){var I,L=p.AggregateNode.makeFromEncoding(e);L&&(L.parent=o,o=L,d.requiresSelectionId(e)&&((I=new E.IdentifierNode).parent=o,o=I));var U=N.StackNode.make(e);U&&(U.parent=o,o=U)}if(f.isUnitModel(e)){var z=b.FilterInvalidNode.make(e);z&&(z.parent=o,o=z)}var H=e.getName(a.MAIN),G=new h.OutputNode(H,a.MAIN,i);n[H]=G,G.parent=o,o=G;var B=null;if(f.isFacetModel(e)){var q=e.getName("facet");B=new v.FacetNode(e,q,G.getSource()),n[q]=B,B.parent=o,o=B}var Y=r({},e.component.data.ancestorParse,m?m.parse:{});return r({},e.component.data,{outputNodes:n,outputNodeRefCounts:i,raw:F,main:G,facetRoot:B,ancestorParse:Y})}},{"../../data":102,"../../datetime":103,"../../log":110,"../../predicate":113,"../../transform":123,"../../util":125,"../model":69,"../selection/selection":85,"./aggregate":27,"./bin":29,"./calculate":30,"./dataflow":31,"./facet":32,"./filter":33,"./filterinvalid":34,"./formatparse":35,"./geojson":36,"./geopoint":37,"./indentifier":38,"./lookup":39,"./source":43,"./stack":44,"./timeunit":45,"vega-util":10}],43:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../data"),l=e("../../util"),c=function(e){function t(t){var n=e.call(this)||this;if(t=t||{name:"source"},s.isInlineData(t))n._data={values:t.values};else if(s.isUrlData(t)){if(n._data={url:t.url},t.format||(t.format={}),!t.format||!t.format.type){var r=/(?:\.([^.]+))?$/.exec(t.url)[1];l.contains(["json","csv","tsv","topojson"],r)||(r="json"),t.format.type=r}}else s.isNamedData(t)&&(n._name=t.name,n._data={});if(!s.isNamedData(t)&&t.format){var i=t.format,a=(i.parse,o(i,["parse"]));n._data.format=a}return n}return i(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},t.prototype.hash=function(){return s.isInlineData(this._data)?(this._hash||(this._hash=l.hash(this._data)),this._hash):s.isUrlData(this._data)?l.hash([this._data.url,this._data.format]):this._name},t.prototype.assemble=function(){return a({name:this._name},this._data,{transform:[]})},t}(e("./dataflow").DataFlowNode);n.SourceNode=c},{"../../data":102,"../../util":125,"./dataflow":31}],44:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),o=e("../../fielddef"),s=e("../../util"),l=e("../common");var c=function(e){function t(t){var n=e.call(this)||this;return n._stack=t,n}return i(t,e),t.prototype.clone=function(){return new t(s.duplicate(this._stack))},t.make=function(e){var n,r=e.stack;if(!r)return null;r.groupbyChannel&&(n=e.fieldDef(r.groupbyChannel));var i,a=e.stack.stackBy.reduce(function(e,t){var n=t.fieldDef,r=o.vgField(n);return r&&e.push(r),e},[]),s=e.encoding.order;return i=s?l.sortParams(s):a.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new t({dimensionFieldDef:n,field:e.vgField(r.fieldChannel),facetby:[],stackby:a,sort:i,offset:r.offset,impute:r.impute})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.field]=!0,this.getGroupbyFields().forEach(function(t){return e[t]=!0}),this._stack.facetby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return a.isArray(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute;return t?t.bin?n?[o.vgField(t,{binSuffix:"mid"})]:[o.vgField(t,{}),o.vgField(t,{binSuffix:"end"})]:[o.vgField(t)]:[]},t.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,r=t.field,i=t.dimensionFieldDef,a=t.impute,s=t.offset,l=t.sort,c=t.stackby;if(a&&i){var u=i?o.vgField(i,{binSuffix:"mid"}):void 0;i.bin&&e.push({type:"formula",expr:"("+o.vgField(i,{expr:"datum"})+"+"+o.vgField(i,{expr:"datum",binSuffix:"end"})+")/2",as:u}),e.push({type:"impute",field:r,groupby:c,key:u,method:"value",value:0})}return e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:r,sort:l,as:[r+"_start",r+"_end"],offset:s}),e},t}(e("./dataflow").DataFlowNode);n.StackNode=c},{"../../fielddef":106,"../../util":125,"../common":24,"./dataflow":31,"vega-util":10}],45:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../fielddef"),s=e("../../timeunit"),l=e("../../util"),c=function(e){function t(t){var n=e.call(this)||this;return n.formula=t,n}return i(t,e),t.prototype.clone=function(){return new t(l.duplicate(this.formula))},t.makeFromEncoding=function(e){var n=e.reduceFieldDef(function(e,t){if(t.timeUnit){var n=o.vgField(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===l.keys(n).length?null:new t(n)},t.makeFromTransform=function(e){return new t(((n={})[e.field]={as:e.as,timeUnit:e.timeUnit,field:e.field},n));var n},t.prototype.merge=function(e){this.formula=a({},this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return l.vals(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return l.vals(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return l.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:s.fieldExpr(e.timeUnit,e.field)}})},t}(e("./dataflow").DataFlowNode);n.TimeUnitNode=c},{"../../fielddef":106,"../../timeunit":120,"../../util":125,"./dataflow":31}],46:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../channel"),s=e("../encoding"),l=e("../fielddef"),c=e("../log"),u=e("../scale"),f=e("../util"),d=e("../vega.schema"),p=e("./buildmodel"),g=e("./data/assemble"),m=e("./data/parse"),h=e("./layout/header"),v=e("./layoutsize/parse"),y=e("./model"),b=e("./repeater"),_=e("./resolve"),O=e("./scale/domain"),S=function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,a,t.resolve)||this;o.type="facet",o.child=p.buildModel(t.spec,o,o.getName("child"),void 0,i,a,!1),o.children=[o.child];var s=b.replaceRepeaterInFacet(t.facet,i);return o.facet=o.initFacet(s),o}return i(t,e),t.prototype.initFacet=function(e){return s.reduce(e,function(e,t,n){return f.contains([o.ROW,o.COLUMN],n)?void 0===t.field?(c.warn(c.message.emptyFieldDef(t,n)),e):(e[n]=l.normalize(t,n),e):(c.warn(c.message.incompatibleChannel(n,"facet")),e)},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=m.parseData(this),this.child.parseData()},t.prototype.parseLayoutSize=function(){v.parseChildrenLayoutSize(this)},t.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},r=void 0!==n.title?n.title:l.title(t,this.config);this.child.component.layoutHeaders[e].title&&(r+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:r,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},t.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},t.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]){var n=this.component,r=n.layoutHeaders,i=n.resolve;if(i.axis[e]=_.parseGuideResolve(i,e),"shared"===i.axis[e])for(var a="x"===e?"column":"row",o=r[a],s=0,l=t.component.axes[e];s<l.length;s++){var c=l[s],u=c.main,f=h.getHeaderType(u.get("orient"));o[f]=o[f]||[this.makeHeaderComponent(a,!1)],o[f][0].axes.push(u.combine()),delete c.main}}},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},t.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},t.prototype.getLayoutBandMixins=function(e){for(var t={},n="header"===e?"headerBand":"footerBand",r=0,i=["row","column"];r<i.length;r++){var a=i[r],o=this.component.layoutHeaders[a][e];if(o&&o[0]){var s="row"===a?"height":"width";this.child.component.layoutSize.get(s)||(t[n]=t[n]||{},t[n][a]=.5)}}return t},t.prototype.assembleLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return a({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:e,bounds:"full",align:"all"})},t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},t.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof t))return{signal:"length(data('"+this.getName("column_domain")+"'))"}},t.prototype.assembleGroup=function(n){return this.parent&&this.parent instanceof t?a({},this.channelHasField("column")?{encode:{update:{columns:{field:l.vgField(this.facet.column,{prefix:"distinct"})}}}}:{},e.prototype.assembleGroup.call(this,n)):e.prototype.assembleGroup.call(this,n)},t.prototype.getCardinalityAggregateForChild=function(){var e=[],n=[];if(this.child instanceof t)this.child.channelHasField("column")&&(e.push(l.vgField(this.child.facet.column)),n.push("distinct"));else for(var r=0,i=["x","y"];r<i.length;r++){var a=i[r],o=this.child.component.scales[a];if(o&&!o.merged){var s=o.get("type"),f=o.get("range");if(u.hasDiscreteDomain(s)&&d.isVgRangeStep(f)){var p=O.assembleDomain(this.child,a),g=O.getFieldFromDomain(p);g?(e.push(g),n.push("distinct")):c.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e.length?{fields:e,ops:n}:void 0},t.prototype.assembleMarks=function(){var e=this.child,t=this.facet,n=this.component.data.facetRoot,r=g.assembleFacetData(n),i=this.channelHasField(o.ROW),s=this.channelHasField(o.COLUMN),l=e.assembleLayoutSize(),c={};i&&s&&(c.aggregate={cross:!0});var u=this.getCardinalityAggregateForChild();u&&(c.aggregate=a({},c.aggregate,u));var f=e.assembleTitle(),d=e.assembleGroupStyle();return[a({name:this.getName("cell"),type:"group"},f?{title:f}:{},d?{style:d}:{},{from:{facet:a({name:n.name,data:n.data,groupby:[].concat(i?[this.vgField(o.ROW)]:[],s?[this.vgField(o.COLUMN)]:[])},c)},sort:{field:[].concat(i?[this.vgField(o.ROW,{expr:"datum"})]:[],s?[this.vgField(o.COLUMN,{expr:"datum"})]:[]),order:[].concat(i?[t.row.sort||"ascending"]:[],s?[t.column.sort||"ascending"]:[])}},r.length>0?{data:r}:{},l?{encode:{update:l}}:{},e.assembleGroup())]},t.prototype.getMapping=function(){return this.facet},t}(y.ModelWithField);n.FacetModel=S},{"../channel":15,"../encoding":104,"../fielddef":106,"../log":110,"../scale":115,"../util":125,"../vega.schema":127,"./buildmodel":23,"./data/assemble":28,"./data/parse":42,"./layout/header":48,"./layoutsize/parse":50,"./model":69,"./repeater":74,"./resolve":75,"./scale/domain":78}],47:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../log"),s=e("../spec"),l=e("../util"),c=e("./axis/parse"),u=e("./data/parse"),f=e("./layoutsize/assemble"),d=e("./layoutsize/parse"),p=e("./legend/assemble"),g=e("./model"),m=e("./selection/selection"),h=e("./unit"),v=function(e){function t(n,r,i,l,c,u,f){var d=e.call(this,n,r,i,u,n.resolve)||this;d.type="layer";var p=a({},l,n.width?{width:n.width}:{},n.height?{height:n.height}:{});return d.initSize(p),d.children=n.layer.map(function(e,n){if(s.isLayerSpec(e))return new t(e,d,d.getName("layer_"+n),p,c,u,f);if(s.isUnitSpec(e))return new h.UnitModel(e,d,d.getName("layer_"+n),p,c,u,f);throw new Error(o.message.INVALID_SPEC)}),d}return i(t,e),t.prototype.parseData=function(){this.component.data=u.parseData(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},t.prototype.parseLayoutSize=function(){d.parseLayerLayoutSize(this)},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=function(t){t.parseSelection(),l.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})},n=0,r=this.children;n<r.length;n++){t(r[n])}},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},t.prototype.parseAxisAndHeader=function(){c.parseLayerAxis(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},f.assembleLayoutSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t)return t;for(var n=0,r=this.children;n<r.length;n++){if(t=r[n].assembleTitle())return t}},t.prototype.assembleLayout=function(){return null},t.prototype.assembleMarks=function(){return m.assembleLayerSelectionMarks(this,l.flatten(this.children.map(function(e){return e.assembleMarks()})))},t.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},p.assembleLegends(this))},t}(g.Model);n.LayerModel=v},{"../log":110,"../spec":118,"../util":125,"./axis/parse":20,"./data/parse":42,"./layoutsize/assemble":49,"./layoutsize/parse":50,"./legend/assemble":51,"./model":69,"./selection/selection":85,"./unit":96}],48:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../fielddef"),a=e("../../util"),o=e("../common");function s(e,t,n,s,l){if(l){var c=null,u=s.facetFieldDef;if(u&&l.labels){var f=u.header,d=void 0===f?{}:f,p=d.format,g=d.labelAngle,m=r({},void 0!==g?{angle:{value:g}}:{});c=r({text:o.formatSignalRef(u,p,"parent",e.config),offset:10,orient:"row"===t?"left":"top",style:"guide-label"},a.keys(m).length>0?{encode:{update:m}}:{})}var h=l.axes,v=h&&h.length>0;if(c||v){var y="row"===t?"height":"width";return r({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},s.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:{field:i.vgField(u,{expr:"datum"}),order:u.sort||"ascending"}}:{},c?{title:c}:{},l.sizeSignal?{encode:{update:(b={},b[y]=l.sizeSignal,b)}}:{},v?{axes:h}:{})}}return null;var b}n.HEADER_CHANNELS=["row","column"],n.HEADER_TYPES=["header","footer"],n.getHeaderType=function(e){return"top"===e||"left"===e?"header":"footer"},n.getTitleGroup=function(e,t){var n=e.component.layoutHeaders[t].title,i=r({align:{value:"center"},text:{value:n}},"vertical"===("row"===t?"vertical":void 0)?{angle:{value:270}}:{});return{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[r({type:"text",role:t+"-title-text",style:"guide-title"},a.keys(i).length>0?{encode:{update:i}}:{})]}},n.getHeaderGroups=function(e,t){for(var r=e.component.layoutHeaders[t],i=[],a=0,o=n.HEADER_TYPES;a<o.length;a++){var l=o[a];if(r[l])for(var c=0,u=r[l];c<u.length;c++){var f=u[c];i.push(s(e,t,l,r,f))}}return i}},{"../../fielddef":106,"../../util":125,"../common":24}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../scale"),i=e("../../vega.schema"),a=e("../model");function o(e,t){var n="width"===t?"x":"y",o=e.component.layoutSize.get(t);if(!o||"merged"===o)return[];var c=e.getSizeSignalRef(t).signal;if("range-step"===o){var u=e.getScaleComponent(n);if(u){var f=u.get("type"),d=u.get("range");if(r.hasDiscreteDomain(f)&&i.isVgRangeStep(d)){var p=e.scaleName(n);if(a.isFacetModel(e.parent))if("independent"===e.parent.component.resolve.scale[n])return[s(p,d)];return[s(p,d),{name:c,update:l(p,u,"domain('"+p+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:c,value:o}]}function s(e,t){return{name:e+"_step",value:t.step}}function l(e,t,n){var r=t.get("type"),i=t.get("padding"),a=t.get("paddingOuter");a=void 0!==a?a:i;var o=t.get("paddingInner");return"bandspace("+n+", "+(o="band"===r?void 0!==o?o:i:1)+", "+a+") * "+e+"_step"}n.assembleLayoutSignals=function(e){return[].concat(o(e,"width"),o(e,"height"))},n.sizeSignals=o,n.sizeExpr=l},{"../../scale":115,"../../vega.schema":127,"../model":69}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../scale"),i=e("../../vega.schema"),a=e("../split");function o(e){s(e);var t=e.component.layoutSize;t.setWithExplicit("width",l(e,"width")),t.setWithExplicit("height",l(e,"height"))}function s(e){for(var t=0,n=e.children;t<n.length;t++){n[t].parseLayoutSize()}}function l(e,t){for(var n,r="width"===t?"x":"y",i=e.component.resolve,o=0,s=e.children;o<s.length;o++){var l=(d=s[o]).component.layoutSize.getWithExplicit(t),c=i.scale[r];if("independent"===c&&"range-step"===l.value){n=void 0;break}if(n){if("independent"===c&&n.value!==l.value){n=void 0;break}n=a.mergeValuesWithExplicit(n,l,t,"")}else n=l}if(n){for(var u=0,f=e.children;u<f.length;u++){var d=f[u];e.renameLayoutSize(d.getName(t),e.getName(t)),d.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function c(e,t){var n="width"===t?"x":"y",a=e.config,o=e.getScaleComponent(n);if(o){var s=o.get("type"),l=o.get("range");return r.hasDiscreteDomain(s)&&i.isVgRangeStep(l)?"range-step":a.view[t]}return"width"===t&&"text"===e.mark()?a.scale.textXRangeStep:a.scale.rangeStep||r.defaultScaleConfig.rangeStep}n.parseLayerLayoutSize=o,n.parseRepeatLayoutSize=o,n.parseConcatLayoutSize=function(e){s(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,l(e,n))},n.parseChildrenLayoutSize=s,n.parseUnitLayoutSize=function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=c(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var r=c(e,"height");t.set("height",r,!1)}}},{"../../scale":115,"../../vega.schema":127,"../split":95}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("json-stable-stringify"),i=e("../../util"),a=e("./parse");n.assembleLegends=function(e){for(var t=e.component.legends,n={},o=0,s=i.keys(t);o<s.length;o++){var l=s[o],c=e.getScaleComponent(l),u=r(c.domains);if(n[u])for(var f=0,d=n[u];f<d.length;f++){var p=d[f];a.mergeLegendComponent(p,t[l])||n[u].push(t[l])}else n[u]=[t[l].clone()]}return i.flatten(i.vals(n)).map(function(e){return e.combine()})}},{"../../util":125,"./parse":54,"json-stable-stringify":1}],52:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(e("../split").Split);n.LegendComponent=a},{"../split":95}],53:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),a=e("../../channel"),o=e("../../fielddef"),s=e("../../mark"),l=e("../../scale"),c=e("../../util"),u=e("../common"),f=e("../mark/mixins");function d(e){if(o.isValueDef(e)){if(o.hasConditionalValueDef(e)){var t=i.isArray(e.condition)?e.condition.map(function(e){return e.value}):[e.condition.value];return Math.max.apply(null,[e.value].concat(t))}return e.value}}n.symbols=function(e,t,n,i,l){if("gradient"!==l){var p={},g=n.mark();switch(g){case s.BAR:case s.TICK:case s.TEXT:p.shape={value:"square"};break;case s.CIRCLE:case s.SQUARE:p.shape={value:g};break;case s.POINT:case s.LINE:case s.GEOSHAPE:case s.AREA:}var m=n.markDef.filled,h=i===a.COLOR?c.without(s.FILL_STROKE_CONFIG,[m?"fill":"stroke","strokeDash","strokeDashOffset"]):s.FILL_STROKE_CONFIG;if(h=c.without(h,["strokeDash","strokeDashOffset"]),u.applyMarkConfig(p,n,h),i!==a.COLOR){var v=f.color(n);v.fill&&(v.fill.field||"transparent"===v.fill.value)&&delete v.fill,v.stroke&&(v.stroke.field||"transparent"===v.stroke.value)&&delete v.stroke,p=r({},p,v)}if(i!==a.SHAPE){var y=n.encoding.shape;o.isValueDef(y)&&(p.shape={value:y.value})}if(i!==a.OPACITY){var b=d(n.encoding.opacity)||n.markDef.opacity;b&&(p.opacity={value:b})}return p=r({},p,t),c.keys(p).length>0?p:void 0}},n.gradient=function(e,t,n,i,a){var o={};if("gradient"===a){var s=d(n.encoding.opacity)||n.markDef.opacity;s&&(o.opacity={value:s})}return o=r({},o,t),c.keys(o).length>0?o:void 0},n.labels=function(e,t,n,i,a){var s=n.legend(i),f=n.config,d={};if(o.isTimeFieldDef(e)){var p=n.getScaleComponent(i).get("type")===l.ScaleType.UTC;t=r({text:{signal:u.timeFormatExpression("datum.value",e.timeUnit,s.format,f.legend.shortTimeLabels,f.timeFormat,p)}},t)}return d=r({},d,t),c.keys(d).length>0?d:void 0}},{"../../channel":15,"../../fielddef":106,"../../mark":112,"../../scale":115,"../../util":125,"../common":24,"../mark/mixins":62,"vega-util":10}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),i=e("../../fielddef"),a=e("../../legend"),o=e("../../type"),s=e("../../util"),l=e("../common"),c=e("../model"),u=e("../resolve"),f=e("../split"),d=e("../split"),p=e("./component"),g=e("./encode"),m=e("./properties");function h(e){var t,n;c.isUnitModel(e)?e.component.legends=(n=(t=e).encoding,[r.COLOR,r.SIZE,r.SHAPE,r.OPACITY].reduce(function(e,a){var s=n[a];return!t.legend(a)||!t.getScaleComponent(a)||i.isFieldDef(s)&&a===r.SHAPE&&s.type===o.GEOJSON||(e[a]=v(t,a)),e},{})):e.component.legends=function(e){for(var t=e.component,n=t.legends,r=t.resolve,i=function(t){h(t),s.keys(t.component.legends).forEach(function(i){r.legend[i]=u.parseGuideResolve(e.component.resolve,i),"shared"===r.legend[i]&&(n[i]=y(n[i],t.component.legends[i]),n[i]||(r.legend[i]="independent",delete n[i]))})},a=0,o=e.children;a<o.length;a++){var l=o[a];i(l)}return s.keys(n).forEach(function(t){for(var n=0,i=e.children;n<i.length;n++){var a=i[n];a.component.legends[t]&&"shared"===r.legend[t]&&delete a.component.legends[t]}}),n}(e)}function v(e,t){var n=e.fieldDef(t),o=e.legend(t),c=new p.LegendComponent({},function(e,t){switch(t){case r.COLOR:var n=e.scaleName(r.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case r.SIZE:return{size:e.scaleName(r.SIZE)};case r.SHAPE:return{shape:e.scaleName(r.SHAPE)};case r.OPACITY:return{opacity:e.scaleName(r.OPACITY)}}return null}(e,t));a.LEGEND_PROPERTIES.forEach(function(n){var r=function(e,t,n,r){var a=r.fieldDef(n);switch(e){case"format":return l.numberFormat(a,t.format,r.config);case"title":return l.getSpecifiedOrDefaultValue(t.title,i.title(a,r.config));case"values":return m.values(t);case"type":return l.getSpecifiedOrDefaultValue(t.type,m.type(a.type,n,r.getScaleComponent(n).get("type")))}return t[e]}(n,o,t,e);if(void 0!==r){var a="values"===n?!!o.values:r===o[n];(a||void 0===e.config.legend[n])&&c.set(n,r,a)}});var u=o.encoding||{},f=["labels","legend","title","symbols","gradient"].reduce(function(r,i){var a=g[i]?g[i](n,u[i],e,t,c.get("type")):u[i];return void 0!==a&&s.keys(a).length>0&&(r[i]={update:a}),r},{});return s.keys(f).length>0&&c.set("encode",f,!!o.encoding),c}function y(e,t){if(!e)return t.clone();var n=e.getWithExplicit("orient"),r=t.getWithExplicit("orient");if(!n.explicit||!r.explicit||n.value===r.value){for(var i=!1,o=function(n){var r=d.mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return l.titleMerger(e,t);case"type":return i=!0,f.makeImplicit("symbol")}return d.defaultTieBreaker(e,t,n,"legend")});e.setWithExplicit(n,r)},c=0,u=a.VG_LEGEND_PROPERTIES;c<u.length;c++){o(u[c])}return i&&(((e.implicit||{}).encode||{}).gradient&&s.deleteNestedProperty(e.implicit,["encode","gradient"]),((e.explicit||{}).encode||{}).gradient&&s.deleteNestedProperty(e.explicit,["encode","gradient"])),e}}n.parseLegend=h,n.parseLegendForChannel=v,n.mergeLegendComponent=y},{"../../channel":15,"../../fielddef":106,"../../legend":109,"../../type":124,"../../util":125,"../common":24,"../model":69,"../resolve":75,"../split":95,"./component":52,"./encode":53,"./properties":55}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),i=e("../../datetime"),a=e("../../scale"),o=e("../../util");n.values=function(e){var t=e.values;return t&&i.isDateTime(t[0])?t.map(function(e){return{signal:i.dateTimeExpr(e,!0)}}):t},n.type=function(e,t,n){if(t===r.COLOR&&("quantitative"===e&&!a.isBinScale(n)||"temporal"===e&&o.contains(["time","utc"],n)))return"gradient"}},{"../../channel":15,"../../datetime":103,"../../scale":115,"../../util":125}],56:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mixins");n.area={vgMark:"area",encodeEntry:function(e){return r({},i.baseEncodeEntry(e,!1),i.pointPosition("x",e,"zeroOrMin"),i.pointPosition("y",e,"zeroOrMin"),i.pointPosition2(e,"zeroOrMin"))}}},{"./mixins":62}],57:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),a=e("../../channel"),o=e("../../fielddef"),s=e("../../log"),l=e("../../scale"),c=e("../../vega.schema"),u=e("./mixins"),f=e("./valueref");function d(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){var r=t.get("type");if(r!==l.ScaleType.POINT)return r===l.ScaleType.BAND?f.bandRef(e):{value:n.bar.continuousBandSize};var a=t.get("range");if(c.isVgRangeStep(a)&&i.isNumber(a.step))return{value:a.step-1};s.warn(s.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}n.bar={vgMark:"rect",encodeEntry:function(e){e.stack;return r({},u.baseEncodeEntry(e,!0),function(e,t){var n=e.config,i=e.width,s=e.markDef.orient,c=e.encoding.size,p=e.encoding.x,g=e.scaleName(a.X),m=e.getScaleComponent(a.X);{if("horizontal"===s)return r({},u.pointPosition("x",e,"zeroOrMin"),u.pointPosition2(e,"zeroOrMin"));if(o.isFieldDef(p)){var h=m.get("type");if(p.bin&&!c&&!l.hasDiscreteDomain(h))return u.binnedPosition(p,"x",e.scaleName("x"),n.bar.binSpacing,m.get("reverse"));if(h===l.ScaleType.BAND)return u.bandPosition(p,"x",e)}return u.centeredBandPosition("x",e,r({},f.mid(i)),d(g,m,n))}}(e),function(e,t){var n=e.config,i=e.encoding,s=e.height,c=e.markDef.orient,p=i.size,g=i.y,m=e.scaleName(a.Y),h=e.getScaleComponent(a.Y);{if("vertical"===c)return r({},u.pointPosition("y",e,"zeroOrMin"),u.pointPosition2(e,"zeroOrMin"));if(o.isFieldDef(g)){var v=h.get("type");if(g.bin&&!p&&!l.hasDiscreteDomain(v))return u.binnedPosition(g,"y",e.scaleName("y"),n.bar.binSpacing,h.get("reverse"));if(v===l.ScaleType.BAND)return u.bandPosition(g,"y",e)}return u.centeredBandPosition("y",e,f.mid(s),d(m,h,n))}}(e))}}},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../scale":115,"../../vega.schema":127,"./mixins":62,"./valueref":68,"vega-util":10}],58:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mixins"),a=e("../../fielddef"),o=e("../../type");n.geoshape={vgMark:"shape",encodeEntry:function(e){return r({},i.baseEncodeEntry(e,!0))},postEncodingTransform:function(e){var t=e.encoding.shape;return[r({type:"geoshape",projection:e.projectionName()},t&&a.isFieldDef(t)&&t.type===o.GEOJSON?{field:a.vgField(t,{expr:"datum"})}:{})]}}},{"../../fielddef":106,"../../type":124,"./mixins":62}],59:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../encoding"),a=e("../../fielddef"),o=e("../../log"),s=e("../../mark"),l=e("../../type"),c=e("../../util"),u=e("../common");n.normalizeMarkDef=function(e,t,n){var f,d,p,g,m=s.isMarkDef(e)?r({},e):{type:e},h=m.orient||u.getMarkConfig("orient",m,n);return m.orient=function(e,t,n){switch(e){case s.POINT:case s.CIRCLE:case s.SQUARE:case s.TEXT:case s.RECT:return}var r=t.y2,i=t.x2;switch(e){case s.RULE:if(i&&r)return;case s.BAR:case s.AREA:if(r)return"vertical";if(i)return"horizontal";if(e===s.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case s.LINE:case s.TICK:var c=a.isFieldDef(t.x)&&a.isContinuous(t.x),u=a.isFieldDef(t.y)&&a.isContinuous(t.y);if(c&&!u)return"tick"!==e?"horizontal":"vertical";if(!c&&u)return"tick"!==e?"vertical":"horizontal";if(c&&u){var f=t.x,d=t.y,p=f.type===l.TEMPORAL,g=d.type===l.TEMPORAL;return p&&!g?"tick"!==e?"vertical":"horizontal":!p&&g?"tick"!==e?"horizontal":"vertical":!f.aggregate&&d.aggregate?"tick"!==e?"vertical":"horizontal":f.aggregate&&!d.aggregate?"tick"!==e?"horizontal":"vertical":n||(e===s.LINE&&t.order||o.warn(o.message.unclearOrientContinuous(e)),"vertical")}return void o.warn(o.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}(m.type,t,h),void 0!==h&&h!==m.orient&&o.warn(o.message.orientOverridden(m.orient,h)),void 0===(m.opacity||u.getMarkConfig("opacity",m,n))&&(m.opacity=function(e,t){if(c.contains([s.POINT,s.TICK,s.CIRCLE,s.SQUARE],e)&&!i.isAggregate(t))return.7}(m.type,t)),void 0===m.filled&&(m.filled=(f=m,d=n,p=u.getMarkConfig("filled",f,d),g=f.type,void 0!==p?p:g!==s.POINT&&g!==s.LINE&&g!==s.RULE)),m}},{"../../encoding":104,"../../fielddef":106,"../../log":110,"../../mark":112,"../../type":124,"../../util":125,"../common":24}],60:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mixins"),a=e("./valueref");n.line={vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return r({},i.baseEncodeEntry(e,!0),i.pointPosition("x",e,a.mid(t)),i.pointPosition("y",e,a.mid(n)),i.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":62,"./valueref":68}],61:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),a=e("../../data"),o=e("../../encoding"),s=e("../../fielddef"),l=e("../../mark"),c=e("../../sort"),u=e("../../util"),f=e("../common"),d=e("./area"),p=e("./bar"),g=e("./geoshape"),m=e("./line"),h=e("./point"),v=e("./rect"),y=e("./rule"),b=e("./text"),_=e("./tick"),O={area:d.area,bar:p.bar,line:m.line,point:h.point,text:b.text,tick:_.tick,rect:v.rect,rule:y.rule,circle:h.circle,square:h.square,geoshape:g.geoshape};n.parseMarkGroup=function(e){return u.contains([l.LINE,l.AREA],e.mark())?(p=(d=e).mark(),g=x(d.encoding),m=O[p].postEncodingTransform?O[p].postEncodingTransform(d):null,h=void 0!==d.markDef.clip?!!d.markDef.clip:w(d),v=f.getStyles(d.markDef),y=E(d),b=[r({name:d.getName("marks"),type:O[p].vgMark},h?{clip:!0}:{},v?{style:v}:{},y?{sort:y}:{},{from:{data:(g.length>0?S:"")+d.requestDataName(a.MAIN)},encode:{update:O[p].encodeEntry(d)}},m?{transform:m}:{})],g.length>0?[{name:d.getName("pathgroup"),type:"group",from:{facet:{name:S+d.requestDataName(a.MAIN),data:d.requestDataName(a.MAIN),groupby:g}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:b}]:b):(n=(t=e).mark(),i=f.getStyles(t.markDef),o=void 0!==t.markDef.clip?!!t.markDef.clip:w(t),s=O[n].postEncodingTransform?O[n].postEncodingTransform(t):null,(c=[]).push(r({name:t.getName("marks"),type:O[n].vgMark},o?{clip:!0}:{},i?{style:i}:{},{from:{data:t.requestDataName(a.MAIN)},encode:{update:O[n].encodeEntry(t)}},s?{transform:s}:{})),c);var t,n,i,o,s,c,d,p,g,m,h,v,y,b};var S="faceted_path_";function E(e){if("line"===e.mark()&&e.channelHasField("order"))return f.sortParams(e.encoding.order,{expr:"datum"});var t="horizontal"===e.markDef.orient?"y":"x",n=e.sort(t),r=c.isSortField(n)?s.vgField({aggregate:o.isAggregate(e.encoding)?n.op:void 0,field:n.field},{expr:"datum"}):e.vgField(t,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"});return r?{field:r,order:"descending"}:void 0}function x(e){return u.keys(e).reduce(function(t,n){switch(n){case"x":case"y":case"order":case"tooltip":case"href":case"x2":case"y2":case"text":case"shape":return t;case"detail":var r=e[n];return r&&(i.isArray(r)?r:[r]).forEach(function(e){e.aggregate||t.push(s.vgField(e,{}))}),t;case"color":case"size":case"opacity":var a=s.getFieldDef(e[n]);return a&&!a.aggregate&&t.push(s.vgField(a,{})),t;default:throw new Error("Bug: Channel "+n+" unimplemented for line mark")}},[])}function w(e){var t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("domainRaw")||n&&n.get("domainRaw"))}n.getPathSort=E,n.pathGroupingFields=x},{"../../data":102,"../../encoding":104,"../../fielddef":106,"../../mark":112,"../../sort":117,"../../util":125,"../common":24,"./area":56,"./bar":57,"./geoshape":58,"./line":60,"./point":63,"./rect":64,"./rule":65,"./text":66,"./tick":67,"vega-util":10}],62:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-util"),a=e("../../fielddef"),o=e("../../log"),s=e("../../predicate"),l=e("../../util"),c=e("../../vega.schema"),u=e("../common"),f=e("../selection/selection"),d=e("./valueref");function p(e){var t=e.config,n=e.markDef.filled?"fill":"stroke",r=g("color",e,{vgChannel:n,defaultValue:e.markDef[n]||e.markDef.color||u.getMarkConfig(n,e.markDef,t)||u.getMarkConfig("color",e.markDef,t)});return!r.fill&&l.contains(["bar","point","circle","square","geoshape"],e.mark())&&(r.fill={value:"transparent"}),r}function g(e,t,n){void 0===n&&(n={});var r=n.defaultValue,i=n.vgChannel,a=n.defaultRef||(void 0!==r?{value:r}:void 0),o=t.encoding[e];return m(t,o,i||e,function(n){return d.midPoint(e,n,t.scaleName(e),t.getScaleComponent(e),null,a)})}function m(e,t,n,o){var l,c,u=t&&t.condition,d=o(t);if(u){var p=(i.isArray(u)?u:[u]).map(function(t){var n=o(t),i=a.isConditionalSelection(t)?f.selectionPredicate(e,t.selection):s.expression(e,t.test);return r({test:i},n)});return(l={})[n]=p.concat(void 0!==d?[d]:[]),l}return void 0!==d?((c={})[n]=d,c):{}}function h(e,t){void 0===t&&(t="text");var n=e.encoding[t];return m(e,n,t,function(t){return d.text(t,e.config)})}function v(e,t,n,r){var i,a=t.encoding,o=t.stack,s=d.stackable(e,a[e],t.scaleName(e),t.getScaleComponent(e),o,n);return(i={})[r||e]=s,i}n.color=p,n.baseEncodeEntry=function(e,t){return r({},(n=e.markDef,i=t,c.VG_MARK_CONFIGS.reduce(function(e,t){return!n[t]||i&&"orient"===t||(e[t]={value:n[t]}),e},{})),p(e),g("opacity",e),h(e,"tooltip"),h(e,"href"));var n,i},n.valueIfDefined=function(e,t){if(void 0!==t)return(n={})[e]={value:t},n;var n},n.nonPosition=g,n.text=h,n.bandPosition=function(e,t,n){var i,s,l=n.scaleName(t),c="x"===t?"width":"height";if(n.encoding.size)if(n.markDef.orient){var u=((i={})[t+"c"]=d.fieldRef(e,l,{},{band:.5}),i);if(a.getFieldDef(n.encoding.size))o.warn(o.message.cannotUseSizeFieldWithBandSize(t));else if(a.isValueDef(n.encoding.size))return r({},u,g("size",n,{vgChannel:c}))}else o.warn(o.message.cannotApplySizeToNonOrientedMark(n.markDef.type));return(s={})[t]=d.fieldRef(e,l,{binSuffix:"range"}),s[c]=d.bandRef(l),s},n.centeredBandPosition=function(e,t,n,i){var a="x"===e?"width":"height";return r({},v(e,t,n,"x"===e?"xc":"yc"),g("size",t,{defaultRef:i,vgChannel:a}))},n.binnedPosition=function(e,t,n,r,i){return"x"===t?{x2:d.bin(e,n,"start",i?0:r),x:d.bin(e,n,"end",i?r:0)}:{y2:d.bin(e,n,"start",i?r:0),y:d.bin(e,n,"end",i?0:r)}},n.pointPosition=v,n.pointPosition2=function(e,t,n){var r,i=e.encoding,a=e.markDef,o=e.stack,s="x2"===(n=n||("horizontal"===a.orient?"x2":"y2"))?"x":"y",l=d.stackable2(n,i[s],i[n],e.scaleName(s),e.getScaleComponent(s),o,t);return(r={})[n]=l,r}},{"../../fielddef":106,"../../log":110,"../../predicate":113,"../../util":125,"../../vega.schema":127,"../common":24,"../selection/selection":85,"./valueref":68,"vega-util":10}],63:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../common"),a=e("./mixins"),o=e("./valueref");function s(e,t){var n=e.config,i=e.width,s=e.height;return r({},a.baseEncodeEntry(e,!0),a.pointPosition("x",e,o.mid(i)),a.pointPosition("y",e,o.mid(s)),a.nonPosition("size",e),l(e,n,t))}function l(e,t,n){return n?{shape:{value:n}}:a.nonPosition("shape",e,{defaultValue:i.getMarkConfig("shape",e.markDef,t)})}n.shapeMixins=l,n.point={vgMark:"symbol",encodeEntry:function(e){return s(e)}},n.circle={vgMark:"symbol",encodeEntry:function(e){return s(e,"circle")}},n.square={vgMark:"symbol",encodeEntry:function(e){return s(e,"square")}}},{"../common":24,"./mixins":62,"./valueref":68}],64:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../fielddef"),o=e("../../log"),s=e("../../mark"),l=e("../../scale"),c=e("./mixins");n.rect={vgMark:"rect",encodeEntry:function(e){return r({},c.baseEncodeEntry(e,!0),function(e){var t=e.encoding.x,n=e.encoding.x2,u=e.getScaleComponent(i.X),f=u?u.get("type"):void 0;{if(a.isFieldDef(t)&&t.bin&&!n)return c.binnedPosition(t,"x",e.scaleName("x"),0,u.get("reverse"));if(a.isFieldDef(t)&&u&&l.hasDiscreteDomain(f)){if(f===l.ScaleType.BAND)return c.bandPosition(t,"x",e);throw new Error(o.message.scaleTypeNotWorkWithMark(s.RECT,f))}return r({},c.pointPosition("x",e,"zeroOrMax"),c.pointPosition2(e,"zeroOrMin","x2"))}}(e),function(e){var t=e.encoding.y,n=e.encoding.y2,u=e.getScaleComponent(i.Y),f=u?u.get("type"):void 0;{if(a.isFieldDef(t)&&t.bin&&!n)return c.binnedPosition(t,"y",e.scaleName("y"),0,u.get("reverse"));if(a.isFieldDef(t)&&u&&l.hasDiscreteDomain(f)){if(f===l.ScaleType.BAND)return c.bandPosition(t,"y",e);throw new Error(o.message.scaleTypeNotWorkWithMark(s.RECT,f))}return r({},c.pointPosition("y",e,"zeroOrMax"),c.pointPosition2(e,"zeroOrMin","y2"))}}(e))}}},{"../../channel":15,"../../fielddef":106,"../../log":110,"../../mark":112,"../../scale":115,"./mixins":62}],65:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mixins"),a=e("./valueref");n.rule={vgMark:"rule",encodeEntry:function(e){e.config;var t=e.markDef,n=e.width,o=e.height,s=t.orient;return e.encoding.x||e.encoding.y?r({},i.baseEncodeEntry(e,!0),i.pointPosition("x",e,"horizontal"===s?"zeroOrMin":a.mid(n)),i.pointPosition("y",e,"vertical"===s?"zeroOrMin":a.mid(o)),"vertical"!==s?i.pointPosition2(e,"zeroOrMax","x2"):{},"horizontal"!==s?i.pointPosition2(e,"zeroOrMax","y2"):{},i.nonPosition("size",e,{vgChannel:"strokeWidth"})):{}}}},{"./mixins":62,"./valueref":68}],66:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../encoding"),o=e("../../fielddef"),s=e("../../type"),l=e("../common"),c=e("./mixins"),u=e("./valueref");n.text={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding,f=e.height,d=n.text;return r({},c.baseEncodeEntry(e,!0),c.pointPosition("x",e,function(e,t){if(o.isFieldDef(t)&&t.type===s.QUANTITATIVE)return{field:{group:"width"},offset:-5};return{value:e.scale.textXRangeStep/2}}(t,d)),c.pointPosition("y",e,u.mid(f)),c.text(e),c.nonPosition("size",e,{vgChannel:"fontSize"}),c.valueIfDefined("align",function(e,t,n){if(void 0===(e.align||l.getMarkConfig("align",e,n)))return a.channelHasField(t,i.X)?"center":"right";return}(e.markDef,n,t)))}}},{"../../channel":15,"../../encoding":104,"../../fielddef":106,"../../type":124,"../common":24,"./mixins":62,"./valueref":68}],67:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../vega.schema"),a=e("./mixins"),o=e("./valueref");n.tick={vgMark:"rect",encodeEntry:function(e){var t,n=e.config,s=e.markDef,l=e.width,c=e.height,u=s.orient,f="horizontal"===u?"width":"height",d="horizontal"===u?"height":"width";return r({},a.baseEncodeEntry(e,!0),a.pointPosition("x",e,o.mid(l),"xc"),a.pointPosition("y",e,o.mid(c),"yc"),a.nonPosition("size",e,{defaultValue:function(e){var t=e.config,n=e.markDef.orient,r=e.getScaleComponent("horizontal"===n?"x":"y");{if(void 0!==t.tick.bandSize)return t.tick.bandSize;var a=r?r.get("range"):void 0,o=a&&i.isVgRangeStep(a)?a.step:t.scale.rangeStep;if("number"!=typeof o)throw new Error("Function does not handle non-numeric rangeStep");return o/1.5}}(e),vgChannel:f}),((t={})[d]={value:n.tick.thickness},t))}}},{"../../vega.schema":127,"./mixins":62,"./valueref":68}],68:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../fielddef"),o=e("../../scale"),s=e("../../type"),l=e("../../util"),c=e("../common");function u(e,t,n,i){var o={scale:t,field:a.vgField(e,n)};return i?r({},o,i):o}function f(e,t,n,r,f,d){if(t){if(a.isFieldDef(t)){if(l.contains([i.X,i.Y,i.X2,i.Y2],e)&&l.contains([s.LATITUDE,s.LONGITUDE],t.type))return{field:a.vgField(t,{suffix:"geo"})};if(t.bin)return l.contains([i.X,i.Y],e)&&t.type===s.QUANTITATIVE?f&&f.impute?u(t,n,{binSuffix:"mid"}):(g=t,{signal:'(scale("'+(m=n)+'", '+a.vgField(g,{expr:"datum"})+') + scale("'+m+'", '+a.vgField(g,{binSuffix:"end",expr:"datum"})+"))/2"}):u(t,n,c.binRequiresRange(t,e)?{binSuffix:"range"}:{});var p=r.get("type");return o.hasDiscreteDomain(p)?"band"===p?u(t,n,{binSuffix:"range"},{band:.5}):u(t,n,{binSuffix:"range"}):u(t,n,{})}return a.isValueDef(t)?{value:t.value}:void 0}var g,m;if("zeroOrMin"===d){if(e===i.X||e===i.X2)return function(e,t){if(e&&!l.contains([o.ScaleType.LOG,o.ScaleType.TIME,o.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{value:0}}(n,r);if(e===i.Y||e===i.Y2)return function(e,t){if(e&&!l.contains([o.ScaleType.LOG,o.ScaleType.TIME,o.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{field:{group:"height"}}}(n,r);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===d){if(e===i.X||e===i.X2)return function(e,t){if(e&&!l.contains([o.ScaleType.LOG,o.ScaleType.TIME,o.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{field:{group:"width"}}}(n,r);if(e===i.Y||e===i.Y2)return function(e,t){if(e&&!l.contains([o.ScaleType.LOG,o.ScaleType.TIME,o.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero"))return{scale:e,value:0};return{value:0}}(n,r);throw new Error("Unsupported channel "+e+" for base function")}return d}n.stackable=function(e,t,n,r,i,o){return a.isFieldDef(t)&&i&&e===i.fieldChannel?u(t,n,{suffix:"end"}):f(e,t,n,r,i,o)},n.stackable2=function(e,t,n,r,i,o,s){return a.isFieldDef(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?u(t,r,{suffix:"start"}):f(e,n,r,i,o,s)},n.bin=function(e,t,n,r){return u(e,t,{binSuffix:"start"===n?void 0:"end"},r?{offset:r}:{})},n.fieldRef=u,n.bandRef=function(e,t){return void 0===t&&(t=!0),{scale:e,band:t}},n.midPoint=f,n.text=function(e,t){if(e){if(a.isFieldDef(e))return c.formatSignalRef(e,e.format,"datum",t);if(a.isValueDef(e))return{value:e.value}}},n.mid=function(e){return r({},e,{mult:.5})}},{"../../channel":15,"../../fielddef":106,"../../scale":115,"../../type":124,"../../util":125,"../common":24}],69:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-util"),s=e("../channel"),l=e("../encoding"),c=e("../fielddef"),u=e("../log"),f=e("../scale"),d=e("../spec"),p=e("../title"),g=e("../transform"),m=e("../util"),h=e("../vega.schema"),v=e("./axis/assemble"),y=e("./layout/header"),b=e("./layoutsize/assemble"),_=e("./legend/assemble"),O=e("./legend/parse"),S=e("./projection/assemble"),E=e("./projection/parse"),x=e("./scale/assemble"),w=e("./scale/domain"),N=e("./scale/parse"),T=e("./split"),P=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();function D(e){return e&&"unit"===e.type}function k(e){return e&&"facet"===e.type}n.NameMap=P,n.isUnitModel=D,n.isFacetModel=k,n.isRepeatModel=function(e){return e&&"repeat"===e.type},n.isConcatModel=function(e){return e&&"concat"===e.type},n.isLayerModel=function(e){return e&&"layer"===e.type};var j=function(){function e(e,t,n,r,i){var s=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=s.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=s.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.name=e.name||n,this.title=o.isString(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new P,this.projectionNameMap=t?t.projectionNameMap:new P,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new P,this.data=e.data,this.description=e.description,this.transforms=g.normalizeTransform(e.transform||[]),this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},ancestorParse:t?a({},t.component.data.ancestorParse):{},isFaceted:d.isFacetSpec(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new T.Split,layoutHeaders:{row:{},column:{}},mark:null,resolve:a({scale:{},axis:{},legend:{}},i||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseProjection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){N.parseScale(this)},e.prototype.parseProjection=function(){E.parseProjection(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseLegend=function(){O.parseLegend(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,r=y.HEADER_CHANNELS;n<r.length;n++){e[o=r[n]].title&&t.push(y.getTitleGroup(this,o))}for(var i=0,a=y.HEADER_CHANNELS;i<a.length;i++){var o=a[i];t=t.concat(y.getHeaderGroups(this,o))}return t},e.prototype.assembleAxes=function(){return v.assembleAxes(this.component.axes)},e.prototype.assembleLegends=function(){return _.assembleLegends(this)},e.prototype.assembleProjections=function(){return S.assembleProjections(this)},e.prototype.assembleTitle=function(){var e=a({},p.extractTitleConfig(this.config.title).nonMark,this.title);if(e.text)return m.contains(["unit","layer"],this.type)||(e.anchor&&"start"!==e.anchor&&u.warn(u.message.cannotSetTitleAnchor(this.type)),e.anchor="start"),m.keys(e).length>0?e:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};(e=e.concat(this.assembleSelectionSignals())).length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||k(this.parent)?x.assembleScales(this):[];r.length>0&&(t.scales=r);var i=this.assembleAxes();i.length>0&&(t.axes=i);var a=this.assembleLegends();return a.length>0&&(t.legends=a),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(D(r)){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return m.varName((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(k(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type"),i=n.get("range");if(f.hasDiscreteDomain(r)&&h.isVgRangeStep(i)){var a=n.get("name"),o=w.assembleDomain(this,t),s=w.getFieldFromDomain(o);if(s){var l=c.vgField({aggregate:"distinct",field:s},{expr:"datum"});return{signal:b.sizeExpr(a,n,l)}}return u.warn("Unknown field for ${channel}.  Cannot calculate view size."),null}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):s.isChannel(e)&&s.isScaleChannel(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.projectionName=function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(u.message.selectionNotFound(t));return n},e}();n.Model=j;var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.vgField=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return c.vgField(n,t)},t.prototype.reduceFieldDef=function(e,t,n){return l.reduce(this.getMapping(),function(t,n,r){var i=c.getFieldDef(n);return i?e(t,i,r):t},t,n)},t.prototype.forEachFieldDef=function(e,t){l.forEach(this.getMapping(),function(t,n){var r=c.getFieldDef(t);r&&e(r,n)},t)},t}(j);n.ModelWithField=A},{"../channel":15,"../encoding":104,"../fielddef":106,"../log":110,"../scale":115,"../spec":118,"../title":121,"../transform":123,"../util":125,"../vega.schema":127,"./axis/assemble":16,"./layout/header":48,"./layoutsize/assemble":49,"./legend/assemble":51,"./legend/parse":54,"./projection/assemble":70,"./projection/parse":72,"./scale/assemble":76,"./scale/domain":78,"./scale/parse":79,"./split":95,"vega-util":10}],70:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("util"),o=e("../../util"),s=e("../../vega.schema"),l=e("../model");function c(e){return e.children.reduce(function(e,t){return e.concat(t.assembleProjections())},u(e))}function u(e){var t=e.component.projection;if(!t||t.merged)return[];var n=t.combine(),l=n.name,c=i(n,["name"]),u={signal:"["+t.size.map(function(e){return e.signal}).join(", ")+"]"},f=t.data.reduce(function(t,n){var r=s.isVgSignalRef(n)?n.signal:"data('"+e.lookupDataSource(n)+"')";return o.contains(t,r)||t.push(r),t},[]);return f.length<=0&&a.error("Projection's fit didn't find any data sources"),[r({name:l,size:u,fit:{signal:f.length>1?"["+f.join(", ")+"]":f[0]}},c)]}n.assembleProjections=function(e){return l.isLayerModel(e)||l.isConcatModel(e)||l.isRepeatModel(e)?c(e):u(e)},n.assembleProjectionsForModelAndChildren=c,n.assembleProjectionForModel=u},{"../../util":125,"../../vega.schema":127,"../model":69,util:8}],71:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(t,n,r,i){var o=e.call(this,a({},n),{name:t})||this;return o.specifiedProjection=n,o.size=r,o.data=i,o.merged=!1,o}return i(t,e),t}(e("../split").Split);n.ProjectionComponent=o},{"../split":95}],72:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),a=e("../../data"),o=e("../../fielddef"),s=e("../../mark"),l=e("../../projection"),c=e("../../type"),u=e("../../util"),f=e("../model"),d=e("./component");function p(e){f.isUnitModel(e)?e.component.projection=function(e){var t=e.specifiedProjection,n=e.markDef,l=e.config,f=e.encoding,p=n&&n.type===s.GEOSHAPE,g=f&&[i.X,i.Y,i.X2,i.Y2].some(function(e){var t=f[e];return o.isFieldDef(t)&&u.contains([c.LATITUDE,c.LONGITUDE],t.type)});if(p||g){var m=[];return[[i.X,i.Y],[i.X2,i.Y2]].forEach(function(t){(e.channelHasField(t[0])||e.channelHasField(t[1]))&&m.push({signal:e.getName("geojson_"+m.length)})}),e.channelHasField(i.SHAPE)&&e.fieldDef(i.SHAPE).type===c.GEOJSON&&m.push({signal:e.getName("geojson_"+m.length)}),0===m.length&&m.push(e.requestDataName(a.MAIN)),new d.ProjectionComponent(e.projectionName(!0),r({},l.projection||{},t||{}),[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")],m)}return}(e):e.component.projection=function(e){if(0===e.children.length)return;var t,n=u.every(e.children,function(e){p(e);var n=e.component.projection;if(n){if(t){var r=function(e,t){var n=u.every(l.PROJECTION_PROPERTIES,function(n){return!e.explicit.hasOwnProperty(n)&&!t.explicit.hasOwnProperty(n)||!(!e.explicit.hasOwnProperty(n)||!t.explicit.hasOwnProperty(n)||u.stringify(e.get(n))!==u.stringify(t.get(n)))});if(u.stringify(e.size)===u.stringify(t.size)){if(n)return e;if(u.stringify(e.explicit)===u.stringify({}))return t;if(u.stringify(t.explicit)===u.stringify({}))return e}return null}(t,n);return r&&(t=r),!!r}return t=n,!0}return!0});if(t&&n){var r=e.projectionName(!0),i=new d.ProjectionComponent(r,t.specifiedProjection,t.size,u.duplicate(t.data));return e.children.forEach(function(e){e.component.projection&&(i.data=i.data.concat(e.component.projection.data),e.renameProjection(e.component.projection.get("name"),r),e.component.projection.merged=!0)}),i}return}(e)}n.parseProjection=p},{"../../channel":15,"../../data":102,"../../fielddef":106,"../../mark":112,"../../projection":114,"../../type":124,"../../util":125,"../model":69,"./component":71}],73:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("../log"),o=e("./baseconcat"),s=e("./buildmodel"),l=e("./layoutsize/parse"),c=function(e){function t(t,n,r,i,o){var s=e.call(this,t,n,r,o,t.resolve)||this;return s.type="repeat",t.resolve&&t.resolve.axis&&("shared"===t.resolve.axis.x||"shared"===t.resolve.axis.y)&&a.warn(a.message.REPEAT_CANNOT_SHARE_AXIS),s.repeat=t.repeat,s.children=s._initChildren(t,s.repeat,i,o),s}return i(t,e),t.prototype._initChildren=function(e,t,n,r){for(var i=[],a=t.row||[n?n.row:null],o=t.column||[n?n.column:null],l=0,c=a;l<c.length;l++)for(var u=c[l],f=0,d=o;f<d.length;f++){var p=d[f],g=(u?"_"+u:"")+(p?"_"+p:""),m={row:u,column:p};i.push(s.buildModel(e.spec,this,this.getName("child"+g),void 0,m,r,!1))}return i},t.prototype.parseLayoutSize=function(){l.parseRepeatLayoutSize(this)},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},t}(o.BaseConcatModel);n.RepeatModel=c},{"../log":110,"./baseconcat":22,"./buildmodel":23,"./layoutsize/parse":50}],74:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../fielddef"),o=e("../log"),s=e("../sort"),l=e("../util");function c(e,t){return a.isRepeatRef(e.field)?e.field.repeat in t?r({},e,{field:t[e.field.repeat]}):void o.warn(o.message.noSuchRepeatedValue(e.field.repeat)):e}function u(e,t){if(void 0!==(e=c(e,t))){if(e.sort&&s.isSortField(e.sort)){var n=c(e.sort,t);e=r({},e,n?{sort:n}:{})}return e}}function f(e,t){if(!a.isFieldDef(e)){if(a.hasConditionalFieldDef(e)){if(n=u(e.condition,t))return r({},e,{condition:n});e.condition;return i(e,["condition"])}return e}var n;return(n=u(e,t))?n:a.isConditionalDef(e)?{condition:e.condition}:void 0}function d(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(l.isArray(i))n[r]=i.map(function(e){return f(e,t)}).filter(function(e){return e});else{var a=f(i,t);a&&(n[r]=a)}}return n}n.replaceRepeaterInFacet=function(e,t){return d(e,t)},n.replaceRepeaterInEncoding=function(e,t){return d(e,t)}},{"../fielddef":106,"../log":110,"../sort":117,"../util":125}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../channel"),i=e("../log"),a=e("../util"),o=e("./model");n.defaultScaleResolve=function(e,t){if(o.isLayerModel(t)||o.isFacetModel(t))return"shared";if(o.isConcatModel(t)||o.isRepeatModel(t))return a.contains(r.POSITION_SCALE_CHANNELS,e)?"independent":"shared";throw new Error("invalid model type for resolve")},n.parseGuideResolve=function(e,t){var n=e.scale[t],o=a.contains(r.POSITION_SCALE_CHANNELS,t)?"axis":"legend";return"independent"===n?("shared"===e[o][t]&&i.warn(i.message.independentScaleMeansIndependentGuide(t)),"independent"):e[o][t]||"shared"}},{"../channel":15,"../log":110,"../util":125,"./model":69}],76:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),o=e("../../util"),s=e("../../vega.schema"),l=e("../model"),c=e("../selection/selection"),u=e("./domain");function f(e){return o.keys(e.component.scales).reduce(function(t,n){var a=e.component.scales[n];if(a.merged)return t;var o=a.combine(),s=o.domainRaw,l=o.range,f=o.name,p=o.type,g=(o.domainRaw,o.range,i(o,["name","type","domainRaw","range"]));return l=d(l,f,e,n),s&&c.isRawSelectionDomain(s)&&(s=c.selectionScaleDomain(e,s)),t.push(r({name:f,type:p,domain:u.assembleDomain(e,n)},s?{domainRaw:s}:{},{range:l},g)),t},[])}function d(e,t,n,r){if("x"===r||"y"===r){if(s.isVgRangeStep(e))return{step:{signal:t+"_step"}};if(a.isArray(e)&&2===e.length){var i=e[0],o=e[1];if(0===i&&s.isVgSignalRef(o))return[0,{signal:n.getSizeName(o.signal)}];if(s.isVgSignalRef(i)&&0===o)return[{signal:n.getSizeName(i.signal)},0]}}return e}n.assembleScales=function e(t){return l.isLayerModel(t)||l.isConcatModel(t)||l.isRepeatModel(t)?t.children.reduce(function(t,n){return t.concat(e(n))},f(t)):f(t)},n.assembleScalesForModel=f,n.assembleScaleRange=d},{"../../util":125,"../../vega.schema":127,"../model":69,"../selection/selection":85,"./domain":78,"vega-util":10}],77:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){function t(t,n){var r=e.call(this,{},{name:t})||this;return r.merged=!1,r.domains=[],r.setWithExplicit("type",n),r}return i(t,e),t}(e("../split").Split);n.ScaleComponent=a},{"../split":95}],78:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../aggregate"),o=e("../../bin"),s=e("../../channel"),l=e("../../data"),c=e("../../datetime"),u=e("../../log"),f=e("../../scale"),d=e("../../sort"),p=e("../../util"),g=e("../../util"),m=e("../../vega.schema"),h=e("../../vega.schema"),v=e("../common"),y=e("../data/optimize"),b=e("../model"),_=e("../selection/selection");function O(e){var t,n,r;b.isUnitModel(e)?(n=(t=e).specifiedScales,r=t.component.scales,g.keys(r).forEach(function(e){var i=n[e],a=i?i.domain:void 0,o=S(t,e),s=r[e];if(s.domains=o,f.isSelectionDomain(a)&&s.set("domainRaw",{signal:_.SELECTION_DOMAIN+p.hash(a)},!0),t.component.data.isFaceted){for(var l=t;!b.isFacetModel(l)&&l.parent;)l=l.parent;var c=l.component.resolve.scale[e];if("shared"===c)for(var u=0,d=o;u<d.length;u++){var g=d[u];h.isDataRefDomain(g)&&(g.data=y.FACET_SCALE_PREFIX+g.data.replace(y.FACET_SCALE_PREFIX,""))}}})):function(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];O(r)}var i=e.component.scales;g.keys(i).forEach(function(t){for(var n,r=0,a=e.children;r<a.length;r++){var o=a[r],s=o.component.scales[t];s&&(n=void 0===n?s.domains:n.concat(s.domains))}i[t].domains=n})}(e)}function S(e,t){var n=e.getScaleComponent(t).get("type"),i=function(e,t,n,r){if("unaggregated"===e){var i=w(t,n),a=i.valid,o=i.reason;if(!a)return void u.warn(o)}else if(void 0===e&&r.useUnaggregatedDomain&&(a=w(t,n).valid))return"unaggregated";return e}(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=r({},e.specifiedScales[t],{domain:i})),"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?E(n,i,e,"x").concat(E(n,i,e,"x2")):E(n,i,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?E(n,i,e,"y").concat(E(n,i,e,"y2")):E(n,i,e,"y2"):E(n,i,e,t)}function E(e,t,n,r){var i=n.fieldDef(r);if(t&&"unaggregated"!==t&&!f.isSelectionDomain(t)){if(!i.bin)return c.isDateTime(t[0])?t.map(function(e){return{signal:"{data: "+c.dateTimeExpr(e,!0)+"}"}}):[t];u.warn(u.message.conflictedDomain(r))}var a=n.stack;if(a&&r===a.fieldChannel)return"normalize"===a.offset?[[0,1]]:[{data:p=n.requestDataName(l.MAIN),field:n.vgField(r,{suffix:"start"})},{data:p,field:n.vgField(r,{suffix:"end"})}];var p,m=s.isScaleChannel(r)?x(n,r,e):void 0;if("unaggregated"===t)return[{data:p=n.requestDataName(l.MAIN),field:n.vgField(r,{aggregate:"min"})},{data:p,field:n.vgField(r,{aggregate:"max"})}];if(!i.bin)return m?[{data:g.isBoolean(m)?n.requestDataName(l.MAIN):n.requestDataName(l.RAW),field:n.vgField(r),sort:m}]:[{data:n.requestDataName(l.MAIN),field:n.vgField(r)}];if(f.isBinScale(e)){var h=n.getName(o.binToString(i.bin)+"_"+i.field+"_bins");return[{signal:"sequence("+h+".start, "+h+".stop + "+h+".step, "+h+".step)"}]}return f.hasDiscreteDomain(e)?[{data:g.isBoolean(m)?n.requestDataName(l.MAIN):n.requestDataName(l.RAW),field:n.vgField(r,v.binRequiresRange(i,r)?{binSuffix:"range"}:{}),sort:!0!==m&&d.isSortField(m)?m:{field:n.vgField(r,{}),op:"min"}}]:"x"===r||"y"===r?[{data:p=n.requestDataName(l.MAIN),field:n.vgField(r,{})},{data:p,field:n.vgField(r,{binSuffix:"end"})}]:[{data:n.requestDataName(l.MAIN),field:n.vgField(r,{})}]}function x(e,t,n){if(f.hasDiscreteDomain(n)){var r=e.sort(t);return d.isSortField(r)?r:"descending"===r?{op:"min",field:e.vgField(t),order:"descending"}:!!g.contains(["ascending",void 0],r)||void 0}}function w(e,t){return e.aggregate?a.SHARED_DOMAIN_OP_INDEX[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:u.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:u.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:u.message.unaggregateDomainHasNoEffectForRawField(e)}}function N(e){var t=g.unique(e.map(function(e){if(h.isDataRefDomain(e)){e.sort;return i(e,["sort"])}return e}),g.hash),n=g.unique(e.map(function(e){if(h.isDataRefDomain(e)){var t=e.sort;return void 0===t||g.isBoolean(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),g.hash);if(1===t.length){var a=e[0];if(h.isDataRefDomain(a)&&n.length>0){var o=n[0];return n.length>1&&(u.warn(u.message.MORE_THAN_ONE_SORT),o=!0),r({},a,{sort:o})}return a}var s=g.unique(n.map(function(e){return!0===e?e:"count"===e.op?e:(u.warn(u.message.domainSortDropped(e)),!0)}),g.hash),l=void 0;1===s.length?l=s[0]:s.length>1&&(u.warn(u.message.MORE_THAN_ONE_SORT),l=!0);var c=g.unique(e.map(function(e){return h.isDataRefDomain(e)?e.data:null}),function(e){return e});return 1===c.length&&null!==c[0]?a=r({data:c[0],fields:t.map(function(e){return e.field})},l?{sort:l}:{}):r({fields:t},l?{sort:l}:{})}n.parseScaleDomain=O,n.parseDomainForChannel=S,n.domainSort=x,n.canUseUnaggregatedDomain=w,n.mergeDomains=N,n.getFieldFromDomain=function(e){if(h.isDataRefDomain(e)&&g.isString(e.field))return e.field;if(m.isDataRefUnionedDomain(e)){for(var t=void 0,n=0,r=e.fields;n<r.length;n++){var i=r[n];if(h.isDataRefDomain(i)&&g.isString(i.field))if(t){if(t!==i.field)return u.warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),t}else t=i.field}return u.warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),t}if(m.isFieldRefUnionDomain(e))return u.warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),t=e.fields[0],g.isString(t)?t:void 0},n.assembleDomain=function(e,t){return N(e.component.scales[t].domains.map(function(t){return h.isDataRefDomain(t)&&(t.data=e.lookupDataSource(t.data)),t}))}},{"../../aggregate":12,"../../bin":14,"../../channel":15,"../../data":102,"../../datetime":103,"../../log":110,"../../scale":115,"../../sort":117,"../../util":125,"../../vega.schema":127,"../common":24,"../data/optimize":40,"../model":69,"../selection/selection":85}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),i=e("../../fielddef"),a=e("../../mark"),o=e("../../scale"),s=e("../../type"),l=e("../../util"),c=e("../model"),u=e("../resolve"),f=e("../split"),d=e("./component"),p=e("./domain"),g=e("./properties"),m=e("./range"),h=e("./type");function v(e){var t,n,p,g;c.isUnitModel(e)?e.component.scales=(n=(t=e).encoding,p=t.config,g=t.mark(),r.SCALE_CHANNELS.reduce(function(e,o){var c,u={},f=n[o];if(i.isFieldDef(f)&&(g===a.GEOSHAPE&&i.isFieldDef(f)&&o===r.SHAPE&&f.type===s.GEOJSON||l.contains([r.X,r.Y,r.X2,r.Y2],o)&&l.contains([s.LATITUDE,s.LONGITUDE],f.type)))return e;if(i.isFieldDef(f)?(c=f,u=f.scale||{}):i.hasConditionalFieldDef(f)?(c=f.condition,u=f.condition.scale||{}):o===r.X?c=i.getFieldDef(n.x2):o===r.Y&&(c=i.getFieldDef(n.y2)),c){var m=u.type,v=h.scaleType(u.type,o,c,g,p.scale);e[o]=new d.ScaleComponent(t.scaleName(o+"",!0),{value:v,explicit:m===v})}return e},{})):e.component.scales=function(e){for(var t=e.component.scales={},n={},r=e.component.resolve,i=function(t){v(t),l.keys(t.component.scales).forEach(function(i){if(r.scale[i]=r.scale[i]||u.defaultScaleResolve(i,e),"shared"===r.scale[i]){var a=n[i],s=t.component.scales[i].getWithExplicit("type");a?o.scaleCompatible(a.value,s.value)?n[i]=f.mergeValuesWithExplicit(a,s,"type","scale",y):(r.scale[i]="independent",delete n[i]):n[i]=s}})},a=0,s=e.children;a<s.length;a++){var c=s[a];i(c)}return l.keys(n).forEach(function(r){var i=e.scaleName(r,!0),a=n[r];t[r]=new d.ScaleComponent(i,a);for(var o=0,s=e.children;o<s.length;o++){var l=s[o],c=l.component.scales[r];c&&(l.renameScale(c.get("name"),i),c.merged=!0)}}),t}(e)}n.parseScale=function(e){v(e),p.parseScaleDomain(e);for(var t=0,n=o.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;t<n.length;t++){var r=n[t];g.parseScaleProperty(e,r)}m.parseScaleRange(e)},n.parseScaleCore=v;var y=f.tieBreakByComparing(function(e,t){return o.scaleTypePrecedence(e)-o.scaleTypePrecedence(t)})},{"../../channel":15,"../../fielddef":106,"../../mark":112,"../../scale":115,"../../type":124,"../../util":125,"../model":69,"../resolve":75,"../split":95,"./component":77,"./domain":78,"./properties":80,"./range":81,"./type":82}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),i=e("../../log"),a=e("../../scale"),o=e("../../util"),s=e("../../util"),l=e("../model"),c=e("../split"),u=e("./range");function f(e,t){var n,r,s;l.isUnitModel(e)?(r=t,s=(n=e).component.scales,o.keys(s).forEach(function(e){var t=n.specifiedScales[e],o=s[e],l=n.getScaleComponent(e),c=n.fieldDef(e),u=n.sort(e),f=n.config,p=t[r],g=l.get("type"),m=a.scaleTypeSupportProperty(g,r),h=a.channelScalePropertyIncompatability(e,r);if(void 0!==p&&(m?h&&i.warn(h):i.warn(i.message.scalePropertyNotWorkWithScaleType(g,r,e))),m&&void 0===h)if(void 0!==p)o.copyKeyFromObject(r,t);else{var v=d(r,e,c,u,l.get("type"),l.get("padding"),l.get("paddingInner"),t.domain,n.markDef,f);void 0!==v&&o.set(r,v,!1)}})):p(e,t)}function d(e,t,n,r,i,a,o,s,l,c){var u=c.scale;switch(e){case"nice":return g(i,t,n);case"padding":return m(t,i,u,n,l,c.bar);case"paddingInner":return h(a,t,u);case"paddingOuter":return v(a,t,i,o,u);case"reverse":return y(i,r);case"zero":return b(t,n,s)}return u[e]}function p(e,t){for(var n=e.component.scales,r=0,i=e.children;r<i.length;r++){var a=i[r];"range"===t?u.parseScaleRange(a):f(a,t)}o.keys(n).forEach(function(r){for(var i,a=0,o=e.children;a<o.length;a++){var s=o[a].component.scales[r];if(s){var l=s.getWithExplicit(t);i=c.mergeValuesWithExplicit(i,l,t,"scale",c.tieBreakByComparing(function(e,n){switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}}n[r].setWithExplicit(t,i)})}function g(e,t,n){if(!n.bin&&!s.contains([a.ScaleType.TIME,a.ScaleType.UTC],e))return s.contains([r.X,r.Y],t)}function m(e,t,n,i,o,l){if(s.contains([r.X,r.Y],e)){if(a.isContinuousToContinuous(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var c=o.type,u=o.orient;if("bar"===c&&!i.bin&&("vertical"===u&&"x"===e||"horizontal"===u&&"y"===e))return l.continuousBandSize}if(t===a.ScaleType.POINT)return n.pointPadding}}function h(e,t,n){if(void 0===e)return s.contains([r.X,r.Y],t)?n.bandPaddingInner:void 0}function v(e,t,n,i,o){if(void 0===e)return s.contains([r.X,r.Y],t)&&n===a.ScaleType.BAND?void 0!==o.bandPaddingOuter?o.bandPaddingOuter:i/2:void 0}function y(e,t){if(a.hasContinuousDomain(e)&&"descending"===t)return!0}function b(e,t,n){return"size"===e&&"quantitative"===t.type||!(!!n&&"unaggregated"!==n||t.bin||!s.contains([r.X,r.Y],e))}n.parseScaleProperty=f,n.getDefaultValue=d,n.parseNonUnitScaleProperty=p,n.nice=g,n.padding=m,n.paddingInner=h,n.paddingOuter=v,n.reverse=y,n.zero=b},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"../model":69,"../split":95,"./range":81}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-util"),i=e("../../channel"),a=e("../../log"),o=e("../../scale"),s=e("../../scale"),l=e("../../util"),c=e("../../vega.schema"),u=e("../model"),f=e("../split"),d=e("./properties");function p(e,t,r,i,s,l,c,u,d,p){for(var h=u||null===i.rangeStep,v=0,y=n.RANGE_PROPERTIES;v<y.length;v++){var b=y[v];if(void 0!==i[b]){var _=o.scaleTypeSupportProperty(t,b),O=o.channelScalePropertyIncompatability(e,b);if(_)if(O)a.warn(O);else switch(b){case"range":return f.makeExplicit(i[b]);case"scheme":return f.makeExplicit(g(i[b]));case"rangeStep":var S=i[b];if(null!==S){if(!u)return f.makeExplicit({step:S});a.warn(a.message.rangeStepDropped(e))}}else a.warn(a.message.scalePropertyNotWorkWithScaleType(t,b,e))}}return f.makeImplicit(m(e,t,r,s,l,c,d,p,h))}function g(e){if(o.isExtendedScheme(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function m(e,t,n,r,o,c,u,f,d){switch(e){case i.X:case i.Y:if(l.contains(["point","band"],t)&&!d)if(e===i.X&&"text"===c){if(r.scale.textXRangeStep)return{step:r.scale.textXRangeStep}}else if(r.scale.rangeStep)return{step:r.scale.rangeStep};return e===i.Y&&s.hasContinuousDomain(t)?[{signal:u},0]:[0,{signal:u}];case i.SIZE:return[function(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(a.message.incompatibleChannel("size",e))}(c,o,r),function(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:h(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=h(t,r);return(i-2)*(i-2)}throw new Error(a.message.incompatibleChannel("size",e))}(c,f,r)];case i.SHAPE:return"symbol";case i.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===c||"geoshape"===c?"heatmap":"ramp";case i.OPACITY:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function h(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.parseScaleRange=function(e){var t,n;u.isUnitModel(e)?(n=(t=e).component.scales,i.SCALE_CHANNELS.forEach(function(e){var i=n[e];if(i){var o=t.getScaleComponent(e),s=t.specifiedScales[e],u=t.fieldDef(e),f="x"===e?"width":"y"===e?"height":void 0,d=f?!!t.component.layoutSize.get(f):void 0,g=o.get("type"),m=l.contains(["point","band"],g)||!!s.rangeStep;f&&t.fit&&!d&&m&&(a.warn(a.message.CANNOT_FIX_RANGE_STEP_WITH_FIT),d=!0);var h=function(e){var t=[],n=e.getScaleComponent("x"),i=n&&n.get("range");i&&c.isVgRangeStep(i)&&r.isNumber(i.step)&&t.push(i.step);var a=e.getScaleComponent("y"),o=a&&a.get("range");return o&&c.isVgRangeStep(o)&&r.isNumber(o.step)&&t.push(o.step),t}(t),v=p(e,g,u.type,s,t.config,i.get("zero"),t.mark(),d,t.getName(f),h);i.setWithExplicit("range",v)}})):d.parseNonUnitScaleProperty(e,"range")},n.parseRangeForChannel=p,n.defaultRange=m},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"../../vega.schema":127,"../model":69,"../split":95,"./properties":80,"vega-util":10}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),i=e("../../log"),a=e("../../scale"),o=e("../../scale"),s=e("../../type"),l=e("../../util"),c=e("../../util");function u(e,t){var n=t.type;return c.contains([s.Type.ORDINAL,s.Type.NOMINAL],n)?void 0===e||o.hasDiscreteDomain(e):n===s.Type.TEMPORAL?c.contains([a.ScaleType.TIME,a.ScaleType.UTC,a.ScaleType.SEQUENTIAL,void 0],e):n!==s.Type.QUANTITATIVE||(t.bin?c.contains([a.ScaleType.BIN_LINEAR,a.ScaleType.BIN_ORDINAL,a.ScaleType.LINEAR],e):c.contains([a.ScaleType.LOG,a.ScaleType.POW,a.ScaleType.SQRT,a.ScaleType.QUANTILE,a.ScaleType.QUANTIZE,a.ScaleType.LINEAR,a.ScaleType.SEQUENTIAL,void 0],e))}n.scaleType=function(e,t,n,o,s){var c=function(e,t,n,a){switch(t.type){case"nominal":case"ordinal":if("color"===e||"discrete"===r.rangeType(e))return"shape"===e&&"ordinal"===t.type&&i.warn(i.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(l.contains(["x","y"],e)){if("rect"===n)return"band";if("bar"===n)return"band"}return"point";case"temporal":return"color"===e?"sequential":"discrete"===r.rangeType(e)?(i.warn(i.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===r.rangeType(e)?(i.warn(i.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"latitude":case"longitude":case"geojson":return}throw new Error(i.message.invalidFieldType(t.type))}(t,n,o);return r.isScaleChannel(t)?void 0!==e?a.channelSupportScaleType(t,e)?u(e,n)?e:(i.warn(i.message.scaleTypeNotWorkWithFieldDef(e,c)),c):(i.warn(i.message.scaleTypeNotWorkWithChannel(t,e,c)),c):c:null},n.fieldDefMatchScaleType=u},{"../../channel":15,"../../log":110,"../../scale":115,"../../type":124,"../../util":125}],83:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../log"),s=e("../../scale"),l=e("../../util"),c=e("./selection"),u=e("./transforms/scales");n.BRUSH="_brush",n.SCALE_TRIGGER="_scale_trigger";var f={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(e,t){var r=t.name,i=u.default.has(t),f=[],p=[],g=[],m=[];if(t.translate&&!i){var h="!event.item || event.item.mark.name !== "+l.stringValue(r+n.BRUSH);d(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(h)<0&&n.push(h)})}return t.project.forEach(function(r){var i=r.channel;if(i===a.X||i===a.Y){var h,v,y,b,_,O,S,E,x,w,N,T,P,D=(h=e,v=t,y=i,b=c.channelSignalName(v,y,"visual"),_=c.channelSignalName(v,y,"data"),O=u.default.has(v),S=h.scaleName(y),E=l.stringValue(S),x=h.getScaleComponent(y),w=x?x.get("type"):void 0,N=h.getSizeSignalRef(y===a.X?"width":"height").signal,T=y+"(unit)",(P=d(v,function(e,t){return e.concat({events:t.between[0],update:"["+T+", "+T+"]"},{events:t,update:"["+b+"[0], clamp("+T+", 0, "+N+")]"})})).push({events:{signal:v.name+n.SCALE_TRIGGER},update:s.hasContinuousDomain(w)&&!s.isBinScale(w)?"[scale("+E+", "+_+"[0]), scale("+E+", "+_+"[1])]":"[0, 0]"}),O?[{name:_,on:[]}]:[{name:b,value:[],on:P},{name:_,on:[{events:{signal:b},update:b+"[0] === "+b+"[1] ? null : invert("+E+", "+b+")"}]}]),k=c.channelSignalName(t,i,"data"),j=c.channelSignalName(t,i,"visual"),A=l.stringValue(e.scaleName(i)),C=e.getScaleComponent(i).get("type"),M=s.hasContinuousDomain(C)?"+":"";f.push.apply(f,D),g.push(k),p.push("{encoding: "+l.stringValue(i)+", field: "+l.stringValue(r.field)+", extent: "+k+"}"),m.push({scaleName:e.scaleName(i),expr:"(!isArray("+k+") || ("+M+"invert("+A+", "+j+")[0] === "+M+k+"[0] && "+M+"invert("+A+", "+j+")[1] === "+M+k+"[1]))"})}else o.warn("Interval selections only support x and y encoding channels.")}),i||f.push({name:r+n.SCALE_TRIGGER,update:m.map(function(e){return e.expr}).join(" && ")+" ? "+(r+n.SCALE_TRIGGER)+" : {}"}),f.concat({name:r+c.TUPLE,on:[{events:g.map(function(e){return{signal:e}}),update:g.join(" && ")+" ? {unit: "+c.unitName(e)+", intervals: ["+p.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+c.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+c.unitName(e)+"}")},marks:function(e,t,a){var o=t.name,s=c.positionalProjections(t),f=s.xi,d=s.yi,p="data("+l.stringValue(t.name+c.STORE)+")";if(u.default.has(t))return a;var g={x:null!==f?{signal:o+"_x[0]"}:{value:0},y:null!==d?{signal:o+"_y[0]"}:{value:0},x2:null!==f?{signal:o+"_x[1]"}:{field:{group:"width"}},y2:null!==d?{signal:o+"_y[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(var m=0,h=l.keys(g);m<h.length;m++){var v=h[m];g[v]=[r({test:p+".length && "+p+"[0].unit === "+c.unitName(e)},g[v]),{value:0}]}var y=t.mark,b=y.fill,_=y.fillOpacity,O=i(y,["fill","fillOpacity"]),S=l.keys(O).reduce(function(e,t){return e[t]={value:O[t]},e},{});return[{name:o+n.BRUSH+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:b},fillOpacity:{value:_}},update:g}}].concat(a,{name:o+n.BRUSH,type:"rect",clip:!0,encode:{enter:r({fill:{value:"transparent"}},S),update:g}})}};function d(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(o.warn(n+" is not an ordered event stream for interval selections"),e)},[])}n.default=f},{"../../channel":15,"../../log":110,"../../scale":115,"../../util":125,"./selection":85,"./transforms/scales":90}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./selection"),a=e("./transforms/nearest"),o={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:function(e,t){var n=t.project,o=a.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum",s=[],l=n.map(function(e){return r.stringValue(e.channel)}).filter(function(e){return e}).join(", "),c=n.map(function(e){return r.stringValue(e.field)}).join(", "),u=n.map(function(t){var n=t.channel,i=e.fieldDef(n);return i&&i.bin?(s.push(t.field),"["+o+r.accessPath(e.vgField(n,{}))+", "+o+r.accessPath(e.vgField(n,{binSuffix:"end"}))+"]"):""+o+r.accessPath(t.field)}).join(", ");return[{name:t.name+i.TUPLE,value:{},on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+i.unitName(e)+", encodings: ["+l+"], fields: ["+c+"], values: ["+u+"]"+(s.length?", "+s.map(function(e){return r.stringValue("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:!0}]}]},modifyExpr:function(e,t){return t.name+i.TUPLE+", "+("global"===t.resolve?"null":"{unit: "+i.unitName(e)+"}")}};n.default=o},{"../../util":125,"./selection":85,"./transforms/nearest":88}],85:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-event-selector"),a=e("../../channel"),o=e("../../log"),s=e("../../selection"),l=e("../../util"),c=e("../model"),u=e("./interval"),f=e("./multi"),d=e("./single"),p=e("./transforms/transforms");function g(e,t){return m(e,function(n,r){t=r.marks?r.marks(e,n,t):t,p.forEachTransform(n,function(r){r.marks&&(t=r.marks(e,n,t))})}),t}function m(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,h(i.type))}}function h(e){switch(e){case"single":return d.default;case"multi":return f.default;case"interval":return u.default}return null}function v(e){for(var t=e.parent;t&&!c.isFacetModel(t);)t=t.parent;return t}n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.SELECTION_DOMAIN="_selection_domain_",n.parseUnitSelection=function(e,t){var n={},a=e.config.selection,o=function(o){if(!t.hasOwnProperty(o))return"continue";var s=t[o],c=a[s.type];for(var u in c)"encodings"===u&&s.fields||"fields"===u&&s.encodings||("mark"===u&&(s[u]=r({},c[u],s[u])),void 0!==s[u]&&!0!==s[u]||(s[u]=c[u]||s[u]));o=l.varName(o);var f=n[o]=r({},s,{name:o,events:l.isString(s.on)?i.selector(s.on,"scope"):s.on});p.forEachTransform(f,function(t){t.parse&&t.parse(e,s,f)})};for(var s in t)o(s);return n},n.assembleUnitSelectionSignals=function(e,t){m(e,function(r,i){var a=r.name,o=i.modifyExpr(e,r);t.push.apply(t,i.signals(e,r)),p.forEachTransform(r,function(n){n.signals&&(t=n.signals(e,r,t)),n.modifyExpr&&(o=n.modifyExpr(e,r,o))}),t.push({name:a+n.MODIFY,on:[{events:{signal:a+n.TUPLE},update:"modify("+l.stringValue(r.name+n.STORE)+", "+o+")"}]})});var r=v(e);if(t.length&&r){var a=l.stringValue(r.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:i.selector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+a+").datum"}]})}return t},n.assembleTopLevelSignals=function(e,t){var n=!1;return m(e,function(r,i){i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),p.forEachTransform(r,function(n){n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}),n=!0}),n&&(t.filter(function(e){return"unit"===e.name}).length||t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),t},n.assembleUnitSelectionData=function(e,t){return m(e,function(e){t.filter(function(t){return t.name===e.name+n.STORE}).length||t.push({name:e.name+n.STORE})}),t},n.assembleUnitSelectionMarks=g,n.assembleLayerSelectionMarks=function(e,t){return e.children.forEach(function(e){c.isUnitModel(e)&&(t=g(e,t))}),t},n.selectionPredicate=function(e,t,r){var i=[],a=l.logicalExpr(t,function(t){var a=l.varName(t),o=e.getSelectionComponent(a,t),s=l.stringValue(a+n.STORE);if(o.timeUnit){var c=r||e.component.data.raw,u=o.timeUnit.clone();c.parent?u.insertAsParentOf(c):c.parent=u}return"none"!==o.empty&&i.push(s),h(o.type).predicate+"("+s+", datum"+("global"===o.resolve?")":", "+l.stringValue(o.resolve)+")")});return(i.length?"!("+i.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+"("+a+")"},n.isRawSelectionDomain=function(e){return e.signal.indexOf(n.SELECTION_DOMAIN)>=0},n.selectionScaleDomain=function(e,t){var r=JSON.parse(t.signal.replace(n.SELECTION_DOMAIN,"")),i=l.varName(r.selection),a=e.component.selection&&e.component.selection[i];return a?(o.warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.'),{signal:"null"}):(a=e.getSelectionComponent(i,r.selection),r.encoding||r.field||(r.field=a.project[0].field,a.project.length>1&&o.warn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+l.stringValue(r.field)+".")),{signal:h(a.type).scaleDomain+"("+l.stringValue(i+n.STORE)+", "+l.stringValue(r.encoding||null)+", "+l.stringValue(r.field||null)+("global"===a.resolve?")":", "+l.stringValue(a.resolve)+")")})},n.unitName=function(e){var t=l.stringValue(e.name),n=v(e);return n&&(t+=(n.facet.row?" + '_' + facet"+l.accessPath(n.vgField("row")):"")+(n.facet.column?" + '_' + facet"+l.accessPath(n.vgField("column")):"")),t},n.requiresSelectionId=function(e){var t=!1;return m(e,function(e){t=t||e.project.some(function(e){return e.field===s.SELECTION_ID})}),t},n.channelSignalName=function(e,t,n){return l.varName(e.name+"_"+("visual"===n?t:e.fields[t]))},n.positionalProjections=function(e){var t=null,n=null,r=null,i=null;return e.project.forEach(function(e,o){e.channel===a.X?(t=e,n=o):e.channel===a.Y&&(r=e,i=o)}),{x:t,xi:n,y:r,yi:i}}},{"../../channel":15,"../../log":110,"../../selection":116,"../../util":125,"../model":69,"./interval":83,"./multi":84,"./single":86,"./transforms/transforms":92,"vega-event-selector":9}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./multi"),a=e("./selection"),o={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:i.default.signals,topLevelSignals:function(e,t,n){var i=n.filter(function(e){return e.name===t.name}),o="data("+r.stringValue(t.name+a.STORE)+")",s=o+"[0].values";return i.length?n:n.concat({name:t.name,update:o+".length && {"+t.project.map(function(e,t){return e.field+": "+s+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+a.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+a.unitName(e)+"}")}};n.default=o},{"../../util":125,"./multi":84,"./selection":85}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../util"),i=e("../selection"),a=e("./nearest"),o={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var i=t.name,o=t.project,s=t.bind,l=a.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return o.forEach(function(e){var a=r.varName(i+"_"+e.field);n.filter(function(e){return e.name===a}).length||n.unshift({name:a,value:"",on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+l+r.accessPath(e.field)+" : null"}],bind:s[e.field]||s[e.channel]||s})}),n},signals:function(e,t,n){var a=t.name,o=t.project,s=n.filter(function(e){return e.name===a+i.TUPLE})[0],l=o.map(function(e){return r.stringValue(e.field)}).join(", "),c=o.map(function(e){return r.varName(a+"_"+e.field)});return s.update=c.join(" && ")+" ? {fields: ["+l+"], values: ["+c.join(", ")+"]} : null",delete s.value,delete s.on,n}};n.default=o},{"../../../util":125,"../selection":85,"./nearest":88}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../log"),i=e("../selection"),a={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(e,t,n){var a=i.positionalProjections(t),o=a.x,s=a.y,l=e.mark();if("line"===l||"area"===l)return r.warn(r.message.nearestNotSupportForContinuous(l)),n;var c={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:o||!o&&!s?"datum.x":{expr:"0"},y:s||!o&&!s?"datum.y":{expr:"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]},u=0,f=!1;return n.forEach(function(t,n){var r=t.name||"";r===e.component.mark[0].name?u=n:r.indexOf("voronoi")>=0&&(f=!0)}),f||n.splice(u+1,0,c),n}};n.default=a},{"../../../log":110,"../selection":85}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../log"),i=e("../../../util"),a=e("../../data/timeunit"),o={has:function(e){var t=e;return void 0!==t.fields||void 0!==t.encodings},parse:function(e,t,n){var o={},s={};(t.fields||[]).forEach(function(e){return o[e]=null}),(t.encodings||[]).forEach(function(t){var n=e.fieldDef(t);if(n)if(n.timeUnit){var i=e.vgField(t);o[i]=t,s[i]={as:i,field:n.field,timeUnit:n.timeUnit}}else o[n.field]=t;else r.warn(r.message.cannotProjectOnChannelWithoutField(t))});var l=n.project||(n.project=[]);for(var c in o)o.hasOwnProperty(c)&&l.push({field:c,channel:o[c]});var u=n.fields||(n.fields={});l.filter(function(e){return e.channel}).forEach(function(e){return u[e.channel]=e.field}),i.keys(s).length&&(n.timeUnit=new a.TimeUnitNode(s))}};n.default=o},{"../../../log":110,"../../../util":125,"../../data/timeunit":45}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../log"),i=e("../../../scale"),a=e("../../../util"),o=e("../selection"),s={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var a=n.scales=[];n.project.forEach(function(t){var s=t.channel,l=e.getScaleComponent(s),c=l?l.get("type"):void 0;l&&i.hasContinuousDomain(c)&&!i.isBinScale(c)?(l.set("domainRaw",{signal:o.channelSignalName(n,s,"data")},!0),a.push(s)):r.warn(r.message.SCALE_BINDINGS_CONTINUOUS)})},topLevelSignals:function(e,t,n){if(!e.parent)return n;var r=t.scales.filter(function(e){return!n.filter(function(n){return n.name===o.channelSignalName(t,e,"data")}).length});return n.concat(r.map(function(e){return{name:o.channelSignalName(t,e,"data")}}))},signals:function(e,t,n){return e.parent&&t.scales.forEach(function(e){var r=n.filter(function(n){return n.name===o.channelSignalName(t,e,"data")})[0];r.push="outer",delete r.value,delete r.update}),n}};n.default=s,n.domain=function(e,t){return"domain("+a.stringValue(e.scaleName(t))+")"}},{"../../../log":110,"../../../scale":115,"../../../util":125,"../selection":85}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../selection"),i={has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var i=t.name+r.TUPLE,a=t.name+"_toggle";return a+" ? null : "+i+", "+("global"===t.resolve?a+" ? null : true, ":a+" ? null : {unit: "+r.unitName(e)+"}, ")+a+" ? "+i+" : null"}};n.default=i},{"../selection":85}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./inputs"),i=e("./nearest"),a=e("./project"),o=e("./scales"),s=e("./toggle"),l=e("./translate"),c=e("./zoom"),u={project:a.default,toggle:s.default,scales:o.default,translate:l.default,zoom:c.default,inputs:r.default,nearest:i.default};n.forEachTransform=function(e,t){for(var n in u)u[n].has(e)&&t(u[n])}},{"./inputs":87,"./nearest":88,"./project":89,"./scales":90,"./toggle":91,"./translate":93,"./zoom":94}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-event-selector"),i=e("../../../channel"),a=e("../interval"),o=e("../selection"),s=e("./scales"),l="_translate_anchor",c="_translate_delta",u={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var u=t.name,d=s.default.has(t),p=u+l,g=o.positionalProjections(t),m=g.x,h=g.y,v=r.selector(t.translate,"scope");return d||(v=v.map(function(e){return e.between[0].markname=u+a.BRUSH,e})),n.push({name:p,value:{},on:[{events:v.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==m?", extent_x: "+(d?s.domain(e,i.X):"slice("+o.channelSignalName(t,"x","visual")+")"):"")+(null!==h?", extent_y: "+(d?s.domain(e,i.Y):"slice("+o.channelSignalName(t,"y","visual")+")"):"")+"}"}]},{name:u+c,value:{},on:[{events:v,update:"{x: "+p+".x - x(unit), y: "+p+".y - y(unit)}"}]}),null!==m&&f(e,t,i.X,"width",n),null!==h&&f(e,t,i.Y,"height",n),n}};function f(e,t,n,r,a){var u=t.name,f=s.default.has(t),d=a.filter(function(e){return e.name===o.channelSignalName(t,n,f?"data":"visual")})[0],p=u+l,g=u+c,m=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(n),v=h.get("type"),y=f&&n===i.X?"-":"",b=p+".extent_"+n,_=(f?"log"===v?"panLog":"pow"===v?"panPow":"panLinear":"panLinear")+"("+b+", "+(""+y+g+"."+n+" / "+(f?""+m:"span("+b+")"))+(f&&"pow"===v?", "+(h.get("exponent")||1):"")+")";d.on.push({events:{signal:g},update:f?_:"clampRange("+_+", 0, "+m+")"})}n.default=u},{"../../../channel":15,"../interval":83,"../selection":85,"./scales":90,"vega-event-selector":9}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-event-selector"),i=e("../../../channel"),a=e("../../../util"),o=e("../interval"),s=e("../selection"),l=e("./scales"),c="_zoom_anchor",u="_zoom_delta",f={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var f=t.name,p=l.default.has(t),g=f+u,m=s.positionalProjections(t),h=m.x,v=m.y,y=a.stringValue(e.scaleName(i.X)),b=a.stringValue(e.scaleName(i.Y)),_=r.selector(t.zoom,"scope");return p||(_=_.map(function(e){return e.markname=f+o.BRUSH,e})),n.push({name:f+c,on:[{events:_,update:p?"{"+[y?"x: invert("+y+", x(unit))":"",b?"y: invert("+b+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:g,on:[{events:_,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==h&&d(e,t,"x","width",n),null!==v&&d(e,t,"y","height",n),n}};function d(e,t,n,r,i){var a=t.name,o=l.default.has(t),f=i.filter(function(e){return e.name===s.channelSignalName(t,n,o?"data":"visual")})[0],d=e.getSizeSignalRef(r).signal,p=e.getScaleComponent(n),g=p.get("type"),m=o?l.domain(e,n):f.name,h=a+u,v=(o?"log"===g?"zoomLog":"pow"===g?"zoomPow":"zoomLinear":"zoomLinear")+"("+m+", "+(""+a+c+"."+n)+", "+h+(o&&"pow"===g?", "+(p.get("exponent")||1):"")+")";f.on.push({events:{signal:h},update:o?v:"clampRange("+v+", 0, "+d+")"})}n.default=f},{"../../../channel":15,"../../../util":125,"../interval":83,"../selection":85,"./scales":90,"vega-event-selector":9}],95:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../log"),a=e("../util"),o=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(a.duplicate(this.explicit),a.duplicate(this.implicit))},e.prototype.combine=function(){return r({},this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e}();function s(e,t,n,r){return e.explicit&&t.explicit&&i.warn(i.message.mergeConflictingProperty(n,r,e.value,t.value)),e}n.Split=o,n.makeExplicit=function(e){return{explicit:!0,value:e}},n.makeImplicit=function(e){return{explicit:!1,value:e}},n.tieBreakByComparing=function(e){return function(t,n,r,i){var a=e(t.value,n.value);return a>0?t:a<0?n:s(t,n,r,i)}},n.defaultTieBreaker=s,n.mergeValuesWithExplicit=function(e,t,n,r,i){return void 0===i&&(i=s),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:a.stringify(e.value)===a.stringify(t.value)?e:i(e,t,n,r)}},{"../log":110,"../util":125}],96:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../channel"),s=e("../encoding"),l=e("../encoding"),c=e("../fielddef"),u=e("../mark"),f=e("../stack"),d=e("../util"),p=e("./axis/parse"),g=e("./data/parse"),m=e("./layoutsize/assemble"),h=e("./layoutsize/parse"),v=e("./mark/init"),y=e("./mark/mark"),b=e("./model"),_=e("./repeater"),O=e("./selection/selection"),S=function(e){function t(t,n,r,i,o,s,c){void 0===i&&(i={});var d=e.call(this,t,n,r,s,void 0)||this;d.fit=c,d.type="unit",d.specifiedScales={},d.specifiedAxes={},d.specifiedLegends={},d.specifiedProjection={},d.selection={},d.children=[],d.initSize(a({},i,t.width?{width:t.width}:{},t.height?{height:t.height}:{}));var p=u.isMarkDef(t.mark)?t.mark.type:t.mark,g=d.encoding=l.normalizeEncoding(_.replaceRepeaterInEncoding(t.encoding||{},o),p);return d.markDef=v.normalizeMarkDef(t.mark,g,s),d.stack=f.stack(p,g,d.config.stack),d.specifiedScales=d.initScales(p,g),d.specifiedAxes=d.initAxes(g),d.specifiedLegends=d.initLegend(g),d.specifiedProjection=t.projection,d.selection=t.selection,d}return i(t,e),t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},t.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},t.prototype.axis=function(e){return this.specifiedAxes[e]},t.prototype.legend=function(e){return this.specifiedLegends[e]},t.prototype.initScales=function(e,t){return o.SCALE_CHANNELS.reduce(function(e,n){var r,i,a=t[n];return c.isFieldDef(a)?(r=a,i=a.scale):c.hasConditionalFieldDef(a)?(r=a.condition,i=a.condition.scale):"x"===n?r=c.getFieldDef(t.x2):"y"===n&&(r=c.getFieldDef(t.y2)),r&&(e[n]=i||{}),e},{})},t.prototype.initAxes=function(e){return[o.X,o.Y].reduce(function(t,n){var r=e[n];if(c.isFieldDef(r)||n===o.X&&c.isFieldDef(e.x2)||n===o.Y&&c.isFieldDef(e.y2)){var i=c.isFieldDef(r)?r.axis:null;null!==i&&!1!==i&&(t[n]=a({},i))}return t},{})},t.prototype.initLegend=function(e){return o.NONPOSITION_SCALE_CHANNELS.reduce(function(t,n){var r=e[n];if(r){var i=c.isFieldDef(r)?r.legend:c.hasConditionalFieldDef(r)?r.condition.legend:null;null!==i&&!1!==i&&(t[n]=a({},i))}return t},{})},t.prototype.parseData=function(){this.component.data=g.parseData(this)},t.prototype.parseLayoutSize=function(){h.parseUnitLayoutSize(this)},t.prototype.parseSelection=function(){this.component.selection=O.parseUnitSelection(this,this.selection)},t.prototype.parseMarkGroup=function(){this.component.mark=y.parseMarkGroup(this)},t.prototype.parseAxisAndHeader=function(){this.component.axes=p.parseUnitAxis(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return O.assembleTopLevelSignals(this,e)},t.prototype.assembleSelectionSignals=function(){return O.assembleUnitSelectionSignals(this,[])},t.prototype.assembleSelectionData=function(e){return O.assembleUnitSelectionData(this,e)},t.prototype.assembleLayout=function(){return null},t.prototype.assembleLayoutSignals=function(){return m.assembleLayoutSignals(this)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&b.isLayerModel(this.parent)||(e=O.assembleUnitSelectionMarks(this,e)),e.map(this.correctDataNames)},t.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,r=d.duplicate(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=d.duplicate(this.config)),t||(n.data=d.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return s.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){var t=this.encoding[e];return c.getFieldDef(t)},t}(b.ModelWithField);n.UnitModel=S},{"../channel":15,"../encoding":104,"../fielddef":106,"../mark":112,"../stack":119,"../util":125,"./axis/parse":20,"./data/parse":42,"./layoutsize/assemble":49,"./layoutsize/parse":50,"./mark/init":59,"./mark/mark":61,"./model":69,"./repeater":74,"./selection/selection":85}],97:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-util"),o=e("../encoding"),s=e("./../encoding"),l=e("./../fielddef"),c=e("./../log"),u=e("./common");function f(e){return!!e.type}n.BOXPLOT="box-plot",n.isBoxPlotDef=f,n.BOXPLOT_STYLES=["boxWhisker","box","boxMid"],n.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size","color"],boxWhisker:["color"],boxMid:["color"]};var d=["x","y","color","detail","opacity","size"];function p(e){return r({},e,{encoding:o.reduce(e.encoding,function(e,t,r){return d.indexOf(r)>-1?e[r]=t:c.warn(c.message.incompatibleChannel(r,n.BOXPLOT)),e},{})})}n.filterUnsupportedChannels=p,n.normalizeBoxPlot=function(e,t){var o=(e=p(e)).mark,d=(e.encoding,e.selection),g=(e.projection,i(e,["mark","encoding","selection","projection"])),m=void 0;f(o)&&o.extent&&a.isNumber(o.extent)&&(m=o.extent);var h,v,y,b,_=function(e,t,r){var a=function(e,t){e.mark;var r,a,o=e.encoding;if(e.projection,i(e,["mark","encoding","projection"]),"vertical"===t?(a="y",r=o.y):(a="x",r=o.x),r&&r.aggregate){var s=r.aggregate,l=i(r,["aggregate"]);s!==n.BOXPLOT&&c.warn("Continuous axis should not have customized aggregation function "+s),r=l}return{continuousAxisChannelDef:r,continuousAxis:a}}(e,t),o=a.continuousAxisChannelDef,u=a.continuousAxis,f=e.encoding,d=void 0===r,p=[{op:"q1",field:o.field,as:"lower_box_"+o.field},{op:"q3",field:o.field,as:"upper_box_"+o.field},{op:"median",field:o.field,as:"mid_box_"+o.field}],g=[];p.push({op:"min",field:o.field,as:(d?"lower_whisker_":"min_")+o.field}),p.push({op:"max",field:o.field,as:(d?"upper_whisker_":"max_")+o.field}),d||(g=[{calculate:"datum.upper_box_"+o.field+" - datum.lower_box_"+o.field,as:"iqr_"+o.field},{calculate:"min(datum.upper_box_"+o.field+" + datum.iqr_"+o.field+" * "+r+", datum.max_"+o.field+")",as:"upper_whisker_"+o.field},{calculate:"max(datum.lower_box_"+o.field+" - datum.iqr_"+o.field+" * "+r+", datum.min_"+o.field+")",as:"lower_whisker_"+o.field}]);var m=[],h=[],v=[],y={};return s.forEach(f,function(e,t){if(t!==u)if(l.isFieldDef(e)){if(e.aggregate&&e.aggregate!==n.BOXPLOT)p.push({op:e.aggregate,field:e.field,as:l.vgField(e)});else if(void 0===e.aggregate){var r=l.vgField(e),i=e.bin;if(i){var a=e.field;h.push({bin:i,field:a,as:r})}else if(e.timeUnit){var o=e.timeUnit;a=e.field,v.push({timeUnit:o,field:a,as:r})}m.push(r)}y[t]={field:l.vgField(e),type:e.type}}else y[t]=f[t]}),{transform:[].concat(h,v,[{aggregate:p,groupby:m}],g),continuousAxisChannelDef:o,continuousAxis:u,encodingWithoutContinuousAxis:y}}(e,function(e){var t=e.mark,r=e.encoding;if(e.projection,i(e,["mark","encoding","projection"]),l.isFieldDef(r.x)&&l.isContinuous(r.x)){if(l.isFieldDef(r.y)&&l.isContinuous(r.y)){if(void 0===r.x.aggregate&&r.y.aggregate===n.BOXPLOT)return"vertical";if(void 0===r.y.aggregate&&r.x.aggregate===n.BOXPLOT)return"horizontal";if(r.x.aggregate===n.BOXPLOT&&r.y.aggregate===n.BOXPLOT)throw new Error("Both x and y cannot have aggregate");return f(t)&&t.orient?t.orient:"vertical"}return"horizontal"}if(l.isFieldDef(r.y)&&l.isContinuous(r.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}(e),m),O=_.transform,S=_.continuousAxisChannelDef,E=_.continuousAxis,x=_.encodingWithoutContinuousAxis,w=(x.color,x.size),N=i(x,["color","size"]),T=w?{size:w}:u.getMarkSpecificConfigMixins(t.box,"size"),P={};return S.scale&&(P.scale=S.scale),S.axis&&(P.axis=S.axis),r({},g,{transform:O,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:r((h={},h[E]=r({field:"lower_whisker_"+S.field,type:S.type},P),h[E+"2"]={field:"lower_box_"+S.field,type:S.type},h),N,u.getMarkSpecificConfigMixins(t.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:r((v={},v[E]={field:"upper_box_"+S.field,type:S.type},v[E+"2"]={field:"upper_whisker_"+S.field,type:S.type},v),N,u.getMarkSpecificConfigMixins(t.boxWhisker,"color"))},r({},d?{selection:d}:{},{mark:{type:"bar",style:"box"},encoding:r((y={},y[E]={field:"lower_box_"+S.field,type:S.type},y[E+"2"]={field:"upper_box_"+S.field,type:S.type},y),x,x.color?{}:u.getMarkSpecificConfigMixins(t.box,"color"),T)}),{mark:{type:"tick",style:"boxMid"},encoding:r((b={},b[E]={field:"mid_box_"+S.field,type:S.type},b),N,u.getMarkSpecificConfigMixins(t.boxMid,"color"),T)}]})}},{"../encoding":104,"./../encoding":104,"./../fielddef":106,"./../log":110,"./common":98,"vega-util":10}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMarkSpecificConfigMixins=function(e,t){var n,r=e[t];return void 0!==r?((n={})[t]={value:r},n):{}}},{}],99:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ERRORBAR="error-bar",n.normalizeErrorBar=function(e){e.mark,e.selection,e.projection;var t=e.encoding,n=i(e,["mark","selection","projection","encoding"]),a=(t.size,i(t,["size"])),o=(t.x2,t.y2,i(t,["x2","y2"])),s=(o.x,o.y,i(o,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return r({},n,{layer:[{mark:"rule",encoding:a},{mark:"tick",encoding:o},{mark:"tick",encoding:t.x2?r({x:t.x2,y:t.y},s):r({x:t.x,y:t.y2},s)}]})}},{}],100:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./../mark"),a=e("./boxplot"),o=e("./errorbar"),s={};function l(e,t){s[e]=t}n.add=l,n.remove=function(e){delete s[e]},n.COMPOSITE_MARK_STYLES=a.BOXPLOT_STYLES,n.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=r({},a.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),l(a.BOXPLOT,a.normalizeBoxPlot),l(o.ERRORBAR,o.normalizeErrorBar),n.normalize=function(e,t){var n=i.isMarkDef(e.mark)?e.mark.type:e.mark,r=s[n];if(r)return r(e,t);throw new Error("Unregistered composite mark "+n)}},{"./../mark":112,"./boxplot":97,"./errorbar":99}],101:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./compositemark"),a=e("./compositemark/index"),o=e("./guide"),s=e("./legend"),l=e("./mark"),c=e("./mark"),u=e("./scale"),f=e("./selection"),d=e("./title"),p=e("./util");n.defaultViewConfig={width:200,height:200},n.defaultConfig={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:n.defaultViewConfig,mark:c.defaultMarkConfig,area:{},bar:c.defaultBarConfig,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:c.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{color:"white"},scale:u.defaultScaleConfig,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:s.defaultLegendConfig,selection:f.defaultConfig,style:{},title:{}},n.initConfig=function(e){return p.mergeDeep(p.duplicate(n.defaultConfig),e)};var g=["view"].concat(l.PRIMITIVE_MARKS,i.COMPOSITE_MARK_STYLES),m=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],h=r({view:["width","height"]},l.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,a.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);function v(e,t,n){var i="title"===t?d.extractTitleConfig(e.title).mark:e[t];"view"===t&&(n="cell");var a=r({},i,e.style[t]);p.keys(a).length>0&&(e.style[n||t]=a),delete e[t]}n.stripAndRedirectConfig=function(e){e=p.duplicate(e);for(var t=0,n=m;t<n.length;t++)delete e[a=n[t]];if(e.axis)for(var r=0,i=o.VL_ONLY_GUIDE_CONFIG;r<i.length;r++){var a=i[r];delete e.axis[a]}if(e.legend)for(var s=0,c=o.VL_ONLY_GUIDE_CONFIG;s<c.length;s++)a=c[s],delete e.legend[a];if(e.mark)for(var u=0,f=l.VL_ONLY_MARK_CONFIG_PROPERTIES;u<f.length;u++)a=f[u],delete e.mark[a];for(var d=0,y=g;d<y.length;d++){for(var b=y[d],_=0,O=l.VL_ONLY_MARK_CONFIG_PROPERTIES;_<O.length;_++)a=O[_],delete e[b][a];var S=h[b];if(S)for(var E=0,x=S;E<x.length;E++)a=x[E],delete e[b][a];v(e,b)}for(var a in v(e,"title","group-title"),e)p.isObject(e[a])&&0===p.keys(e[a]).length&&delete e[a];return p.keys(e).length>0?e:void 0}},{"./compositemark":100,"./compositemark/index":100,"./guide":107,"./legend":109,"./mark":112,"./scale":115,"./selection":116,"./title":121,"./util":125}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=function(e){return!!e.url},n.isInlineData=function(e){return!!e.values},n.isNamedData=function(e){return!!e.name},n.MAIN="main",n.RAW="raw"},{}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./log"),i=e("./util"),a=2006;n.isDateTime=function(e){return!(!e||!(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))},n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.dateTimeExpr=function(e,t){void 0===t&&(t=!1);var o=[];if(t&&void 0!==e.day&&i.keys(e).length>1&&(r.warn(r.message.droppedDay(e)),delete(e=i.duplicate(e)).day),void 0!==e.year?o.push(e.year):void 0!==e.day?o.push(a):o.push(0),void 0!==e.month){var s=t?function(e){if(i.isNumber(e))return e-1+"";var t=e.toLowerCase(),a=n.MONTHS.indexOf(t);if(-1!==a)return a+"";var o=t.substr(0,3),s=n.SHORT_MONTHS.indexOf(o);if(-1!==s)return s+"";throw new Error(r.message.invalidTimeUnit("month",e))}(e.month):e.month;o.push(s)}else if(void 0!==e.quarter){var l=t?function(e){if(i.isNumber(e))return e>4&&r.warn(r.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(r.message.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;o.push(l+"*3")}else o.push(0);if(void 0!==e.date)o.push(e.date);else if(void 0!==e.day){var c=t?function(e){if(i.isNumber(e))return e%7+"";var t=e.toLowerCase(),a=n.DAYS.indexOf(t);if(-1!==a)return a+"";var o=t.substr(0,3),s=n.SHORT_DAYS.indexOf(o);if(-1!==s)return s+"";throw new Error(r.message.invalidTimeUnit("day",e))}(e.day):e.day;o.push(c+"+1")}else o.push(1);for(var u=0,f=["hours","minutes","seconds","milliseconds"];u<f.length;u++){var d=f[u];void 0!==e[d]?o.push(e[d]):o.push(0)}return e.utc?"utc("+o.join(", ")+")":"datetime("+o.join(", ")+")"}},{"./log":110,"./util":125}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./channel"),i=e("./fielddef"),a=e("./log"),o=e("./util");function s(e,t){var n=e&&e[t];return!!n&&(o.isArray(n)?o.some(n,function(e){return!!e.field}):i.isFieldDef(n)||i.hasConditionalFieldDef(n))}n.channelHasField=s,n.isAggregate=function(e){return o.some(r.CHANNELS,function(t){if(s(e,t)){var n=e[t];if(o.isArray(n))return o.some(n,function(e){return!!e.aggregate});var r=i.getFieldDef(n);return r&&!!r.aggregate}return!1})},n.normalizeEncoding=function(e,t){return o.keys(e).reduce(function(n,s){if(!r.supportMark(s,t))return a.warn(a.message.incompatibleChannel(s,t)),n;if("size"===s&&"line"===t){var l=i.getFieldDef(e[s]);if(l&&l.aggregate)return a.warn(a.message.incompatibleChannel(s,t,"when the field is aggregated.")),n}if("detail"===s||"order"===s)(c=e[s])&&(n[s]=(o.isArray(c)?c:[c]).reduce(function(e,t){return i.isFieldDef(t)?e.push(i.normalizeFieldDef(t,s)):a.warn(a.message.emptyFieldDef(t,s)),e},[]));else{var c=e[s];if(!i.isFieldDef(c)&&!i.isValueDef(c)&&!i.isConditionalDef(c))return a.warn(a.message.emptyFieldDef(c,s)),n;n[s]=i.normalize(c,s)}return n},{})},n.isRanged=function(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)},n.fieldDefs=function(e){var t=[];return r.CHANNELS.forEach(function(n){if(s(e,n)){var r=e[n];(o.isArray(r)?r:[r]).forEach(function(e){i.isFieldDef(e)?t.push(e):i.hasConditionalFieldDef(e)&&t.push(e.condition)})}}),t},n.forEach=function(e,t,n){if(e)for(var r=function(r){o.isArray(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)},i=0,a=o.keys(e);i<a.length;i++)r(a[i])},n.reduce=function(e,t,n,r){return e?o.keys(e).reduce(function(n,i){var a=e[i];return o.isArray(a)?a.reduce(function(e,n){return t.call(r,e,n,i)},n):t.call(r,n,a,i)},n):n}},{"./channel":15,"./fielddef":106,"./log":110,"./util":125}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],106:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./aggregate"),o=e("./bin"),s=e("./channel"),l=e("./log"),c=e("./timeunit"),u=e("./type"),f=e("./util");function d(e){return!!e&&!!e.condition&&!f.isArray(e.condition)&&p(e.condition)}function p(e){return!(!e||!e.field&&"count"!==e.aggregate)}function g(e){return e&&"value"in e&&void 0!==e.value}function m(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return!1}throw new Error(l.message.invalidFieldType(e.type))}function h(e){return!m(e)}function v(e){return"count"===e.aggregate}function y(e,t){var n=e.field,r=e.bin,i=e.timeUnit,a=e.aggregate;return"count"===a?t.countTitle:r?n+" (binned)":i?n+" ("+c.getTimeUnitParts(i).join("-")+")":a?f.titlecase(a)+" of "+n:n}function b(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}n.isConditionalSelection=function(e){return e.selection},n.isRepeatRef=function(e){return e&&!f.isString(e)&&"repeat"in e},n.isConditionalDef=function(e){return!!e&&!!e.condition},n.hasConditionalFieldDef=d,n.hasConditionalValueDef=function(e){return!!e&&!!e.condition&&(f.isArray(e.condition)||g(e.condition))},n.isFieldDef=p,n.isStringFieldDef=function(e){return p(e)&&f.isString(e.field)},n.isValueDef=g,n.isScaleFieldDef=function(e){return!(!e||!e.scale&&!e.sort)},n.vgField=function(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(v(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=o.binToString(e.bin),i=t.binSuffix||""):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr&&(n=""+t.expr+f.accessPath(n)),n},n.isDiscrete=m,n.isContinuous=h,n.isCount=v,n.verbalTitleFormatter=y,n.functionalTitleFormatter=b,n.defaultTitleFormatter=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return b(e);default:return y(e,t)}};var _=n.defaultTitleFormatter;function O(e){_=e}function S(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(s.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function E(e,t){if(e.aggregate&&!a.isAggregateOp(e.aggregate)){e.aggregate;var n=i(e,["aggregate"]);l.warn(l.message.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=r({},e,{timeUnit:c.normalizeTimeUnit(e.timeUnit)})),e.bin&&(e=r({},e,{bin:x(e.bin,t)})),e.type){var o=u.getFullName(e.type);e.type!==o&&(e=r({},e,{type:o})),"quantitative"!==e.type&&a.isCountingAggregateOp(e.aggregate)&&(l.warn(l.message.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=r({},e,{type:"quantitative"}))}else{var s=S(e,t);l.warn(l.message.emptyOrInvalidFieldType(e.type,t,s)),e=r({},e,{type:s})}var f=N(e,t),d=f.compatible,p=f.warning;return d||l.warn(p),e}function x(e,t){return f.isBoolean(e)?{maxbins:o.autoMaxBins(t)}:e.maxbins||e.step?e:r({},e,{maxbins:o.autoMaxBins(t)})}n.setTitleFormatter=O,n.resetTitleFormatter=function(){O(n.defaultTitleFormatter)},n.title=function(e,t){return _(e,t)},n.defaultType=S,n.getFieldDef=function(e){return p(e)?e:d(e)?e.condition:void 0},n.normalize=function(e,t){if(f.isString(e)||f.isNumber(e)||f.isBoolean(e)){var n=f.isString(e)?"string":f.isNumber(e)?"number":"boolean";return l.warn(l.message.primitiveChannelDef(t,n,e)),{value:e}}return p(e)?E(e,t):d(e)?r({},e,{condition:E(e.condition,t)}):e},n.normalizeFieldDef=E,n.normalizeBin=x;var w={compatible:!0};function N(e,t){switch(t){case"row":case"column":return h(e)&&!e.timeUnit?{compatible:!1,warning:l.message.facetChannelShouldBeDiscrete(t)}:w;case"x":case"y":case"color":case"text":case"detail":case"tooltip":case"href":return w;case"opacity":case"size":case"x2":case"y2":return m(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:w;case"shape":return"nominal"!==e.type&&"geojson"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data or geojson only"}:w;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:w}throw new Error("channelCompatability not implemented for channel "+t)}n.channelCompatibility=N,n.isNumberFieldDef=function(e){return"quantitative"===e.type||!!e.bin},n.isTimeFieldDef=function(e){return"temporal"===e.type||!!e.timeUnit}},{"./aggregate":12,"./bin":14,"./channel":15,"./log":110,"./timeunit":120,"./type":124,"./util":125}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.aggregate=e("./aggregate"),n.axis=e("./axis"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var r=e("./compile/compile");n.compile=r.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":11,"./aggregate":12,"./axis":13,"./bin":14,"./channel":15,"./compile/compile":25,"./compositemark":100,"./config":101,"./data":102,"./datetime":103,"./encoding":104,"./facet":105,"./fielddef":106,"./legend":109,"./mark":112,"./scale":115,"./sort":117,"./spec":118,"./stack":119,"./timeunit":120,"./transform":123,"./type":124,"./util":125,"./validate":126}],109:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util");n.defaultLegendConfig={};var a={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},o=r({},a,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1});n.LEGEND_PROPERTIES=i.flagKeys(a),n.VG_LEGEND_PROPERTIES=i.flagKeys(o)},{"./util":125}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-util"),i=e("./util"),a=r.logger(r.Warn),o=a,s=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.warns).push.apply(e,t),this},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.infos).push.apply(e,t),this},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.debugs).push.apply(e,t),this},e}();function l(){return o=a}n.LocalLogger=s,n.wrap=function(e){return function(){o=new s,e(o),l()}},n.set=function(e){return o=e},n.reset=l,n.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.warn.apply(o,arguments)},n.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.info.apply(o,arguments)},n.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.debug.apply(o,arguments)},function(e){e.INVALID_SPEC="Invalid spec",e.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',e.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',e.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},e.nearestNotSupportForContinuous=function(e){return'The "nearest" transform is not supported for '+e+" marks."},e.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},e.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",e.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},e.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",e.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",e.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},e.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},e.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},e.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+i.stringify(e)+"."},e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the the data from the secondary source.',e.primitiveChannelDef=function(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+i.stringify(n)+"}."},e.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},e.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},e.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},e.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},e.emptyFieldDef=function(e,t){return"Dropping "+i.stringify(e)+' from channel "'+t+'" since it does not contain data field or value.'},e.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},e.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},e.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continous fields. In this case, we use vertical by default'},e.unclearOrientDiscreteOrEmpty=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'},e.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},e.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+i.stringify(e)+")."},e.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},e.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+i.stringify(e)+")."},e.cannotUseSizeFieldWithBandSize=function(e){return"Using size field when "+e+"-channel has a band scale is not supported."},e.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},e.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},e.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},e.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},e.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},e.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},e.mergeConflictingProperty=function(e,t,n,r){return"Conflicting "+t+' property "'+e+'" ('+i.stringify(n)+" and "+i.stringify(r)+").  Using "+i.stringify(n)+"."},e.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},e.conflictedDomain=function(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'},e.domainSortDropped=function(e){return"Dropping sort property "+i.stringify(e)+" as unioned domains only support boolean or op 'count'."},e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},e.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},e.stackNonSummativeAggregate=function(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'},e.invalidTimeUnit=function(e,t){return"Invalid "+e+": "+i.stringify(t)},e.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},e.droppedDay=function(e){return"Dropping day from datetime "+i.stringify(e)+" as day cannot be combined with other units."}}(n.message||(n.message={}))},{"./util":125,"vega-util":10}],111:[function(e,t,n){"use strict";function r(e){return!!e.or}function i(e){return!!e.and}function a(e){return!!e.not}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=r,n.isLogicalAnd=i,n.isLogicalNot=a,n.forEachLeave=function e(t,n){if(a(t))e(t.not,n);else if(i(t))for(var o=0,s=t.and;o<s.length;o++)e(s[o],n);else if(r(t))for(var l=0,c=t.or;l<c.length;l++)e(c[l],n);else n(t)},n.normalizeLogicalOperand=function e(t,n){return a(t)?{not:e(t.not,n)}:i(t)?{and:t.and.map(function(t){return e(t,n)})}:r(t)?{or:t.or.map(function(t){return e(t,n)})}:n(t)}},{}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,a=e("./util");(i=r=n.Mark||(n.Mark={})).AREA="area",i.BAR="bar",i.LINE="line",i.POINT="point",i.RECT="rect",i.RULE="rule",i.TEXT="text",i.TICK="tick",i.CIRCLE="circle",i.SQUARE="square",i.GEOSHAPE="geoshape",n.AREA=r.AREA,n.BAR=r.BAR,n.LINE=r.LINE,n.POINT=r.POINT,n.TEXT=r.TEXT,n.TICK=r.TICK,n.RECT=r.RECT,n.RULE=r.RULE,n.GEOSHAPE=r.GEOSHAPE,n.CIRCLE=r.CIRCLE,n.SQUARE=r.SQUARE;var o={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function s(e){return e.type}n.isMark=function(e){return!!o[e]},n.PRIMITIVE_MARKS=a.flagKeys(o),n.isMarkDef=s;var l=a.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=function(e){return(s(e)?e.type:e)in l},n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:5},n.defaultTickConfig={thickness:1}},{"./util":125}],113:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./compile/selection/selection"),a=e("./datetime"),o=e("./fielddef"),s=e("./timeunit"),l=e("./util");function c(e){return e&&e.selection}function u(e){return e&&!!e.field&&void 0!==e.equal}function f(e){return!!(e&&e.field&&l.isArray(e.range)&&2===e.range.length)}function d(e){return e&&!!e.field&&(l.isArray(e.oneOf)||l.isArray(e.in))}function p(e){return d(e)||u(e)||f(e)}function g(e,t){void 0===t&&(t=!0);var n=e.timeUnit?"time("+s.fieldExpr(e.timeUnit,e.field)+")":o.vgField(e,{expr:"datum"});if(u(e))return n+"==="+m(e.equal,e.timeUnit);if(d(e))return"indexof(["+(e.oneOf||e.in).map(function(t){return m(t,e.timeUnit)}).join(",")+"], "+n+") !== -1";if(f(e)){var r=e.range[0],i=e.range[1];if(null!==r&&null!==i&&t)return"inrange("+n+", ["+m(r,e.timeUnit)+", "+m(i,e.timeUnit)+"])";var a=[];return null!==r&&a.push(n+" >= "+m(r,e.timeUnit)),null!==i&&a.push(n+" <= "+m(i,e.timeUnit)),a.length>0?a.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function m(e,t){if(a.isDateTime(e))return"time("+a.dateTimeExpr(e,!0)+")";if(s.isLocalSingleTimeUnit(t)){var n={};return n[t]=e,"time("+a.dateTimeExpr(n,!0)+")"}return s.isUtcSingleTimeUnit(t)?m(e,s.getLocalTimeUnit(t)):JSON.stringify(e)}n.isSelectionPredicate=c,n.isFieldEqualPredicate=u,n.isFieldRangePredicate=f,n.isFieldOneOfPredicate=d,n.isFieldPredicate=p,n.expression=function(e,t,n){return l.logicalExpr(t,function(t){return l.isString(t)?t:c(t)?i.selectionPredicate(e,t.selection,n):g(t)})},n.fieldFilterExpression=g,n.normalizePredicate=function(e){return p(e)&&e.timeUnit?r({},e,{timeUnit:s.normalizeTimeUnit(e.timeUnit)}):e}},{"./compile/selection/selection":85,"./datetime":103,"./fielddef":106,"./timeunit":120,"./util":125}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PROJECTION_PROPERTIES=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"]},{}],115:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var i,a=e("./channel"),o=e("./log"),s=e("./util");(i=n.ScaleType||(n.ScaleType={})).LINEAR="linear",i.BIN_LINEAR="bin-linear",i.LOG="log",i.POW="pow",i.SQRT="sqrt",i.TIME="time",i.UTC="utc",i.SEQUENTIAL="sequential",i.QUANTILE="quantile",i.QUANTIZE="quantize",i.THRESHOLD="threshold",i.ORDINAL="ordinal",i.BIN_ORDINAL="bin-ordinal",i.POINT="point",i.BAND="band";var l={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.SCALE_TYPES=s.keys(l),n.scaleCompatible=function(e,t){var n=l[e],r=l[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n};var c={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=function(e){return c[e]},n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var u=s.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var f=s.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var d=s.toSet(n.DISCRETE_DOMAIN_SCALES),p=s.toSet(["bin-linear","bin-ordinal"]);function g(e){return e in f}function m(e){return e in u}n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=function(e){return e in d},n.isBinScale=function(e){return e in p},n.hasContinuousDomain=g,n.isContinuousToContinuous=m,n.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},n.isExtendedScheme=function(e){return e&&!!e.name},n.isSelectionDomain=function(e){return e&&e.selection};var h={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};n.SCALE_PROPERTIES=s.flagKeys(h);var v=r(h,["type","domain","range","rangeStep","scheme"]);n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=s.flagKeys(v),n.scaleTypeSupportProperty=function(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return s.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return s.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return m(e)||"band"===e||"point"===e;case"padding":return m(e)||s.contains(["point","band"],e);case"paddingOuter":case"rangeStep":return s.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return m(e)||"sequential"===e;case"nice":return m(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return g(e)&&!s.contains(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")},n.channelScalePropertyIncompatability=function(e,t){switch(t){case"interpolate":case"scheme":return"color"!==e?o.message.cannotUseScalePropertyWithNonColor(e):void 0;case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')},n.channelSupportScaleType=function(e,t){switch(e){case a.Channel.X:case a.Channel.Y:case a.Channel.SIZE:case a.Channel.OPACITY:return m(t)||s.contains(["band","point"],t);case a.Channel.COLOR:return"band"!==t;case a.Channel.SHAPE:return"ordinal"===t}return!1}},{"./channel":15,"./log":110,"./util":125}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELECTION_ID="_vgsid_",n.defaultConfig={single:{on:"click",fields:[n.SELECTION_ID],resolve:"global",empty:"all"},multi:{on:"click",fields:[n.SELECTION_ID],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}}},{}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=function(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}},{}],118:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./channel"),o=e("./compositemark"),s=e("./encoding"),l=e("./encoding"),c=e("./log"),u=e("./mark"),f=e("./stack"),d=e("./util");function p(e){return void 0!==e.facet}function g(e){return!!e.mark}function m(e){return void 0!==e.layer}function h(e){return void 0!==e.repeat}function v(e){return y(e)||b(e)}function y(e){return void 0!==e.vconcat}function b(e){return void 0!==e.hconcat}function _(e,t){if(p(e))return o=t,l=(n=e).spec,u=i(n,["spec"]),r({},u,{spec:_(l,o)});var n,o,l,u,f,d,v,S,E,x,w,N,T,P,D,k,j,A,C,M,R,F,I,L,U,z,H,G;if(m(e))return function e(t,n){var a=t.layer,o=i(t,["layer"]);return r({},o,{layer:a.map(function(t){return m(t)?e(t,n):O(t,n)})})}(e,t);if(h(e))return d=t,v=(f=e).spec,S=i(f,["spec"]),r({},S,{spec:_(v,d)});if(y(e))return x=t,w=(E=e).vconcat,N=i(E,["vconcat"]),r({},N,{vconcat:w.map(function(e){return _(e,x)})});if(b(e))return P=t,D=(T=e).hconcat,k=i(T,["hconcat"]),r({},k,{hconcat:D.map(function(e){return _(e,P)})});if(g(e)){var B=s.channelHasField(e.encoding,a.ROW),q=s.channelHasField(e.encoding,a.COLUMN);return B||q?(A=t,C=(j=e).encoding,M=C.row,R=C.column,F=i(C,["row","column"]),I=j.mark,L=j.width,U=j.projection,z=j.height,H=j.selection,j.encoding,G=i(j,["mark","width","projection","height","selection","encoding"]),r({},G,{facet:r({},M?{row:M}:{},R?{column:R}:{}),spec:O(r({},U?{projection:U}:{},{mark:I},L?{width:L}:{},z?{height:z}:{},{encoding:F},H?{selection:H}:{}),A)})):O(e,t)}throw new Error(c.message.INVALID_SPEC)}function O(e,t){if(p=e,u.isPrimitiveMark(p.mark)){if(s.isRanged(e.encoding))return function(e){var t=s.channelHasField(e.encoding,a.X),n=s.channelHasField(e.encoding,a.Y),r=s.channelHasField(e.encoding,a.X2),i=s.channelHasField(e.encoding,a.Y2);if(r&&!t||i&&!n){var o=d.duplicate(e);return r&&!t&&(o.encoding.x=o.encoding.x2,delete o.encoding.x2),i&&!n&&(o.encoding.y=o.encoding.y2,delete o.encoding.y2),o}return e}(e);var n=t&&t.overlay,l=n&&e.mark===u.AREA&&d.contains(["linepoint","line"],n.area),c=n&&(n.line&&e.mark===u.LINE||"linepoint"===n.area&&e.mark===u.AREA);return c||l?function(e,t,n,a){var o,s=e.mark,l=e.selection,c=e.projection,u=e.encoding,d=i(e,["mark","selection","projection","encoding"]),p=[{mark:s,encoding:u}],g=f.stack(s,u,a?a.stack:void 0),m=u;if(g){var h=g.fieldChannel,v=g.offset;m=r({},u,((o={})[h]=r({},u[h],v?{stack:v}:{}),o))}n&&p.push(r({},c?{projection:c}:{},{mark:{type:"line",style:"lineOverlay"}},l?{selection:l}:{},{encoding:m}));t&&p.push(r({},c?{projection:c}:{},{mark:{type:"point",filled:!0,style:"pointOverlay"}},l?{selection:l}:{},{encoding:m}));return r({},d,{layer:p})}(e,c,l,t):e}return o.normalize(e,t);var p}function S(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),r=d.hash(n);e[r]=e[r]||t}),e}n.isFacetSpec=p,n.isUnitSpec=g,n.isLayerSpec=m,n.isRepeatSpec=h,n.isConcatSpec=v,n.isVConcatSpec=y,n.isHConcatSpec=b,n.normalize=_,n.fieldDefs=function(e){return d.vals(function e(t,n){return void 0===n&&(n={}),m(t)?t.layer.forEach(function(t){g(t)?S(n,l.fieldDefs(t.encoding)):e(t,n)}):p(t)?(S(n,l.fieldDefs(t.facet)),e(t.spec,n)):h(t)?e(t.spec,n):v(t)?(y(t)?t.vconcat:t.hconcat).forEach(function(t){return e(t,n)}):S(n,l.fieldDefs(t.encoding)),n}(e))},n.isStacked=function(e,t){return t=t||e.config,!!u.isPrimitiveMark(e.mark)&&null!==f.stack(e.mark,e.encoding,t?t.stack:void 0)}},{"./channel":15,"./compositemark":100,"./encoding":104,"./log":110,"./mark":112,"./stack":119,"./util":125}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./aggregate"),i=e("./channel"),a=e("./encoding"),o=e("./fielddef"),s=e("./log"),l=e("./mark"),c=e("./scale"),u=e("./util"),f={zero:1,center:1,normalize:1};function d(e){return!!f[e]}n.isStackOffset=d,n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=function(e,t,f){var p=l.isMarkDef(e)?e.type:e;if(!u.contains(n.STACKABLE_MARKS,p))return null;var g=function(e){var t=e.x,n=e.y;if(o.isFieldDef(t)&&o.isFieldDef(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(o.isFieldDef(t)&&"quantitative"===t.type)return"x";if(o.isFieldDef(n)&&"quantitative"===n.type)return"y"}}(t);if(!g)return null;var m=t[g],h=o.isStringFieldDef(m)?o.vgField(m,{}):void 0,v="x"===g?"y":"x",y=t[v],b=o.isStringFieldDef(y)?o.vgField(y,{}):void 0,_=i.NONPOSITION_CHANNELS.reduce(function(e,n){if(a.channelHasField(t,n)){var r=t[n];(u.isArray(r)?r:[r]).forEach(function(t){var r=o.getFieldDef(t);if(!r.aggregate){var i=o.isStringFieldDef(r)?o.vgField(r,{}):void 0;(!i||i!==b&&i!==h)&&e.push({channel:n,fieldDef:r})}})}return e},[]);if(0===_.length)return null;var O=void 0;return(O=void 0!==m.stack?m.stack:u.contains(n.STACK_BY_DEFAULT_MARKS,p)&&void 0===f?"zero":f)&&d(O)?m.scale&&m.scale.type&&m.scale.type!==c.ScaleType.LINEAR?(s.warn(s.message.cannotStackNonLinearScale(m.scale.type)),null):a.channelHasField(t,g===i.X?i.X2:i.Y2)?(s.warn(s.message.cannotStackRangedMark(g)),null):(m.aggregate&&!u.contains(r.SUM_OPS,m.aggregate)&&s.warn(s.message.stackNonSummativeAggregate(m.aggregate)),{groupbyChannel:y?v:void 0,fieldChannel:g,impute:u.contains(["area","line"],p),stackBy:_,offset:O}):null}},{"./aggregate":12,"./channel":15,"./encoding":104,"./fielddef":106,"./log":110,"./mark":112,"./scale":115,"./util":125}],120:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i,a,o=e("./datetime"),s=e("./log"),l=e("./util");(a=i=n.TimeUnit||(n.TimeUnit={})).YEAR="year",a.MONTH="month",a.DAY="day",a.DATE="date",a.HOURS="hours",a.MINUTES="minutes",a.SECONDS="seconds",a.MILLISECONDS="milliseconds",a.YEARMONTH="yearmonth",a.YEARMONTHDATE="yearmonthdate",a.YEARMONTHDATEHOURS="yearmonthdatehours",a.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",a.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",a.MONTHDATE="monthdate",a.HOURSMINUTES="hoursminutes",a.HOURSMINUTESSECONDS="hoursminutesseconds",a.MINUTESSECONDS="minutesseconds",a.SECONDSMILLISECONDS="secondsmilliseconds",a.QUARTER="quarter",a.YEARQUARTER="yearquarter",a.QUARTERMONTH="quartermonth",a.YEARQUARTERMONTH="yearquartermonth",a.UTCYEAR="utcyear",a.UTCMONTH="utcmonth",a.UTCDAY="utcday",a.UTCDATE="utcdate",a.UTCHOURS="utchours",a.UTCMINUTES="utcminutes",a.UTCSECONDS="utcseconds",a.UTCMILLISECONDS="utcmilliseconds",a.UTCYEARMONTH="utcyearmonth",a.UTCYEARMONTHDATE="utcyearmonthdate",a.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",a.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",a.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",a.UTCMONTHDATE="utcmonthdate",a.UTCHOURSMINUTES="utchoursminutes",a.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",a.UTCMINUTESSECONDS="utcminutesseconds",a.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",a.UTCQUARTER="utcquarter",a.UTCYEARQUARTER="utcyearquarter",a.UTCQUARTERMONTH="utcquartermonth",a.UTCYEARQUARTERMONTH="utcyearquartermonth";var c={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};n.TIMEUNIT_PARTS=l.flagKeys(c),n.isLocalSingleTimeUnit=function(e){return!!c[e]};var u={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};n.isUtcSingleTimeUnit=function(e){return!!u[e]};var f={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},d=r({},u,f);function p(e){return!!d[e]}n.isUTCTimeUnit=p,n.getLocalTimeUnit=function(e){return e.substr(3)};var g=r({},c,u,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},f);n.TIMEUNITS=l.flagKeys(g),n.isTimeUnit=function(e){return!!g[e]};var m={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function h(e,t){var n=m[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function v(e,t){var n=e.indexOf(t);return n>-1&&(t!==i.SECONDS||0===n||"i"!==e.charAt(n-1))}n.convert=function(e,t){for(var r=p(e),a=r?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),o=0,s=n.TIMEUNIT_PARTS;o<s.length;o++){var l=s[o];if(v(e,l))switch(l){case i.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case i.QUARTER:var c=h("month",r),u=c.getDateMethod;a[c.setDateMethod](3*Math.floor(t[u]()/3));break;default:var f=h(l,r),d=f.getDateMethod;a[f.setDateMethod](t[d]())}}return a},n.getTimeUnitParts=function(e){return n.TIMEUNIT_PARTS.reduce(function(t,n){return v(e,n)?t.concat(n):t},[])},n.containsTimeUnit=v,n.fieldExpr=function(e,t){var r="datum"+l.accessPath(t),a=p(e)?"utc":"",s=n.TIMEUNIT_PARTS.reduce(function(t,n){var o;return v(e,n)&&(t[n]=(o=n)===i.QUARTER?"("+a+"quarter("+r+")-1)":""+a+o+"("+r+")"),t},{});return o.dateTimeExpr(s)},n.formatExpression=function(e,t,n,r){if(e){var a=[],o="",s=v(e,i.YEAR);v(e,i.QUARTER)&&(o="'Q' + quarter("+t+")"),v(e,i.MONTH)&&a.push(!1!==n?"%b":"%B"),v(e,i.DAY)?a.push(n?"%a":"%A"):v(e,i.DATE)&&a.push("%d"+(s?",":"")),s&&a.push(n?"%y":"%Y");var l=[];v(e,i.HOURS)&&l.push("%H"),v(e,i.MINUTES)&&l.push("%M"),v(e,i.SECONDS)&&l.push("%S"),v(e,i.MILLISECONDS)&&l.push("%L");var c=[];return a.length>0&&c.push(a.join(" ")),l.length>0&&c.push(l.join(":")),c.length>0&&(o&&(o+=" + ' ' + "),o+=r?"utcFormat("+t+", '"+c.join(" ")+"')":"timeFormat("+t+", '"+c.join(" ")+"')"),o||void 0}},n.normalizeTimeUnit=function(e){return"day"!==e&&e.indexOf("day")>=0?(s.warn(s.message.dayReplacedWithDate(e)),e.replace("day","date")):e}},{"./datetime":103,"./log":110,"./util":125}],121:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.extractTitleConfig=function(e){var t=e.anchor,n=e.offset,a=e.orient,o=e.color,s=i(e,["anchor","offset","orient","color"]);return{mark:r({},s,o?{fill:o}:{}),nonMark:r({},t?{anchor:t}:{},n?{offset:n}:{},a?{orient:a}:{})}}},{}],122:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("util"),a=e("./log");function o(e){return i.isString(e)?{type:e}:e||{}}n.normalizeAutoSize=function(e,t,n){void 0===n&&(n=!0);var i=r({type:"pad"},o(t),o(e));return"fit"===i.type&&(n||(a.warn(a.message.FIT_NON_SINGLE),i.type="pad")),i};var s=["background","padding"];n.extractTopLevelProperties=function(e){return s.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}},{"./log":110,util:8}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./logical"),i=e("./predicate");function a(e){return void 0!==e.filter}n.isFilter=a,n.isLookup=function(e){return void 0!==e.lookup},n.isCalculate=function(e){return void 0!==e.calculate},n.isBin=function(e){return!!e.bin},n.isTimeUnit=function(e){return void 0!==e.timeUnit},n.isAggregate=function(e){return void 0!==e.aggregate},n.normalizeTransform=function(e){return e.map(function(e){return a(e)?{filter:r.normalizeLogicalOperand(e.filter,i.normalizePredicate)}:e})}},{"./logical":111,"./predicate":113}],124:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),(i=r=n.Type||(n.Type={})).QUANTITATIVE="quantitative",i.ORDINAL="ordinal",i.TEMPORAL="temporal",i.NOMINAL="nominal",i.LATITUDE="latitude",i.LONGITUDE="longitude",i.GEOJSON="geojson";var a={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};n.isType=function(e){return!!a[e]},n.QUANTITATIVE=r.QUANTITATIVE,n.ORDINAL=r.ORDINAL,n.TEMPORAL=r.TEMPORAL,n.NOMINAL=r.NOMINAL,n.LATITUDE=r.LATITUDE,n.LONGITUDE=r.LONGITUDE,n.GEOJSON=r.GEOJSON,n.getFullName=function(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal";case n.LATITUDE:return"latitude";case n.LONGITUDE:return"longitude";case n.GEOJSON:return"geojson"}}},{}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("json-stable-stringify"),i=e("vega-util"),a=e("./logical"),o=e("vega-util");function s(e,t){return e.indexOf(t)>-1}function l(e,t){return e.filter(function(e){return!s(t,e)})}function c(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=u(e,i[r])}return e}function u(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||i.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=c(i.isArray(t[n].constructor)?[]:{},t[n]):c(e[n],t[n]));return e}function f(e){return JSON.parse(JSON.stringify(e))}n.isArray=o.isArray,n.isObject=o.isObject,n.isNumber=o.isNumber,n.isString=o.isString,n.truncate=o.truncate,n.toSet=o.toSet,n.stringValue=o.stringValue,n.splitAccessPath=o.splitAccessPath,n.pick=function(e,t){for(var n={},r=0,i=t;r<i.length;r++){var a=i[r];e.hasOwnProperty(a)&&(n[a]=e[a])}return n},n.omit=function(e,t){for(var n=f(e),r=0,i=t;r<i.length;r++)delete n[i[r]];return n},n.stringify=r,n.hash=function(e){if(i.isNumber(e))return e;var t=i.isString(e)?e:r(e);if(t.length<100)return t;for(var n=0,a=0;a<t.length;a++)n=(n<<5)-n+t.charCodeAt(a),n&=n;return n},n.contains=s,n.without=l,n.union=function(e,t){return e.concat(l(t,e))},n.some=function(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1},n.every=function(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0},n.flatten=function(e){return[].concat.apply([],e)},n.mergeDeep=c,n.unique=function(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var s=o[a];(n=t(s))in i||(i[n]=1,r.push(s))}return r},n.differ=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1},n.hasIntersection=function(e,t){for(var n in e)if(n in t)return!0;return!1},n.isNumeric=function(e){return!isNaN(e)},n.differArray=function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},n.keys=Object.keys,n.vals=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},n.flagKeys=function(e){return n.keys(e)},n.duplicate=f,n.isBoolean=function(e){return!0===e||!1===e},n.varName=function(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t},n.logicalExpr=function e(t,n){return a.isLogicalNot(t)?"!("+e(t.not,n)+")":a.isLogicalAnd(t)?"("+t.and.map(function(t){return e(t,n)}).join(") && (")+")":a.isLogicalOr(t)?"("+t.or.map(function(t){return e(t,n)}).join(") || (")+")":n(t)},n.deleteNestedProperty=function(e,t){for(var r=!0;t.length>0&&r;){for(var i=e,a=0;a<t.length-1;a++)i=i[t[a]];delete i[t.pop()],0!==n.keys(i).length&&(r=!1)}},n.titlecase=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},n.accessPath=function(e){return"["+i.splitAccessPath(e).map(i.stringValue).join("][")+"]"}},{"./logical":111,"json-stable-stringify":1,"vega-util":10}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mark"),i=e("./mark"),a=e("./util");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:a.toSet(["row","column","x","y","size","color","detail"]),line:a.toSet(["row","column","x","y","color","detail"]),area:a.toSet(["row","column","x","y","color","detail"]),tick:a.toSet(["row","column","x","y","color","detail"]),circle:a.toSet(["row","column","x","y","color","size","detail"]),square:a.toSet(["row","column","x","y","color","size","detail"]),point:a.toSet(["row","column","x","y","color","size","detail","shape"]),geoshape:a.toSet(["row","column","color","detail","shape"]),text:a.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=function(e,t,a){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===a&&(a=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var o=r.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,l=t[o],c=a[o];for(var u in l)if(!(l[u]in s))return'Missing encoding channel "'+l[u]+'" for mark "'+o+'"';for(var f in s)if(!c[f])return'Encoding channel "'+f+'" is not supported by mark type "'+o+'"';return o!==i.BAR||s.x||s.y?null:"Missing both x and y for bar"}},{"./mark":112,"./util":125}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util");n.isVgSignalRef=function(e){return!!e.signal},n.isVgRangeStep=function(e){return!!e.step},n.isDataRefUnionedDomain=function(e){return!r.isArray(e)&&"fields"in e&&!("data"in e)},n.isFieldRefUnionDomain=function(e){return!r.isArray(e)&&"fields"in e&&"data"in e},n.isDataRefDomain=function(e){return!r.isArray(e)&&"field"in e&&"data"in e},n.isSignalRefDomain=function(e){return!r.isArray(e)&&"signal"in e};n.VG_MARK_CONFIGS=r.flagKeys({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,limit:1,dx:1,dy:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1})},{"./util":125}]},{},[108])(108)});