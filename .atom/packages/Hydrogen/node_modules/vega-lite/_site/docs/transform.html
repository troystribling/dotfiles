<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="shortcut icon" href="https://vega.github.io/favicon.ico"/>
    <meta name="description" content="Vega-Lite - a high-level grammar for statistical graphics. Vega-Lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.
Vega-Lite specifications consist of simple mappings of variables in a data set to visual encoding channels such as x, y, color, and size. These mappings are then translated into detailed visualization specifications in the form of Vega specification language. Vega-Lite produces default values for visualization components (e.g., scales, axes, and legends) in the output Vega specification using a rule-based approach, but users can explicit specify these properties to override default values.">

    <script src="/vega-lite/bower_components/d3/d3.min.js"></script>
    <script src="/vega-lite/bower_components/vega/vega.min.js"></script>
    <script src="/vega-lite/vega-lite.min.js"></script>
    <script src="/vega-lite/bower_components/vega-embed/vega-embed.js"></script>
    <script src="/vega-lite/bower_components/highlightjs/highlight.pack.js"></script>

    <script>
      var BASEURL = "/vega-lite";
    </script>

    <title> Vega-Lite: Transformation </title>
    <link rel="stylesheet" href="/vega-lite/site/static/syntax.css">
    <link rel="stylesheet" href="/vega-lite/bower_components/highlightjs/styles/github.css">
    <link rel="stylesheet" href="/vega-lite/bower_components/octicons/build/octicons.css">
    <link rel="stylesheet" href="/vega-lite/site/static/main.css">
  </head>
  <body>
    <div class="fill">
  <header>
    <nav class="page-centered">
      <a class="vl-title" href="/vega-lite/">Vega-Lite</a>
      <div class="vl-links">
        <div class="primary-links">
          <a href="/vega-lite/tutorials/getting_started.html" >Tutorials</a>
          <a href="/vega-lite/usage/embed.html" >Usage</a>
          <a href="/vega-lite/docs/" class="active">Documentation</a>
          <a href="/vega-lite/examples/" >Examples</a>
        </div>
        <div class="secondary-links">
          <a href="https://www.github.com/vega/vega-lite" target="_blank">GitHub</a>
          <a href="https://vega.github.io/vega-editor/?mode=vega-lite" target="_blank">Try Online</a>
        </div>
      </div>
    </nav>
  </header>

  <section>
    



<div class="page-centered page-main">
  
  <aside class="page-sidebar">
    <ul class="sidebar-nav">
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/" title="">Overview
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/spec.html" title="">Spec
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/data.html" title="">Data
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a class="active"
          href="/vega-lite/docs/transform.html" title="">Transform
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/mark.html" title="">Mark
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/encoding.html" title="">Encoding
      </a></li>
      
      <ul class="sub-sub-nav">
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/aggregate.html" title="">Aggregate
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/bin.html" title="">Bin
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/sort.html" title="">Sort
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/timeunit.html" title="">Time Unit
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/scale.html" title="">Scale
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/axis.html" title="">Axis
        </a></li>
        
        <li class="sidebar-nav-item sub-item"><a 
            href="/vega-lite/docs/legend.html" title="">Legend
        </a></li>
        
      </ul>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/config.html" title="">Config
      </a></li>
      
      
      
      
      <br>
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/size.html" title="">Customizing Size
      </a></li>
      
      
      
      
      <li class="sidebar-nav-item"><a 
          href="/vega-lite/docs/facet.html" title="">Faceting
      </a></li>
      
      
      
    </nav>
  </aside>
  

  <section class="page-content">
    <h1>Transformation</h1>

    <p>Data Transformation in Vega-Lite are described via either top-level transforms (the <code class="highlighter-rouge">transform</code> property) or <a href="encoding.html#inline">inline transforms inside <code class="highlighter-rouge">encoding</code></a> (<code class="highlighter-rouge">aggregate</code>, <code class="highlighter-rouge">bin</code>, <code class="highlighter-rouge">timeUnit</code>, and <code class="highlighter-rouge">sort</code>).</p>

<p>When both types of transforms are specified, the top-level transforms are executed first in this order: <code class="highlighter-rouge">filterInvalid</code>, <code class="highlighter-rouge">calculate</code>, and then <code class="highlighter-rouge">filter</code>. Then the inline transforms are executed in this order: <code class="highlighter-rouge">bin</code>, <code class="highlighter-rouge">timeUnit</code>, <code class="highlighter-rouge">aggregate</code>, and <code class="highlighter-rouge">sort</code>.</p>

<p>The rest of this page describes the top-level <code class="highlighter-rouge">transform</code> property. For more information about inline transforms, please see the following pages: <a href="bin.html"><code class="highlighter-rouge">bin</code></a>, <a href="timeUnit.html"><code class="highlighter-rouge">timeUnit</code></a>, <a href="aggregate.html"><code class="highlighter-rouge">aggregate</code></a>, and <a href="sort.html"><code class="highlighter-rouge">sort</code></a>.</p>

<h2 id="top-level-transform-property">Top-level Transform Property</h2>

<div class="language-json suppress-error highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">       </span><span class="err">//</span><span class="w"> </span><span class="err">transform</span><span class="w">
    </span><span class="nt">"filterInvalid"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w">
    </span><span class="nt">"calculate"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"mark"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="nt">"encoding"</span><span class="p">:</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<p>The top-level <code class="highlighter-rouge">transform</code> object supports the following transformation properties:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">filterInvalid</td>
      <td style="text-align: center">Boolean</td>
      <td style="text-align: left">Whether to filter invalid values (<code class="highlighter-rouge">null</code> and <code class="highlighter-rouge">NaN</code>) from the data. <br />     •By default (<code class="highlighter-rouge">undefined</code>), only quantitative and temporal fields are filtered. <br />     •If set to <code class="highlighter-rouge">true</code>, all data items with null values are filtered. <br />     •If <code class="highlighter-rouge">false</code>, all data items are included.  In this case, null values will be interpret as zeroes.</td>
    </tr>
    <tr>
      <td style="text-align: left">calculate</td>
      <td style="text-align: center">Formula[]</td>
      <td style="text-align: left">An array of formula objects for deriving new fields. Each formula object has two properties: <br />     • <code class="highlighter-rouge">field</code> <em>(String)</em> – The field name in which to store the computed value. <br />    • <code class="highlighter-rouge">expr</code> <em>(String)</em>  – A string containing an expression for the formula. Use the variable <code class="highlighter-rouge">datum</code> to refer to the current data object.</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="#filter">filter</a></td>
      <td style="text-align: center">String | FilterObject | String[] | FilterObject[]</td>
      <td style="text-align: left">A filter object or a <a href="https://github.com/vega/vega/wiki/Expressions">Vega Expression</a> string for filtering data items (or rows) or an array of either filter objects or expression strings.</td>
    </tr>
  </tbody>
</table>

<p>These transforms are executed in this order: <code class="highlighter-rouge">filterInvalid</code>, <code class="highlighter-rouge">calculate</code>, and then <code class="highlighter-rouge">filter</code>.
Since <code class="highlighter-rouge">calculate</code> is before <code class="highlighter-rouge">filter</code>, derived fields can be used in <code class="highlighter-rouge">filter</code>’s expression.</p>

<p><strong>Example</strong></p>

<p>This example use <code class="highlighter-rouge">calculate</code> to derive a new field, then <code class="highlighter-rouge">filter</code> data based on the new field.</p>

<p><span class="vl-example" data-name="bar_filter_calc"></span></p>

<!-- TODO population use calc to derive Male / Female -->
<!-- TODO example about filterInvalid -->

<h3 id="filter">Filter</h3>

<p>Vega-Lite’s <code class="highlighter-rouge">transform.filter</code> property can be (1) a filter predicate object, (2) <a href="https://github.com/vega/vega/wiki/Expressions">Vega Expression</a> string or (3) an array of filter predicates (either predicate object or expression string) that must be all true for a datum to be include.</p>

<h4 id="filter-object">Filter Object</h4>

<p>For a filter object, a <code class="highlighter-rouge">field</code> must be provided with one of the filter operators (<code class="highlighter-rouge">equal</code>, <code class="highlighter-rouge">in</code>, <code class="highlighter-rouge">range</code>).  Values of these operators can be primitive types (string, number, boolean) or a <a href="#datetime">DateTime definition object</a> for describiing time. In addition, <code class="highlighter-rouge">timeUnit</code> can be provided to further transform a temporal <code class="highlighter-rouge">field</code>.</p>

<p>The following table describes properties of a filter object.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">field</td>
      <td style="text-align: center">String</td>
      <td style="text-align: left">Field to be filtered.</td>
    </tr>
    <tr>
      <td style="text-align: left">equal</td>
      <td style="text-align: center">String | Number | <a href="#datetime">DateTime</a> | Boolean</td>
      <td style="text-align: left">Value that the <code class="highlighter-rouge">field</code>’s value should be equal to.</td>
    </tr>
    <tr>
      <td style="text-align: left">range</td>
      <td style="text-align: center">Number[] | <a href="#datetime">DateTime</a>[]</td>
      <td style="text-align: left">Array of length 2 describing (inclusive) minimum and maximum values for the <code class="highlighter-rouge">field</code>’s value to be included in the filtered data.  If the minimum / maximum is <code class="highlighter-rouge">null</code>, then the ranged has unbounded minimum / maximum.</td>
    </tr>
    <tr>
      <td style="text-align: left">in</td>
      <td style="text-align: center">String[] | Number[] | <a href="#datetime">DateTime</a>[]</td>
      <td style="text-align: left">A set of values that the <code class="highlighter-rouge">field</code>’s value should be a member of, for a data item included in the filtered data.</td>
    </tr>
  </tbody>
</table>

<h5 id="datetime">Date Time Definition Object</h5>

<p>A DateTime object must have at least one of the following properties:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">year</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing the year.</td>
    </tr>
    <tr>
      <td style="text-align: left">quarter</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing the quarter of the year (from 1-4).</td>
    </tr>
    <tr>
      <td style="text-align: left">month</td>
      <td style="text-align: center">Number | string</td>
      <td style="text-align: left">One of: (1) integer value representing the month from <code class="highlighter-rouge">1</code>-<code class="highlighter-rouge">12</code>. <code class="highlighter-rouge">1</code> represents January;  (2) case-insensitive month name (e.g., <code class="highlighter-rouge">"January"</code>);  (3) case-insensitive, 3-character short month name (e.g., <code class="highlighter-rouge">"Jan"</code>).</td>
    </tr>
    <tr>
      <td style="text-align: left">date</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing the date from 1-31.</td>
    </tr>
    <tr>
      <td style="text-align: left">day</td>
      <td style="text-align: center">Number | string</td>
      <td style="text-align: left">Value representing the day of week.  This can be one of: (1) integer value – <code class="highlighter-rouge">1</code> represents Monday; (2) (2) case-insensitive day name (e.g., <code class="highlighter-rouge">"Monday"</code>);  (3) case-insensitive, 3-character short day name (e.g., <code class="highlighter-rouge">"Mon"</code>).   <br /> <strong>Warning:</strong> A DateTime definition object with <code class="highlighter-rouge">day</code>** should not be combined with <code class="highlighter-rouge">year</code>, <code class="highlighter-rouge">quarter</code>, <code class="highlighter-rouge">month</code>, or <code class="highlighter-rouge">date</code>.</td>
    </tr>
    <tr>
      <td style="text-align: left">hours</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing the hour of day from 0-23.</td>
    </tr>
    <tr>
      <td style="text-align: left">minutes</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing minute segment of a time from 0-59.</td>
    </tr>
    <tr>
      <td style="text-align: left">seconds</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing  second segment of a time from 0-59.</td>
    </tr>
    <tr>
      <td style="text-align: left">milliseconds</td>
      <td style="text-align: center">Number</td>
      <td style="text-align: left">Integer value representing  millsecond segment of a time.</td>
    </tr>
  </tbody>
</table>

<p><strong>Examples</strong></p>

<ul>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"car_color"</span><span class="p">,</span><span class="w"> </span><span class="nt">"equal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">}</span></code> checks if the <code class="highlighter-rouge">car_color</code> field’s value is equal to <code class="highlighter-rouge">"red"</code>.</li>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"car_color"</span><span class="p">,</span><span class="w"> </span><span class="nt">"in"</span><span class="p">:[</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yellow"</span><span class="p">]}</span></code> checks if the <code class="highlighter-rouge">car_color</code> field’s value is <code class="highlighter-rouge">"red"</code> or <code class="highlighter-rouge">"yellow"</code>.</li>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]}</span></code> checks if the <code class="highlighter-rouge">x</code> field’s value is in range [0,5] (0 ≤ x ≤ 5).</li>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]}</span></code> checks if the <code class="highlighter-rouge">x</code> field’s value is in range [-Infinity,5] (x ≤ 5).</li>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"timeUnit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span><span class="w"> </span><span class="mi">2008</span><span class="p">]</span><span class="w"> </span><span class="p">}</span></code> checks if the <code class="highlighter-rouge">date</code>’s value is between year 2006 and 2008.</li>
  <li><code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"year"</span><span class="p">:</span><span class="w"> </span><span class="mi">2006</span><span class="p">,</span><span class="w"> </span><span class="nt">"month"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jan"</span><span class="p">,</span><span class="w"> </span><span class="nt">"date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"year"</span><span class="p">:</span><span class="w"> </span><span class="mi">2008</span><span class="p">,</span><span class="w"> </span><span class="nt">"month"</span><span class="p">:</span><span class="w"> </span><span class="s2">"feb"</span><span class="p">,</span><span class="w"> </span><span class="nt">"date"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">}]</span><span class="w"> </span><span class="p">}</span></code> checks if the <code class="highlighter-rouge">date</code>’s value is between Jan 1, 2006  and Feb 20, 2008.</li>
</ul>

<h4 id="filter-expresssion">Filter Expresssion</h4>

<p>For a <a href="https://github.com/vega/vega/wiki/Expressions">Vega Expression</a> string, each datum object can be referred using bound variable <code class="highlighter-rouge">datum</code>. For example, setting <code class="highlighter-rouge">filter</code> to <code class="highlighter-rouge">"datum.b2 &gt; 60"</code> would make the output data includes only items that have values in the field <code class="highlighter-rouge">b2</code> over 60.</p>

<h4 id="filter-array">Filter Array</h4>

<p>For a filter array, the array’s members should be either filter objects or filter expresssions.  All of member predicates should be satisfied for a data item to be included in the filtered data.  In other words, the <code class="highlighter-rouge">filter</code> array will form a conjunctive predicate that join all predicates with “and” operators.</p>


  </section>
</div>

  </section>
</div>

<footer>
  <div class="page-centered">
    <span>
      <a href="https://github.com/vega/vega-lite/edit/master/site/docs/transform.md">Edit this page</a> and submit a pull request!
    </span>
    <span class="fill"></span>
    <a href="http://idl.cs.washington.edu" title="UW Interactive Data Lab" class="idl-logo"><img src="/vega-lite/site/static/idl-logo.png"/></a>
  </div>
</footer>

    <script src="/vega-lite/site/static/main.js"></script>
    <script>
      // Google Analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44428446-6', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
