{"version":3,"file":"joinaggregatefacet.js","sourceRoot":"","sources":["../../../../src/compile/data/joinaggregatefacet.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,OAAO,EAAC,MAAM,kBAAkB,CAAC;AACzC,OAAO,EAAC,eAAe,EAAE,WAAW,EAAC,MAAM,YAAY,CAAC;AAExD,OAAO,EAAC,kBAAkB,EAAC,MAAM,UAAU,CAAC;AAE5C,OAAO,EAAC,0BAA0B,EAAC,MAAM,iBAAiB,CAAC;AAE3D,MAAM,UAAU,0BAA0B,CACxC,MAAoB,EACpB,KAA2B;IAE3B,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,KAAK,CAAC;IAC5B,IAAI,GAAG,IAAI,MAAM,EAAE;QACjB,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,0CAA0C;QAC1C,KAAK,MAAM,QAAQ,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,EAAE;YACpC,IAAI,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;gBAC9B,MAAM,EAAC,KAAK,EAAE,EAAE,GAAG,eAAe,EAAC,GAAG,QAAQ,CAAC,IAAI,CAAC;gBACpD,MAAM,GAAG,SAAS,GAAG,IAAI,0BAA0B,CAAC,MAAM,EAAE;oBAC1D,aAAa,EAAE;wBACb;4BACE,EAAE;4BACF,KAAK;4BACL,EAAE,EAAE,kBAAkB,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC;yBAC/D;qBACF;oBACD,OAAO,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;iBAC7B,CAAC,CAAC;aACJ;SACF;QACD,OAAO,SAAS,CAAC;KAClB;IACD,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import {vgField} from '../../channeldef';\nimport {DEFAULT_SORT_OP, isSortField} from '../../sort';\nimport {FacetMapping} from '../../spec/facet';\nimport {facetSortFieldName} from '../facet';\nimport {DataFlowNode} from './dataflow';\nimport {JoinAggregateTransformNode} from './joinaggregate';\n\nexport function makeJoinAggregateFromFacet(\n  parent: DataFlowNode,\n  facet: FacetMapping<string>\n): JoinAggregateTransformNode {\n  const {row, column} = facet;\n  if (row && column) {\n    let newParent = null;\n    // only need to make one for crossed facet\n    for (const fieldDef of [row, column]) {\n      if (isSortField(fieldDef.sort)) {\n        const {field, op = DEFAULT_SORT_OP} = fieldDef.sort;\n        parent = newParent = new JoinAggregateTransformNode(parent, {\n          joinaggregate: [\n            {\n              op,\n              field,\n              as: facetSortFieldName(fieldDef, fieldDef.sort, {forAs: true})\n            }\n          ],\n          groupby: [vgField(fieldDef)]\n        });\n      }\n    }\n    return newParent;\n  }\n  return null;\n}\n"]}