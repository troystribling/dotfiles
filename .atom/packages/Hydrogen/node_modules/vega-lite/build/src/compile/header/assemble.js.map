{"version":3,"file":"assemble.js","sourceRoot":"","sources":["../../../../src/compile/header/assemble.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Utility for generating row / column headers\n */\nimport {TitleAnchor, TitleConfig} from 'vega';\nimport {isArray} from 'vega-util';\nimport {FACET_CHANNELS, FacetChannel} from '../../channel';\nimport {vgField} from '../../channeldef';\nimport {Config} from '../../config';\nimport {\n  CoreHeader,\n  HEADER_LABEL_PROPERTIES,\n  HEADER_LABEL_PROPERTIES_MAP,\n  HEADER_TITLE_PROPERTIES,\n  HEADER_TITLE_PROPERTIES_MAP\n} from '../../header';\nimport {isSortField} from '../../sort';\nimport {FacetFieldDef, isFacetMapping} from '../../spec/facet';\nimport {contains, keys} from '../../util';\nimport {RowCol, VgComparator, VgMarkGroup, VgTitle} from '../../vega.schema';\nimport {defaultLabelAlign, defaultLabelBaseline} from '../axis/properties';\nimport {formatSignalRef} from '../common';\nimport {sortArrayIndexField} from '../data/calculate';\nimport {isFacetModel, Model} from '../model';\nimport {getHeaderChannel, getHeaderProperties, getHeaderProperty} from './common';\nimport {\n  HEADER_TYPES,\n  HeaderChannel,\n  HeaderComponent,\n  HeaderType,\n  LayoutHeaderComponent,\n  LayoutHeaderComponentIndex\n} from './component';\n\n// TODO: rename to assembleHeaderTitleGroup\nexport function assembleTitleGroup(model: Model, channel: FacetChannel) {\n  const title = model.component.layoutHeaders[channel].title;\n  const config = model.config ? model.config : undefined;\n  const facetFieldDef = model.component.layoutHeaders[channel].facetFieldDef\n    ? model.component.layoutHeaders[channel].facetFieldDef\n    : undefined;\n\n  const {titleAnchor, titleAngle, titleOrient} = getHeaderProperties(\n    ['titleAnchor', 'titleAngle', 'titleOrient'],\n    facetFieldDef,\n    config,\n    channel\n  );\n  const headerChannel = getHeaderChannel(channel, titleOrient);\n\n  return {\n    name: `${channel}-title`,\n    type: 'group',\n    role: `${headerChannel}-title`,\n    title: {\n      text: title,\n      ...(channel === 'row' ? {orient: 'left'} : {}),\n      style: 'guide-title',\n      ...defaultHeaderGuideBaseline(titleAngle, headerChannel),\n      ...defaultHeaderGuideAlign(headerChannel, titleAngle, titleAnchor),\n      ...assembleHeaderProperties(config, facetFieldDef, channel, HEADER_TITLE_PROPERTIES, HEADER_TITLE_PROPERTIES_MAP)\n    }\n  };\n}\n\nexport function defaultHeaderGuideAlign(headerChannel: HeaderChannel, angle: number, anchor: TitleAnchor = 'middle') {\n  switch (anchor) {\n    case 'start':\n      return {align: 'left'};\n    case 'end':\n      return {align: 'right'};\n  }\n\n  const align = defaultLabelAlign(angle, headerChannel === 'row' ? 'left' : 'top');\n  return align ? {align} : {};\n}\n\nexport function defaultHeaderGuideBaseline(angle: number, channel: FacetChannel) {\n  const baseline = defaultLabelBaseline(angle, channel === 'row' ? 'left' : 'top');\n  return baseline ? {baseline} : {};\n}\n\nexport function assembleHeaderGroups(model: Model, channel: HeaderChannel): VgMarkGroup[] {\n  const layoutHeader = model.component.layoutHeaders[channel];\n  const groups = [];\n  for (const headerType of HEADER_TYPES) {\n    if (layoutHeader[headerType]) {\n      for (const headerCmpt of layoutHeader[headerType]) {\n        groups.push(assembleHeaderGroup(model, channel, headerType, layoutHeader, headerCmpt));\n      }\n    }\n  }\n  return groups;\n}\n\nfunction getSort(facetFieldDef: FacetFieldDef<string>, channel: HeaderChannel): VgComparator {\n  const {sort} = facetFieldDef;\n  if (isSortField(sort)) {\n    return {\n      field: vgField(sort, {expr: 'datum'}),\n      order: sort.order || 'ascending'\n    };\n  } else if (isArray(sort)) {\n    return {\n      field: sortArrayIndexField(facetFieldDef, channel, {expr: 'datum'}),\n      order: 'ascending'\n    };\n  } else {\n    return {\n      field: vgField(facetFieldDef, {expr: 'datum'}),\n      order: sort || 'ascending'\n    };\n  }\n}\n\nexport function assembleLabelTitle(facetFieldDef: FacetFieldDef<string>, channel: FacetChannel, config: Config) {\n  const {format, labelAngle, labelAnchor, labelOrient} = getHeaderProperties(\n    ['format', 'labelAngle', 'labelAnchor', 'labelOrient'],\n    facetFieldDef,\n    config,\n    channel\n  );\n\n  const headerChannel = getHeaderChannel(channel, labelOrient);\n  return {\n    text: formatSignalRef(facetFieldDef, format, 'parent', config),\n    ...(channel === 'row' ? {orient: 'left'} : {}),\n    style: 'guide-label',\n    frame: 'group',\n    ...defaultHeaderGuideBaseline(labelAngle, headerChannel),\n    ...defaultHeaderGuideAlign(headerChannel, labelAngle, labelAnchor),\n    ...assembleHeaderProperties(config, facetFieldDef, channel, HEADER_LABEL_PROPERTIES, HEADER_LABEL_PROPERTIES_MAP)\n  };\n}\n\nexport function assembleHeaderGroup(\n  model: Model,\n  channel: HeaderChannel,\n  headerType: HeaderType,\n  layoutHeader: LayoutHeaderComponent,\n  headerCmpt: HeaderComponent\n) {\n  if (headerCmpt) {\n    let title = null;\n    const {facetFieldDef} = layoutHeader;\n    const config = model.config ? model.config : undefined;\n    if (facetFieldDef && headerCmpt.labels) {\n      const {labelOrient} = getHeaderProperties(['labelOrient'], facetFieldDef, config, channel);\n\n      // Include label title in the header if orient aligns with the channel\n      if (\n        (channel === 'row' && !contains(['top', 'bottom'], labelOrient)) ||\n        (channel === 'column' && !contains(['left', 'right'], labelOrient))\n      ) {\n        title = assembleLabelTitle(facetFieldDef, channel, config);\n      }\n    }\n\n    const isFacetWithoutRowCol = isFacetModel(model) && !isFacetMapping(model.facet);\n\n    const axes = headerCmpt.axes;\n\n    const hasAxes = axes && axes.length > 0;\n    if (title || hasAxes) {\n      const sizeChannel = channel === 'row' ? 'height' : 'width';\n\n      return {\n        name: model.getName(`${channel}_${headerType}`),\n        type: 'group',\n        role: `${channel}-${headerType}`,\n\n        ...(layoutHeader.facetFieldDef\n          ? {\n              from: {data: model.getName(channel + '_domain')},\n              sort: getSort(facetFieldDef, channel)\n            }\n          : {}),\n        ...(hasAxes && isFacetWithoutRowCol\n          ? {\n              from: {data: model.getName(`facet_domain_${channel}`)}\n            }\n          : {}),\n\n        ...(title ? {title} : {}),\n        ...(headerCmpt.sizeSignal\n          ? {\n              encode: {\n                update: {\n                  [sizeChannel]: headerCmpt.sizeSignal\n                }\n              }\n            }\n          : {}),\n        ...(hasAxes ? {axes} : {})\n      };\n    }\n  }\n  return null;\n}\n\nconst LAYOUT_TITLE_BAND = {\n  column: {\n    start: 0,\n    end: 1\n  },\n  row: {\n    start: 1,\n    end: 0\n  }\n};\n\nexport function getLayoutTitleBand(titleAnchor: TitleAnchor, headerChannel: HeaderChannel) {\n  return LAYOUT_TITLE_BAND[headerChannel][titleAnchor];\n}\n\nexport function assembleLayoutTitleBand(\n  headerComponentIndex: LayoutHeaderComponentIndex,\n  config: Config\n): RowCol<number> {\n  const titleBand = {};\n\n  for (const channel of FACET_CHANNELS) {\n    const headerComponent = headerComponentIndex[channel];\n    if (headerComponent && headerComponent.facetFieldDef) {\n      const {titleAnchor, titleOrient} = getHeaderProperties(\n        ['titleAnchor', 'titleOrient'],\n        headerComponent.facetFieldDef,\n        config,\n        channel\n      );\n\n      const headerChannel = getHeaderChannel(channel, titleOrient);\n      const band = getLayoutTitleBand(titleAnchor, headerChannel);\n      if (band !== undefined) {\n        titleBand[headerChannel] = band;\n      }\n    }\n  }\n\n  return keys(titleBand).length > 0 ? titleBand : undefined;\n}\n\nexport function assembleHeaderProperties(\n  config: Config,\n  facetFieldDef: FacetFieldDef<string>,\n  channel: FacetChannel,\n  properties: (keyof CoreHeader)[],\n  propertiesMap: {[k in keyof CoreHeader]: keyof TitleConfig}\n): Partial<VgTitle> {\n  const props = {};\n  for (const prop of properties) {\n    if (!propertiesMap[prop]) {\n      continue;\n    }\n\n    const value = getHeaderProperty(prop, facetFieldDef, config, channel);\n    if (value !== undefined) {\n      props[propertiesMap[prop]] = value;\n    }\n  }\n  return props;\n}\n"]}