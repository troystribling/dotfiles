{"version":3,"file":"repeat.js","sourceRoot":"","sources":["../../../src/compile/repeat.ts"],"names":[],"mappings":"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","sourcesContent":["import {isArray} from 'vega-util';\nimport {Config} from '../config';\nimport * as log from '../log';\nimport {NormalizedRepeatSpec} from '../spec';\nimport {RepeatMapping} from '../spec/repeat';\nimport {VgLayout} from '../vega.schema';\nimport {BaseConcatModel} from './baseconcat';\nimport {buildModel} from './buildmodel';\nimport {parseRepeatLayoutSize} from './layoutsize/parse';\nimport {Model} from './model';\nimport {RepeaterValue} from './repeater';\n\nexport class RepeatModel extends BaseConcatModel {\n  public readonly repeat: RepeatMapping | string[];\n\n  public readonly children: Model[];\n\n  constructor(\n    spec: NormalizedRepeatSpec,\n    parent: Model,\n    parentGivenName: string,\n    repeatValues: RepeaterValue,\n    config: Config\n  ) {\n    super(spec, 'repeat', parent, parentGivenName, config, repeatValues, spec.resolve);\n\n    if (spec.resolve && spec.resolve.axis && (spec.resolve.axis.x === 'shared' || spec.resolve.axis.y === 'shared')) {\n      log.warn(log.message.REPEAT_CANNOT_SHARE_AXIS);\n    }\n\n    this.repeat = spec.repeat;\n    this.children = this._initChildren(spec, this.repeat, repeatValues, config);\n  }\n\n  private _initChildren(\n    spec: NormalizedRepeatSpec,\n    repeat: RepeatMapping | string[],\n    repeater: RepeaterValue,\n    config: Config\n  ): Model[] {\n    const children: Model[] = [];\n\n    const row = (!isArray(repeat) && repeat.row) || [repeater ? repeater.row : null];\n    const column = (!isArray(repeat) && repeat.column) || [repeater ? repeater.column : null];\n    const repeatValues = (isArray(repeat) && repeat) || [repeater ? repeater.repeat : null];\n\n    // cross product\n    for (const repeatValue of repeatValues) {\n      for (const rowValue of row) {\n        for (const columnValue of column) {\n          const name =\n            (repeatValue ? `__repeat_repeat_${repeatValue}` : '') +\n            (rowValue ? `__repeat_row_${rowValue}` : '') +\n            (columnValue ? `__repeat_column_${columnValue}` : '');\n\n          const childRepeat = {\n            repeat: repeatValue,\n            row: rowValue,\n            column: columnValue\n          };\n\n          children.push(\n            buildModel(spec.spec, this, this.getName('child' + name), undefined, childRepeat, config, false)\n          );\n        }\n      }\n    }\n\n    return children;\n  }\n\n  public parseLayoutSize() {\n    parseRepeatLayoutSize(this);\n  }\n\n  protected assembleDefaultLayout(): VgLayout {\n    const {repeat} = this;\n    const columns = isArray(repeat) ? undefined : repeat.column ? repeat.column.length : 1;\n\n    return {\n      ...(columns ? {columns} : {}),\n      bounds: 'full',\n      align: 'all'\n    };\n  }\n}\n"]}