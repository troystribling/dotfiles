Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _atom = require('atom');

var _logger = require('./logger');

var _serverManager = require('./server-manager.js');

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _codeFormatAdapter = require('./adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _codeHighlightAdapter = require('./adapters/code-highlight-adapter');

var _codeHighlightAdapter2 = _interopRequireDefault(_codeHighlightAdapter);

var _datatipAdapter = require('./adapters/datatip-adapter');

var _datatipAdapter2 = _interopRequireDefault(_datatipAdapter);

var _definitionAdapter = require('./adapters/definition-adapter');

var _definitionAdapter2 = _interopRequireDefault(_definitionAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _findReferencesAdapter = require('./adapters/find-references-adapter');

var _findReferencesAdapter2 = _interopRequireDefault(_findReferencesAdapter);

var _linterPushV2Adapter = require('./adapters/linter-push-v2-adapter');

var _linterPushV2Adapter2 = _interopRequireDefault(_linterPushV2Adapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _outlineViewAdapter = require('./adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

// Public: AutoLanguageClient provides a simple way to have all the supported
// Atom-IDE services wired up entirely for you by just subclassing it and
// implementing startServerProcess/getGrammarScopes/getLanguageName and
// getServerName.
let AutoLanguageClient = class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
  }

  // Shared adapters that can take the RPC connection as required


  // You must implement these so we know how to deal with your language and server
  // -------------------------------------------------------------------------

  // Return an array of the grammar scopes you handle, e.g. [ 'source.js' ]
  getGrammarScopes() {
    throw Error('Must implement getGrammarScopes when extending AutoLanguageClient');
  }

  // Return the name of the language you support, e.g. 'JavaScript'
  getLanguageName() {
    throw Error('Must implement getLanguageName when extending AutoLanguageClient');
  }

  // Return the name of your server, e.g. 'Eclipse JDT'
  getServerName() {
    throw Error('Must implement getServerName when extending AutoLanguageClient');
  }

  // Start your server process
  startServerProcess(projectPath) {
    throw Error('Must override startServerProcess to start language server process when extending AutoLanguageClient');
  }

  // You might want to override these for different behavior
  // ---------------------------------------------------------------------------

  // Determine whether we should start a server for a given editor if we don't have one yet
  shouldStartForEditor(editor) {
    return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
  }

  // Return the parameters used to initialize a client - you may want to extend capabilities
  getInitializeParams(projectPath, process) {
    return {
      processId: process.pid,
      capabilities: {},
      rootPath: projectPath
    };
  }

  // Early wire-up of listeners before initialize method is sent
  preInitialization(connection) {}

  // Late wire-up of listeners after initialize method has been sent
  postInitialization(server) {}

  // Determine whether to use ipc, stdio or socket to connect to the server
  getConnectionType() {
    const hasSocket = this.socket != null;
    return hasSocket ? 'socket' : 'stdio';
  }

  // Default implementation of the rest of the AutoLanguageClient
  // ---------------------------------------------------------------------------

  // Activate does very little for perf reasons - hooks in via ServerManager for later 'activation'
  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = this.getLogger();
    this._serverManager = new _serverManager.ServerManager(p => this.startServer(p), this.logger, e => this.shouldStartForEditor(e));
  }

  // Deactivate disposes the resources we're using
  deactivate() {
    this._disposable.dispose();
    this._serverManager.dispose();
  }

  spawnChildNode(args, options = {}) {
    this.logger.debug(`starting child Node "${args.join(' ')}"`);
    options.env = options.env || Object.create(process.env);
    options.env.ELECTRON_RUN_AS_NODE = '1';
    options.env.ELECTRON_NO_ATTACH_CONSOLE = '1';
    return cp.spawn(process.execPath, args, options);
  }

  // By default LSP logging is switched off but you can switch it on via the core.debugLSP setting
  getLogger() {
    return atom.config.get('core.debugLSP') ? new _logger.ConsoleLogger(this.name) : new _logger.NullLogger();
  }

  // Starts the server by starting the process, then initializing the language server and starting adapters
  startServer(projectPath) {
    var _this = this;

    return _asyncToGenerator(function* () {
      const process = yield _this.startServerProcess(projectPath);
      const connection = new ls.LanguageClientConnection(_this.createRpcConnection(process), _this.logger);
      _this.preInitialization(connection);
      const initializeParams = _this.getInitializeParams(projectPath, process);
      const initializeResponse = yield connection.initialize(initializeParams);
      const newServer = {
        projectPath,
        process,
        connection,
        capabilities: initializeResponse.capabilities,
        disposable: new _atom.CompositeDisposable()
      };
      _this.postInitialization(newServer);
      _this.startExclusiveAdapters(newServer);
      return newServer;
    })();
  }

  // Creates the RPC connection which can be ipc, socket or stdio
  createRpcConnection(process) {
    let reader, writer;
    const connectionType = this.getConnectionType();

    switch (connectionType) {
      case 'ipc':
        reader = new rpc.IPCMessageReader(process);
        writer = new rpc.IPCMessageWriter(process);
        break;
      case 'socket':
        reader = new rpc.SocketMessageReader(this.socket);
        writer = new rpc.SocketMessageWriter(this.socket);
        break;
      case 'stdio':
        reader = new rpc.StreamMessageReader(process.stdout);
        writer = new rpc.StreamMessageWriter(process.stdin);
        break;
      default:
        throw new Error(`Unknown RPC connection type '${connectionType}' - must be 'ipc', 'socket' or 'stdio'`);
    }
    return rpc.createMessageConnection(reader, writer, {
      error: m => {
        this.logger.error(m);
      }
    });
  }

  // Start adapters that are not shared between servers
  startExclusiveAdapters(server) {
    _notificationsAdapter2.default.attach(server.connection, this.name);

    if (_documentSyncAdapter2.default.canAdapt(server.capabilities)) {
      server.docSyncAdapter = new _documentSyncAdapter2.default(server.connection, server.capabilities.textDocumentSync, editor => this.shouldSyncForEditor(editor, server.projectPath));
      server.disposable.add(server.docSyncAdapter);
    }

    server.linterPushV2 = new _linterPushV2Adapter2.default(server.connection);
    if (this._linterDelegate != null) {
      server.linterPushV2.attach(this._linterDelegate);
    }
  }

  shouldSyncForEditor(editor, projectPath) {
    return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
  }

  isFileInProject(editor, projectPath) {
    return (editor.getURI() || '').startsWith(projectPath);
  }

  // Autocomplete+ via LS completion---------------------------------------
  provideAutocomplete() {
    return {
      selector: this.getGrammarScopes().map(g => '.' + g).join(', '),
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  getSuggestions(request) {
    var _this2 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this2._serverManager.getServer(request.editor);
      if (server == null || !_autocompleteAdapter2.default.canAdapt(server.capabilities)) {
        return [];
      }

      _this2.autoComplete = _this2.autoComplete || new _autocompleteAdapter2.default();
      return _this2.autoComplete.getSuggestions(server.connection, request);
    })();
  }

  // Definitions via LS documentHighlight and gotoDefinition------------
  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this)
    };
  }

  getDefinition(editor, point) {
    var _this3 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this3._serverManager.getServer(editor);
      if (server == null || !_definitionAdapter2.default.canAdapt(server.capabilities)) {
        return null;
      }

      _this3.definitions = _this3.definitions || new _definitionAdapter2.default();
      return _this3.definitions.getDefinition(server.connection, server.capabilities, _this3.getLanguageName(), editor, point);
    })();
  }

  // Outline View via LS documentSymbol---------------------------------
  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  getOutline(editor) {
    var _this4 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this4._serverManager.getServer(editor);
      if (server == null || !_outlineViewAdapter2.default.canAdapt(server.capabilities)) {
        return null;
      }

      _this4.outlineView = _this4.outlineView || new _outlineViewAdapter2.default();
      return _this4.outlineView.getOutline(server.connection, editor);
    })();
  }

  // Linter push v2 API via LS publishDiagnostics
  consumeLinterV2(registerIndie) {
    this._linterDelegate = registerIndie({ name: this.name });
    if (this._linterDelegate == null) {
      return;
    }

    for (const server of this._serverManager.getActiveServers()) {
      if (server.linterPushV2 != null) {
        server.linterPushV2.attach(this._linterDelegate);
      }
    }
  }

  // Find References via LS findReferences------------------------------
  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  getReferences(editor, point) {
    var _this5 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this5._serverManager.getServer(editor);
      if (server == null || !_findReferencesAdapter2.default.canAdapt(server.capabilities)) {
        return null;
      }

      _this5.findReferences = _this5.findReferences || new _findReferencesAdapter2.default();
      return _this5.findReferences.getReferences(server.connection, editor, point, server.projectPath);
    })();
  }

  // Datatip via LS textDocument/hover----------------------------------
  consumeDatatip(service) {
    this._disposable.add(service.addProvider({
      providerName: this.name,
      priority: 1,
      grammarScopes: this.getGrammarScopes(),
      validForScope: scopeName => {
        return this.getGrammarScopes().includes(scopeName);
      },
      datatip: this.getDatatip.bind(this)
    }));
  }

  getDatatip(editor, point) {
    var _this6 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this6._serverManager.getServer(editor);
      if (server == null || !_datatipAdapter2.default.canAdapt(server.capabilities)) {
        return null;
      }

      _this6.datatip = _this6.datatip || new _datatipAdapter2.default();
      return _this6.datatip.getDatatip(server.connection, editor, point);
    })();
  }

  // Code Format via LS formatDocument & formatDocumentRange------------
  provideCodeFormat() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      formatCode: this.getCodeFormat.bind(this)
    };
  }

  getCodeFormat(editor, range) {
    var _this7 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this7._serverManager.getServer(editor);
      if (server == null || !_codeFormatAdapter2.default.canAdapt(server.capabilities)) {
        return [];
      }

      return _codeFormatAdapter2.default.format(server.connection, server.capabilities, editor, range);
    })();
  }

  provideCodeHighlight() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      highlight: (editor, position) => {
        return this.getCodeHighlight(editor, position);
      }
    };
  }

  getCodeHighlight(editor, position) {
    var _this8 = this;

    return _asyncToGenerator(function* () {
      const server = yield _this8._serverManager.getServer(editor);
      if (server == null || !_codeHighlightAdapter2.default.canAdapt(server.capabilities)) {
        return null;
      }

      return _codeHighlightAdapter2.default.highlight(server.connection, server.capabilities, editor, position);
    })();
  }
};
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsImdldEdyYW1tYXJTY29wZXMiLCJFcnJvciIsImdldExhbmd1YWdlTmFtZSIsImdldFNlcnZlck5hbWUiLCJzdGFydFNlcnZlclByb2Nlc3MiLCJwcm9qZWN0UGF0aCIsInNob3VsZFN0YXJ0Rm9yRWRpdG9yIiwiZWRpdG9yIiwiaW5jbHVkZXMiLCJnZXRHcmFtbWFyIiwic2NvcGVOYW1lIiwiZ2V0SW5pdGlhbGl6ZVBhcmFtcyIsInByb2Nlc3MiLCJwcm9jZXNzSWQiLCJwaWQiLCJjYXBhYmlsaXRpZXMiLCJyb290UGF0aCIsInByZUluaXRpYWxpemF0aW9uIiwiY29ubmVjdGlvbiIsInBvc3RJbml0aWFsaXphdGlvbiIsInNlcnZlciIsImdldENvbm5lY3Rpb25UeXBlIiwiaGFzU29ja2V0Iiwic29ja2V0IiwiYWN0aXZhdGUiLCJuYW1lIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiX3NlcnZlck1hbmFnZXIiLCJwIiwic3RhcnRTZXJ2ZXIiLCJlIiwiZGVhY3RpdmF0ZSIsImRpc3Bvc2UiLCJzcGF3bkNoaWxkTm9kZSIsImFyZ3MiLCJvcHRpb25zIiwiZGVidWciLCJqb2luIiwiZW52IiwiT2JqZWN0IiwiY3JlYXRlIiwiRUxFQ1RST05fUlVOX0FTX05PREUiLCJFTEVDVFJPTl9OT19BVFRBQ0hfQ09OU09MRSIsInNwYXduIiwiZXhlY1BhdGgiLCJhdG9tIiwiY29uZmlnIiwiZ2V0IiwiTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uIiwiY3JlYXRlUnBjQ29ubmVjdGlvbiIsImluaXRpYWxpemVQYXJhbXMiLCJpbml0aWFsaXplUmVzcG9uc2UiLCJpbml0aWFsaXplIiwibmV3U2VydmVyIiwiZGlzcG9zYWJsZSIsInN0YXJ0RXhjbHVzaXZlQWRhcHRlcnMiLCJyZWFkZXIiLCJ3cml0ZXIiLCJjb25uZWN0aW9uVHlwZSIsIklQQ01lc3NhZ2VSZWFkZXIiLCJJUENNZXNzYWdlV3JpdGVyIiwiU29ja2V0TWVzc2FnZVJlYWRlciIsIlNvY2tldE1lc3NhZ2VXcml0ZXIiLCJTdHJlYW1NZXNzYWdlUmVhZGVyIiwic3Rkb3V0IiwiU3RyZWFtTWVzc2FnZVdyaXRlciIsInN0ZGluIiwiY3JlYXRlTWVzc2FnZUNvbm5lY3Rpb24iLCJlcnJvciIsIm0iLCJhdHRhY2giLCJjYW5BZGFwdCIsImRvY1N5bmNBZGFwdGVyIiwidGV4dERvY3VtZW50U3luYyIsInNob3VsZFN5bmNGb3JFZGl0b3IiLCJhZGQiLCJsaW50ZXJQdXNoVjIiLCJfbGludGVyRGVsZWdhdGUiLCJpc0ZpbGVJblByb2plY3QiLCJnZXRVUkkiLCJzdGFydHNXaXRoIiwicHJvdmlkZUF1dG9jb21wbGV0ZSIsInNlbGVjdG9yIiwibWFwIiwiZyIsImV4Y2x1ZGVMb3dlclByaW9yaXR5IiwiZ2V0U3VnZ2VzdGlvbnMiLCJiaW5kIiwicmVxdWVzdCIsImdldFNlcnZlciIsImF1dG9Db21wbGV0ZSIsInByb3ZpZGVEZWZpbml0aW9ucyIsInByaW9yaXR5IiwiZ3JhbW1hclNjb3BlcyIsImdldERlZmluaXRpb24iLCJwb2ludCIsImRlZmluaXRpb25zIiwicHJvdmlkZU91dGxpbmVzIiwiZ2V0T3V0bGluZSIsIm91dGxpbmVWaWV3IiwiY29uc3VtZUxpbnRlclYyIiwicmVnaXN0ZXJJbmRpZSIsImdldEFjdGl2ZVNlcnZlcnMiLCJwcm92aWRlRmluZFJlZmVyZW5jZXMiLCJpc0VkaXRvclN1cHBvcnRlZCIsImZpbmRSZWZlcmVuY2VzIiwiZ2V0UmVmZXJlbmNlcyIsImNvbnN1bWVEYXRhdGlwIiwic2VydmljZSIsImFkZFByb3ZpZGVyIiwicHJvdmlkZXJOYW1lIiwidmFsaWRGb3JTY29wZSIsImRhdGF0aXAiLCJnZXREYXRhdGlwIiwicHJvdmlkZUNvZGVGb3JtYXQiLCJmb3JtYXRDb2RlIiwiZ2V0Q29kZUZvcm1hdCIsInJhbmdlIiwiZm9ybWF0IiwicHJvdmlkZUNvZGVIaWdobGlnaHQiLCJoaWdobGlnaHQiLCJwb3NpdGlvbiIsImdldENvZGVIaWdobGlnaHQiXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUE7O0lBQVlBLEU7O0FBQ1o7O0lBQVlDLEU7O0FBQ1o7O0lBQVlDLEc7O0FBQ1o7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtJQUNxQkMsa0IsR0FBTixNQUFNQSxrQkFBTixDQUF5QjtBQUFBO0FBQUEsU0FDdENDLFdBRHNDLEdBQ3hCLCtCQUR3QjtBQUFBOztBQVN0Qzs7O0FBT0E7QUFDQTs7QUFFQTtBQUNBQyxxQkFBa0M7QUFDaEMsVUFBTUMsTUFBTSxtRUFBTixDQUFOO0FBQ0Q7O0FBRUQ7QUFDQUMsb0JBQTBCO0FBQ3hCLFVBQU1ELE1BQU0sa0VBQU4sQ0FBTjtBQUNEOztBQUVEO0FBQ0FFLGtCQUF3QjtBQUN0QixVQUFNRixNQUFNLGdFQUFOLENBQU47QUFDRDs7QUFFRDtBQUNBRyxxQkFBbUJDLFdBQW5CLEVBQW9FO0FBQ2xFLFVBQU1KLE1BQU0scUdBQU4sQ0FBTjtBQUNEOztBQUVEO0FBQ0E7O0FBRUE7QUFDQUssdUJBQXFCQyxNQUFyQixFQUF1RDtBQUNyRCxXQUFPLEtBQUtQLGdCQUFMLEdBQXdCUSxRQUF4QixDQUFpQ0QsT0FBT0UsVUFBUCxHQUFvQkMsU0FBckQsQ0FBUDtBQUNEOztBQUVEO0FBQ0FDLHNCQUFvQk4sV0FBcEIsRUFBeUNPLE9BQXpDLEVBQW1HO0FBQ2pHLFdBQU87QUFDTEMsaUJBQVdELFFBQVFFLEdBRGQ7QUFFTEMsb0JBQWMsRUFGVDtBQUdMQyxnQkFBVVg7QUFITCxLQUFQO0FBS0Q7O0FBRUQ7QUFDQVksb0JBQWtCQyxVQUFsQixFQUFpRSxDQUFFOztBQUVuRTtBQUNBQyxxQkFBbUJDLE1BQW5CLEVBQStDLENBQUU7O0FBRWpEO0FB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dFVxQyxDO2tCQUFuQjVILGtCIiwiZmlsZSI6ImF1dG8tbGFuZ3VhZ2VjbGllbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0ICogYXMgY3AgZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4vbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgKiBhcyBycGMgZnJvbSAndnNjb2RlLWpzb25ycGMnO1xyXG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2F0b20nO1xyXG5pbXBvcnQge0NvbnNvbGVMb2dnZXIsIE51bGxMb2dnZXIsIHR5cGUgTG9nZ2VyfSBmcm9tICcuL2xvZ2dlcic7XHJcbmltcG9ydCB7U2VydmVyTWFuYWdlciwgdHlwZSBBY3RpdmVTZXJ2ZXJ9IGZyb20gJy4vc2VydmVyLW1hbmFnZXIuanMnO1xyXG5cclxuaW1wb3J0IEF1dG9jb21wbGV0ZUFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlcic7XHJcbmltcG9ydCBDb2RlRm9ybWF0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2NvZGUtZm9ybWF0LWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29kZUhpZ2hsaWdodEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9jb2RlLWhpZ2hsaWdodC1hZGFwdGVyJztcclxuaW1wb3J0IERhdGF0aXBBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZGF0YXRpcC1hZGFwdGVyJztcclxuaW1wb3J0IERlZmluaXRpb25BZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZGVmaW5pdGlvbi1hZGFwdGVyJztcclxuaW1wb3J0IERvY3VtZW50U3luY0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kb2N1bWVudC1zeW5jLWFkYXB0ZXInO1xyXG5pbXBvcnQgRmluZFJlZmVyZW5jZXNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZmluZC1yZWZlcmVuY2VzLWFkYXB0ZXInO1xyXG5pbXBvcnQgTGludGVyUHVzaFYyQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2xpbnRlci1wdXNoLXYyLWFkYXB0ZXInO1xyXG5pbXBvcnQgTm90aWZpY2F0aW9uc0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9ub3RpZmljYXRpb25zLWFkYXB0ZXInO1xyXG5pbXBvcnQgT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvb3V0bGluZS12aWV3LWFkYXB0ZXInO1xyXG5cclxudHlwZSBDb25uZWN0aW9uVHlwZSA9ICdzdGRpbycgfCAnc29ja2V0JyB8ICdpcGMnO1xyXG5cclxuLy8gUHVibGljOiBBdXRvTGFuZ3VhZ2VDbGllbnQgcHJvdmlkZXMgYSBzaW1wbGUgd2F5IHRvIGhhdmUgYWxsIHRoZSBzdXBwb3J0ZWRcclxuLy8gQXRvbS1JREUgc2VydmljZXMgd2lyZWQgdXAgZW50aXJlbHkgZm9yIHlvdSBieSBqdXN0IHN1YmNsYXNzaW5nIGl0IGFuZFxyXG4vLyBpbXBsZW1lbnRpbmcgc3RhcnRTZXJ2ZXJQcm9jZXNzL2dldEdyYW1tYXJTY29wZXMvZ2V0TGFuZ3VhZ2VOYW1lIGFuZFxyXG4vLyBnZXRTZXJ2ZXJOYW1lLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvTGFuZ3VhZ2VDbGllbnQge1xyXG4gIF9kaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcclxuICBfc2VydmVyTWFuYWdlcjogU2VydmVyTWFuYWdlcjtcclxuICBfbGludGVyRGVsZWdhdGU6IGxpbnRlciRWMkluZGllRGVsZWdhdGU7XHJcblxyXG4gIGxvZ2dlcjogTG9nZ2VyO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBzb2NrZXQ6IG5ldCRTb2NrZXQ7XHJcblxyXG4gIC8vIFNoYXJlZCBhZGFwdGVycyB0aGF0IGNhbiB0YWtlIHRoZSBSUEMgY29ubmVjdGlvbiBhcyByZXF1aXJlZFxyXG4gIGF1dG9Db21wbGV0ZTogP0F1dG9jb21wbGV0ZUFkYXB0ZXI7XHJcbiAgZGF0YXRpcDogP0RhdGF0aXBBZGFwdGVyO1xyXG4gIGRlZmluaXRpb25zOiA/RGVmaW5pdGlvbkFkYXB0ZXI7XHJcbiAgZmluZFJlZmVyZW5jZXM6ID9GaW5kUmVmZXJlbmNlc0FkYXB0ZXI7XHJcbiAgb3V0bGluZVZpZXc6ID9PdXRsaW5lVmlld0FkYXB0ZXI7XHJcblxyXG4gIC8vIFlvdSBtdXN0IGltcGxlbWVudCB0aGVzZSBzbyB3ZSBrbm93IGhvdyB0byBkZWFsIHdpdGggeW91ciBsYW5ndWFnZSBhbmQgc2VydmVyXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBSZXR1cm4gYW4gYXJyYXkgb2YgdGhlIGdyYW1tYXIgc2NvcGVzIHlvdSBoYW5kbGUsIGUuZy4gWyAnc291cmNlLmpzJyBdXHJcbiAgZ2V0R3JhbW1hclNjb3BlcygpOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRHcmFtbWFyU2NvcGVzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBsYW5ndWFnZSB5b3Ugc3VwcG9ydCwgZS5nLiAnSmF2YVNjcmlwdCdcclxuICBnZXRMYW5ndWFnZU5hbWUoKTogc3RyaW5nIHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRMYW5ndWFnZU5hbWUgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIG5hbWUgb2YgeW91ciBzZXJ2ZXIsIGUuZy4gJ0VjbGlwc2UgSkRUJ1xyXG4gIGdldFNlcnZlck5hbWUoKTogc3RyaW5nIHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRTZXJ2ZXJOYW1lIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnQgeW91ciBzZXJ2ZXIgcHJvY2Vzc1xyXG4gIHN0YXJ0U2VydmVyUHJvY2Vzcyhwcm9qZWN0UGF0aDogc3RyaW5nKTogY2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3Mge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3Qgb3ZlcnJpZGUgc3RhcnRTZXJ2ZXJQcm9jZXNzIHRvIHN0YXJ0IGxhbmd1YWdlIHNlcnZlciBwcm9jZXNzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gWW91IG1pZ2h0IHdhbnQgdG8gb3ZlcnJpZGUgdGhlc2UgZm9yIGRpZmZlcmVudCBiZWhhdmlvclxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBEZXRlcm1pbmUgd2hldGhlciB3ZSBzaG91bGQgc3RhcnQgYSBzZXJ2ZXIgZm9yIGEgZ2l2ZW4gZWRpdG9yIGlmIHdlIGRvbid0IGhhdmUgb25lIHlldFxyXG4gIHNob3VsZFN0YXJ0Rm9yRWRpdG9yKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBwYXJhbWV0ZXJzIHVzZWQgdG8gaW5pdGlhbGl6ZSBhIGNsaWVudCAtIHlvdSBtYXkgd2FudCB0byBleHRlbmQgY2FwYWJpbGl0aWVzXHJcbiAgZ2V0SW5pdGlhbGl6ZVBhcmFtcyhwcm9qZWN0UGF0aDogc3RyaW5nLCBwcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IGxzLkluaXRpYWxpemVQYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJvY2Vzc0lkOiBwcm9jZXNzLnBpZCxcclxuICAgICAgY2FwYWJpbGl0aWVzOiB7fSxcclxuICAgICAgcm9vdFBhdGg6IHByb2plY3RQYXRoLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEVhcmx5IHdpcmUtdXAgb2YgbGlzdGVuZXJzIGJlZm9yZSBpbml0aWFsaXplIG1ldGhvZCBpcyBzZW50XHJcbiAgcHJlSW5pdGlhbGl6YXRpb24oY29ubmVjdGlvbjogbHMuTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uKTogdm9pZCB7fVxyXG5cclxuICAvLyBMYXRlIHdpcmUtdXAgb2YgbGlzdGVuZXJzIGFmdGVyIGluaXRpYWxpemUgbWV0aG9kIGhhcyBiZWVuIHNlbnRcclxuICBwb3N0SW5pdGlhbGl6YXRpb24oc2VydmVyOiBBY3RpdmVTZXJ2ZXIpOiB2b2lkIHt9XHJcblxyXG4gIC8vIERldGVybWluZSB3aGV0aGVyIHRvIHVzZSBpcGMsIHN0ZGlvIG9yIHNvY2tldCB0byBjb25uZWN0IHRvIHRoZSBzZXJ2ZXJcclxuICBnZXRDb25uZWN0aW9uVHlwZSgpOiBDb25uZWN0aW9uVHlwZSB7XHJcbiAgICBjb25zdCBoYXNTb2NrZXQgPSB0aGlzLnNvY2tldCAhPSBudWxsO1xyXG4gICAgcmV0dXJuIGhhc1NvY2tldCA/ICdzb2NrZXQnIDogJ3N0ZGlvJztcclxuICB9XHJcblxyXG4gIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIHJlc3Qgb2YgdGhlIEF1dG9MYW5ndWFnZUNsaWVudFxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBBY3RpdmF0ZSBkb2VzIHZlcnkgbGl0dGxlIGZvciBwZXJmIHJlYXNvbnMgLSBob29rcyBpbiB2aWEgU2VydmVyTWFuYWdlciBmb3IgbGF0ZXIgJ2FjdGl2YXRpb24nXHJcbiAgYWN0aXZhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5hbWUgPSBgJHt0aGlzLmdldExhbmd1YWdlTmFtZSgpfSAoJHt0aGlzLmdldFNlcnZlck5hbWUoKX0pYDtcclxuICAgIHRoaXMubG9nZ2VyID0gdGhpcy5nZXRMb2dnZXIoKTtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIgPSBuZXcgU2VydmVyTWFuYWdlcihwID0+IHRoaXMuc3RhcnRTZXJ2ZXIocCksIHRoaXMubG9nZ2VyLCBlID0+IHRoaXMuc2hvdWxkU3RhcnRGb3JFZGl0b3IoZSkpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVhY3RpdmF0ZSBkaXNwb3NlcyB0aGUgcmVzb3VyY2VzIHdlJ3JlIHVzaW5nXHJcbiAgZGVhY3RpdmF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBzcGF3bkNoaWxkTm9kZShhcmdzOiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogY2hpbGRfcHJvY2VzcyRzcGF3bk9wdHMgPSB7fSk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHtcclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBzdGFydGluZyBjaGlsZCBOb2RlIFwiJHthcmdzLmpvaW4oJyAnKX1cImApO1xyXG4gICAgb3B0aW9ucy5lbnYgPSBvcHRpb25zLmVudiB8fCBPYmplY3QuY3JlYXRlKHByb2Nlc3MuZW52KTtcclxuICAgIG9wdGlvbnMuZW52LkVMRUNUUk9OX1JVTl9BU19OT0RFID0gJzEnO1xyXG4gICAgb3B0aW9ucy5lbnYuRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUgPSAnMSc7XHJcbiAgICByZXR1cm4gY3Auc3Bhd24ocHJvY2Vzcy5leGVjUGF0aCwgYXJncywgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvLyBCeSBkZWZhdWx0IExTUCBsb2dnaW5nIGlzIHN3aXRjaGVkIG9mZiBidXQgeW91IGNhbiBzd2l0Y2ggaXQgb24gdmlhIHRoZSBjb3JlLmRlYnVnTFNQIHNldHRpbmdcclxuICBnZXRMb2dnZXIoKTogTG9nZ2VyIHtcclxuICAgIHJldHVybiBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuZGVidWdMU1AnKSA/IG5ldyBDb25zb2xlTG9nZ2VyKHRoaXMubmFtZSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnRzIHRoZSBzZXJ2ZXIgYnkgc3RhcnRpbmcgdGhlIHByb2Nlc3MsIHRoZW4gaW5pdGlhbGl6aW5nIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgYW5kIHN0YXJ0aW5nIGFkYXB0ZXJzXHJcbiAgYXN5bmMgc3RhcnRTZXJ2ZXIocHJvamVjdFBhdGg6IHN0cmluZyk6IFByb21pc2U8QWN0aXZlU2VydmVyPiB7XHJcbiAgICBjb25zdCBwcm9jZXNzID0gYXdhaXQgdGhpcy5zdGFydFNlcnZlclByb2Nlc3MocHJvamVjdFBhdGgpO1xyXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24odGhpcy5jcmVhdGVScGNDb25uZWN0aW9uKHByb2Nlc3MpLCB0aGlzLmxvZ2dlcik7XHJcbiAgICB0aGlzLnByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb24pO1xyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVBhcmFtcyA9IHRoaXMuZ2V0SW5pdGlhbGl6ZVBhcmFtcyhwcm9qZWN0UGF0aCwgcHJvY2Vzcyk7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUmVzcG9uc2UgPSBhd2FpdCBjb25uZWN0aW9uLmluaXRpYWxpemUoaW5pdGlhbGl6ZVBhcmFtcyk7XHJcbiAgICBjb25zdCBuZXdTZXJ2ZXIgPSB7XHJcbiAgICAgIHByb2plY3RQYXRoLFxyXG4gICAgICBwcm9jZXNzLFxyXG4gICAgICBjb25uZWN0aW9uLFxyXG4gICAgICBjYXBhYmlsaXRpZXM6IGluaXRpYWxpemVSZXNwb25zZS5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIGRpc3Bvc2FibGU6IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXHJcbiAgICB9O1xyXG4gICAgdGhpcy5wb3N0SW5pdGlhbGl6YXRpb24obmV3U2VydmVyKTtcclxuICAgIHRoaXMuc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhuZXdTZXJ2ZXIpO1xyXG4gICAgcmV0dXJuIG5ld1NlcnZlcjtcclxuICB9XHJcblxyXG4gIC8vIENyZWF0ZXMgdGhlIFJQQyBjb25uZWN0aW9uIHdoaWNoIGNhbiBiZSBpcGMsIHNvY2tldCBvciBzdGRpb1xyXG4gIGNyZWF0ZVJwY0Nvbm5lY3Rpb24ocHJvY2VzczogY2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3MpOiBycGMuQ29ubmVjdGlvbiB7XHJcbiAgICBsZXQgcmVhZGVyLCB3cml0ZXI7XHJcbiAgICBjb25zdCBjb25uZWN0aW9uVHlwZSA9IHRoaXMuZ2V0Q29ubmVjdGlvblR5cGUoKTtcclxuXHJcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb25UeXBlKSB7XHJcbiAgICAgIGNhc2UgJ2lwYyc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5JUENNZXNzYWdlUmVhZGVyKHByb2Nlc3MpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuSVBDTWVzc2FnZVdyaXRlcihwcm9jZXNzKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnc29ja2V0JzpcclxuICAgICAgICByZWFkZXIgPSBuZXcgcnBjLlNvY2tldE1lc3NhZ2VSZWFkZXIodGhpcy5zb2NrZXQpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuU29ja2V0TWVzc2FnZVdyaXRlcih0aGlzLnNvY2tldCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3N0ZGlvJzpcclxuICAgICAgICByZWFkZXIgPSBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VSZWFkZXIocHJvY2Vzcy5zdGRvdXQpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuU3RyZWFtTWVzc2FnZVdyaXRlcihwcm9jZXNzLnN0ZGluKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gUlBDIGNvbm5lY3Rpb24gdHlwZSAnJHtjb25uZWN0aW9uVHlwZX0nIC0gbXVzdCBiZSAnaXBjJywgJ3NvY2tldCcgb3IgJ3N0ZGlvJ2ApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJwYy5jcmVhdGVNZXNzYWdlQ29ubmVjdGlvbihyZWFkZXIsIHdyaXRlciwge1xyXG4gICAgICBlcnJvcjogbSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IobSk7XHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXJ0IGFkYXB0ZXJzIHRoYXQgYXJlIG5vdCBzaGFyZWQgYmV0d2VlbiBzZXJ2ZXJzXHJcbiAgc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhzZXJ2ZXI6IEFjdGl2ZVNlcnZlcik6IHZvaWQge1xyXG4gICAgTm90aWZpY2F0aW9uc0FkYXB0ZXIuYXR0YWNoKHNlcnZlci5jb25uZWN0aW9uLCB0aGlzLm5hbWUpO1xyXG5cclxuICAgIGlmIChEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5kb2NTeW5jQWRhcHRlciA9IG5ldyBEb2N1bWVudFN5bmNBZGFwdGVyKHNlcnZlci5jb25uZWN0aW9uLCBzZXJ2ZXIuY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMsIGVkaXRvciA9PlxyXG4gICAgICAgIHRoaXMuc2hvdWxkU3luY0ZvckVkaXRvcihlZGl0b3IsIHNlcnZlci5wcm9qZWN0UGF0aCksXHJcbiAgICAgICk7XHJcbiAgICAgIHNlcnZlci5kaXNwb3NhYmxlLmFkZChzZXJ2ZXIuZG9jU3luY0FkYXB0ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlcnZlci5saW50ZXJQdXNoVjIgPSBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihzZXJ2ZXIuY29ubmVjdGlvbik7XHJcbiAgICBpZiAodGhpcy5fbGludGVyRGVsZWdhdGUgIT0gbnVsbCkge1xyXG4gICAgICBzZXJ2ZXIubGludGVyUHVzaFYyLmF0dGFjaCh0aGlzLl9saW50ZXJEZWxlZ2F0ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzaG91bGRTeW5jRm9yRWRpdG9yKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5pc0ZpbGVJblByb2plY3QoZWRpdG9yLCBwcm9qZWN0UGF0aCkgJiYgdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlZGl0b3IpO1xyXG4gIH1cclxuXHJcbiAgaXNGaWxlSW5Qcm9qZWN0KGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGVkaXRvci5nZXRVUkkoKSB8fCAnJykuc3RhcnRzV2l0aChwcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZUF1dG9jb21wbGV0ZSgpOiBhdG9tJEF1dG9jb21wbGV0ZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNlbGVjdG9yOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5tYXAoZyA9PiAnLicgKyBnKS5qb2luKCcsICcpLFxyXG4gICAgICBleGNsdWRlTG93ZXJQcmlvcml0eTogZmFsc2UsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiB0aGlzLmdldFN1Z2dlc3Rpb25zLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U3VnZ2VzdGlvbnMocmVxdWVzdDogYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0KTogUHJvbWlzZTxBcnJheTxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+PiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihyZXF1ZXN0LmVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUF1dG9jb21wbGV0ZUFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYXV0b0NvbXBsZXRlID0gdGhpcy5hdXRvQ29tcGxldGUgfHwgbmV3IEF1dG9jb21wbGV0ZUFkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5nZXRTdWdnZXN0aW9ucyhzZXJ2ZXIuY29ubmVjdGlvbiwgcmVxdWVzdCk7XHJcbiAgfVxyXG5cclxuICAvLyBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZURlZmluaXRpb25zKCk6IGF0b21JZGUkRGVmaW5pdGlvblByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgcHJpb3JpdHk6IDIwLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgZ2V0RGVmaW5pdGlvbjogdGhpcy5nZXREZWZpbml0aW9uLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0RGVmaW5pdGlvbihlZGl0b3I6IFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/YXRvbUlkZSREZWZpbml0aW9uUXVlcnlSZXN1bHQ+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIURlZmluaXRpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGVmaW5pdGlvbnMgPSB0aGlzLmRlZmluaXRpb25zIHx8IG5ldyBEZWZpbml0aW9uQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbnMuZ2V0RGVmaW5pdGlvbihcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHRoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCksXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcG9pbnQsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gT3V0bGluZSBWaWV3IHZpYSBMUyBkb2N1bWVudFN5bWJvbC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVPdXRsaW5lcygpOiBhdG9tSWRlJE91dGxpbmVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZ2V0T3V0bGluZTogdGhpcy5nZXRPdXRsaW5lLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0T3V0bGluZShlZGl0b3I6IGF0b20kVGV4dEVkaXRvcik6IFByb21pc2U8P2F0b21JZGUkT3V0bGluZT4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhT3V0bGluZVZpZXdBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3V0bGluZVZpZXcgPSB0aGlzLm91dGxpbmVWaWV3IHx8IG5ldyBPdXRsaW5lVmlld0FkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLm91dGxpbmVWaWV3LmdldE91dGxpbmUoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvcik7XHJcbiAgfVxyXG5cclxuICAvLyBMaW50ZXIgcHVzaCB2MiBBUEkgdmlhIExTIHB1Ymxpc2hEaWFnbm9zdGljc1xyXG4gIGNvbnN1bWVMaW50ZXJWMihyZWdpc3RlckluZGllOiAoe25hbWU6IHN0cmluZ30pID0+IGxpbnRlciRWMkluZGllRGVsZWdhdGUpOiB2b2lkIHtcclxuICAgIHRoaXMuX2xpbnRlckRlbGVnYXRlID0gcmVnaXN0ZXJJbmRpZSh7bmFtZTogdGhpcy5uYW1lfSk7XHJcbiAgICBpZiAodGhpcy5fbGludGVyRGVsZWdhdGUgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRBY3RpdmVTZXJ2ZXJzKCkpIHtcclxuICAgICAgaWYgKHNlcnZlci5saW50ZXJQdXNoVjIgIT0gbnVsbCkge1xyXG4gICAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIuYXR0YWNoKHRoaXMuX2xpbnRlckRlbGVnYXRlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRmluZCBSZWZlcmVuY2VzIHZpYSBMUyBmaW5kUmVmZXJlbmNlcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVGaW5kUmVmZXJlbmNlcygpOiBhdG9tSWRlJEZpbmRSZWZlcmVuY2VzUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNFZGl0b3JTdXBwb3J0ZWQ6IChlZGl0b3I6IGF0b20kVGV4dEVkaXRvcikgPT4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpLFxyXG4gICAgICBmaW5kUmVmZXJlbmNlczogdGhpcy5nZXRSZWZlcmVuY2VzLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0UmVmZXJlbmNlcyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9hdG9tSWRlJEZpbmRSZWZlcmVuY2VzUmV0dXJuPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFGaW5kUmVmZXJlbmNlc0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5maW5kUmVmZXJlbmNlcyA9IHRoaXMuZmluZFJlZmVyZW5jZXMgfHwgbmV3IEZpbmRSZWZlcmVuY2VzQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZFJlZmVyZW5jZXMuZ2V0UmVmZXJlbmNlcyhzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb2ludCwgc2VydmVyLnByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIERhdGF0aXAgdmlhIExTIHRleHREb2N1bWVudC9ob3Zlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICBjb25zdW1lRGF0YXRpcChzZXJ2aWNlOiBhdG9tSWRlJERhdGF0aXBTZXJ2aWNlKTogdm9pZCB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlLmFkZChcclxuICAgICAgc2VydmljZS5hZGRQcm92aWRlcih7XHJcbiAgICAgICAgcHJvdmlkZXJOYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgICAgdmFsaWRGb3JTY29wZTogKHNjb3BlTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoc2NvcGVOYW1lKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRhdGF0aXA6IHRoaXMuZ2V0RGF0YXRpcC5iaW5kKHRoaXMpLFxyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXREYXRhdGlwKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P2F0b21JZGUkRGF0YXRpcD4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhRGF0YXRpcEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kYXRhdGlwID0gdGhpcy5kYXRhdGlwIHx8IG5ldyBEYXRhdGlwQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YXRpcC5nZXREYXRhdGlwKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50KTtcclxuICB9XHJcblxyXG4gIC8vIENvZGUgRm9ybWF0IHZpYSBMUyBmb3JtYXREb2N1bWVudCAmIGZvcm1hdERvY3VtZW50UmFuZ2UtLS0tLS0tLS0tLS1cclxuICBwcm92aWRlQ29kZUZvcm1hdCgpOiBhdG9tSWRlJFJhbmdlQ29kZUZvcm1hdFByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZm9ybWF0Q29kZTogdGhpcy5nZXRDb2RlRm9ybWF0LmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q29kZUZvcm1hdChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcmFuZ2U6IGF0b20kUmFuZ2UpOiBQcm9taXNlPEFycmF5PGF0b21JZGUkVGV4dEVkaXQ+PiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdChzZXJ2ZXIuY29ubmVjdGlvbiwgc2VydmVyLmNhcGFiaWxpdGllcywgZWRpdG9yLCByYW5nZSk7XHJcbiAgfVxyXG5cclxuICBwcm92aWRlQ29kZUhpZ2hsaWdodCgpOiBhdG9tSWRlJENvZGVIaWdobGlnaHRQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgIGhpZ2hsaWdodDogKGVkaXRvciwgcG9zaXRpb24pID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2RlSGlnaGxpZ2h0KGVkaXRvciwgcG9zaXRpb24pO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENvZGVIaWdobGlnaHQoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvc2l0aW9uOiBhdG9tJFBvaW50KTogUHJvbWlzZTw/QXJyYXk8YXRvbSRSYW5nZT4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVIaWdobGlnaHRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlSGlnaGxpZ2h0QWRhcHRlci5oaWdobGlnaHQoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMsIGVkaXRvciwgcG9zaXRpb24pO1xyXG4gIH1cclxufVxyXG4iXX0=