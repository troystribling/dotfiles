var _atom = require('atom');

var _chai = require('chai');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _convert = require('../../lib/convert');

var _convert2 = _interopRequireDefault(_convert);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _codeFormatAdapter = require('../../lib/adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('CodeFormatAdapter', () => {
  let fakeEditor;
  let connection;
  let range;

  beforeEach(() => {
    connection = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    fakeEditor = (0, _helpers.createFakeEditor)();
    range = new _atom.Range([0, 0], [100, 100]);
  });

  describe('canAdapt', () => {
    it('returns true if range formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({
        documentRangeFormattingProvider: true
      });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns true if document formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({
        documentFormattingProvider: true
      });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns false it no formatting supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({});
      (0, _chai.expect)(result).to.be.false;
    });
  });

  describe('format', () => {
    it('prefers range formatting if available', () => {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, {
        documentRangeFormattingProvider: true,
        documentFormattingProvider: true
      }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.true;
      (0, _chai.expect)(docStub.called).to.be.false;
    });

    it('falls back to document formatting if range formatting not available', () => {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, { documentFormattingProvider: true }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.false;
      (0, _chai.expect)(docStub.called).to.be.true;
    });

    it('throws if neither range or document formatting are supported', () => {
      (0, _chai.expect)(() => _codeFormatAdapter2.default.format(connection, {}, fakeEditor, range)).to.throw('');
    });
  });

  describe('formatDocument', () => {
    it('converts the results from the connection', async () => {
      _sinon2.default.stub(connection, 'documentFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = await _codeFormatAdapter2.default.formatDocument(connection, fakeEditor);
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    });
  });

  describe('createDocumentFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentFormattingParams(fakeEditor);

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('formatRange', () => {
    it('converts the results from the connection', async () => {
      _sinon2.default.stub(connection, 'documentRangeFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = await _codeFormatAdapter2.default.formatRange(connection, fakeEditor, new _atom.Range([0, 0], [1, 1]));
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    });
  });

  describe('createDocumentRangeFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentRangeFormattingParams(fakeEditor, new _atom.Range([1, 0], [2, 3]));

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.range).to.eql({
        start: { line: 1, character: 0 },
        end: { line: 2, character: 3 }
      });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('getFormatOptions', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(17);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.tabSize).to.equal(17);
    });

    it('returns the soft tab setting from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(true);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.insertSpaces).to.be.true;
    });
  });

  describe('convertLsTextEdit', () => {
    it('returns oldRange and newText from a textEdit', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 0 },
          end: { line: 2, character: 3 }
        },
        newText: 'abc-def'
      };
      const actual = _convert2.default.convertLsTextEdit(textEdit);
      (0, _chai.expect)(actual.oldRange).to.eql(new _atom.Range([1, 0], [2, 3]));
      (0, _chai.expect)(actual.newText).to.equal('abc-def');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlci50ZXN0LmpzIl0sIm5hbWVzIjpbImxzIiwiZGVzY3JpYmUiLCJmYWtlRWRpdG9yIiwiY29ubmVjdGlvbiIsInJhbmdlIiwiYmVmb3JlRWFjaCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsIml0IiwicmVzdWx0IiwiY2FuQWRhcHQiLCJkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIiwidG8iLCJiZSIsInRydWUiLCJkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlciIsImZhbHNlIiwicmFuZ2VTdHViIiwic3B5IiwiZG9jU3R1YiIsImZvcm1hdCIsImNhbGxlZCIsInRocm93Iiwic3R1YiIsInJlc29sdmVzIiwic3RhcnQiLCJsaW5lIiwiY2hhcmFjdGVyIiwiZW5kIiwibmV3VGV4dCIsImFjdHVhbCIsImZvcm1hdERvY3VtZW50IiwibGVuZ3RoIiwiZXF1YWwiLCJvbGRSYW5nZSIsInJvdyIsImNvbHVtbiIsInJldHVybnMiLCJjcmVhdGVEb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMiLCJ0ZXh0RG9jdW1lbnQiLCJlcWwiLCJ1cmkiLCJvcHRpb25zIiwidGFiU2l6ZSIsImluc2VydFNwYWNlcyIsImZvcm1hdFJhbmdlIiwiY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMiLCJnZXRGb3JtYXRPcHRpb25zIiwidGV4dEVkaXQiLCJjb252ZXJ0THNUZXh0RWRpdCJdLCJtYXBwaW5ncyI6IkFBRUE7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztJQUFZQSxFOztBQUNaOzs7O0FBQ0E7Ozs7OztBQUVBQyxTQUFTLG1CQUFULEVBQThCLE1BQU07QUFDbEMsTUFBSUMsVUFBSjtBQUNBLE1BQUlDLFVBQUo7QUFDQSxNQUFJQyxLQUFKOztBQUVBQyxhQUFXLE1BQU07QUFDZkYsaUJBQWEsSUFBSUgsR0FBR00sd0JBQVAsQ0FBZ0MsbUNBQWhDLENBQWI7QUFD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a0JLLGdCQUFsQixDQUFtQzVDLFVBQW5DLENBQWhCO0FBQ0Esd0JBQU91QyxRQUFRQyxPQUFmLEVBQXdCL0IsRUFBeEIsQ0FBMkJxQixLQUEzQixDQUFpQyxFQUFqQztBQUNELEtBSkQ7O0FBTUF6QixPQUFHLDhDQUFILEVBQW1ELE1BQU07QUFDdkQsc0JBQU1lLElBQU4sQ0FBV3BCLFVBQVgsRUFBdUIsYUFBdkIsRUFBc0NrQyxPQUF0QyxDQUE4QyxJQUE5QztBQUNBLFlBQU1LLFVBQVUsNEJBQWtCSyxnQkFBbEIsQ0FBbUM1QyxVQUFuQyxDQUFoQjtBQUNBLHdCQUFPdUMsUUFBUUUsWUFBZixFQUE2QmhDLEVBQTdCLENBQWdDQyxFQUFoQyxDQUFtQ0MsSUFBbkM7QUFDRCxLQUpEO0FBS0QsR0FaRDs7QUFjQVosV0FBUyxtQkFBVCxFQUE4QixNQUFNO0FBQ2xDTSxPQUFHLDhDQUFILEVBQW1ELE1BQU07QUFDdkQsWUFBTXdDLFdBQVc7QUFDZjNDLGVBQU87QUFDTG9CLGlCQUFPLEVBQUNDLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCLEVBREY7QUFFTEMsZUFBSyxFQUFDRixNQUFNLENBQVAsRUFBVUMsV0FBVyxDQUFyQjtBQUZBLFNBRFE7QUFLZkUsaUJBQVM7QUFMTSxPQUFqQjtBQU9BLFlBQU1DLFNBQVMsa0JBQVFtQixpQkFBUixDQUEwQkQsUUFBMUIsQ0FBZjtBQUNBLHdCQUFPbEIsT0FBT0ksUUFBZCxFQUF3QnRCLEVBQXhCLENBQTJCNEIsR0FBM0IsQ0FBK0IsZ0JBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFWLEVBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBbEIsQ0FBL0I7QUFDQSx3QkFBT1YsT0FBT0QsT0FBZCxFQUF1QmpCLEVBQXZCLENBQTBCcUIsS0FBMUIsQ0FBZ0MsU0FBaEM7QUFDRCxLQVhEO0FBWUQsR0FiRDtBQWNELENBcExEIiwiZmlsZSI6ImNvZGUtZm9ybWF0LWFkYXB0ZXIudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XHJcblxyXG5pbXBvcnQge1JhbmdlfSBmcm9tICdhdG9tJztcclxuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknO1xyXG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xyXG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi8uLi9saWIvY29udmVydCc7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4uLy4uL2xpYi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCBDb2RlRm9ybWF0QWRhcHRlciBmcm9tICcuLi8uLi9saWIvYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlcic7XHJcbmltcG9ydCB7Y3JlYXRlU3B5Q29ubmVjdGlvbiwgY3JlYXRlRmFrZUVkaXRvcn0gZnJvbSAnLi4vaGVscGVycy5qcyc7XHJcblxyXG5kZXNjcmliZSgnQ29kZUZvcm1hdEFkYXB0ZXInLCAoKSA9PiB7XHJcbiAgbGV0IGZha2VFZGl0b3I7XHJcbiAgbGV0IGNvbm5lY3Rpb247XHJcbiAgbGV0IHJhbmdlO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGNvbm5lY3Rpb24gPSBuZXcgbHMuTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uKGNyZWF0ZVNweUNvbm5lY3Rpb24oKSk7XHJcbiAgICBmYWtlRWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcigpO1xyXG4gICAgcmFuZ2UgPSBuZXcgUmFuZ2UoWzAsIDBdLCBbMTAwLCAxMDBdKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NhbkFkYXB0JywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiByYW5nZSBmb3JtYXR0aW5nIGlzIHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQ29kZUZvcm1hdEFkYXB0ZXIuY2FuQWRhcHQoe1xyXG4gICAgICAgIGRvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBkb2N1bWVudCBmb3JtYXR0aW5nIGlzIHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQ29kZUZvcm1hdEFkYXB0ZXIuY2FuQWRhcHQoe1xyXG4gICAgICAgIGRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXR1cm5zIGZhbHNlIGl0IG5vIGZvcm1hdHRpbmcgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdCh7fSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmZhbHNlO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICBpdCgncHJlZmVycyByYW5nZSBmb3JtYXR0aW5nIGlmIGF2YWlsYWJsZScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmFuZ2VTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudFJhbmdlRm9ybWF0dGluZycpO1xyXG4gICAgICBjb25zdCBkb2NTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudEZvcm1hdHRpbmcnKTtcclxuICAgICAgQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KFxyXG4gICAgICAgIGNvbm5lY3Rpb24sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQcm92aWRlcjogdHJ1ZSxcclxuICAgICAgICAgIGRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmFrZUVkaXRvcixcclxuICAgICAgICByYW5nZSxcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KHJhbmdlU3R1Yi5jYWxsZWQpLnRvLmJlLnRydWU7XHJcbiAgICAgIGV4cGVjdChkb2NTdHViLmNhbGxlZCkudG8uYmUuZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZmFsbHMgYmFjayB0byBkb2N1bWVudCBmb3JtYXR0aW5nIGlmIHJhbmdlIGZvcm1hdHRpbmcgbm90IGF2YWlsYWJsZScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmFuZ2VTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudFJhbmdlRm9ybWF0dGluZycpO1xyXG4gICAgICBjb25zdCBkb2NTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudEZvcm1hdHRpbmcnKTtcclxuICAgICAgQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KGNvbm5lY3Rpb24sIHtkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlcjogdHJ1ZX0sIGZha2VFZGl0b3IsIHJhbmdlKTtcclxuICAgICAgZXhwZWN0KHJhbmdlU3R1Yi5jYWxsZWQpLnRvLmJlLmZhbHNlO1xyXG4gICAgICBleHBlY3QoZG9jU3R1Yi5jYWxsZWQpLnRvLmJlLnRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgndGhyb3dzIGlmIG5laXRoZXIgcmFuZ2Ugb3IgZG9jdW1lbnQgZm9ybWF0dGluZyBhcmUgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoKCkgPT4gQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KGNvbm5lY3Rpb24sIHt9LCBmYWtlRWRpdG9yLCByYW5nZSkpLnRvLnRocm93KCcnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZm9ybWF0RG9jdW1lbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgdGhlIHJlc3VsdHMgZnJvbSB0aGUgY29ubmVjdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgc2lub24uc3R1Yihjb25uZWN0aW9uLCAnZG9jdW1lbnRGb3JtYXR0aW5nJykucmVzb2x2ZXMoW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMCwgY2hhcmFjdGVyOiAxfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMCwgY2hhcmFjdGVyOiAyfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBuZXdUZXh0OiAnYWJjJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogNSwgY2hhcmFjdGVyOiAxMH0sXHJcbiAgICAgICAgICAgIGVuZDoge2xpbmU6IDE1LCBjaGFyYWN0ZXI6IDIwfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBuZXdUZXh0OiAnZGVmJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdKTtcclxuICAgICAgY29uc3QgYWN0dWFsID0gYXdhaXQgQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0RG9jdW1lbnQoY29ubmVjdGlvbiwgZmFrZUVkaXRvcik7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwubGVuZ3RoKS50by5lcXVhbCgyKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFswXS5uZXdUZXh0KS50by5lcXVhbCgnYWJjJyk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ub2xkUmFuZ2Uuc3RhcnQucm93KS50by5lcXVhbCg1KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5jb2x1bW4pLnRvLmVxdWFsKDEwKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQucm93KS50by5lcXVhbCgxNSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ub2xkUmFuZ2UuZW5kLmNvbHVtbikudG8uZXF1YWwoMjApO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm5ld1RleHQpLnRvLmVxdWFsKCdkZWYnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY3JlYXRlRG9jdW1lbnRGb3JtYXR0aW5nUGFyYW1zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgdGhlIHRhYiBzaXplIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcclxuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0UGF0aCcpLnJldHVybnMoJy9hL2IvYy9kLnR4dCcpO1xyXG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRUYWJMZW5ndGgnKS5yZXR1cm5zKDEpO1xyXG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRTb2Z0VGFicycpLnJldHVybnMoZmFsc2UpO1xyXG5cclxuICAgICAgY29uc3QgYWN0dWFsID0gQ29kZUZvcm1hdEFkYXB0ZXIuY3JlYXRlRG9jdW1lbnRGb3JtYXR0aW5nUGFyYW1zKGZha2VFZGl0b3IpO1xyXG5cclxuICAgICAgZXhwZWN0KGFjdHVhbC50ZXh0RG9jdW1lbnQpLnRvLmVxbCh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCd9KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLnRhYlNpemUpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QoYWN0dWFsLm9wdGlvbnMuaW5zZXJ0U3BhY2VzKS50by5lcXVhbChmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Zvcm1hdFJhbmdlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIHRoZSByZXN1bHRzIGZyb20gdGhlIGNvbm5lY3Rpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHNpbm9uLnN0dWIoY29ubmVjdGlvbiwgJ2RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nJykucmVzb2x2ZXMoW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMCwgY2hhcmFjdGVyOiAxfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMCwgY2hhcmFjdGVyOiAyfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBuZXdUZXh0OiAnYWJjJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogNSwgY2hhcmFjdGVyOiAxMH0sXHJcbiAgICAgICAgICAgIGVuZDoge2xpbmU6IDE1LCBjaGFyYWN0ZXI6IDIwfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBuZXdUZXh0OiAnZGVmJyxcclxuICAgICAgICB9LFxyXG4gICAgICBdKTtcclxuICAgICAgY29uc3QgYWN0dWFsID0gYXdhaXQgQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0UmFuZ2UoY29ubmVjdGlvbiwgZmFrZUVkaXRvciwgbmV3IFJhbmdlKFswLCAwXSwgWzEsIDFdKSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwubGVuZ3RoKS50by5lcXVhbCgyKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFswXS5uZXdUZXh0KS50by5lcXVhbCgnYWJjJyk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ub2xkUmFuZ2Uuc3RhcnQucm93KS50by5lcXVhbCg1KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5jb2x1bW4pLnRvLmVxdWFsKDEwKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQucm93KS50by5lcXVhbCgxNSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ub2xkUmFuZ2UuZW5kLmNvbHVtbikudG8uZXF1YWwoMjApO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm5ld1RleHQpLnRvLmVxdWFsKCdkZWYnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyB0aGUgdGFiIHNpemUgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xyXG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRQYXRoJykucmV0dXJucygnL2EvYi9jL2QudHh0Jyk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMSk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFNvZnRUYWJzJykucmV0dXJucyhmYWxzZSk7XHJcblxyXG4gICAgICBjb25zdCBhY3R1YWwgPSBDb2RlRm9ybWF0QWRhcHRlci5jcmVhdGVEb2N1bWVudFJhbmdlRm9ybWF0dGluZ1BhcmFtcyhmYWtlRWRpdG9yLCBuZXcgUmFuZ2UoWzEsIDBdLCBbMiwgM10pKTtcclxuXHJcbiAgICAgIGV4cGVjdChhY3R1YWwudGV4dERvY3VtZW50KS50by5lcWwoe3VyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnfSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwucmFuZ2UpLnRvLmVxbCh7XHJcbiAgICAgICAgc3RhcnQ6IHtsaW5lOiAxLCBjaGFyYWN0ZXI6IDB9LFxyXG4gICAgICAgIGVuZDoge2xpbmU6IDIsIGNoYXJhY3RlcjogM30sXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QoYWN0dWFsLm9wdGlvbnMudGFiU2l6ZSkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwub3B0aW9ucy5pbnNlcnRTcGFjZXMpLnRvLmVxdWFsKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0Rm9ybWF0T3B0aW9ucycsICgpID0+IHtcclxuICAgIGl0KCdyZXR1cm5zIHRoZSB0YWIgc2l6ZSBmcm9tIHRoZSBlZGl0b3InLCAoKSA9PiB7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMTcpO1xyXG4gICAgICBjb25zdCBvcHRpb25zID0gQ29kZUZvcm1hdEFkYXB0ZXIuZ2V0Rm9ybWF0T3B0aW9ucyhmYWtlRWRpdG9yKTtcclxuICAgICAgZXhwZWN0KG9wdGlvbnMudGFiU2l6ZSkudG8uZXF1YWwoMTcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldHVybnMgdGhlIHNvZnQgdGFiIHNldHRpbmcgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xyXG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRTb2Z0VGFicycpLnJldHVybnModHJ1ZSk7XHJcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBDb2RlRm9ybWF0QWRhcHRlci5nZXRGb3JtYXRPcHRpb25zKGZha2VFZGl0b3IpO1xyXG4gICAgICBleHBlY3Qob3B0aW9ucy5pbnNlcnRTcGFjZXMpLnRvLmJlLnRydWU7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbnZlcnRMc1RleHRFZGl0JywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgb2xkUmFuZ2UgYW5kIG5ld1RleHQgZnJvbSBhIHRleHRFZGl0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXh0RWRpdCA9IHtcclxuICAgICAgICByYW5nZToge1xyXG4gICAgICAgICAgc3RhcnQ6IHtsaW5lOiAxLCBjaGFyYWN0ZXI6IDB9LFxyXG4gICAgICAgICAgZW5kOiB7bGluZTogMiwgY2hhcmFjdGVyOiAzfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG5ld1RleHQ6ICdhYmMtZGVmJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgYWN0dWFsID0gQ29udmVydC5jb252ZXJ0THNUZXh0RWRpdCh0ZXh0RWRpdCk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwub2xkUmFuZ2UpLnRvLmVxbChuZXcgUmFuZ2UoWzEsIDBdLCBbMiwgM10pKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5uZXdUZXh0KS50by5lcXVhbCgnYWJjLWRlZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=