var _atom = require('atom');

var _chai = require('chai');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _codeFormatAdapter = require('../../lib/adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

describe('CodeFormatAdapter', () => {
  let fakeEditor;
  let connection;
  let range;

  beforeEach(() => {
    connection = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    fakeEditor = (0, _helpers.createFakeEditor)();
    range = new _atom.Range([0, 0], [100, 100]);
  });

  describe('canAdapt', () => {
    it('returns true if range formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({
        documentRangeFormattingProvider: true
      });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns true if document formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({
        documentFormattingProvider: true
      });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns false it no formatting supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({});
      (0, _chai.expect)(result).to.be.false;
    });
  });

  describe('format', () => {
    it('prefers range formatting if available', () => {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, {
        documentRangeFormattingProvider: true,
        documentFormattingProvider: true
      }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.true;
      (0, _chai.expect)(docStub.called).to.be.false;
    });

    it('falls back to document formatting if range formatting not available', () => {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, { documentFormattingProvider: true }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.false;
      (0, _chai.expect)(docStub.called).to.be.true;
    });

    it('throws if neither range or document formatting are supported', () => {
      (0, _chai.expect)(() => _codeFormatAdapter2.default.format(connection, {}, fakeEditor, range)).to.throw('');
    });
  });

  describe('formatDocument', () => {
    it('converts the results from the connection', _asyncToGenerator(function* () {
      _sinon2.default.stub(connection, 'documentFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = yield _codeFormatAdapter2.default.formatDocument(connection, fakeEditor);
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    }));
  });

  describe('createDocumentFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentFormattingParams(fakeEditor);

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('formatRange', () => {
    it('converts the results from the connection', _asyncToGenerator(function* () {
      _sinon2.default.stub(connection, 'documentRangeFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = yield _codeFormatAdapter2.default.formatRange(connection, fakeEditor, new _atom.Range([0, 0], [1, 1]));
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    }));
  });

  describe('createDocumentRangeFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentRangeFormattingParams(fakeEditor, new _atom.Range([1, 0], [2, 3]));

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.range).to.eql({
        start: { line: 1, character: 0 },
        end: { line: 2, character: 3 }
      });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('getFormatOptions', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(17);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.tabSize).to.equal(17);
    });

    it('returns the soft tab setting from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(true);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.insertSpaces).to.be.true;
    });
  });

  describe('convertLsTextEdit', () => {
    it('returns oldRange and newText from a textEdit', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 0 },
          end: { line: 2, character: 3 }
        },
        newText: 'abc-def'
      };
      const actual = _codeFormatAdapter2.default.convertLsTextEdit(textEdit);
      (0, _chai.expect)(actual.oldRange).to.eql(new _atom.Range([1, 0], [2, 3]));
      (0, _chai.expect)(actual.newText).to.equal('abc-def');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlci50ZXN0LmpzIl0sIm5hbWVzIjpbImxzIiwiZGVzY3JpYmUiLCJmYWtlRWRpdG9yIiwiY29ubmVjdGlvbiIsInJhbmdlIiwiYmVmb3JlRWFjaCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsIml0IiwicmVzdWx0IiwiY2FuQWRhcHQiLCJkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIiwidG8iLCJiZSIsInRydWUiLCJkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlciIsImZhbHNlIiwicmFuZ2VTdHViIiwic3B5IiwiZG9jU3R1YiIsImZvcm1hdCIsImNhbGxlZCIsInRocm93Iiwic3R1YiIsInJlc29sdmVzIiwic3RhcnQiLCJsaW5lIiwiY2hhcmFjdGVyIiwiZW5kIiwibmV3VGV4dCIsImFjdHVhbCIsImZvcm1hdERvY3VtZW50IiwibGVuZ3RoIiwiZXF1YWwiLCJvbGRSYW5nZSIsInJvdyIsImNvbHVtbiIsInJldHVybnMiLCJjcmVhdGVEb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMiLCJ0ZXh0RG9jdW1lbnQiLCJlcWwiLCJ1cmkiLCJvcHRpb25zIiwidGFiU2l6ZSIsImluc2VydFNwYWNlcyIsImZvcm1hdFJhbmdlIiwiY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMiLCJnZXRGb3JtYXRPcHRpb25zIiwidGV4dEVkaXQiLCJjb252ZXJ0THNUZXh0RWRpdCJdLCJtYXBwaW5ncyI6IkFBRUE7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7SUFBWUEsRTs7QUFDWjs7OztBQUNBOzs7Ozs7OztBQUVBQyxTQUFTLG1CQUFULEVBQThCLE1BQU07QUFDbEMsTUFBSUMsVUFBSjtBQUNBLE1BQUlDLFVBQUo7QUFDQSxNQUFJQyxLQUFKOztBQUVBQyxhQUFXLE1BQU07QUFDZkYsaUJBQWEsSUFBSUgsR0FBR00sd0JBQVAsQ0FBZ0MsbUNBQWhDLENBQWI7QUFDQUosaUJBQWEsZ0NBQWI7QUFDQUUsWUFBUSxnQkFBVSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQVYsRUFBa0IsQ0FBQyxHQUFELEVBQU0sR0FBTixDQUFsQixDQUFSO0FBQ0QsR0FKRDs7QUFNQUgsV0FBUyxVQUFULEVBQXFCLE1BQU07QUFDekJNLE9BQUcsK0NBQUgsRUFBb0QsTUFBTTtBQUN4RCxZQUFNQyxTQUFTLDRCQUFrQkMsUUFBbEIsQ0FBMkI7QUFDeENDLHlDQUFpQztBQURPLE9BQTNCLENBQWY7QUFHQSx3QkFBT0YsTUFBUCxFQUFlRyxFQUFmLENBQWtCQyxFQUFsQixDQUFxQkMsSUFBckI7QUFDRCxLQUxEOztBQU9BTixPQUFHLGtEQUFILEVBQXVELE1BQU07QUFDM0QsWUFBTUMsU0FBUyw0QkFBa0JDLFFBQWxCLENBQTJCO0FBQ3hDSyxvQ0FBNEI7QUFEWSxPQUEzQixDQUFmO0FBR0Esd0JBQU9OLE1BQVAsRUFBZUcsRUFBZixDQUFrQkMsRUFBbEIsQ0FBcUJDLElBQXJCO0FBQ0QsS0FMRDs7QUFPQU4sT0FBRywwQ0FBSCxFQUErQyxNQUFNO0FBQ25ELFlBQU1DLFNBQVMsNEJBQWtCQyxRQUFsQixDQUEyQixFQUEzQixDQUFmO0FBQ0Esd0JBQU9ELE1BQVAsRUFBZUcsRUFBZixDQUFrQkMsRUFBbEIsQ0FBcUJHLEtBQXJCO0FBQ0QsS0FIRDtBQUlELEdBbkJEOztBQXFCQWQsV0FBUyxRQUFULEVBQW1CLE1BQU07QUFDdkJNLE9BQUcsdUNBQUgsRUFBNEMsTUFBTTtBQUNoRCxZQUFNUyxZQUFZLGdCQUFNQyxHQUFOLENBQVVkLFVBQVYsRUFBc0IseUJBQXRCLENBQWxCO0FBQ0EsWUFBTWUsVUFBVSxnQkFBTUQsR0FBTixDQUFVZCxVQUFWLEVBQXNCLG9CQUF0QixDQUFoQjtBQUNBLGtDQUFrQmdCLE1BQWxCLENBQ0VoQixVQURGLEVBRUU7QUFDRU8seUNBQWlDLElBRG5DO0FBRUVJLG9DQUE0QjtBQUY5QixPQUZGLEVBTUVaLFVBTkYsRUFPRUUsS0FQRjtBQVNBLHdCQUFPWSxVQUFVSSxNQUFqQixFQUF5QlQsRUFBekIsQ0FBNEJDLEVBQTVCLENBQStCQyxJQUEvQjtBQUNBLHdCQUFPSyxRQUFRRSxNQUFmLEVBQXVCVCxFQUF2QixDQUEwQkMsRUFBMUIsQ0FBNkJHLEtBQTdCO0FBQ0QsS0FkRDs7QUFnQkFSLE9BQUcscUVBQUgsRUFBMEUsTUFBTTtBQUM5RSxZQUFNUyxZQUFZLGdCQUFNQyxHQUFOLENBQVVkLFVBQVYsRUFBc0IseUJBQXRCLENBQWxCO0FBQ0EsWUFBTWUsVUFBVSxnQkFBTUQsR0FBTixDQUFVZCxVQUFWLEVBQXNCLG9CQUF0QixDQUFoQjtBQUNBLGtDQUFrQmdCLE1BQWxCLENBQXlCaEIsVUFBekIsRUFBcUMsRUFBQ1csNEJBQTRCLElBQTdCLEVBQXJDLEVBQXlFWixVQUF6RSxFQUFxRkUsS0FBckY7QUFDQSx3QkFBT1ksVUFBVUksTUFBakIsRUFBeUJULEVBQXpCLENBQTRCQyxFQUE1QixDQUErQkcsS0FBL0I7QUFDQSx3QkFBT0csUUFBUUUsTUFBZixFQUF1QlQsRUFBdkIsQ0FBMEJDLEVBQTFCLENBQTZCQyxJQUE3QjtBQUNELEtBTkQ7O0FBUUFOLE9BQUcsOERBQUgsRUFBbUUsTUFBTTtBQUN2RSx3QkFBTyxNQUFNLDRCQUFrQlksTUFBbEIsQ0FBeUJoQixVQUF6QixFQUFxQyxFQUFyQyxFQUF5Q0QsVUFBekMsRUFBcURFLEtBQXJELENBQWIsRUFBMEVPLEVBQTFFLENBQTZFVSxLQUE3RSxDQUFtRixFQUFuRjtBQUNELEtBRkQ7QUFHRCxHQTVCRDs7QUE4QkFwQixXQUFTLGdCQUFULEVBQTJCLE1BQU07QUFDL0JNLE9BQUcsMENBQUgsb0JBQStDLGFBQVk7QUFDekQsc0JBQU1lLElBQU4sQ0FBV25CLFVBQVgsRUFBdUIsb0JBQXZCLEVBQTZDb0IsUUFBN0MsQ0FBc0QsQ0FDcEQ7QUFDRW5CLGVBQU87QUFDTG9CLGlCQUFPLEVBQUNDLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCLEVBREY7QUFFTEMsZUFBSyxFQUFDRixNQUFNLENBQVAsRUFBVUMsV0FBVyxDQUFyQjtBQUZBLFNBRFQ7QUFLRUUsaUJBQVM7QUFMWCxPQURvRCxFQVFwRDtBQUNFeEIsZUFBTztBQUNMb0IsaUJBQU8sRUFBQ0MsTUFBTSxDQUFQLEVBQVVDLFdBQVcsRUFBckIsRUFERjtBQUVMQyxlQUFLLEVBQUNGLE1BQU0sRUFBUCxFQUFXQyxXQUFXLEVBQXRCO0FBRkEsU0FEVDtBQUtFRSxpQkFBUztBQUxYLE9BUm9ELENBQXREO0FBZ0JBLFlBQU1DLFNBQVMsTUFBTSw0QkFBa0JDLGNBQWxCLENBQWlDM0IsVUFBakMsRUFBNkNELFVBQTdDLENBQXJCO0FBQ0Esd0JBQU8yQixPQUFPRSxNQUFkLEVBQXNCcEIsRUFBdEIsQ0FBeUJxQixLQUF6QixDQUErQixDQUEvQjtBQUNBLHdCQUFPSCxPQUFPLENBQVAsRUFBVUQsT0FBakIsRUFBMEJqQixFQUExQixDQUE2QnFCLEtBQTdCLENBQW1DLEtBQW5DO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVSSxRQUFWLENBQW1CVCxLQUFuQixDQUF5QlUsR0FBaEMsRUFBcUN2QixFQUFyQyxDQUF3Q3FCLEtBQXhDLENBQThDLENBQTlDO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVSSxRQUFWLENBQW1CVCxLQUFuQixDQUF5QlcsTUFBaEMsRUFBd0N4QixFQUF4QyxDQUEyQ3FCLEtBQTNDLENBQWlELEVBQWpEO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVSSxRQUFWLENBQW1CTixHQUFuQixDQUF1Qk8sR0FBOUIsRUFBbUN2QixFQUFuQyxDQUFzQ3FCLEtBQXRDLENBQTRDLEVBQTVDO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVSSxRQUFWLENBQW1CTixHQUFuQixDQUF1QlEsTUFBOUIsRUFBc0N4QixFQUF0QyxDQUF5Q3FCLEtBQXpDLENBQStDLEVBQS9DO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVRCxPQUFqQixFQUEwQmpCLEVBQTFCLENBQTZCcUIsS0FBN0IsQ0FBbUMsS0FBbkM7QUFDRCxLQXpCRDtBQTBCRCxHQTNCRDs7QUE2QkEvQixXQUFTLGdDQUFULEVBQTJDLE1BQU07QUFDL0NNLE9BQUcsc0NBQUgsRUFBMkMsTUFBTTtBQUMvQyxzQkFBTWUsSUFBTixDQUFXcEIsVUFBWCxFQUF1QixTQUF2QixFQUFrQ2tDLE9BQWxDLENBQTBDLGNBQTFDO0FBQ0Esc0JBQU1kLElBQU4sQ0FBV3BCLFVBQVgsRUFBdUIsY0FBdkIsRUFBdUNrQyxPQUF2QyxDQUErQyxDQUEvQztBQUNBLHNCQUFNZCxJQUFOLENBQVdwQixVQUFYLEVBQXVCLGFBQXZCLEVBQXNDa0MsT0FBdEMsQ0FBOEMsS0FBOUM7O0FBRUEsWUFBTVAsU0FBUyw0QkFBa0JRLDhCQUFsQixDQUFpRG5DLFVBQWpELENBQWY7O0FBRUEsd0JBQU8yQixPQUFPUyxZQUFkLEVBQTRCM0IsRUFBNUIsQ0FBK0I0QixHQUEvQixDQUFtQyxFQUFDQyxLQUFLLHFCQUFOLEVBQW5DO0FBQ0Esd0JBQU9YLE9BQU9ZLE9BQVAsQ0FBZUMsT0FBdEIsRUFBK0IvQixFQUEvQixDQUFrQ3FCLEtBQWxDLENBQXdDLENBQXhDO0FBQ0Esd0JBQU9ILE9BQU9ZLE9BQVAsQ0FBZUUsWUFBdEIsRUFBb0NoQyxFQUFwQyxDQUF1Q3FCLEtBQXZDLENBQTZDLEtBQTdDO0FBQ0QsS0FWRDtBQVdELEdBWkQ7O0FBY0EvQixXQUFTLGFBQVQsRUFBd0IsTUFBTTtBQUM1Qk0sT0FBRywwQ0FBSCxvQkFBK0MsYUFBWTtBQUN6RCxzQkFBTWUsSUFBTixDQUFXbkIsVUFBWCxFQUF1Qix5QkFBdkIsRUFBa0RvQixRQUFsRCxDQUEyRCxDQUN6RDtBQUNFbkIsZUFBTztBQUNMb0IsaUJBQU8sRUFBQ0MsTUFBTSxDQUFQLEVBQVVDLFdBQVcsQ0FBckIsRUFERjtBQUVMQyxlQUFLLEVBQUNGLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCO0FBRkEsU0FEVDtBQUtFRSxpQkFBUztBQUxYLE9BRHlELEVBUXpEO0FBQ0V4QixlQUFPO0FBQ0xvQixpQkFBTyxFQUFDQyxNQUFNLENBQVAsRUFBVUMsV0FBVyxFQUFyQixFQURGO0FBRUxDLGVBQUssRUFBQ0YsTUFBTSxFQUFQLEVBQVdDLFdBQVcsRUFBdEI7QUFGQSxTQURUO0FBS0VFLGlCQUFTO0FBTFgsT0FSeUQsQ0FBM0Q7QUFnQkEsWUFBTUMsU0FBUyxNQUFNLDRCQUFrQmUsV0FBbEIsQ0FBOEJ6QyxVQUE5QixFQUEwQ0QsVUFBMUMsRUFBc0QsZ0JBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFWLEVBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBbEIsQ0FBdEQsQ0FBckI7QUFDQSx3QkFBTzJCLE9BQU9FLE1BQWQsRUFBc0JwQixFQUF0QixDQUF5QnFCLEtBQXpCLENBQStCLENBQS9CO0FBQ0Esd0JBQU9ILE9BQU8sQ0FBUCxFQUFVRCxPQUFqQixFQUEwQmpCLEVBQTFCLENBQTZCcUIsS0FBN0IsQ0FBbUMsS0FBbkM7QUFDQSx3QkFBT0gsT0FBTyxDQUFQLEVBQVVJLFFBQVYsQ0FBbUJULEtBQW5CLENBQXlCVSxHQUFoQyxFQUFxQ3ZCLEVBQXJDLENBQXdDcUIsS0FBeEMsQ0FBOEMsQ0FBOUM7QUFDQSx3QkFBT0gsT0FBTyxDQUFQLEVBQVVJLFFBQVYsQ0FBbUJULEtBQW5CLENBQXlCVyxNQUFoQyxFQUF3Q3hCLEVBQXhDLENBQTJDcUIsS0FBM0MsQ0FBaUQsRUFBakQ7QUFDQSx3QkFBT0gsT0FBTyxDQUFQLEVBQVVJLFFBQVYsQ0FBbUJOLEdBQW5CLENBQXVCTyxHQUE5QixFQUFtQ3ZCLEVBQW5DLENBQXNDcUIsS0FBdEMsQ0FBNEMsRUFBNUM7QUFDQSx3QkFBT0gsT0FBTyxDQUFQLEVBQVVJLFFBQVYsQ0FBbUJOLEdBQW5CLENBQXVCUSxNQUE5QixFQUFzQ3hCLEVBQXRDLENBQXlDcUIsS0FBekMsQ0FBK0MsRUFBL0M7QUFDQSx3QkFBT0gsT0FBTyxDQUFQLEVBQVVELE9BQWpCLEVBQTBCakIsRUFBMUIsQ0FBNkJxQixLQUE3QixDQUFtQyxLQUFuQztBQUNELEtBekJEO0FBMEJELEdBM0JEOztBQTZCQS9CLFdBQVMscUNBQVQsRUFBZ0QsTUFBTTtBQUNwRE0sT0FBRyxzQ0FBSCxFQUEyQyxNQUFNO0FBQy9DLHNCQUFNZSxJQUFOLENBQVdwQixVQUFYLEVBQXVCLFNBQXZCLEVBQWtDa0MsT0FBbEMsQ0FBMEMsY0FBMUM7QUFDQSxzQkFBTWQsSUFBTixDQUFXcEIsVUFBWCxFQUF1QixjQUF2QixFQUF1Q2tDLE9BQXZDLENBQStDLENBQS9DO0FBQ0Esc0JBQU1kLElBQU4sQ0FBV3BCLFVBQVgsRUFBdUIsYUFBdkIsRUFBc0NrQyxPQUF0QyxDQUE4QyxLQUE5Qzs7QUFFQSxZQUFNUCxTQUFTLDRCQUFrQmdCLG1DQUFsQixDQUFzRDNDLFVBQXRELEVBQWtFLGdCQUFVLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBVixFQUFrQixDQUFDLENBQUQsRUFBSSxDQUFKLENBQWxCLENBQWxFLENBQWY7O0FBRUEsd0JBQU8yQixPQUFPUyxZQUFkLEVBQTRCM0IsRUFBNUIsQ0FBK0I0QixHQUEvQixDQUFtQyxFQUFDQyxLQUFLLHFCQUFOLEVBQW5DO0FBQ0Esd0JBQU9YLE9BQU96QixLQUFkLEVBQXFCTyxFQUFyQixDQUF3QjRCLEdBQXhCLENBQTRCO0FBQzFCZixlQUFPLEVBQUNDLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCLEVBRG1CO0FBRTFCQyxhQUFLLEVBQUNGLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCO0FBRnFCLE9BQTVCO0FBSUEsd0JBQU9HLE9BQU9ZLE9BQVAsQ0FBZUMsT0FBdEIsRUFBK0IvQixFQUEvQixDQUFrQ3FCLEtBQWxDLENBQXdDLENBQXhDO0FBQ0Esd0JBQU9ILE9BQU9ZLE9BQVAsQ0FBZUUsWUFBdEIsRUFBb0NoQyxFQUFwQyxDQUF1Q3FCLEtBQXZDLENBQTZDLEtBQTdDO0FBQ0QsS0FkRDtBQWVELEdBaEJEOztBQWtCQS9CLFdBQVMsa0JBQVQsRUFBNkIsTUFBTTtBQUNqQ00sT0FBRyxzQ0FBSCxFQUEyQyxNQUFNO0FBQy9DLHNCQUFNZSxJQUFOLENBQVdwQixVQUFYLEVBQXVCLGNBQXZCLEVBQXVDa0MsT0FBdkMsQ0FBK0MsRUFBL0M7QUFDQSxZQUFNSyxVQUFVLDRCQUFrQkssZ0JBQWxCLENBQW1DNUMsVUFBbkMsQ0FBaEI7QUFDQSx3QkFBT3VDLFFBQVFDLE9BQWYsRUFBd0IvQixFQUF4QixDQUEyQnFCLEtBQTNCLENBQWlDLEVBQWpDO0FBQ0QsS0FKRDs7QUFNQXpCLE9BQUcsOENBQUgsRUFBbUQsTUFBTTtBQUN2RCxzQkFBTWUsSUFBTixDQUFXcEIsVUFBWCxFQUF1QixhQUF2QixFQUFzQ2tDLE9BQXRDLENBQThDLElBQTlDO0FBQ0EsWUFBTUssVUFBVSw0QkFBa0JLLGdCQUFsQixDQUFtQzVDLFVBQW5DLENBQWhCO0FBQ0Esd0JBQU91QyxRQUFRRSxZQUFmLEVBQTZCaEMsRUFBN0IsQ0FBZ0NDLEVBQWhDLENBQW1DQyxJQUFuQztBQUNELEtBSkQ7QUFLRCxHQVpEOztBQWNBWixXQUFTLG1CQUFULEVBQThCLE1BQU07QUFDbENNLE9BQUcsOENBQUgsRUFBbUQsTUFBTTtBQUN2RCxZQUFNd0MsV0FBVztBQUNmM0MsZUFBTztBQUNMb0IsaUJBQU8sRUFBQ0MsTUFBTSxDQUFQLEVBQVVDLFdBQVcsQ0FBckIsRUFERjtBQUVMQyxlQUFLLEVBQUNGLE1BQU0sQ0FBUCxFQUFVQyxXQUFXLENBQXJCO0FBRkEsU0FEUTtBQUtmRSxpQkFBUztBQUxNLE9BQWpCO0FBT0EsWUFBTUMsU0FBUyw0QkFBa0JtQixpQkFBbEIsQ0FBb0NELFFBQXBDLENBQWY7QUFDQSx3QkFBT2xCLE9BQU9JLFFBQWQsRUFBd0J0QixFQUF4QixDQUEyQjRCLEdBQTNCLENBQStCLGdCQUFVLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBVixFQUFrQixDQUFDLENBQUQsRUFBSSxDQUFKLENBQWxCLENBQS9CO0FBQ0Esd0JBQU9WLE9BQU9ELE9BQWQsRUFBdUJqQixFQUF2QixDQUEwQnFCLEtBQTFCLENBQWdDLFNBQWhDO0FBQ0QsS0FYRDtBQVlELEdBYkQ7QUFjRCxDQXBMRCIsImZpbGUiOiJjb2RlLWZvcm1hdC1hZGFwdGVyLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0IHtSYW5nZX0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcclxuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcclxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi4vLi4vbGliL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0IENvZGVGb3JtYXRBZGFwdGVyIGZyb20gJy4uLy4uL2xpYi9hZGFwdGVycy9jb2RlLWZvcm1hdC1hZGFwdGVyJztcclxuaW1wb3J0IHtjcmVhdGVTcHlDb25uZWN0aW9uLCBjcmVhdGVGYWtlRWRpdG9yfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcclxuXHJcbmRlc2NyaWJlKCdDb2RlRm9ybWF0QWRhcHRlcicsICgpID0+IHtcclxuICBsZXQgZmFrZUVkaXRvcjtcclxuICBsZXQgY29ubmVjdGlvbjtcclxuICBsZXQgcmFuZ2U7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcclxuICAgIGZha2VFZGl0b3IgPSBjcmVhdGVGYWtlRWRpdG9yKCk7XHJcbiAgICByYW5nZSA9IG5ldyBSYW5nZShbMCwgMF0sIFsxMDAsIDEwMF0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY2FuQWRhcHQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIHJhbmdlIGZvcm1hdHRpbmcgaXMgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdCh7XHJcbiAgICAgICAgZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQcm92aWRlcjogdHJ1ZSxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLnRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIGRvY3VtZW50IGZvcm1hdHRpbmcgaXMgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdCh7XHJcbiAgICAgICAgZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldHVybnMgZmFsc2UgaXQgbm8gZm9ybWF0dGluZyBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IENvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHt9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZmFsc2U7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Zvcm1hdCcsICgpID0+IHtcclxuICAgIGl0KCdwcmVmZXJzIHJhbmdlIGZvcm1hdHRpbmcgaWYgYXZhaWxhYmxlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByYW5nZVN0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nJyk7XHJcbiAgICAgIGNvbnN0IGRvY1N0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50Rm9ybWF0dGluZycpO1xyXG4gICAgICBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoXHJcbiAgICAgICAgY29ubmVjdGlvbixcclxuICAgICAgICB7XHJcbiAgICAgICAgICBkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxyXG4gICAgICAgICAgZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBmYWtlRWRpdG9yLFxyXG4gICAgICAgIHJhbmdlLFxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QocmFuZ2VTdHViLmNhbGxlZCkudG8uYmUudHJ1ZTtcclxuICAgICAgZXhwZWN0KGRvY1N0dWIuY2FsbGVkKS50by5iZS5mYWxzZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdmYWxscyBiYWNrIHRvIGRvY3VtZW50IGZvcm1hdHRpbmcgaWYgcmFuZ2UgZm9ybWF0dGluZyBub3QgYXZhaWxhYmxlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByYW5nZVN0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nJyk7XHJcbiAgICAgIGNvbnN0IGRvY1N0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50Rm9ybWF0dGluZycpO1xyXG4gICAgICBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoY29ubmVjdGlvbiwge2RvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlfSwgZmFrZUVkaXRvciwgcmFuZ2UpO1xyXG4gICAgICBleHBlY3QocmFuZ2VTdHViLmNhbGxlZCkudG8uYmUuZmFsc2U7XHJcbiAgICAgIGV4cGVjdChkb2NTdHViLmNhbGxlZCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCd0aHJvd3MgaWYgbmVpdGhlciByYW5nZSBvciBkb2N1bWVudCBmb3JtYXR0aW5nIGFyZSBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdCgoKSA9PiBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoY29ubmVjdGlvbiwge30sIGZha2VFZGl0b3IsIHJhbmdlKSkudG8udGhyb3coJycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdmb3JtYXREb2N1bWVudCcsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyB0aGUgcmVzdWx0cyBmcm9tIHRoZSBjb25uZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBzaW5vbi5zdHViKGNvbm5lY3Rpb24sICdkb2N1bWVudEZvcm1hdHRpbmcnKS5yZXNvbHZlcyhbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgICAgc3RhcnQ6IHtsaW5lOiAwLCBjaGFyYWN0ZXI6IDF9LFxyXG4gICAgICAgICAgICBlbmQ6IHtsaW5lOiAwLCBjaGFyYWN0ZXI6IDJ9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICdhYmMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgICAgc3RhcnQ6IHtsaW5lOiA1LCBjaGFyYWN0ZXI6IDEwfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMTUsIGNoYXJhY3RlcjogMjB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICdkZWYnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0pO1xyXG4gICAgICBjb25zdCBhY3R1YWwgPSBhd2FpdCBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXREb2N1bWVudChjb25uZWN0aW9uLCBmYWtlRWRpdG9yKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5sZW5ndGgpLnRvLmVxdWFsKDIpO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzBdLm5ld1RleHQpLnRvLmVxdWFsKCdhYmMnKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5yb3cpLnRvLmVxdWFsKDUpO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LmNvbHVtbikudG8uZXF1YWwoMTApO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLmVuZC5yb3cpLnRvLmVxdWFsKDE1KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQuY29sdW1uKS50by5lcXVhbCgyMCk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ubmV3VGV4dCkudG8uZXF1YWwoJ2RlZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGVEb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyB0aGUgdGFiIHNpemUgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xyXG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRQYXRoJykucmV0dXJucygnL2EvYi9jL2QudHh0Jyk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMSk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFNvZnRUYWJzJykucmV0dXJucyhmYWxzZSk7XHJcblxyXG4gICAgICBjb25zdCBhY3R1YWwgPSBDb2RlRm9ybWF0QWRhcHRlci5jcmVhdGVEb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMoZmFrZUVkaXRvcik7XHJcblxyXG4gICAgICBleHBlY3QoYWN0dWFsLnRleHREb2N1bWVudCkudG8uZXFsKHt1cmk6ICdmaWxlOi8vL2EvYi9jL2QudHh0J30pO1xyXG4gICAgICBleHBlY3QoYWN0dWFsLm9wdGlvbnMudGFiU2l6ZSkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwub3B0aW9ucy5pbnNlcnRTcGFjZXMpLnRvLmVxdWFsKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZm9ybWF0UmFuZ2UnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgdGhlIHJlc3VsdHMgZnJvbSB0aGUgY29ubmVjdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgc2lub24uc3R1Yihjb25uZWN0aW9uLCAnZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmcnKS5yZXNvbHZlcyhbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgICAgc3RhcnQ6IHtsaW5lOiAwLCBjaGFyYWN0ZXI6IDF9LFxyXG4gICAgICAgICAgICBlbmQ6IHtsaW5lOiAwLCBjaGFyYWN0ZXI6IDJ9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICdhYmMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgICAgc3RhcnQ6IHtsaW5lOiA1LCBjaGFyYWN0ZXI6IDEwfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMTUsIGNoYXJhY3RlcjogMjB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICdkZWYnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0pO1xyXG4gICAgICBjb25zdCBhY3R1YWwgPSBhd2FpdCBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXRSYW5nZShjb25uZWN0aW9uLCBmYWtlRWRpdG9yLCBuZXcgUmFuZ2UoWzAsIDBdLCBbMSwgMV0pKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5sZW5ndGgpLnRvLmVxdWFsKDIpO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzBdLm5ld1RleHQpLnRvLmVxdWFsKCdhYmMnKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5yb3cpLnRvLmVxdWFsKDUpO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LmNvbHVtbikudG8uZXF1YWwoMTApO1xyXG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLmVuZC5yb3cpLnRvLmVxdWFsKDE1KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQuY29sdW1uKS50by5lcXVhbCgyMCk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ubmV3VGV4dCkudG8uZXF1YWwoJ2RlZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGVEb2N1bWVudFJhbmdlRm9ybWF0dGluZ1BhcmFtcycsICgpID0+IHtcclxuICAgIGl0KCdyZXR1cm5zIHRoZSB0YWIgc2l6ZSBmcm9tIHRoZSBlZGl0b3InLCAoKSA9PiB7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFBhdGgnKS5yZXR1cm5zKCcvYS9iL2MvZC50eHQnKTtcclxuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0VGFiTGVuZ3RoJykucmV0dXJucygxKTtcclxuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0U29mdFRhYnMnKS5yZXR1cm5zKGZhbHNlKTtcclxuXHJcbiAgICAgIGNvbnN0IGFjdHVhbCA9IENvZGVGb3JtYXRBZGFwdGVyLmNyZWF0ZURvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUGFyYW1zKGZha2VFZGl0b3IsIG5ldyBSYW5nZShbMSwgMF0sIFsyLCAzXSkpO1xyXG5cclxuICAgICAgZXhwZWN0KGFjdHVhbC50ZXh0RG9jdW1lbnQpLnRvLmVxbCh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCd9KTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5yYW5nZSkudG8uZXFsKHtcclxuICAgICAgICBzdGFydDoge2xpbmU6IDEsIGNoYXJhY3RlcjogMH0sXHJcbiAgICAgICAgZW5kOiB7bGluZTogMiwgY2hhcmFjdGVyOiAzfSxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwub3B0aW9ucy50YWJTaXplKS50by5lcXVhbCgxKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLmluc2VydFNwYWNlcykudG8uZXF1YWwoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRGb3JtYXRPcHRpb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgdGhlIHRhYiBzaXplIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcclxuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0VGFiTGVuZ3RoJykucmV0dXJucygxNyk7XHJcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBDb2RlRm9ybWF0QWRhcHRlci5nZXRGb3JtYXRPcHRpb25zKGZha2VFZGl0b3IpO1xyXG4gICAgICBleHBlY3Qob3B0aW9ucy50YWJTaXplKS50by5lcXVhbCgxNyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0dXJucyB0aGUgc29mdCB0YWIgc2V0dGluZyBmcm9tIHRoZSBlZGl0b3InLCAoKSA9PiB7XHJcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFNvZnRUYWJzJykucmV0dXJucyh0cnVlKTtcclxuICAgICAgY29uc3Qgb3B0aW9ucyA9IENvZGVGb3JtYXRBZGFwdGVyLmdldEZvcm1hdE9wdGlvbnMoZmFrZUVkaXRvcik7XHJcbiAgICAgIGV4cGVjdChvcHRpb25zLmluc2VydFNwYWNlcykudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29udmVydExzVGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyBvbGRSYW5nZSBhbmQgbmV3VGV4dCBmcm9tIGEgdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRleHRFZGl0ID0ge1xyXG4gICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICBzdGFydDoge2xpbmU6IDEsIGNoYXJhY3RlcjogMH0sXHJcbiAgICAgICAgICBlbmQ6IHtsaW5lOiAyLCBjaGFyYWN0ZXI6IDN9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmV3VGV4dDogJ2FiYy1kZWYnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBhY3R1YWwgPSBDb2RlRm9ybWF0QWRhcHRlci5jb252ZXJ0THNUZXh0RWRpdCh0ZXh0RWRpdCk7XHJcbiAgICAgIGV4cGVjdChhY3R1YWwub2xkUmFuZ2UpLnRvLmVxbChuZXcgUmFuZ2UoWzEsIDBdLCBbMiwgM10pKTtcclxuICAgICAgZXhwZWN0KGFjdHVhbC5uZXdUZXh0KS50by5lcXVhbCgnYWJjLWRlZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=