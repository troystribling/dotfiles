var _linterPushV2Adapter = require('../../lib/adapters/linter-push-v2-adapter');

var _linterPushV2Adapter2 = _interopRequireDefault(_linterPushV2Adapter);

var _convert = require('../../lib/convert');

var _convert2 = _interopRequireDefault(_convert);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _chai = require('chai');

var _atom = require('atom');

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('LinterPushV2Adapter', () => {
  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  describe('constructor', () => {
    it('subscribes to onPublishDiagnostics', () => {
      const languageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
      _sinon2.default.spy(languageClient, 'onPublishDiagnostics');
      new _linterPushV2Adapter2.default(languageClient);
      (0, _chai.expect)(languageClient.onPublishDiagnostics.called).equals(true);
    });
  });

  describe('diagnosticToMessage', () => {
    it('converts Diagnostic and path to a linter$Message', () => {
      const filePath = '/a/b/c/d';
      const diagnostic = {
        message: 'This is a message',
        range: {
          start: { line: 1, character: 2 },
          end: { line: 3, character: 4 }
        },
        source: 'source',
        code: 'code',
        severity: ls.DiagnosticSeverity.Information,
        type: ls.DiagnosticSeverity.Information
      };

      const connection = { onPublishDiagnostics() {} };
      const adapter = new _linterPushV2Adapter2.default(connection);
      const result = adapter.diagnosticToV2Message(filePath, diagnostic);

      (0, _chai.expect)(result.excerpt).equals(diagnostic.message);
      (0, _chai.expect)(result.linterName).equals(diagnostic.source);
      (0, _chai.expect)(result.location.file).equals(filePath);
      (0, _chai.expect)(result.location.position).deep.equals(new _atom.Range(new _atom.Point(1, 2), new _atom.Point(3, 4)));
      (0, _chai.expect)(result.severity).equals('info');
    });
  });

  describe('diagnosticSeverityToSeverity', () => {
    it('converts DiagnosticSeverity.Error to "error"', () => {
      const severity = _linterPushV2Adapter2.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Error);
      (0, _chai.expect)(severity).equals('error');
    });

    it('converts DiagnosticSeverity.Warning to "warning"', () => {
      const severity = _linterPushV2Adapter2.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Warning);
      (0, _chai.expect)(severity).equals('warning');
    });

    it('converts DiagnosticSeverity.Information to "info"', () => {
      const severity = _linterPushV2Adapter2.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Information);
      (0, _chai.expect)(severity).equals('info');
    });

    it('converts DiagnosticSeverity.Hint to "info"', () => {
      const severity = _linterPushV2Adapter2.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Hint);
      (0, _chai.expect)(severity).equals('info');
    });
  });

  describe('captureDiagnostics', () => {
    it('stores diagnostic codes and allows their retrival', () => {
      const languageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
      const adapter = new _linterPushV2Adapter2.default(languageClient);
      const testPath = _path2.default.join(__dirname, 'test.txt');
      adapter.captureDiagnostics({
        uri: _convert2.default.pathToUri(testPath),
        diagnostics: [{
          message: 'Test message',
          range: {
            start: { line: 1, character: 2 },
            end: { line: 3, character: 4 }
          },
          source: 'source',
          code: 'test code',
          severity: ls.DiagnosticSeverity.Information,
          type: ls.DiagnosticSeverity.Information
        }]
      });

      const mockEditor = (0, _helpers.createFakeEditor)(testPath);
      (0, _chai.expect)(adapter.getDiagnosticCode(mockEditor, new _atom.Range([1, 2], [3, 4]), 'Test message')).to.equal('test code');
      (0, _chai.expect)(adapter.getDiagnosticCode(mockEditor, new _atom.Range([1, 2], [3, 4]), 'Test message2')).to.not.exist;
      (0, _chai.expect)(adapter.getDiagnosticCode(mockEditor, new _atom.Range([1, 2], [3, 5]), 'Test message')).to.not.exist;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvbGludGVyLXB1c2gtdjItYWRhcHRlci50ZXN0LmpzIl0sIm5hbWVzIjpbImxzIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiZ2xvYmFsIiwic2lub24iLCJzYW5kYm94IiwiY3JlYXRlIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsIml0IiwibGFuZ3VhZ2VDbGllbnQiLCJMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24iLCJzcHkiLCJvblB1Ymxpc2hEaWFnbm9zdGljcyIsImNhbGxlZCIsImVxdWFscyIsImZpbGVQYXRoIiwiZGlhZ25vc3RpYyIsIm1lc3NhZ2UiLCJyYW5nZSIsInN0YXJ0IiwibGluZSIsImNoYXJhY3RlciIsImVuZCIsInNvdXJjZSIsImNvZGUiLCJzZXZlcml0eSIsIkRpYWdub3N0aWNTZXZlcml0eSIsIkluZm9ybWF0aW9uIiwidHlwZSIsImNvbm5lY3Rpb24iLCJhZGFwdGVyIiwicmVzdWx0IiwiZGlhZ25vc3RpY1RvVjJNZXNzYWdlIiwiZXhjZXJwdCIsImxpbnRlck5hbWUiLCJsb2NhdGlvbiIsImZpbGUiLCJwb3NpdGlvbiIsImRlZXAiLCJkaWFnbm9zdGljU2V2ZXJpdHlUb1NldmVyaXR5IiwiRXJyb3IiLCJXYXJuaW5nIiwiSGludCIsInRlc3RQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImNhcHR1cmVEaWFnbm9zdGljcyIsInVyaSIsInBhdGhUb1VyaSIsImRpYWdub3N0aWNzIiwibW9ja0VkaXRvciIsImdldERpYWdub3N0aWNDb2RlIiwidG8iLCJlcXVhbCIsIm5vdCIsImV4aXN0Il0sIm1hcHBpbmdzIjoiQUFFQTs7OztBQUNBOzs7O0FBQ0E7O0lBQVlBLEU7O0FBQ1o7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQUMsU0FBUyxxQkFBVCxFQUFnQyxNQUFNO0FBQ3BDQyxhQUFXLE1BQU07QUFDZkMsV0FBT0MsS0FBUCxHQUFlLGdCQUFNQyxPQUFOLENBQWNDLE1B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QUFDLENBQUQsRUFBSSxDQUFKLENBQVYsRUFBa0IsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFsQixDQUF0QyxFQUFpRSxlQUFqRSxDQUFQLEVBQTBGRSxFQUExRixDQUE2RkUsR0FBN0YsQ0FBaUdDLEtBQWpHO0FBQ0Esd0JBQU96QixRQUFRcUIsaUJBQVIsQ0FBMEJELFVBQTFCLEVBQXNDLGdCQUFVLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBVixFQUFrQixDQUFDLENBQUQsRUFBSSxDQUFKLENBQWxCLENBQXRDLEVBQWlFLGNBQWpFLENBQVAsRUFBeUZFLEVBQXpGLENBQTRGRSxHQUE1RixDQUFnR0MsS0FBaEc7QUFDRCxLQXpCRDtBQTBCRCxHQTNCRDtBQTRCRCxDQTlGRCIsImZpbGUiOiJsaW50ZXItcHVzaC12Mi1hZGFwdGVyLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0IExpbnRlclB1c2hWMkFkYXB0ZXIgZnJvbSAnLi4vLi4vbGliL2FkYXB0ZXJzL2xpbnRlci1wdXNoLXYyLWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi8uLi9saWIvY29udmVydCc7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4uLy4uL2xpYi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xyXG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSc7XHJcbmltcG9ydCB7UG9pbnQsIFJhbmdlfSBmcm9tICdhdG9tJztcclxuaW1wb3J0IHtjcmVhdGVTcHlDb25uZWN0aW9uLCBjcmVhdGVGYWtlRWRpdG9yfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcclxuXHJcbmRlc2NyaWJlKCdMaW50ZXJQdXNoVjJBZGFwdGVyJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uLnJlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgaXQoJ3N1YnNjcmliZXMgdG8gb25QdWJsaXNoRGlhZ25vc3RpY3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxhbmd1YWdlQ2xpZW50ID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbihjcmVhdGVTcHlDb25uZWN0aW9uKCkpO1xyXG4gICAgICBzaW5vbi5zcHkobGFuZ3VhZ2VDbGllbnQsICdvblB1Ymxpc2hEaWFnbm9zdGljcycpO1xyXG4gICAgICBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihsYW5ndWFnZUNsaWVudCk7XHJcbiAgICAgIGV4cGVjdChsYW5ndWFnZUNsaWVudC5vblB1Ymxpc2hEaWFnbm9zdGljcy5jYWxsZWQpLmVxdWFscyh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGlhZ25vc3RpY1RvTWVzc2FnZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBEaWFnbm9zdGljIGFuZCBwYXRoIHRvIGEgbGludGVyJE1lc3NhZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gJy9hL2IvYy9kJztcclxuICAgICAgY29uc3QgZGlhZ25vc3RpYzogbHMuRGlhZ25vc3RpYyA9IHtcclxuICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhIG1lc3NhZ2UnLFxyXG4gICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICBzdGFydDoge2xpbmU6IDEsIGNoYXJhY3RlcjogMn0sXHJcbiAgICAgICAgICBlbmQ6IHtsaW5lOiAzLCBjaGFyYWN0ZXI6IDR9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc291cmNlOiAnc291cmNlJyxcclxuICAgICAgICBjb2RlOiAnY29kZScsXHJcbiAgICAgICAgc2V2ZXJpdHk6IGxzLkRpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbixcclxuICAgICAgICB0eXBlOiBscy5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb24sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBjb25uZWN0aW9uOiBhbnkgPSB7b25QdWJsaXNoRGlhZ25vc3RpY3MoKSB7fX07XHJcbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihjb25uZWN0aW9uKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYWRhcHRlci5kaWFnbm9zdGljVG9WMk1lc3NhZ2UoZmlsZVBhdGgsIGRpYWdub3N0aWMpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5leGNlcnB0KS5lcXVhbHMoZGlhZ25vc3RpYy5tZXNzYWdlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5saW50ZXJOYW1lKS5lcXVhbHMoZGlhZ25vc3RpYy5zb3VyY2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmxvY2F0aW9uLmZpbGUpLmVxdWFscyhmaWxlUGF0aCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubG9jYXRpb24ucG9zaXRpb24pLmRlZXAuZXF1YWxzKG5ldyBSYW5nZShuZXcgUG9pbnQoMSwgMiksIG5ldyBQb2ludCgzLCA0KSkpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS5lcXVhbHMoJ2luZm8nKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGlhZ25vc3RpY1NldmVyaXR5VG9TZXZlcml0eScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBEaWFnbm9zdGljU2V2ZXJpdHkuRXJyb3IgdG8gXCJlcnJvclwiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZXZlcml0eSA9IExpbnRlclB1c2hWMkFkYXB0ZXIuZGlhZ25vc3RpY1NldmVyaXR5VG9TZXZlcml0eShscy5EaWFnbm9zdGljU2V2ZXJpdHkuRXJyb3IpO1xyXG4gICAgICBleHBlY3Qoc2V2ZXJpdHkpLmVxdWFscygnZXJyb3InKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBEaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZyB0byBcIndhcm5pbmdcIicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBMaW50ZXJQdXNoVjJBZGFwdGVyLmRpYWdub3N0aWNTZXZlcml0eVRvU2V2ZXJpdHkobHMuRGlhZ25vc3RpY1NldmVyaXR5Lldhcm5pbmcpO1xyXG4gICAgICBleHBlY3Qoc2V2ZXJpdHkpLmVxdWFscygnd2FybmluZycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIERpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbiB0byBcImluZm9cIicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBMaW50ZXJQdXNoVjJBZGFwdGVyLmRpYWdub3N0aWNTZXZlcml0eVRvU2V2ZXJpdHkobHMuRGlhZ25vc3RpY1NldmVyaXR5LkluZm9ybWF0aW9uKTtcclxuICAgICAgZXhwZWN0KHNldmVyaXR5KS5lcXVhbHMoJ2luZm8nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBEaWFnbm9zdGljU2V2ZXJpdHkuSGludCB0byBcImluZm9cIicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBMaW50ZXJQdXNoVjJBZGFwdGVyLmRpYWdub3N0aWNTZXZlcml0eVRvU2V2ZXJpdHkobHMuRGlhZ25vc3RpY1NldmVyaXR5LkhpbnQpO1xyXG4gICAgICBleHBlY3Qoc2V2ZXJpdHkpLmVxdWFscygnaW5mbycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjYXB0dXJlRGlhZ25vc3RpY3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnc3RvcmVzIGRpYWdub3N0aWMgY29kZXMgYW5kIGFsbG93cyB0aGVpciByZXRyaXZhbCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbGFuZ3VhZ2VDbGllbnQgPSBuZXcgbHMuTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uKGNyZWF0ZVNweUNvbm5lY3Rpb24oKSk7XHJcbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihsYW5ndWFnZUNsaWVudCk7XHJcbiAgICAgIGNvbnN0IHRlc3RQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ3Rlc3QudHh0Jyk7XHJcbiAgICAgIGFkYXB0ZXIuY2FwdHVyZURpYWdub3N0aWNzKHtcclxuICAgICAgICB1cmk6IENvbnZlcnQucGF0aFRvVXJpKHRlc3RQYXRoKSxcclxuICAgICAgICBkaWFnbm9zdGljczogW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVGVzdCBtZXNzYWdlJyxcclxuICAgICAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgICAgICBzdGFydDoge2xpbmU6IDEsIGNoYXJhY3RlcjogMn0sXHJcbiAgICAgICAgICAgICAgZW5kOiB7bGluZTogMywgY2hhcmFjdGVyOiA0fSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc291cmNlOiAnc291cmNlJyxcclxuICAgICAgICAgICAgY29kZTogJ3Rlc3QgY29kZScsXHJcbiAgICAgICAgICAgIHNldmVyaXR5OiBscy5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb24sXHJcbiAgICAgICAgICAgIHR5cGU6IGxzLkRpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbixcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgXSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrRWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcih0ZXN0UGF0aCk7XHJcbiAgICAgIGV4cGVjdChhZGFwdGVyLmdldERpYWdub3N0aWNDb2RlKG1vY2tFZGl0b3IsIG5ldyBSYW5nZShbMSwgMl0sIFszLCA0XSksICdUZXN0IG1lc3NhZ2UnKSkudG8uZXF1YWwoJ3Rlc3QgY29kZScpO1xyXG4gICAgICBleHBlY3QoYWRhcHRlci5nZXREaWFnbm9zdGljQ29kZShtb2NrRWRpdG9yLCBuZXcgUmFuZ2UoWzEsIDJdLCBbMywgNF0pLCAnVGVzdCBtZXNzYWdlMicpKS50by5ub3QuZXhpc3Q7XHJcbiAgICAgIGV4cGVjdChhZGFwdGVyLmdldERpYWdub3N0aWNDb2RlKG1vY2tFZGl0b3IsIG5ldyBSYW5nZShbMSwgMl0sIFszLCA1XSksICdUZXN0IG1lc3NhZ2UnKSkudG8ubm90LmV4aXN0O1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=