var _convert = require('../lib/convert');

var _convert2 = _interopRequireDefault(_convert);

var _atom = require('atom');

var _chai = require('chai');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let originalPlatform;

const setProcessPlatform = platform => {
  Object.defineProperty(process, 'platform', { value: platform });
};

const createFakeEditor = (path, text) => {
  const editor = new _atom.TextEditor();
  editor.getBuffer().setPath(path);
  if (text != null) {
    editor.setText(text);
  }
  return editor;
};

describe('Convert', () => {
  beforeEach(() => {
    originalPlatform = process.platform;
  });
  afterEach(() => {
    Object.defineProperty(process, 'platform', { value: originalPlatform });
  });

  describe('pathToUri', () => {
    it('prefixes an absolute path with file://', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('prefixes an relative path with file:///', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    }); // TODO: Maybe don't do this in the function - should never be called with relative

    it('replaces backslashes with forward slashes', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a\\b\\c\\d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('does not encode Windows drive specifiers', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('d:\\ee\\ff.txt')).equals('file:///d:/ee/ff.txt');
    });

    it('URI encodes special characters', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/sp ace/do$lar')).equals('file:///a/sp%20ace/do$lar');
    });
  });

  describe('uriToPath', () => {
    it('converts a file:// path to an absolute path', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('/a/b/c/d.txt');
    });

    it('converts forward slashes to backslashes on Windows', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('a\\b\\c\\d.txt');
    });

    it('decodes Windows drive specifiers', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///d:/ee/ff.txt')).equals('d:\\ee\\ff.txt');
    });

    it('URI decodes special characters', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/sp%20ace/do$lar')).equals('/a/sp ace/do$lar');
    });
  });

  describe('pointToPosition', () => {
    it('converts an Atom Point to a LSP position', () => {
      const point = { row: 1, column: 2 };
      const position = _convert2.default.pointToPosition(point);
      (0, _chai.expect)(position.line).equals(point.row);
      (0, _chai.expect)(position.character).equals(point.column);
    });
  });

  describe('positionToPoint', () => {
    it('converts a LSP position to an Atom Point-array', () => {
      const position = { line: 3, character: 4 };
      const point = _convert2.default.positionToPoint(position);
      (0, _chai.expect)(point.row).equals(position.line);
      (0, _chai.expect)(point.column).equals(position.character);
    });
  });

  describe('lsRangeToAtomRange', () => {
    it('converts a LSP range to an Atom Range-array', () => {
      const lspRange = {
        start: { character: 5, line: 6 },
        end: { line: 7, character: 8 }
      };
      const atomRange = _convert2.default.lsRangeToAtomRange(lspRange);
      (0, _chai.expect)(atomRange.start.row).equals(lspRange.start.line);
      (0, _chai.expect)(atomRange.start.column).equals(lspRange.start.character);
      (0, _chai.expect)(atomRange.end.row).equals(lspRange.end.line);
      (0, _chai.expect)(atomRange.end.column).equals(lspRange.end.character);
    });
  });

  describe('atomRangeToLSRange', () => {
    it('converts an Atom range to a LSP Range-array', () => {
      const atomRange = new _atom.Range(new _atom.Point(9, 10), new _atom.Point(11, 12));
      const lspRange = _convert2.default.atomRangeToLSRange(atomRange);
      (0, _chai.expect)(lspRange.start.line).equals(atomRange.start.row);
      (0, _chai.expect)(lspRange.start.character).equals(atomRange.start.column);
      (0, _chai.expect)(lspRange.end.line).equals(atomRange.end.row);
      (0, _chai.expect)(lspRange.end.character).equals(atomRange.end.column);
    });
  });

  describe('editorToTextDocumentIdentifier', () => {
    it('uses getath which returns a path to create the URI', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const identifier = _convert2.default.editorToTextDocumentIdentifier(createFakeEditor(path));
      (0, _chai.expect)(identifier.uri).equals('file://' + path);
    });
  });

  describe('editorToTextDocumentPositionParams', () => {
    it('uses the editor cursor position when none specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const editor = createFakeEditor(path, 'abc\ndefgh\nijkl');
      editor.setCursorBufferPosition(new _atom.Point(1, 2));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 1, character: 2 });
    });

    it('uses the cursor position parameter when specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const specifiedPoint = new _atom.Point(911, 112);
      const editor = createFakeEditor(path, 'abcdef\nghijkl\nmnopq');
      editor.setCursorBufferPosition(new _atom.Point(1, 1));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor, specifiedPoint);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 911, character: 112 });
    });
  });

  describe('grammarScopesToTextEditorScopes', () => {
    it('converts a single grammarScope to an atom-text-editor scope', () => {
      const grammarScopes = ['abc.def'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"]');
    });

    it('converts a multiple grammarScopes to a comma-seperated list of atom-text-editor scopes', () => {
      const grammarScopes = ['abc.def', 'ghi.jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"], atom-text-editor[data-grammar="ghi jkl"]');
    });

    it('converts grammarScopes containing HTML sensitive characters to escaped sequences', () => {
      const grammarScopes = ['abc<def', 'ghi"jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc&lt;def"], atom-text-editor[data-grammar="ghi&quot;jkl"]');
    });
  });

  describe('encodeHTMLAttribute', () => {
    it('encodes characters that are not safe inside a HTML attribute', () => {
      const stringToEncode = 'a"b\'c&d>e<f';
      const encoded = _convert2.default.encodeHTMLAttribute(stringToEncode);
      (0, _chai.expect)(encoded).equals('a&quot;b&apos;c&amp;d&gt;e&lt;f');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvY29udmVydC50ZXN0LmpzIl0sIm5hbWVzIjpbIm9yaWdpbmFsUGxhdGZvcm0iLCJzZXRQcm9jZXNzUGxhdGZvcm0iLCJwbGF0Zm9ybSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwicHJvY2VzcyIsInZhbHVlIiwiY3JlYXRlRmFrZUVkaXRvciIsInBhdGgiLCJ0ZXh0IiwiZWRpdG9yIiwiZ2V0QnVmZmVyIiwic2V0UGF0aCIsInNldFRleHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJhZnRlckVhY2giLCJpdCIsInBhdGhUb1VyaSIsImVxdWFscyIsInVyaVRvUGF0aCIsInBvaW50Iiwicm93IiwiY29sdW1uIiwicG9zaXRpb24iLCJwb2ludFRvUG9zaXRpb24iLCJsaW5lIiwiY2hhcmFjdGVyIiwicG9zaXRpb25Ub1BvaW50IiwibHNwUmFuZ2UiLCJzdGFydCIsImVuZCIsImF0b21SYW5nZSIsImxzUmFuZ2VUb0F0b21SYW5nZSIsImF0b21SYW5nZVRvTFNSYW5nZSIsImlkZW50aWZpZXIiLCJlZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXIiLCJ1cmkiLCJzZXRDdXJzb3JCdWZmZXJQb3NpdGlvbiIsInBhcmFtcyIsImVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMiLCJ0ZXh0RG9jdW1lbnQiLCJkZWVwIiwic3BlY2lmaWVkUG9pbnQiLCJncmFtbWFyU2NvcGVzIiwidGV4dEVkaXRvclNjb3BlcyIsImdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMiLCJzdHJpbmdUb0VuY29kZSIsImVuY29kZWQiLCJlbmNvZGVIVE1MQXR0cmlidXRlIl0sIm1hcHBpbmdzIjoiQUFFQTs7OztBQUNBOztBQUNBOzs7O0FBRUEsSUFBSUEsZ0JBQUo7O0FBQ0EsTUFBTUMscUJBQXFCQyxZQUFZO0FBQ3JDQyxTQUFPQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixVQUEvQixFQUEyQyxFQUFDQyxPQUFPSixRQUFSLEVB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TUFBTTtBQUNqRyxZQUFNMkIsZ0JBQWdCLENBQUMsU0FBRCxFQUFZLFNBQVosQ0FBdEI7QUFDQSxZQUFNQyxtQkFBbUIsa0JBQVFDLCtCQUFSLENBQXdDRixhQUF4QyxDQUF6QjtBQUNBLHdCQUFPQyxnQkFBUCxFQUF5QjFCLE1BQXpCLENBQ0Usb0ZBREY7QUFHRCxLQU5EOztBQVFBRixPQUFHLGtGQUFILEVBQXVGLE1BQU07QUFDM0YsWUFBTTJCLGdCQUFnQixDQUFDLFNBQUQsRUFBWSxTQUFaLENBQXRCO0FBQ0EsWUFBTUMsbUJBQW1CLGtCQUFRQywrQkFBUixDQUF3Q0YsYUFBeEMsQ0FBekI7QUFDQSx3QkFBT0MsZ0JBQVAsRUFBeUIxQixNQUF6QixDQUNFLDRGQURGO0FBR0QsS0FORDtBQU9ELEdBdEJEOztBQXdCQUwsV0FBUyxxQkFBVCxFQUFnQyxNQUFNO0FBQ3BDRyxPQUFHLDhEQUFILEVBQW1FLE1BQU07QUFDdkUsWUFBTThCLGlCQUFpQixjQUF2QjtBQUNBLFlBQU1DLFVBQVUsa0JBQVFDLG1CQUFSLENBQTRCRixjQUE1QixDQUFoQjtBQUNBLHdCQUFPQyxPQUFQLEVBQWdCN0IsTUFBaEIsQ0FBdUIsaUNBQXZCO0FBQ0QsS0FKRDtBQUtELEdBTkQ7QUFPRCxDQTNKRCIsImZpbGUiOiJjb252ZXJ0LnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0IENvbnZlcnQgZnJvbSAnLi4vbGliL2NvbnZlcnQnO1xyXG5pbXBvcnQge1BvaW50LCBSYW5nZSwgVGV4dEVkaXRvcn0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcclxuXHJcbmxldCBvcmlnaW5hbFBsYXRmb3JtO1xyXG5jb25zdCBzZXRQcm9jZXNzUGxhdGZvcm0gPSBwbGF0Zm9ybSA9PiB7XHJcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogcGxhdGZvcm19KTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUZha2VFZGl0b3IgPSAocGF0aDogc3RyaW5nLCB0ZXh0OiA/c3RyaW5nKTogYXRvbSRUZXh0RWRpdG9yID0+IHtcclxuICBjb25zdCBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvcigpO1xyXG4gIGVkaXRvci5nZXRCdWZmZXIoKS5zZXRQYXRoKHBhdGgpO1xyXG4gIGlmICh0ZXh0ICE9IG51bGwpIHtcclxuICAgIGVkaXRvci5zZXRUZXh0KHRleHQpO1xyXG4gIH1cclxuICByZXR1cm4gZWRpdG9yO1xyXG59O1xyXG5cclxuZGVzY3JpYmUoJ0NvbnZlcnQnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBvcmlnaW5hbFBsYXRmb3JtID0gcHJvY2Vzcy5wbGF0Zm9ybTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogb3JpZ2luYWxQbGF0Zm9ybX0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncGF0aFRvVXJpJywgKCkgPT4ge1xyXG4gICAgaXQoJ3ByZWZpeGVzIGFuIGFic29sdXRlIHBhdGggd2l0aCBmaWxlOi8vJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwcmVmaXhlcyBhbiByZWxhdGl2ZSBwYXRoIHdpdGggZmlsZTovLy8nLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYS9iL2MvZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTsgLy8gVE9ETzogTWF5YmUgZG9uJ3QgZG8gdGhpcyBpbiB0aGUgZnVuY3Rpb24gLSBzaG91bGQgbmV2ZXIgYmUgY2FsbGVkIHdpdGggcmVsYXRpdmVcclxuXHJcbiAgICBpdCgncmVwbGFjZXMgYmFja3NsYXNoZXMgd2l0aCBmb3J3YXJkIHNsYXNoZXMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYVxcXFxiXFxcXGNcXFxcZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZG9lcyBub3QgZW5jb2RlIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCdkOlxcXFxlZVxcXFxmZi50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2Q6L2VlL2ZmLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ1VSSSBlbmNvZGVzIHNwZWNpYWwgY2hhcmFjdGVycycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCcvYS9zcCBhY2UvZG8kbGFyJykpLmVxdWFscygnZmlsZTovLy9hL3NwJTIwYWNlL2RvJGxhcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd1cmlUb1BhdGgnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYSBmaWxlOi8vIHBhdGggdG8gYW4gYWJzb2x1dGUgcGF0aCcsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgZm9yd2FyZCBzbGFzaGVzIHRvIGJhY2tzbGFzaGVzIG9uIFdpbmRvd3MnLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnYVxcXFxiXFxcXGNcXFxcZC50eHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWNvZGVzIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCd3aW4zMicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6Ly8vZDovZWUvZmYudHh0JykpLmVxdWFscygnZDpcXFxcZWVcXFxcZmYudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnVVJJIGRlY29kZXMgc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6Ly8vYS9zcCUyMGFjZS9kbyRsYXInKSkuZXF1YWxzKCcvYS9zcCBhY2UvZG8kbGFyJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3BvaW50VG9Qb3NpdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIFBvaW50IHRvIGEgTFNQIHBvc2l0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwb2ludCA9IHtyb3c6IDEsIGNvbHVtbjogMn07XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gQ29udmVydC5wb2ludFRvUG9zaXRpb24ocG9pbnQpO1xyXG4gICAgICBleHBlY3QocG9zaXRpb24ubGluZSkuZXF1YWxzKHBvaW50LnJvdyk7XHJcbiAgICAgIGV4cGVjdChwb3NpdGlvbi5jaGFyYWN0ZXIpLmVxdWFscyhwb2ludC5jb2x1bW4pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwb3NpdGlvblRvUG9pbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYSBMU1AgcG9zaXRpb24gdG8gYW4gQXRvbSBQb2ludC1hcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgcG9zaXRpb24gPSB7bGluZTogMywgY2hhcmFjdGVyOiA0fTtcclxuICAgICAgY29uc3QgcG9pbnQgPSBDb252ZXJ0LnBvc2l0aW9uVG9Qb2ludChwb3NpdGlvbik7XHJcbiAgICAgIGV4cGVjdChwb2ludC5yb3cpLmVxdWFscyhwb3NpdGlvbi5saW5lKTtcclxuICAgICAgZXhwZWN0KHBvaW50LmNvbHVtbikuZXF1YWxzKHBvc2l0aW9uLmNoYXJhY3Rlcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2xzUmFuZ2VUb0F0b21SYW5nZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhIExTUCByYW5nZSB0byBhbiBBdG9tIFJhbmdlLWFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsc3BSYW5nZSA9IHtcclxuICAgICAgICBzdGFydDoge2NoYXJhY3RlcjogNSwgbGluZTogNn0sXHJcbiAgICAgICAgZW5kOiB7bGluZTogNywgY2hhcmFjdGVyOiA4fSxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgYXRvbVJhbmdlID0gQ29udmVydC5sc1JhbmdlVG9BdG9tUmFuZ2UobHNwUmFuZ2UpO1xyXG4gICAgICBleHBlY3QoYXRvbVJhbmdlLnN0YXJ0LnJvdykuZXF1YWxzKGxzcFJhbmdlLnN0YXJ0LmxpbmUpO1xyXG4gICAgICBleHBlY3QoYXRvbVJhbmdlLnN0YXJ0LmNvbHVtbikuZXF1YWxzKGxzcFJhbmdlLnN0YXJ0LmNoYXJhY3Rlcik7XHJcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2UuZW5kLnJvdykuZXF1YWxzKGxzcFJhbmdlLmVuZC5saW5lKTtcclxuICAgICAgZXhwZWN0KGF0b21SYW5nZS5lbmQuY29sdW1uKS5lcXVhbHMobHNwUmFuZ2UuZW5kLmNoYXJhY3Rlcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2F0b21SYW5nZVRvTFNSYW5nZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIHJhbmdlIHRvIGEgTFNQIFJhbmdlLWFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhdG9tUmFuZ2UgPSBuZXcgUmFuZ2UobmV3IFBvaW50KDksIDEwKSwgbmV3IFBvaW50KDExLCAxMikpO1xyXG4gICAgICBjb25zdCBsc3BSYW5nZSA9IENvbnZlcnQuYXRvbVJhbmdlVG9MU1JhbmdlKGF0b21SYW5nZSk7XHJcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5saW5lKS5lcXVhbHMoYXRvbVJhbmdlLnN0YXJ0LnJvdyk7XHJcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5jaGFyYWN0ZXIpLmVxdWFscyhhdG9tUmFuZ2Uuc3RhcnQuY29sdW1uKTtcclxuICAgICAgZXhwZWN0KGxzcFJhbmdlLmVuZC5saW5lKS5lcXVhbHMoYXRvbVJhbmdlLmVuZC5yb3cpO1xyXG4gICAgICBleHBlY3QobHNwUmFuZ2UuZW5kLmNoYXJhY3RlcikuZXF1YWxzKGF0b21SYW5nZS5lbmQuY29sdW1uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3VzZXMgZ2V0YXRoIHdoaWNoIHJldHVybnMgYSBwYXRoIHRvIGNyZWF0ZSB0aGUgVVJJJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXRoID0gJy9jL2QvZS9mL2cvaC9pL2oudHh0JztcclxuICAgICAgY29uc3QgaWRlbnRpZmllciA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKGNyZWF0ZUZha2VFZGl0b3IocGF0aCkpO1xyXG4gICAgICBleHBlY3QoaWRlbnRpZmllci51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcycsICgpID0+IHtcclxuICAgIGl0KCd1c2VzIHRoZSBlZGl0b3IgY3Vyc29yIHBvc2l0aW9uIHdoZW4gbm9uZSBzcGVjaWZpZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xyXG4gICAgICBjb25zdCBlZGl0b3IgPSBjcmVhdGVGYWtlRWRpdG9yKHBhdGgsICdhYmNcXG5kZWZnaFxcbmlqa2wnKTtcclxuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKG5ldyBQb2ludCgxLCAyKSk7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhlZGl0b3IpO1xyXG4gICAgICBleHBlY3QocGFyYW1zLnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcclxuICAgICAgZXhwZWN0KHBhcmFtcy5wb3NpdGlvbikuZGVlcC5lcXVhbHMoe2xpbmU6IDEsIGNoYXJhY3RlcjogMn0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3VzZXMgdGhlIGN1cnNvciBwb3NpdGlvbiBwYXJhbWV0ZXIgd2hlbiBzcGVjaWZpZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xyXG4gICAgICBjb25zdCBzcGVjaWZpZWRQb2ludCA9IG5ldyBQb2ludCg5MTEsIDExMik7XHJcbiAgICAgIGNvbnN0IGVkaXRvciA9IGNyZWF0ZUZha2VFZGl0b3IocGF0aCwgJ2FiY2RlZlxcbmdoaWprbFxcbm1ub3BxJyk7XHJcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihuZXcgUG9pbnQoMSwgMSkpO1xyXG4gICAgICBjb25zdCBwYXJhbXMgPSBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMoZWRpdG9yLCBzcGVjaWZpZWRQb2ludCk7XHJcbiAgICAgIGV4cGVjdChwYXJhbXMudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xyXG4gICAgICBleHBlY3QocGFyYW1zLnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogOTExLCBjaGFyYWN0ZXI6IDExMn0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIGEgc2luZ2xlIGdyYW1tYXJTY29wZSB0byBhbiBhdG9tLXRleHQtZWRpdG9yIHNjb3BlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmMuZGVmJ107XHJcbiAgICAgIGNvbnN0IHRleHRFZGl0b3JTY29wZXMgPSBDb252ZXJ0LmdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blcyk7XHJcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjIGRlZlwiXScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGEgbXVsdGlwbGUgZ3JhbW1hclNjb3BlcyB0byBhIGNvbW1hLXNlcGVyYXRlZCBsaXN0IG9mIGF0b20tdGV4dC1lZGl0b3Igc2NvcGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmMuZGVmJywgJ2doaS5qa2wnXTtcclxuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcclxuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpLmVxdWFscyhcclxuICAgICAgICAnYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJhYmMgZGVmXCJdLCBhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImdoaSBqa2xcIl0nLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGdyYW1tYXJTY29wZXMgY29udGFpbmluZyBIVE1MIHNlbnNpdGl2ZSBjaGFyYWN0ZXJzIHRvIGVzY2FwZWQgc2VxdWVuY2VzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmM8ZGVmJywgJ2doaVwiamtsJ107XHJcbiAgICAgIGNvbnN0IHRleHRFZGl0b3JTY29wZXMgPSBDb252ZXJ0LmdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blcyk7XHJcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoXHJcbiAgICAgICAgJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjJmx0O2RlZlwiXSwgYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJnaGkmcXVvdDtqa2xcIl0nLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlbmNvZGVIVE1MQXR0cmlidXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2VuY29kZXMgY2hhcmFjdGVycyB0aGF0IGFyZSBub3Qgc2FmZSBpbnNpZGUgYSBIVE1MIGF0dHJpYnV0ZScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3RyaW5nVG9FbmNvZGUgPSAnYVwiYlxcJ2MmZD5lPGYnO1xyXG4gICAgICBjb25zdCBlbmNvZGVkID0gQ29udmVydC5lbmNvZGVIVE1MQXR0cmlidXRlKHN0cmluZ1RvRW5jb2RlKTtcclxuICAgICAgZXhwZWN0KGVuY29kZWQpLmVxdWFscygnYSZxdW90O2ImYXBvcztjJmFtcDtkJmd0O2UmbHQ7ZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=