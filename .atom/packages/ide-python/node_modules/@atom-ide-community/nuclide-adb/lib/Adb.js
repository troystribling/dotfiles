"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Adb = void 0;

var _assert = _interopRequireDefault(require("assert"));

var _nuclideUri = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/nuclideUri"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _ps = require("./common/ps");

var _process = require("@atom-ide-community/nuclide-commons/process");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
const ADB_TIMEOUT = 5000;

class Adb {
  constructor(serial) {
    this._serial = void 0;
    this._serial = serial;
  }

  getAndroidProp(key) {
    return this.runShortCommand('shell', 'getprop', key).map(s => s.trim());
  }

  getDeviceArchitecture() {
    return this.getAndroidProp('ro.product.cpu.abi');
  }

  async getInstalledPackages() {
    const prefix = 'package:';
    const stdout = await this.runShortCommand('shell', 'pm', 'list', 'packages').toPromise();
    return stdout.trim().split(/\s+/).map(s => s.substring(prefix.length));
  }

  async isPackageInstalled(pkg) {
    const packages = await this.getInstalledPackages();
    return packages.includes(pkg);
  }

  getDeviceModel() {
    return this.getAndroidProp('ro.product.model').map(s => s === 'sdk' ? 'emulator' : s);
  }

  getAPIVersion() {
    return this.getAndroidProp('ro.build.version.sdk');
  }

  getBrand() {
    return this.getAndroidProp('ro.product.brand');
  }

  getManufacturer() {
    return this.getAndroidProp('ro.product.manufacturer');
  }

  getDeviceInfo() {
    const unknownCB = () => _rxjsCompatUmdMin.Observable.of('');

    return _rxjsCompatUmdMin.Observable.forkJoin(this.getDeviceArchitecture().catch(unknownCB), this.getAPIVersion().catch(unknownCB), this.getDeviceModel().catch(unknownCB), this.getOSVersion().catch(unknownCB), this.getManufacturer().catch(unknownCB), this.getBrand().catch(unknownCB), this.getWifiIp().catch(unknownCB)).map(([architecture, apiVersion, model, android_version, manufacturer, brand, wifi_ip]) => {
      return new Map([['name', this._serial], ['adb_port', '5037'], ['architecture', architecture], ['api_version', apiVersion], ['model', model], ['android_version', android_version], ['manufacturer', manufacturer], ['brand', brand], ['wifi_ip', wifi_ip]]);
    });
  }

  getWifiIp() {
    return this.runShortCommand('shell', 'ip', 'addr', 'show', 'wlan0').map(lines => {
      const line = lines.split(/\n/).filter(l => l.includes('inet'))[0];

      if (line == null) {
        return '';
      }

      const rawIp = line.trim().split(/\s+/)[1];
      return rawIp.substring(0, rawIp.indexOf('/'));
    });
  } // In some android devices, we have to kill the package, not the process.
  // http://stackoverflow.com/questions/17154961/adb-shell-operation-not-permitted


  async stopProcess(packageName, pid) {
    await Promise.all([this.runShortCommand('shell', 'am', 'force-stop', packageName).toPromise(), this.runShortCommand('shell', 'kill', '-9', `${pid}`).toPromise(), this.runShortCommand('shell', 'run-as', packageName, 'kill', '-9', `${pid}`).toPromise()]);
  }

  getOSVersion() {
    return this.getAndroidProp('ro.build.version.release');
  }

  installPackage(packagePath) {
    (0, _assert.default)(!_nuclideUri.default.isRemote(packagePath));
    return this.getAPIVersion().map(version => parseInt(version, 10) >= 17).catch(() => _rxjsCompatUmdMin.Observable.of(false)).switchMap(canUseDowngradeOption => this.runLongCommandNew(...['install', '-r', // The -d option allows downgrades, which happen frequently during development.
    ...(canUseDowngradeOption ? ['-d'] : []), packagePath])) // adb install sends a lot of identical progress events to stdout, deduplicate them
    .distinctUntilChanged((a, b) => {
      if (a.kind === 'stdout' && b.kind === 'stdout') {
        return a.data === b.data;
      } else {
        return false;
      }
    });
  }

  uninstallPackage(packageName) {
    // TODO(T17463635)
    return this.runLongCommand('uninstall', packageName);
  }

  async getForwardSpec(pid) {
    const specLines = await this.runShortCommand('forward', '--list').toPromise();
    const specs = specLines.split(/\n/).map(line => {
      const cols = line.split(/\s+/);
      return {
        spec: cols[1],
        target: cols[2]
      };
    });
    const matchingSpec = specs.find(spec => spec.target === `jdwp:${pid}`);

    if (matchingSpec != null) {
      return matchingSpec.spec;
    }

    return null;
  }

  async forwardJdwpPortToPid(tcpPort, pid) {
    await this.runShortCommand('forward', `tcp:${tcpPort}`, `jdwp:${pid}`).toPromise();
    return this.getForwardSpec(pid);
  }

  async removeJdwpForwardSpec(spec) {
    let output;
    let result = '';

    if (spec != null) {
      output = this.runLongCommand('forward', '--remove', spec);
    } else {
      output = this.runLongCommand('forward', '--remove-all');
    }

    const subscription = output.subscribe(processMessage => {
      switch (processMessage.kind) {
        case 'stdout':
        case 'stderr':
          result += processMessage.data + '\n';
          break;
      }
    });
    await output.toPromise();
    subscription.unsubscribe();
    return result;
  }

  async launchActivity(packageName, activity, debug, action, parameters) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'am', 'start'];

    if (action != null) {
      args.push('-a', action);
    }

    if (parameters != null) {
      for (const [key, parameter] of parameters) {
        args.push('-e', key, parameter);
      }
    }

    args.push('-W', '-n');
    args.push(`${packageName}/${activity}`);
    return this.runShortCommand(...args).toPromise();
  }

  async launchMainActivity(packageName, debug) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'monkey', '-p', `${packageName}`, '-c', 'android.intent.category.LAUNCHER', '1'];
    return this.runShortCommand(...args).toPromise();
  }

  async launchService(packageName, serviceName, debug) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'am', 'startservice', `${packageName}/${serviceName}`];
    return this.runShortCommand(...args).toPromise();
  }

  setDebugApp(packageName, persist) {
    const args = ['shell', 'am', 'set-debug-app', '-w'];

    if (persist) {
      args.push('--persistent');
    }

    args.push(`${packageName}`);
    return this.runShortCommand(...args).toPromise();
  }

  _dumpsysPackage() {
    return this.runShortCommand('shell', 'dumpsys', 'package');
  }

  activityExists(packageName, activity) {
    const packageActivityString = `${packageName}/${activity}`;
    return this._dumpsysPackage().map(stdout => stdout.includes(packageActivityString)).toPromise();
  }

  getAllAvailablePackages() {
    return this._dumpsysPackage().map(stdout => stdout.split('\n').map(line => line.trim())).toPromise();
  }

  touchFile(path) {
    return this.runShortCommand('shell', 'touch', path).toPromise();
  }

  removeFile(path) {
    return this.runShortCommand('shell', 'rm', path).toPromise();
  }

  getDebuggableProcesses() {
    return this.getJavaProcesses();
  }

  getJavaProcesses() {
    const jdwpProcesses = new Set();
    return this.runPsCommand().map(stdout => {
      const psOutput = stdout.trim();
      return (0, _ps.parsePsTableOutput)(psOutput, ['user', 'pid', 'name']);
    }).switchMap(allProcesses => {
      const map = new Map();
      allProcesses.filter(row => row != null).forEach(proc => map.set(proc.pid, proc));
      return Promise.resolve(map);
    }).switchMap(allProcessesMap => {
      return this.runLongCommand('jdwp').map(output => {
        if (output.kind === 'stdout') {
          const block = output.data;
          block.split(/\s+/).forEach(pid => {
            const proc = allProcessesMap.get(pid);

            if (proc != null) {
              jdwpProcesses.add(proc);
            }
          });
        }
      });
    }).timeout(1000).catch(error => _rxjsCompatUmdMin.Observable.of([])).switchMap(() => {
      return Promise.resolve(Array.from(jdwpProcesses));
    });
  }

  async dumpsysPackage(pkg) {
    if (!(await this.isPackageInstalled(pkg))) {
      return null;
    }

    return this.runShortCommand('shell', 'dumpsys', 'package', pkg).toPromise();
  }

  getDeviceArgs() {
    return this._serial !== '' ? ['-s', this._serial] : [];
  }

  getProcesses() {
    return this.runPsCommand().map(stdout => stdout.split(/\n/).map(line => {
      const info = line.trim().split(/\s+/);
      return {
        user: info[0],
        pid: info[1],
        name: info[info.length - 1]
      };
    }));
  }

  runPsCommand(...additionalCommands) {
    return this.getAPIVersion().switchMap(apiVersion => {
      let commands = ['shell', 'ps']; // Starting with Android 8.0 Oreo (API 26) ps only returns all processes
      // with -A

      if (parseInt(apiVersion, 10) >= 26) {
        commands.push('-A');
      }

      commands = commands.concat(additionalCommands);
      return this.runShortCommand(...commands);
    });
  }

  runShortCommand(...command) {
    return (0, _process.runCommand)('adb', this.getDeviceArgs().concat(command));
  }

  runLongCommand(...command) {
    // TODO(T17463635)
    return (0, _process.observeProcess)('adb', this.getDeviceArgs().concat(command), {
      killTreeWhenDone: true,

      /* TODO(T17353599) */
      isExitError: () => false
    }).catch(error => _rxjsCompatUmdMin.Observable.of({
      kind: 'error',
      error
    })); // TODO(T17463635)
  }

  runLongCommandNew(...command) {
    return (0, _process.observeProcess)('adb', this.getDeviceArgs().concat(command), {
      killTreeWhenDone: true
    });
  }

  static _parseDevicesCommandOutput(stdout) {
    const nameFrequency = new Map();
    return stdout.split(/\n+/g).slice(1).filter(s => s.length > 0 && !s.trim().startsWith('*')).map(s => s.split(/\s+/g)).filter(a => a[0] !== '').map(a => {
      const serial = a[0];
      const props = a.slice(2);
      let product;
      let model;
      let device;
      let usb;
      let transportId;

      for (const prop of props) {
        const pair = prop.split(':');

        if (pair.length !== 2) {
          continue;
        }

        switch (pair[0]) {
          case 'product':
            product = pair[1];
            break;

          case 'model':
            model = pair[1];
            break;

          case 'device':
            device = pair[1];
            break;

          case 'usb':
            usb = pair[1];
            break;

          case 'transport_id':
            transportId = pair[1];
            break;

          default:
            break;
        }
      }

      const displayName = serial.startsWith('emulator') || serial.startsWith('localhost:') || model == null ? serial : model;
      const count = nameFrequency.get(displayName);

      if (count == null) {
        nameFrequency.set(displayName, 1);
      } else {
        nameFrequency.set(displayName, count + 1);
      }

      return {
        serial,
        displayName,
        product,
        model,
        device,
        usb,
        transportId
      };
    }).map(device => {
      const {
        displayName,
        serial
      } = device;

      if (displayName === serial || nameFrequency.get(displayName) === 1) {
        return device;
      } else {
        return { ...device,
          displayName: `${displayName} - ${serial}`
        };
      }
    });
  }

  static getDevices() {
    return (0, _process.runCommand)('adb', ['devices', '-l']).map(stdout => this._parseDevicesCommandOutput(stdout)).timeout(ADB_TIMEOUT).toPromise();
  }

  static killServer() {
    return (0, _process.runCommand)('adb', ['kill-server']).mapTo(undefined).toPromise();
  }

  static getVersion() {
    return (0, _process.runCommand)('adb', ['version']).map(versionString => {
      const version = versionString.match(/version (\d+.\d+.\d+)/);

      if (version) {
        return version[1];
      }

      throw new Error(`No version found with "${versionString}"`);
    }).toPromise();
  }

}

exports.Adb = Adb;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL251Y2xpZGUvbnVjbGlkZS1hZGIvbGliL0FkYi5qcyJdLCJuYW1lcyI6WyJBREJfVElNRU9VVCIsIkFkYiIsImNvbnN0cnVjdG9yIiwic2VyaWFsIiwiX3NlcmlhbCIsImdldEFuZHJvaWRQcm9wIiwia2V5IiwicnVuU2hvcnRDb21tYW5kIiwibWFwIiwicyIsInRyaW0iLCJnZXREZXZpY2VBcmNoaXRlY3R1cmUiLCJnZXRJbnN0YWxsZWRQYWNrYWdlcyIsInByZWZpeCIsInN0ZG91dCIsInRvUHJvbWlzZSIsInNwbGl0Iiwic3Vic3RyaW5nIiwibGVuZ3RoIiwiaXNQYWNrYWdlSW5zdGFsbGVkIiwicGtnIiwicGFja2FnZXMiLCJpbmNsdWRlcyIsImdldERldmljZU1vZGVsIiwiZ2V0QVBJVmVyc2lvbiIsImdldEJyYW5kIiwiZ2V0TWFudWZhY3R1cmVyIiwiZ2V0RGV2aWNlSW5mbyIsInVua25vd25DQiIsIk9ic2VydmFibGUiLCJvZiIsImZvcmtKb2luIiwiY2F0Y2giLCJnZXRPU1ZlcnNpb24iLCJnZXRXaWZpSXAiLCJhcmNoaXRlY3R1cmUiLCJhcGlWZXJzaW9uIiwibW9kZWwiLCJhbmRyb2lkX3ZlcnNpb24iLCJtYW51ZmFjdHVyZXIiLCJicmFuZCIsIndpZmlfaXAiLCJNYXAiLCJsaW5lcyIsImxpbmUiLCJmaWx0ZXIiLCJsIiwicmF3SXAiLCJpbmRleE9mIiwic3RvcFByb2Nlc3MiLCJwYWNrYWdlTmFtZSIsInBpZCIsIlByb21pc2UiLCJhbGwiLCJpbnN0YWxsUGFja2FnZSIsInBhY2thZ2VQYXRoIiwibnVjbGlkZVVyaSIsImlzUmVtb3RlIiwidmVyc2lvbiIsInBhcnNlSW50Iiwic3dpdGNoTWFwIiwiY2FuVXNlRG93bmdyYWRlT3B0aW9uIiwicnVuTG9uZ0NvbW1hbmROZXciLCJkaXN0aW5jdFVudGlsQ2hhbmdlZCIsImEiLCJiIiwia2luZCIsImRhdGEiLCJ1bmluc3RhbGxQYWNrYWdlIiwicnVuTG9uZ0NvbW1hbmQiLCJnZXRGb3J3YXJkU3BlYyIsInNwZWNMaW5lcyIsInNwZWNzIiwiY29scyIsInNwZWMiLCJ0YXJnZXQiLCJtYXRjaGluZ1NwZWMiLCJmaW5kIiwiZm9yd2FyZEpkd3BQb3J0VG9QaWQiLCJ0Y3BQb3J0IiwicmVtb3ZlSmR3cEZvcndhcmRTcGVjIiwib3V0cHV0IiwicmVzdWx0Iiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlIiwicHJvY2Vzc01lc3NhZ2UiLCJ1bnN1YnNjcmliZSIsImxhdW5jaEFjdGl2aXR5IiwiYWN0aXZpdHkiLCJkZWJ1ZyIsImFjdGlvbiIsInBhcmFtZXRlcnMiLCJzZXREZWJ1Z0FwcCIsImFyZ3MiLCJwdXNoIiwicGFyYW1ldGVyIiwibGF1bmNoTWFpbkFjdGl2aXR5IiwibGF1bmNoU2VydmljZSIsInNlcnZpY2VOYW1lIiwicGVyc2lzdCIsIl9kdW1wc3lzUGFja2FnZSIsImFjdGl2aXR5RXhpc3RzIiwicGFja2FnZUFjdGl2aXR5U3RyaW5nIiwiZ2V0QWxsQXZhaWxhYmxlUGFja2FnZXMiLCJ0b3VjaEZpbGUiLCJwYXRoIiwicmVtb3ZlRmlsZSIsImdldERlYnVnZ2FibGVQcm9jZXNzZXMiLCJnZXRKYXZhUHJvY2Vzc2VzIiwiamR3cFByb2Nlc3NlcyIsIlNldCIsInJ1blBzQ29tbWFuZCIsInBzT3V0cHV0IiwiYWxsUHJvY2Vzc2VzIiwicm93IiwiZm9yRWFjaCIsInByb2MiLCJzZXQiLCJyZXNvbHZlIiwiYWxsUHJvY2Vzc2VzTWFwIiwiYmxvY2siLCJnZXQiLCJhZGQiLCJ0aW1lb3V0IiwiZXJyb3IiLCJBcnJheSIsImZyb20iLCJkdW1wc3lzUGFja2FnZSIsImdldERldmljZUFyZ3MiLCJnZXRQcm9jZXNzZXMiLCJpbmZvIiwidXNlciIsIm5hbWUiLCJhZGRpdGlvbmFsQ29tbWFuZHMiLCJjb21tYW5kcyIsImNvbmNhdCIsImNvbW1hbmQiLCJraWxsVHJlZVdoZW5Eb25lIiwiaXNFeGl0RXJyb3IiLCJfcGFyc2VEZXZpY2VzQ29tbWFuZE91dHB1dCIsIm5hbWVGcmVxdWVuY3kiLCJzbGljZSIsInN0YXJ0c1dpdGgiLCJwcm9wcyIsInByb2R1Y3QiLCJkZXZpY2UiLCJ1c2IiLCJ0cmFuc3BvcnRJZCIsInByb3AiLCJwYWlyIiwiZGlzcGxheU5hbWUiLCJjb3VudCIsImdldERldmljZXMiLCJraWxsU2VydmVyIiwibWFwVG8iLCJ1bmRlZmluZWQiLCJnZXRWZXJzaW9uIiwidmVyc2lvblN0cmluZyIsIm1hdGNoIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUF2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWVBLE1BQU1BLFdBQVcsR0FBRyxJQUFwQjs7QUFFTyxNQUFNQyxHQUFOLENBQVU7QUFHZkMsRUFBQUEsV0FBVyxDQUFDQyxNQUFELEVBQWlCO0FBQUEsU0FGNUJDLE9BRTRCO0FBQzFCLFNBQUtBLE9BQUwsR0FBZUQsTUFBZjtBQUNEOztBQUVERSxFQUFBQSxjQUFjLENBQUNDLEdBQUQsRUFBa0M7QUFDOUMsV0FBTyxLQUFLQyxlQUFMLENBQXFCLE9BQXJCLEVBQThCLFNBQTlCLEVBQXlDRCxHQUF6QyxFQUE4Q0UsR0FBOUMsQ0FBa0RDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxJQUFGLEVBQXZELENBQVA7QUFDRDs7QUFFREMsRUFBQUEscUJBQXFCLEdBQXVCO0FBQzFDLFdBQU8sS0FBS04sY0FBTCxDQUFvQixvQkFBcEIsQ0FBUDtBQUNEOztBQUV5QixRQUFwQk8sb0JBQW9CLEdBQTJCO0FBQ25ELFVBQU1DLE1BQU0sR0FBRyxVQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHLE1BQU0sS0FBS1AsZUFBTCxDQUNuQixPQURtQixFQUVuQixJQUZtQixFQUduQixNQUhtQixFQUluQixVQUptQixFQUtuQlEsU0FMbUIsRUFBckI7QUFNQSxXQUFPRCxNQUFNLENBQ1ZKLElBREksR0FFSk0sS0FGSSxDQUVFLEtBRkYsRUFHSlIsR0FISSxDQUdBQyxDQUFDLElBQUlBLENBQUMsQ0FBQ1EsU0FBRixDQUFZSixNQUFNLENBQUNLLE1BQW5CLENBSEwsQ0FBUDtBQUlEOztBQUV1QixRQUFsQkMsa0JBQWtCLENBQUNDLEdBQUQsRUFBZ0M7QUFDdEQsVUFBTUMsUUFBUSxHQUFHLE1BQU0sS0FBS1Qsb0JBQUwsRUFBdkI7QUFDQSxXQUFPUyxRQUFRLENBQUNDLFFBQVQsQ0FBa0JGLEdBQWxCLENBQVA7QUFDRDs7QUFFREcsRUFBQUEsY0FBYyxHQUF1QjtBQUNuQyxXQUFPLEtBQUtsQixjQUFMLENBQW9CLGtCQUFwQixFQUF3Q0csR0FBeEMsQ0FDTEMsQ0FBQyxJQUFLQSxDQUFDLEtBQUssS0FBTixHQUFjLFVBQWQsR0FBMkJBLENBRDVCLENBQVA7QUFHRDs7QUFFRGUsRUFBQUEsYUFBYSxHQUF1QjtBQUNsQyxXQUFPLEtBQUtuQixjQUFMLENBQW9CLHNCQUFwQixDQUFQO0FBQ0Q7O0FBRURvQixFQUFBQSxRQUFRLEdBQXVCO0FBQzdCLFdBQU8sS0FBS3BCLGNBQUwsQ0FBb0Isa0JBQXBCLENBQVA7QUFDRDs7QUFFRHFCLEVBQUFBLGVBQWUsR0FBdUI7QUFDcEMsV0FBTyxLQUFLckIsY0FBTCxDQUFvQix5QkFBcEIsQ0FBUDtBQUNEOztBQUVEc0IsRUFBQUEsYUFBYSxHQUFvQztBQUMvQyxVQUFNQyxTQUFTLEdBQUcsTUFBTUMsNkJBQVdDLEVBQVgsQ0FBYyxFQUFkLENBQXhCOztBQUNBLFdBQU9ELDZCQUFXRSxRQUFYLENBQ0wsS0FBS3BCLHFCQUFMLEdBQTZCcUIsS0FBN0IsQ0FBbUNKLFNBQW5DLENBREssRUFFTCxLQUFLSixhQUFMLEdBQXFCUSxLQUFyQixDQUEyQkosU0FBM0IsQ0FGSyxFQUdMLEtBQUtMLGNBQUwsR0FBc0JTLEtBQXRCLENBQTRCSixTQUE1QixDQUhLLEVBSUwsS0FBS0ssWUFBTCxHQUFvQkQsS0FBcEIsQ0FBMEJKLFNBQTFCLENBSkssRUFLTCxLQUFLRixlQUFMLEdBQXVCTSxLQUF2QixDQUE2QkosU0FBN0IsQ0FMSyxFQU1MLEtBQUtILFFBQUwsR0FBZ0JPLEtBQWhCLENBQXNCSixTQUF0QixDQU5LLEVBT0wsS0FBS00sU0FBTCxHQUFpQkYsS0FBakIsQ0FBdUJKLFNBQXZCLENBUEssRUFRTHBCLEdBUkssQ0FTTCxDQUFDLENBQ0MyQixZQURELEVBRUNDLFVBRkQsRUFHQ0MsS0FIRCxFQUlDQyxlQUpELEVBS0NDLFlBTEQsRUFNQ0MsS0FORCxFQU9DQyxPQVBELENBQUQsS0FRTTtBQUNKLGFBQU8sSUFBSUMsR0FBSixDQUFRLENBQ2IsQ0FBQyxNQUFELEVBQVMsS0FBS3RDLE9BQWQsQ0FEYSxFQUViLENBQUMsVUFBRCxFQUFhLE1BQWIsQ0FGYSxFQUdiLENBQUMsY0FBRCxFQUFpQitCLFlBQWpCLENBSGEsRUFJYixDQUFDLGFBQUQsRUFBZ0JDLFVBQWhCLENBSmEsRUFLYixDQUFDLE9BQUQsRUFBVUMsS0FBVixDQUxhLEVBTWIsQ0FBQyxpQkFBRCxFQUFvQkMsZUFBcEIsQ0FOYSxFQU9iLENBQUMsY0FBRCxFQUFpQkMsWUFBakIsQ0FQYSxFQVFiLENBQUMsT0FBRCxFQUFVQyxLQUFWLENBUmEsRUFTYixDQUFDLFNBQUQsRUFBWUMsT0FBWixDQVRhLENBQVIsQ0FBUDtBQVdELEtBN0JJLENBQVA7QUErQkQ7O0FBRURQLEVBQUFBLFNBQVMsR0FBdUI7QUFDOUIsV0FBTyxLQUFLM0IsZUFBTCxDQUFxQixPQUFyQixFQUE4QixJQUE5QixFQUFvQyxNQUFwQyxFQUE0QyxNQUE1QyxFQUFvRCxPQUFwRCxFQUE2REMsR0FBN0QsQ0FDTG1DLEtBQUssSUFBSTtBQUNQLFlBQU1DLElBQUksR0FBR0QsS0FBSyxDQUFDM0IsS0FBTixDQUFZLElBQVosRUFBa0I2QixNQUFsQixDQUF5QkMsQ0FBQyxJQUFJQSxDQUFDLENBQUN4QixRQUFGLENBQVcsTUFBWCxDQUE5QixFQUFrRCxDQUFsRCxDQUFiOztBQUNBLFVBQUlzQixJQUFJLElBQUksSUFBWixFQUFrQjtBQUNoQixlQUFPLEVBQVA7QUFDRDs7QUFDRCxZQUFNRyxLQUFLLEdBQUdILElBQUksQ0FBQ2xDLElBQUwsR0FBWU0sS0FBWixDQUFrQixLQUFsQixFQUF5QixDQUF6QixDQUFkO0FBQ0EsYUFBTytCLEtBQUssQ0FBQzlCLFNBQU4sQ0FBZ0IsQ0FBaEIsRUFBbUI4QixLQUFLLENBQUNDLE9BQU4sQ0FBYyxHQUFkLENBQW5CLENBQVA7QUFDRCxLQVJJLENBQVA7QUFVRCxHQWxHYyxDQW9HZjtBQUNBOzs7QUFDaUIsUUFBWEMsV0FBVyxDQUFDQyxXQUFELEVBQXNCQyxHQUF0QixFQUFrRDtBQUNqRSxVQUFNQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxDQUNoQixLQUFLOUMsZUFBTCxDQUNFLE9BREYsRUFFRSxJQUZGLEVBR0UsWUFIRixFQUlFMkMsV0FKRixFQUtFbkMsU0FMRixFQURnQixFQU9oQixLQUFLUixlQUFMLENBQXFCLE9BQXJCLEVBQThCLE1BQTlCLEVBQXNDLElBQXRDLEVBQTZDLEdBQUU0QyxHQUFJLEVBQW5ELEVBQXNEcEMsU0FBdEQsRUFQZ0IsRUFRaEIsS0FBS1IsZUFBTCxDQUNFLE9BREYsRUFFRSxRQUZGLEVBR0UyQyxXQUhGLEVBSUUsTUFKRixFQUtFLElBTEYsRUFNRyxHQUFFQyxHQUFJLEVBTlQsRUFPRXBDLFNBUEYsRUFSZ0IsQ0FBWixDQUFOO0FBaUJEOztBQUVEa0IsRUFBQUEsWUFBWSxHQUF1QjtBQUNqQyxXQUFPLEtBQUs1QixjQUFMLENBQW9CLDBCQUFwQixDQUFQO0FBQ0Q7O0FBRURpRCxFQUFBQSxjQUFjLENBQUNDLFdBQUQsRUFBc0Q7QUFDbEUseUJBQVUsQ0FBQ0Msb0JBQVdDLFFBQVgsQ0FBb0JGLFdBQXBCLENBQVg7QUFDQSxXQUNFLEtBQUsvQixhQUFMLEdBQ0doQixHQURILENBQ09rRCxPQUFPLElBQUlDLFFBQVEsQ0FBQ0QsT0FBRCxFQUFVLEVBQVYsQ0FBUixJQUF5QixFQUQzQyxFQUVHMUIsS0FGSCxDQUVTLE1BQU1ILDZCQUFXQyxFQUFYLENBQWMsS0FBZCxDQUZmLEVBR0c4QixTQUhILENBR2FDLHFCQUFxQixJQUM5QixLQUFLQyxpQkFBTCxDQUNFLEdBQUcsQ0FDRCxTQURDLEVBRUQsSUFGQyxFQUdEO0FBQ0EsUUFBSUQscUJBQXFCLEdBQUcsQ0FBQyxJQUFELENBQUgsR0FBWSxFQUFyQyxDQUpDLEVBS0ROLFdBTEMsQ0FETCxDQUpKLEVBY0U7QUFkRixLQWVHUSxvQkFmSCxDQWV3QixDQUFDQyxDQUFELEVBQUlDLENBQUosS0FBVTtBQUM5QixVQUFJRCxDQUFDLENBQUNFLElBQUYsS0FBVyxRQUFYLElBQXVCRCxDQUFDLENBQUNDLElBQUYsS0FBVyxRQUF0QyxFQUFnRDtBQUM5QyxlQUFPRixDQUFDLENBQUNHLElBQUYsS0FBV0YsQ0FBQyxDQUFDRSxJQUFwQjtBQUNELE9BRkQsTUFFTztBQUNMLGVBQU8sS0FBUDtBQUNEO0FBQ0YsS0FyQkgsQ0FERjtBQXdCRDs7QUFFREMsRUFBQUEsZ0JBQWdCLENBQUNsQixXQUFELEVBQXdEO0FBQ3RFO0FBQ0EsV0FBTyxLQUFLbUIsY0FBTCxDQUFvQixXQUFwQixFQUFpQ25CLFdBQWpDLENBQVA7QUFDRDs7QUFFbUIsUUFBZG9CLGNBQWMsQ0FBQ25CLEdBQUQsRUFBZ0M7QUFDbEQsVUFBTW9CLFNBQVMsR0FBRyxNQUFNLEtBQUtoRSxlQUFMLENBQ3RCLFNBRHNCLEVBRXRCLFFBRnNCLEVBR3RCUSxTQUhzQixFQUF4QjtBQUlBLFVBQU15RCxLQUFLLEdBQUdELFNBQVMsQ0FBQ3ZELEtBQVYsQ0FBZ0IsSUFBaEIsRUFBc0JSLEdBQXRCLENBQTBCb0MsSUFBSSxJQUFJO0FBQzlDLFlBQU02QixJQUFJLEdBQUc3QixJQUFJLENBQUM1QixLQUFMLENBQVcsS0FBWCxDQUFiO0FBQ0EsYUFBTztBQUNMMEQsUUFBQUEsSUFBSSxFQUFFRCxJQUFJLENBQUMsQ0FBRCxDQURMO0FBRUxFLFFBQUFBLE1BQU0sRUFBRUYsSUFBSSxDQUFDLENBQUQ7QUFGUCxPQUFQO0FBSUQsS0FOYSxDQUFkO0FBT0EsVUFBTUcsWUFBWSxHQUFHSixLQUFLLENBQUNLLElBQU4sQ0FBV0gsSUFBSSxJQUFJQSxJQUFJLENBQUNDLE1BQUwsS0FBaUIsUUFBT3hCLEdBQUksRUFBL0MsQ0FBckI7O0FBQ0EsUUFBSXlCLFlBQVksSUFBSSxJQUFwQixFQUEwQjtBQUN4QixhQUFPQSxZQUFZLENBQUNGLElBQXBCO0FBQ0Q7O0FBQ0QsV0FBTyxJQUFQO0FBQ0Q7O0FBRXlCLFFBQXBCSSxvQkFBb0IsQ0FBQ0MsT0FBRCxFQUFrQjVCLEdBQWxCLEVBQWlEO0FBQ3pFLFVBQU0sS0FBSzVDLGVBQUwsQ0FDSixTQURJLEVBRUgsT0FBTXdFLE9BQVEsRUFGWCxFQUdILFFBQU81QixHQUFJLEVBSFIsRUFJSnBDLFNBSkksRUFBTjtBQUtBLFdBQU8sS0FBS3VELGNBQUwsQ0FBb0JuQixHQUFwQixDQUFQO0FBQ0Q7O0FBRTBCLFFBQXJCNkIscUJBQXFCLENBQUNOLElBQUQsRUFBaUM7QUFDMUQsUUFBSU8sTUFBSjtBQUNBLFFBQUlDLE1BQU0sR0FBRyxFQUFiOztBQUNBLFFBQUlSLElBQUksSUFBSSxJQUFaLEVBQWtCO0FBQ2hCTyxNQUFBQSxNQUFNLEdBQUcsS0FBS1osY0FBTCxDQUFvQixTQUFwQixFQUErQixVQUEvQixFQUEyQ0ssSUFBM0MsQ0FBVDtBQUNELEtBRkQsTUFFTztBQUNMTyxNQUFBQSxNQUFNLEdBQUcsS0FBS1osY0FBTCxDQUFvQixTQUFwQixFQUErQixjQUEvQixDQUFUO0FBQ0Q7O0FBRUQsVUFBTWMsWUFBWSxHQUFHRixNQUFNLENBQUNHLFNBQVAsQ0FBaUJDLGNBQWMsSUFBSTtBQUN0RCxjQUFRQSxjQUFjLENBQUNuQixJQUF2QjtBQUNFLGFBQUssUUFBTDtBQUNBLGFBQUssUUFBTDtBQUNFZ0IsVUFBQUEsTUFBTSxJQUFJRyxjQUFjLENBQUNsQixJQUFmLEdBQXNCLElBQWhDO0FBQ0E7QUFKSjtBQU1ELEtBUG9CLENBQXJCO0FBUUEsVUFBTWMsTUFBTSxDQUFDbEUsU0FBUCxFQUFOO0FBQ0FvRSxJQUFBQSxZQUFZLENBQUNHLFdBQWI7QUFDQSxXQUFPSixNQUFQO0FBQ0Q7O0FBRW1CLFFBQWRLLGNBQWMsQ0FDbEJyQyxXQURrQixFQUVsQnNDLFFBRmtCLEVBR2xCQyxLQUhrQixFQUlsQkMsTUFKa0IsRUFLbEJDLFVBTGtCLEVBTUQ7QUFDakIsUUFBSUYsS0FBSixFQUFXO0FBQ1Q7QUFDQTtBQUNBLFlBQU0sS0FBS0csV0FBTCxDQUFpQjFDLFdBQWpCLEVBQThCLEtBQTlCLENBQU47QUFDRDs7QUFFRCxVQUFNMkMsSUFBSSxHQUFHLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0IsT0FBaEIsQ0FBYjs7QUFDQSxRQUFJSCxNQUFNLElBQUksSUFBZCxFQUFvQjtBQUNsQkcsTUFBQUEsSUFBSSxDQUFDQyxJQUFMLENBQVUsSUFBVixFQUFnQkosTUFBaEI7QUFDRDs7QUFDRCxRQUFJQyxVQUFVLElBQUksSUFBbEIsRUFBd0I7QUFDdEIsV0FBSyxNQUFNLENBQUNyRixHQUFELEVBQU15RixTQUFOLENBQVgsSUFBK0JKLFVBQS9CLEVBQTJDO0FBQ3pDRSxRQUFBQSxJQUFJLENBQUNDLElBQUwsQ0FBVSxJQUFWLEVBQWdCeEYsR0FBaEIsRUFBcUJ5RixTQUFyQjtBQUNEO0FBQ0Y7O0FBQ0RGLElBQUFBLElBQUksQ0FBQ0MsSUFBTCxDQUFVLElBQVYsRUFBZ0IsSUFBaEI7QUFDQUQsSUFBQUEsSUFBSSxDQUFDQyxJQUFMLENBQVcsR0FBRTVDLFdBQVksSUFBR3NDLFFBQVMsRUFBckM7QUFDQSxXQUFPLEtBQUtqRixlQUFMLENBQXFCLEdBQUdzRixJQUF4QixFQUE4QjlFLFNBQTlCLEVBQVA7QUFDRDs7QUFFdUIsUUFBbEJpRixrQkFBa0IsQ0FDdEI5QyxXQURzQixFQUV0QnVDLEtBRnNCLEVBR0w7QUFDakIsUUFBSUEsS0FBSixFQUFXO0FBQ1Q7QUFDQTtBQUNBLFlBQU0sS0FBS0csV0FBTCxDQUFpQjFDLFdBQWpCLEVBQThCLEtBQTlCLENBQU47QUFDRDs7QUFFRCxVQUFNMkMsSUFBSSxHQUFHLENBQ1gsT0FEVyxFQUVYLFFBRlcsRUFHWCxJQUhXLEVBSVYsR0FBRTNDLFdBQVksRUFKSixFQUtYLElBTFcsRUFNWCxrQ0FOVyxFQU9YLEdBUFcsQ0FBYjtBQVNBLFdBQU8sS0FBSzNDLGVBQUwsQ0FBcUIsR0FBR3NGLElBQXhCLEVBQThCOUUsU0FBOUIsRUFBUDtBQUNEOztBQUVrQixRQUFia0YsYUFBYSxDQUNqQi9DLFdBRGlCLEVBRWpCZ0QsV0FGaUIsRUFHakJULEtBSGlCLEVBSUE7QUFDakIsUUFBSUEsS0FBSixFQUFXO0FBQ1Q7QUFDQTtBQUNBLFlBQU0sS0FBS0csV0FBTCxDQUFpQjFDLFdBQWpCLEVBQThCLEtBQTlCLENBQU47QUFDRDs7QUFFRCxVQUFNMkMsSUFBSSxHQUFHLENBQ1gsT0FEVyxFQUVYLElBRlcsRUFHWCxjQUhXLEVBSVYsR0FBRTNDLFdBQVksSUFBR2dELFdBQVksRUFKbkIsQ0FBYjtBQU1BLFdBQU8sS0FBSzNGLGVBQUwsQ0FBcUIsR0FBR3NGLElBQXhCLEVBQThCOUUsU0FBOUIsRUFBUDtBQUNEOztBQUVENkUsRUFBQUEsV0FBVyxDQUFDMUMsV0FBRCxFQUFzQmlELE9BQXRCLEVBQXlEO0FBQ2xFLFVBQU1OLElBQUksR0FBRyxDQUFDLE9BQUQsRUFBVSxJQUFWLEVBQWdCLGVBQWhCLEVBQWlDLElBQWpDLENBQWI7O0FBRUEsUUFBSU0sT0FBSixFQUFhO0FBQ1hOLE1BQUFBLElBQUksQ0FBQ0MsSUFBTCxDQUFVLGNBQVY7QUFDRDs7QUFDREQsSUFBQUEsSUFBSSxDQUFDQyxJQUFMLENBQVcsR0FBRTVDLFdBQVksRUFBekI7QUFDQSxXQUFPLEtBQUszQyxlQUFMLENBQXFCLEdBQUdzRixJQUF4QixFQUE4QjlFLFNBQTlCLEVBQVA7QUFDRDs7QUFFRHFGLEVBQUFBLGVBQWUsR0FBdUI7QUFDcEMsV0FBTyxLQUFLN0YsZUFBTCxDQUFxQixPQUFyQixFQUE4QixTQUE5QixFQUF5QyxTQUF6QyxDQUFQO0FBQ0Q7O0FBRUQ4RixFQUFBQSxjQUFjLENBQUNuRCxXQUFELEVBQXNCc0MsUUFBdEIsRUFBMEQ7QUFDdEUsVUFBTWMscUJBQXFCLEdBQUksR0FBRXBELFdBQVksSUFBR3NDLFFBQVMsRUFBekQ7QUFDQSxXQUFPLEtBQUtZLGVBQUwsR0FDSjVGLEdBREksQ0FDQU0sTUFBTSxJQUFJQSxNQUFNLENBQUNRLFFBQVAsQ0FBZ0JnRixxQkFBaEIsQ0FEVixFQUVKdkYsU0FGSSxFQUFQO0FBR0Q7O0FBRUR3RixFQUFBQSx1QkFBdUIsR0FBMkI7QUFDaEQsV0FBTyxLQUFLSCxlQUFMLEdBQ0o1RixHQURJLENBQ0FNLE1BQU0sSUFBSUEsTUFBTSxDQUFDRSxLQUFQLENBQWEsSUFBYixFQUFtQlIsR0FBbkIsQ0FBdUJvQyxJQUFJLElBQUlBLElBQUksQ0FBQ2xDLElBQUwsRUFBL0IsQ0FEVixFQUVKSyxTQUZJLEVBQVA7QUFHRDs7QUFFRHlGLEVBQUFBLFNBQVMsQ0FBQ0MsSUFBRCxFQUFnQztBQUN2QyxXQUFPLEtBQUtsRyxlQUFMLENBQXFCLE9BQXJCLEVBQThCLE9BQTlCLEVBQXVDa0csSUFBdkMsRUFBNkMxRixTQUE3QyxFQUFQO0FBQ0Q7O0FBRUQyRixFQUFBQSxVQUFVLENBQUNELElBQUQsRUFBZ0M7QUFDeEMsV0FBTyxLQUFLbEcsZUFBTCxDQUFxQixPQUFyQixFQUE4QixJQUE5QixFQUFvQ2tHLElBQXBDLEVBQTBDMUYsU0FBMUMsRUFBUDtBQUNEOztBQUVENEYsRUFBQUEsc0JBQXNCLEdBQXFDO0FBQ3pELFdBQU8sS0FBS0MsZ0JBQUwsRUFBUDtBQUNEOztBQUVEQSxFQUFBQSxnQkFBZ0IsR0FBMEM7QUFDeEQsVUFBTUMsYUFBYSxHQUFHLElBQUlDLEdBQUosRUFBdEI7QUFDQSxXQUFPLEtBQUtDLFlBQUwsR0FDSnZHLEdBREksQ0FDQU0sTUFBTSxJQUFJO0FBQ2IsWUFBTWtHLFFBQVEsR0FBR2xHLE1BQU0sQ0FBQ0osSUFBUCxFQUFqQjtBQUNBLGFBQU8sNEJBQW1Cc0csUUFBbkIsRUFBNkIsQ0FBQyxNQUFELEVBQVMsS0FBVCxFQUFnQixNQUFoQixDQUE3QixDQUFQO0FBQ0QsS0FKSSxFQUtKcEQsU0FMSSxDQUtNcUQsWUFBWSxJQUFJO0FBQ3pCLFlBQU16RyxHQUFHLEdBQUcsSUFBSWtDLEdBQUosRUFBWjtBQUNBdUUsTUFBQUEsWUFBWSxDQUNUcEUsTUFESCxDQUNVcUUsR0FBRyxJQUFJQSxHQUFHLElBQUksSUFEeEIsRUFFR0MsT0FGSCxDQUVXQyxJQUFJLElBQUk1RyxHQUFHLENBQUM2RyxHQUFKLENBQVFELElBQUksQ0FBQ2pFLEdBQWIsRUFBa0JpRSxJQUFsQixDQUZuQjtBQUdBLGFBQU9oRSxPQUFPLENBQUNrRSxPQUFSLENBQWdCOUcsR0FBaEIsQ0FBUDtBQUNELEtBWEksRUFZSm9ELFNBWkksQ0FZTTJELGVBQWUsSUFBSTtBQUM1QixhQUFPLEtBQUtsRCxjQUFMLENBQW9CLE1BQXBCLEVBQTRCN0QsR0FBNUIsQ0FBZ0N5RSxNQUFNLElBQUk7QUFDL0MsWUFBSUEsTUFBTSxDQUFDZixJQUFQLEtBQWdCLFFBQXBCLEVBQThCO0FBQzVCLGdCQUFNc0QsS0FBYSxHQUFHdkMsTUFBTSxDQUFDZCxJQUE3QjtBQUNBcUQsVUFBQUEsS0FBSyxDQUFDeEcsS0FBTixDQUFZLEtBQVosRUFBbUJtRyxPQUFuQixDQUEyQmhFLEdBQUcsSUFBSTtBQUNoQyxrQkFBTWlFLElBQUksR0FBR0csZUFBZSxDQUFDRSxHQUFoQixDQUFvQnRFLEdBQXBCLENBQWI7O0FBQ0EsZ0JBQUlpRSxJQUFJLElBQUksSUFBWixFQUFrQjtBQUNoQlAsY0FBQUEsYUFBYSxDQUFDYSxHQUFkLENBQWtCTixJQUFsQjtBQUNEO0FBQ0YsV0FMRDtBQU1EO0FBQ0YsT0FWTSxDQUFQO0FBV0QsS0F4QkksRUF5QkpPLE9BekJJLENBeUJJLElBekJKLEVBMEJKM0YsS0ExQkksQ0EwQkU0RixLQUFLLElBQUkvRiw2QkFBV0MsRUFBWCxDQUFjLEVBQWQsQ0ExQlgsRUEyQko4QixTQTNCSSxDQTJCTSxNQUFNO0FBQ2YsYUFBT1IsT0FBTyxDQUFDa0UsT0FBUixDQUFnQk8sS0FBSyxDQUFDQyxJQUFOLENBQVdqQixhQUFYLENBQWhCLENBQVA7QUFDRCxLQTdCSSxDQUFQO0FBOEJEOztBQUVtQixRQUFka0IsY0FBYyxDQUFDM0csR0FBRCxFQUFnQztBQUNsRCxRQUFJLEVBQUUsTUFBTSxLQUFLRCxrQkFBTCxDQUF3QkMsR0FBeEIsQ0FBUixDQUFKLEVBQTJDO0FBQ3pDLGFBQU8sSUFBUDtBQUNEOztBQUNELFdBQU8sS0FBS2IsZUFBTCxDQUFxQixPQUFyQixFQUE4QixTQUE5QixFQUF5QyxTQUF6QyxFQUFvRGEsR0FBcEQsRUFBeURMLFNBQXpELEVBQVA7QUFDRDs7QUFFRGlILEVBQUFBLGFBQWEsR0FBa0I7QUFDN0IsV0FBTyxLQUFLNUgsT0FBTCxLQUFpQixFQUFqQixHQUFzQixDQUFDLElBQUQsRUFBTyxLQUFLQSxPQUFaLENBQXRCLEdBQTZDLEVBQXBEO0FBQ0Q7O0FBRUQ2SCxFQUFBQSxZQUFZLEdBQXFDO0FBQy9DLFdBQU8sS0FBS2xCLFlBQUwsR0FBb0J2RyxHQUFwQixDQUF3Qk0sTUFBTSxJQUNuQ0EsTUFBTSxDQUFDRSxLQUFQLENBQWEsSUFBYixFQUFtQlIsR0FBbkIsQ0FBdUJvQyxJQUFJLElBQUk7QUFDN0IsWUFBTXNGLElBQUksR0FBR3RGLElBQUksQ0FBQ2xDLElBQUwsR0FBWU0sS0FBWixDQUFrQixLQUFsQixDQUFiO0FBQ0EsYUFBTztBQUFDbUgsUUFBQUEsSUFBSSxFQUFFRCxJQUFJLENBQUMsQ0FBRCxDQUFYO0FBQWdCL0UsUUFBQUEsR0FBRyxFQUFFK0UsSUFBSSxDQUFDLENBQUQsQ0FBekI7QUFBOEJFLFFBQUFBLElBQUksRUFBRUYsSUFBSSxDQUFDQSxJQUFJLENBQUNoSCxNQUFMLEdBQWMsQ0FBZjtBQUF4QyxPQUFQO0FBQ0QsS0FIRCxDQURLLENBQVA7QUFNRDs7QUFFRDZGLEVBQUFBLFlBQVksQ0FBQyxHQUFHc0Isa0JBQUosRUFBc0Q7QUFDaEUsV0FBTyxLQUFLN0csYUFBTCxHQUFxQm9DLFNBQXJCLENBQStCeEIsVUFBVSxJQUFJO0FBQ2xELFVBQUlrRyxRQUFRLEdBQUcsQ0FBQyxPQUFELEVBQVUsSUFBVixDQUFmLENBRGtELENBRWxEO0FBQ0E7O0FBQ0EsVUFBSTNFLFFBQVEsQ0FBQ3ZCLFVBQUQsRUFBYSxFQUFiLENBQVIsSUFBNEIsRUFBaEMsRUFBb0M7QUFDbENrRyxRQUFBQSxRQUFRLENBQUN4QyxJQUFULENBQWMsSUFBZDtBQUNEOztBQUNEd0MsTUFBQUEsUUFBUSxHQUFHQSxRQUFRLENBQUNDLE1BQVQsQ0FBZ0JGLGtCQUFoQixDQUFYO0FBQ0EsYUFBTyxLQUFLOUgsZUFBTCxDQUFxQixHQUFHK0gsUUFBeEIsQ0FBUDtBQUNELEtBVE0sQ0FBUDtBQVVEOztBQUVEL0gsRUFBQUEsZUFBZSxDQUFDLEdBQUdpSSxPQUFKLEVBQTJDO0FBQ3hELFdBQU8seUJBQVcsS0FBWCxFQUFrQixLQUFLUixhQUFMLEdBQXFCTyxNQUFyQixDQUE0QkMsT0FBNUIsQ0FBbEIsQ0FBUDtBQUNEOztBQUVEbkUsRUFBQUEsY0FBYyxDQUFDLEdBQUdtRSxPQUFKLEVBQXlEO0FBQ3JFO0FBQ0EsV0FBTyw2QkFBZSxLQUFmLEVBQXNCLEtBQUtSLGFBQUwsR0FBcUJPLE1BQXJCLENBQTRCQyxPQUE1QixDQUF0QixFQUE0RDtBQUNqRUMsTUFBQUEsZ0JBQWdCLEVBQUUsSUFEK0M7O0FBRWpFO0FBQXNCQyxNQUFBQSxXQUFXLEVBQUUsTUFBTTtBQUZ3QixLQUE1RCxFQUdKMUcsS0FISSxDQUdFNEYsS0FBSyxJQUFJL0YsNkJBQVdDLEVBQVgsQ0FBYztBQUFDb0MsTUFBQUEsSUFBSSxFQUFFLE9BQVA7QUFBZ0IwRCxNQUFBQTtBQUFoQixLQUFkLENBSFgsQ0FBUCxDQUZxRSxDQUtYO0FBQzNEOztBQUVEOUQsRUFBQUEsaUJBQWlCLENBQUMsR0FBRzBFLE9BQUosRUFBbUQ7QUFDbEUsV0FBTyw2QkFBZSxLQUFmLEVBQXNCLEtBQUtSLGFBQUwsR0FBcUJPLE1BQXJCLENBQTRCQyxPQUE1QixDQUF0QixFQUE0RDtBQUNqRUMsTUFBQUEsZ0JBQWdCLEVBQUU7QUFEK0MsS0FBNUQsQ0FBUDtBQUdEOztBQUVnQyxTQUExQkUsMEJBQTBCLENBQUM3SCxNQUFELEVBQW1DO0FBQ2xFLFVBQU04SCxhQUFrQyxHQUFHLElBQUlsRyxHQUFKLEVBQTNDO0FBRUEsV0FBTzVCLE1BQU0sQ0FDVkUsS0FESSxDQUNFLE1BREYsRUFFSjZILEtBRkksQ0FFRSxDQUZGLEVBR0poRyxNQUhJLENBR0dwQyxDQUFDLElBQUlBLENBQUMsQ0FBQ1MsTUFBRixHQUFXLENBQVgsSUFBZ0IsQ0FBQ1QsQ0FBQyxDQUFDQyxJQUFGLEdBQVNvSSxVQUFULENBQW9CLEdBQXBCLENBSHpCLEVBSUp0SSxHQUpJLENBSUFDLENBQUMsSUFBSUEsQ0FBQyxDQUFDTyxLQUFGLENBQVEsTUFBUixDQUpMLEVBS0o2QixNQUxJLENBS0dtQixDQUFDLElBQUlBLENBQUMsQ0FBQyxDQUFELENBQUQsS0FBUyxFQUxqQixFQU1KeEQsR0FOSSxDQU1Bd0QsQ0FBQyxJQUFJO0FBQ1IsWUFBTTdELE1BQU0sR0FBRzZELENBQUMsQ0FBQyxDQUFELENBQWhCO0FBQ0EsWUFBTStFLEtBQUssR0FBRy9FLENBQUMsQ0FBQzZFLEtBQUYsQ0FBUSxDQUFSLENBQWQ7QUFDQSxVQUFJRyxPQUFKO0FBQ0EsVUFBSTNHLEtBQUo7QUFDQSxVQUFJNEcsTUFBSjtBQUNBLFVBQUlDLEdBQUo7QUFDQSxVQUFJQyxXQUFKOztBQUNBLFdBQUssTUFBTUMsSUFBWCxJQUFtQkwsS0FBbkIsRUFBMEI7QUFDeEIsY0FBTU0sSUFBSSxHQUFHRCxJQUFJLENBQUNwSSxLQUFMLENBQVcsR0FBWCxDQUFiOztBQUNBLFlBQUlxSSxJQUFJLENBQUNuSSxNQUFMLEtBQWdCLENBQXBCLEVBQXVCO0FBQ3JCO0FBQ0Q7O0FBQ0QsZ0JBQVFtSSxJQUFJLENBQUMsQ0FBRCxDQUFaO0FBQ0UsZUFBSyxTQUFMO0FBQ0VMLFlBQUFBLE9BQU8sR0FBR0ssSUFBSSxDQUFDLENBQUQsQ0FBZDtBQUNBOztBQUNGLGVBQUssT0FBTDtBQUNFaEgsWUFBQUEsS0FBSyxHQUFHZ0gsSUFBSSxDQUFDLENBQUQsQ0FBWjtBQUNBOztBQUNGLGVBQUssUUFBTDtBQUNFSixZQUFBQSxNQUFNLEdBQUdJLElBQUksQ0FBQyxDQUFELENBQWI7QUFDQTs7QUFDRixlQUFLLEtBQUw7QUFDRUgsWUFBQUEsR0FBRyxHQUFHRyxJQUFJLENBQUMsQ0FBRCxDQUFWO0FBQ0E7O0FBQ0YsZUFBSyxjQUFMO0FBQ0VGLFlBQUFBLFdBQVcsR0FBR0UsSUFBSSxDQUFDLENBQUQsQ0FBbEI7QUFDQTs7QUFDRjtBQUNFO0FBakJKO0FBbUJEOztBQUNELFlBQU1DLFdBQVcsR0FDZm5KLE1BQU0sQ0FBQzJJLFVBQVAsQ0FBa0IsVUFBbEIsS0FDQTNJLE1BQU0sQ0FBQzJJLFVBQVAsQ0FBa0IsWUFBbEIsQ0FEQSxJQUVBekcsS0FBSyxJQUFJLElBRlQsR0FHSWxDLE1BSEosR0FJSWtDLEtBTE47QUFPQSxZQUFNa0gsS0FBSyxHQUFHWCxhQUFhLENBQUNuQixHQUFkLENBQWtCNkIsV0FBbEIsQ0FBZDs7QUFDQSxVQUFJQyxLQUFLLElBQUksSUFBYixFQUFtQjtBQUNqQlgsUUFBQUEsYUFBYSxDQUFDdkIsR0FBZCxDQUFrQmlDLFdBQWxCLEVBQStCLENBQS9CO0FBQ0QsT0FGRCxNQUVPO0FBQ0xWLFFBQUFBLGFBQWEsQ0FBQ3ZCLEdBQWQsQ0FBa0JpQyxXQUFsQixFQUErQkMsS0FBSyxHQUFHLENBQXZDO0FBQ0Q7O0FBRUQsYUFBTztBQUNMcEosUUFBQUEsTUFESztBQUVMbUosUUFBQUEsV0FGSztBQUdMTixRQUFBQSxPQUhLO0FBSUwzRyxRQUFBQSxLQUpLO0FBS0w0RyxRQUFBQSxNQUxLO0FBTUxDLFFBQUFBLEdBTks7QUFPTEMsUUFBQUE7QUFQSyxPQUFQO0FBU0QsS0E5REksRUErREozSSxHQS9ESSxDQStEQXlJLE1BQU0sSUFBSTtBQUNiLFlBQU07QUFBQ0ssUUFBQUEsV0FBRDtBQUFjbkosUUFBQUE7QUFBZCxVQUF3QjhJLE1BQTlCOztBQUNBLFVBQUlLLFdBQVcsS0FBS25KLE1BQWhCLElBQTBCeUksYUFBYSxDQUFDbkIsR0FBZCxDQUFrQjZCLFdBQWxCLE1BQW1DLENBQWpFLEVBQW9FO0FBQ2xFLGVBQU9MLE1BQVA7QUFDRCxPQUZELE1BRU87QUFDTCxlQUFPLEVBQ0wsR0FBR0EsTUFERTtBQUVMSyxVQUFBQSxXQUFXLEVBQUcsR0FBRUEsV0FBWSxNQUFLbkosTUFBTztBQUZuQyxTQUFQO0FBSUQ7QUFDRixLQXpFSSxDQUFQO0FBMEVEOztBQUVnQixTQUFWcUosVUFBVSxHQUE4QjtBQUM3QyxXQUFPLHlCQUFXLEtBQVgsRUFBa0IsQ0FBQyxTQUFELEVBQVksSUFBWixDQUFsQixFQUNKaEosR0FESSxDQUNBTSxNQUFNLElBQUksS0FBSzZILDBCQUFMLENBQWdDN0gsTUFBaEMsQ0FEVixFQUVKNkcsT0FGSSxDQUVJM0gsV0FGSixFQUdKZSxTQUhJLEVBQVA7QUFJRDs7QUFFZ0IsU0FBVjBJLFVBQVUsR0FBa0I7QUFDakMsV0FBTyx5QkFBVyxLQUFYLEVBQWtCLENBQUMsYUFBRCxDQUFsQixFQUNKQyxLQURJLENBQ0VDLFNBREYsRUFFSjVJLFNBRkksRUFBUDtBQUdEOztBQUVnQixTQUFWNkksVUFBVSxHQUFvQjtBQUNuQyxXQUFPLHlCQUFXLEtBQVgsRUFBa0IsQ0FBQyxTQUFELENBQWxCLEVBQ0pwSixHQURJLENBQ0FxSixhQUFhLElBQUk7QUFDcEIsWUFBTW5HLE9BQU8sR0FBR21HLGFBQWEsQ0FBQ0MsS0FBZCxDQUFvQix1QkFBcEIsQ0FBaEI7O0FBQ0EsVUFBSXBHLE9BQUosRUFBYTtBQUNYLGVBQU9BLE9BQU8sQ0FBQyxDQUFELENBQWQ7QUFDRDs7QUFDRCxZQUFNLElBQUlxRyxLQUFKLENBQVcsMEJBQXlCRixhQUFjLEdBQWxELENBQU47QUFDRCxLQVBJLEVBUUo5SSxTQVJJLEVBQVA7QUFTRDs7QUF4ZmMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge0FuZHJvaWRKYXZhUHJvY2VzcywgU2ltcGxlUHJvY2VzcywgQWRiRGV2aWNlfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHR5cGUge1xyXG4gIExlZ2FjeVByb2Nlc3NNZXNzYWdlLFxyXG4gIFByb2Nlc3NNZXNzYWdlLFxyXG59IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL3Byb2Nlc3MnO1xyXG5pbXBvcnQgdHlwZSB7TnVjbGlkZVVyaX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XHJcblxyXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XHJcbmltcG9ydCBudWNsaWRlVXJpIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL251Y2xpZGVVcmknO1xyXG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qcyc7XHJcbmltcG9ydCB7cGFyc2VQc1RhYmxlT3V0cHV0fSBmcm9tICcuL2NvbW1vbi9wcyc7XHJcbmltcG9ydCB7cnVuQ29tbWFuZCwgb2JzZXJ2ZVByb2Nlc3N9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL3Byb2Nlc3MnO1xyXG5cclxuY29uc3QgQURCX1RJTUVPVVQgPSA1MDAwO1xyXG5cclxuZXhwb3J0IGNsYXNzIEFkYiB7XHJcbiAgX3NlcmlhbDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihzZXJpYWw6IHN0cmluZykge1xyXG4gICAgdGhpcy5fc2VyaWFsID0gc2VyaWFsO1xyXG4gIH1cclxuXHJcbiAgZ2V0QW5kcm9pZFByb3Aoa2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKCdzaGVsbCcsICdnZXRwcm9wJywga2V5KS5tYXAocyA9PiBzLnRyaW0oKSk7XHJcbiAgfVxyXG5cclxuICBnZXREZXZpY2VBcmNoaXRlY3R1cmUoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFuZHJvaWRQcm9wKCdyby5wcm9kdWN0LmNwdS5hYmknKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEluc3RhbGxlZFBhY2thZ2VzKCk6IFByb21pc2U8QXJyYXk8c3RyaW5nPj4ge1xyXG4gICAgY29uc3QgcHJlZml4ID0gJ3BhY2thZ2U6JztcclxuICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHRoaXMucnVuU2hvcnRDb21tYW5kKFxyXG4gICAgICAnc2hlbGwnLFxyXG4gICAgICAncG0nLFxyXG4gICAgICAnbGlzdCcsXHJcbiAgICAgICdwYWNrYWdlcycsXHJcbiAgICApLnRvUHJvbWlzZSgpO1xyXG4gICAgcmV0dXJuIHN0ZG91dFxyXG4gICAgICAudHJpbSgpXHJcbiAgICAgIC5zcGxpdCgvXFxzKy8pXHJcbiAgICAgIC5tYXAocyA9PiBzLnN1YnN0cmluZyhwcmVmaXgubGVuZ3RoKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpc1BhY2thZ2VJbnN0YWxsZWQocGtnOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHBhY2thZ2VzID0gYXdhaXQgdGhpcy5nZXRJbnN0YWxsZWRQYWNrYWdlcygpO1xyXG4gICAgcmV0dXJuIHBhY2thZ2VzLmluY2x1ZGVzKHBrZyk7XHJcbiAgfVxyXG5cclxuICBnZXREZXZpY2VNb2RlbCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QW5kcm9pZFByb3AoJ3JvLnByb2R1Y3QubW9kZWwnKS5tYXAoXHJcbiAgICAgIHMgPT4gKHMgPT09ICdzZGsnID8gJ2VtdWxhdG9yJyA6IHMpLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldEFQSVZlcnNpb24oKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFuZHJvaWRQcm9wKCdyby5idWlsZC52ZXJzaW9uLnNkaycpO1xyXG4gIH1cclxuXHJcbiAgZ2V0QnJhbmQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFuZHJvaWRQcm9wKCdyby5wcm9kdWN0LmJyYW5kJyk7XHJcbiAgfVxyXG5cclxuICBnZXRNYW51ZmFjdHVyZXIoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFuZHJvaWRQcm9wKCdyby5wcm9kdWN0Lm1hbnVmYWN0dXJlcicpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGV2aWNlSW5mbygpOiBPYnNlcnZhYmxlPE1hcDxzdHJpbmcsIHN0cmluZz4+IHtcclxuICAgIGNvbnN0IHVua25vd25DQiA9ICgpID0+IE9ic2VydmFibGUub2YoJycpO1xyXG4gICAgcmV0dXJuIE9ic2VydmFibGUuZm9ya0pvaW4oXHJcbiAgICAgIHRoaXMuZ2V0RGV2aWNlQXJjaGl0ZWN0dXJlKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICAgdGhpcy5nZXRBUElWZXJzaW9uKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICAgdGhpcy5nZXREZXZpY2VNb2RlbCgpLmNhdGNoKHVua25vd25DQiksXHJcbiAgICAgIHRoaXMuZ2V0T1NWZXJzaW9uKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICAgdGhpcy5nZXRNYW51ZmFjdHVyZXIoKS5jYXRjaCh1bmtub3duQ0IpLFxyXG4gICAgICB0aGlzLmdldEJyYW5kKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICAgdGhpcy5nZXRXaWZpSXAoKS5jYXRjaCh1bmtub3duQ0IpLFxyXG4gICAgKS5tYXAoXHJcbiAgICAgIChbXHJcbiAgICAgICAgYXJjaGl0ZWN0dXJlLFxyXG4gICAgICAgIGFwaVZlcnNpb24sXHJcbiAgICAgICAgbW9kZWwsXHJcbiAgICAgICAgYW5kcm9pZF92ZXJzaW9uLFxyXG4gICAgICAgIG1hbnVmYWN0dXJlcixcclxuICAgICAgICBicmFuZCxcclxuICAgICAgICB3aWZpX2lwLFxyXG4gICAgICBdKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNYXAoW1xyXG4gICAgICAgICAgWyduYW1lJywgdGhpcy5fc2VyaWFsXSxcclxuICAgICAgICAgIFsnYWRiX3BvcnQnLCAnNTAzNyddLFxyXG4gICAgICAgICAgWydhcmNoaXRlY3R1cmUnLCBhcmNoaXRlY3R1cmVdLFxyXG4gICAgICAgICAgWydhcGlfdmVyc2lvbicsIGFwaVZlcnNpb25dLFxyXG4gICAgICAgICAgWydtb2RlbCcsIG1vZGVsXSxcclxuICAgICAgICAgIFsnYW5kcm9pZF92ZXJzaW9uJywgYW5kcm9pZF92ZXJzaW9uXSxcclxuICAgICAgICAgIFsnbWFudWZhY3R1cmVyJywgbWFudWZhY3R1cmVyXSxcclxuICAgICAgICAgIFsnYnJhbmQnLCBicmFuZF0sXHJcbiAgICAgICAgICBbJ3dpZmlfaXAnLCB3aWZpX2lwXSxcclxuICAgICAgICBdKTtcclxuICAgICAgfSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRXaWZpSXAoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCgnc2hlbGwnLCAnaXAnLCAnYWRkcicsICdzaG93JywgJ3dsYW4wJykubWFwKFxyXG4gICAgICBsaW5lcyA9PiB7XHJcbiAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzLnNwbGl0KC9cXG4vKS5maWx0ZXIobCA9PiBsLmluY2x1ZGVzKCdpbmV0JykpWzBdO1xyXG4gICAgICAgIGlmIChsaW5lID09IG51bGwpIHtcclxuICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcmF3SXAgPSBsaW5lLnRyaW0oKS5zcGxpdCgvXFxzKy8pWzFdO1xyXG4gICAgICAgIHJldHVybiByYXdJcC5zdWJzdHJpbmcoMCwgcmF3SXAuaW5kZXhPZignLycpKTtcclxuICAgICAgfSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBJbiBzb21lIGFuZHJvaWQgZGV2aWNlcywgd2UgaGF2ZSB0byBraWxsIHRoZSBwYWNrYWdlLCBub3QgdGhlIHByb2Nlc3MuXHJcbiAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzE1NDk2MS9hZGItc2hlbGwtb3BlcmF0aW9uLW5vdC1wZXJtaXR0ZWRcclxuICBhc3luYyBzdG9wUHJvY2VzcyhwYWNrYWdlTmFtZTogc3RyaW5nLCBwaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICB0aGlzLnJ1blNob3J0Q29tbWFuZChcclxuICAgICAgICAnc2hlbGwnLFxyXG4gICAgICAgICdhbScsXHJcbiAgICAgICAgJ2ZvcmNlLXN0b3AnLFxyXG4gICAgICAgIHBhY2thZ2VOYW1lLFxyXG4gICAgICApLnRvUHJvbWlzZSgpLFxyXG4gICAgICB0aGlzLnJ1blNob3J0Q29tbWFuZCgnc2hlbGwnLCAna2lsbCcsICctOScsIGAke3BpZH1gKS50b1Byb21pc2UoKSxcclxuICAgICAgdGhpcy5ydW5TaG9ydENvbW1hbmQoXHJcbiAgICAgICAgJ3NoZWxsJyxcclxuICAgICAgICAncnVuLWFzJyxcclxuICAgICAgICBwYWNrYWdlTmFtZSxcclxuICAgICAgICAna2lsbCcsXHJcbiAgICAgICAgJy05JyxcclxuICAgICAgICBgJHtwaWR9YCxcclxuICAgICAgKS50b1Byb21pc2UoKSxcclxuICAgIF0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0T1NWZXJzaW9uKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbmRyb2lkUHJvcCgncm8uYnVpbGQudmVyc2lvbi5yZWxlYXNlJyk7XHJcbiAgfVxyXG5cclxuICBpbnN0YWxsUGFja2FnZShwYWNrYWdlUGF0aDogTnVjbGlkZVVyaSk6IE9ic2VydmFibGU8UHJvY2Vzc01lc3NhZ2U+IHtcclxuICAgIGludmFyaWFudCghbnVjbGlkZVVyaS5pc1JlbW90ZShwYWNrYWdlUGF0aCkpO1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy5nZXRBUElWZXJzaW9uKClcclxuICAgICAgICAubWFwKHZlcnNpb24gPT4gcGFyc2VJbnQodmVyc2lvbiwgMTApID49IDE3KVxyXG4gICAgICAgIC5jYXRjaCgoKSA9PiBPYnNlcnZhYmxlLm9mKGZhbHNlKSlcclxuICAgICAgICAuc3dpdGNoTWFwKGNhblVzZURvd25ncmFkZU9wdGlvbiA9PlxyXG4gICAgICAgICAgdGhpcy5ydW5Mb25nQ29tbWFuZE5ldyhcclxuICAgICAgICAgICAgLi4uW1xyXG4gICAgICAgICAgICAgICdpbnN0YWxsJyxcclxuICAgICAgICAgICAgICAnLXInLFxyXG4gICAgICAgICAgICAgIC8vIFRoZSAtZCBvcHRpb24gYWxsb3dzIGRvd25ncmFkZXMsIHdoaWNoIGhhcHBlbiBmcmVxdWVudGx5IGR1cmluZyBkZXZlbG9wbWVudC5cclxuICAgICAgICAgICAgICAuLi4oY2FuVXNlRG93bmdyYWRlT3B0aW9uID8gWyctZCddIDogW10pLFxyXG4gICAgICAgICAgICAgIHBhY2thZ2VQYXRoLFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgKSxcclxuICAgICAgICApXHJcbiAgICAgICAgLy8gYWRiIGluc3RhbGwgc2VuZHMgYSBsb3Qgb2YgaWRlbnRpY2FsIHByb2dyZXNzIGV2ZW50cyB0byBzdGRvdXQsIGRlZHVwbGljYXRlIHRoZW1cclxuICAgICAgICAuZGlzdGluY3RVbnRpbENoYW5nZWQoKGEsIGIpID0+IHtcclxuICAgICAgICAgIGlmIChhLmtpbmQgPT09ICdzdGRvdXQnICYmIGIua2luZCA9PT0gJ3N0ZG91dCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEuZGF0YSA9PT0gYi5kYXRhO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgdW5pbnN0YWxsUGFja2FnZShwYWNrYWdlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxMZWdhY3lQcm9jZXNzTWVzc2FnZT4ge1xyXG4gICAgLy8gVE9ETyhUMTc0NjM2MzUpXHJcbiAgICByZXR1cm4gdGhpcy5ydW5Mb25nQ29tbWFuZCgndW5pbnN0YWxsJywgcGFja2FnZU5hbWUpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Rm9yd2FyZFNwZWMocGlkOiBudW1iZXIpOiBQcm9taXNlPD9zdHJpbmc+IHtcclxuICAgIGNvbnN0IHNwZWNMaW5lcyA9IGF3YWl0IHRoaXMucnVuU2hvcnRDb21tYW5kKFxyXG4gICAgICAnZm9yd2FyZCcsXHJcbiAgICAgICctLWxpc3QnLFxyXG4gICAgKS50b1Byb21pc2UoKTtcclxuICAgIGNvbnN0IHNwZWNzID0gc3BlY0xpbmVzLnNwbGl0KC9cXG4vKS5tYXAobGluZSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbHMgPSBsaW5lLnNwbGl0KC9cXHMrLyk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3BlYzogY29sc1sxXSxcclxuICAgICAgICB0YXJnZXQ6IGNvbHNbMl0sXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IG1hdGNoaW5nU3BlYyA9IHNwZWNzLmZpbmQoc3BlYyA9PiBzcGVjLnRhcmdldCA9PT0gYGpkd3A6JHtwaWR9YCk7XHJcbiAgICBpZiAobWF0Y2hpbmdTcGVjICE9IG51bGwpIHtcclxuICAgICAgcmV0dXJuIG1hdGNoaW5nU3BlYy5zcGVjO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBmb3J3YXJkSmR3cFBvcnRUb1BpZCh0Y3BQb3J0OiBudW1iZXIsIHBpZDogbnVtYmVyKTogUHJvbWlzZTw/c3RyaW5nPiB7XHJcbiAgICBhd2FpdCB0aGlzLnJ1blNob3J0Q29tbWFuZChcclxuICAgICAgJ2ZvcndhcmQnLFxyXG4gICAgICBgdGNwOiR7dGNwUG9ydH1gLFxyXG4gICAgICBgamR3cDoke3BpZH1gLFxyXG4gICAgKS50b1Byb21pc2UoKTtcclxuICAgIHJldHVybiB0aGlzLmdldEZvcndhcmRTcGVjKHBpZCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZW1vdmVKZHdwRm9yd2FyZFNwZWMoc3BlYzogP3N0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBsZXQgb3V0cHV0O1xyXG4gICAgbGV0IHJlc3VsdCA9ICcnO1xyXG4gICAgaWYgKHNwZWMgIT0gbnVsbCkge1xyXG4gICAgICBvdXRwdXQgPSB0aGlzLnJ1bkxvbmdDb21tYW5kKCdmb3J3YXJkJywgJy0tcmVtb3ZlJywgc3BlYyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBvdXRwdXQgPSB0aGlzLnJ1bkxvbmdDb21tYW5kKCdmb3J3YXJkJywgJy0tcmVtb3ZlLWFsbCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IG91dHB1dC5zdWJzY3JpYmUocHJvY2Vzc01lc3NhZ2UgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHByb2Nlc3NNZXNzYWdlLmtpbmQpIHtcclxuICAgICAgICBjYXNlICdzdGRvdXQnOlxyXG4gICAgICAgIGNhc2UgJ3N0ZGVycic6XHJcbiAgICAgICAgICByZXN1bHQgKz0gcHJvY2Vzc01lc3NhZ2UuZGF0YSArICdcXG4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgYXdhaXQgb3V0cHV0LnRvUHJvbWlzZSgpO1xyXG4gICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgbGF1bmNoQWN0aXZpdHkoXHJcbiAgICBwYWNrYWdlTmFtZTogc3RyaW5nLFxyXG4gICAgYWN0aXZpdHk6IHN0cmluZyxcclxuICAgIGRlYnVnOiBib29sZWFuLFxyXG4gICAgYWN0aW9uOiA/c3RyaW5nLFxyXG4gICAgcGFyYW1ldGVyczogP01hcDxzdHJpbmcsIHN0cmluZz4sXHJcbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGlmIChkZWJ1Zykge1xyXG4gICAgICAvLyBFbmFibGUgXCJ3YWl0IGZvciBkZWJ1Z2dlclwiIHNlbWFudGljcyBmb3IgdGhlIG5leHQgbGF1bmNoIG9mXHJcbiAgICAgIC8vIHRoZSBzcGVjaWZpZWQgcGFja2FnZS5cclxuICAgICAgYXdhaXQgdGhpcy5zZXREZWJ1Z0FwcChwYWNrYWdlTmFtZSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFyZ3MgPSBbJ3NoZWxsJywgJ2FtJywgJ3N0YXJ0J107XHJcbiAgICBpZiAoYWN0aW9uICE9IG51bGwpIHtcclxuICAgICAgYXJncy5wdXNoKCctYScsIGFjdGlvbik7XHJcbiAgICB9XHJcbiAgICBpZiAocGFyYW1ldGVycyAhPSBudWxsKSB7XHJcbiAgICAgIGZvciAoY29uc3QgW2tleSwgcGFyYW1ldGVyXSBvZiBwYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgYXJncy5wdXNoKCctZScsIGtleSwgcGFyYW1ldGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXJncy5wdXNoKCctVycsICctbicpO1xyXG4gICAgYXJncy5wdXNoKGAke3BhY2thZ2VOYW1lfS8ke2FjdGl2aXR5fWApO1xyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKC4uLmFyZ3MpLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgbGF1bmNoTWFpbkFjdGl2aXR5KFxyXG4gICAgcGFja2FnZU5hbWU6IHN0cmluZyxcclxuICAgIGRlYnVnOiBib29sZWFuLFxyXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBpZiAoZGVidWcpIHtcclxuICAgICAgLy8gRW5hYmxlIFwid2FpdCBmb3IgZGVidWdnZXJcIiBzZW1hbnRpY3MgZm9yIHRoZSBuZXh0IGxhdW5jaCBvZlxyXG4gICAgICAvLyB0aGUgc3BlY2lmaWVkIHBhY2thZ2UuXHJcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGVidWdBcHAocGFja2FnZU5hbWUsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhcmdzID0gW1xyXG4gICAgICAnc2hlbGwnLFxyXG4gICAgICAnbW9ua2V5JyxcclxuICAgICAgJy1wJyxcclxuICAgICAgYCR7cGFja2FnZU5hbWV9YCxcclxuICAgICAgJy1jJyxcclxuICAgICAgJ2FuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSJyxcclxuICAgICAgJzEnLFxyXG4gICAgXTtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCguLi5hcmdzKS50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxhdW5jaFNlcnZpY2UoXHJcbiAgICBwYWNrYWdlTmFtZTogc3RyaW5nLFxyXG4gICAgc2VydmljZU5hbWU6IHN0cmluZyxcclxuICAgIGRlYnVnOiBib29sZWFuLFxyXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBpZiAoZGVidWcpIHtcclxuICAgICAgLy8gRW5hYmxlIFwid2FpdCBmb3IgZGVidWdnZXJcIiBzZW1hbnRpY3MgZm9yIHRoZSBuZXh0IGxhdW5jaCBvZlxyXG4gICAgICAvLyB0aGUgc3BlY2lmaWVkIHBhY2thZ2UuXHJcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGVidWdBcHAocGFja2FnZU5hbWUsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhcmdzID0gW1xyXG4gICAgICAnc2hlbGwnLFxyXG4gICAgICAnYW0nLFxyXG4gICAgICAnc3RhcnRzZXJ2aWNlJyxcclxuICAgICAgYCR7cGFja2FnZU5hbWV9LyR7c2VydmljZU5hbWV9YCxcclxuICAgIF07XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoLi4uYXJncykudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBzZXREZWJ1Z0FwcChwYWNrYWdlTmFtZTogc3RyaW5nLCBwZXJzaXN0OiBib29sZWFuKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSBbJ3NoZWxsJywgJ2FtJywgJ3NldC1kZWJ1Zy1hcHAnLCAnLXcnXTtcclxuXHJcbiAgICBpZiAocGVyc2lzdCkge1xyXG4gICAgICBhcmdzLnB1c2goJy0tcGVyc2lzdGVudCcpO1xyXG4gICAgfVxyXG4gICAgYXJncy5wdXNoKGAke3BhY2thZ2VOYW1lfWApO1xyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKC4uLmFyZ3MpLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgX2R1bXBzeXNQYWNrYWdlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ2R1bXBzeXMnLCAncGFja2FnZScpO1xyXG4gIH1cclxuXHJcbiAgYWN0aXZpdHlFeGlzdHMocGFja2FnZU5hbWU6IHN0cmluZywgYWN0aXZpdHk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgcGFja2FnZUFjdGl2aXR5U3RyaW5nID0gYCR7cGFja2FnZU5hbWV9LyR7YWN0aXZpdHl9YDtcclxuICAgIHJldHVybiB0aGlzLl9kdW1wc3lzUGFja2FnZSgpXHJcbiAgICAgIC5tYXAoc3Rkb3V0ID0+IHN0ZG91dC5pbmNsdWRlcyhwYWNrYWdlQWN0aXZpdHlTdHJpbmcpKVxyXG4gICAgICAudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBnZXRBbGxBdmFpbGFibGVQYWNrYWdlcygpOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcclxuICAgIHJldHVybiB0aGlzLl9kdW1wc3lzUGFja2FnZSgpXHJcbiAgICAgIC5tYXAoc3Rkb3V0ID0+IHN0ZG91dC5zcGxpdCgnXFxuJykubWFwKGxpbmUgPT4gbGluZS50cmltKCkpKVxyXG4gICAgICAudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICB0b3VjaEZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCgnc2hlbGwnLCAndG91Y2gnLCBwYXRoKS50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCgnc2hlbGwnLCAncm0nLCBwYXRoKS50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIGdldERlYnVnZ2FibGVQcm9jZXNzZXMoKTogT2JzZXJ2YWJsZTxBcnJheTxTaW1wbGVQcm9jZXNzPj4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0SmF2YVByb2Nlc3NlcygpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SmF2YVByb2Nlc3NlcygpOiBPYnNlcnZhYmxlPEFycmF5PEFuZHJvaWRKYXZhUHJvY2Vzcz4+IHtcclxuICAgIGNvbnN0IGpkd3BQcm9jZXNzZXMgPSBuZXcgU2V0KCk7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5Qc0NvbW1hbmQoKVxyXG4gICAgICAubWFwKHN0ZG91dCA9PiB7XHJcbiAgICAgICAgY29uc3QgcHNPdXRwdXQgPSBzdGRvdXQudHJpbSgpO1xyXG4gICAgICAgIHJldHVybiBwYXJzZVBzVGFibGVPdXRwdXQocHNPdXRwdXQsIFsndXNlcicsICdwaWQnLCAnbmFtZSddKTtcclxuICAgICAgfSlcclxuICAgICAgLnN3aXRjaE1hcChhbGxQcm9jZXNzZXMgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICBhbGxQcm9jZXNzZXNcclxuICAgICAgICAgIC5maWx0ZXIocm93ID0+IHJvdyAhPSBudWxsKVxyXG4gICAgICAgICAgLmZvckVhY2gocHJvYyA9PiBtYXAuc2V0KHByb2MucGlkLCBwcm9jKSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtYXApO1xyXG4gICAgICB9KVxyXG4gICAgICAuc3dpdGNoTWFwKGFsbFByb2Nlc3Nlc01hcCA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuTG9uZ0NvbW1hbmQoJ2pkd3AnKS5tYXAob3V0cHV0ID0+IHtcclxuICAgICAgICAgIGlmIChvdXRwdXQua2luZCA9PT0gJ3N0ZG91dCcpIHtcclxuICAgICAgICAgICAgY29uc3QgYmxvY2s6IHN0cmluZyA9IG91dHB1dC5kYXRhO1xyXG4gICAgICAgICAgICBibG9jay5zcGxpdCgvXFxzKy8pLmZvckVhY2gocGlkID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBwcm9jID0gYWxsUHJvY2Vzc2VzTWFwLmdldChwaWQpO1xyXG4gICAgICAgICAgICAgIGlmIChwcm9jICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGpkd3BQcm9jZXNzZXMuYWRkKHByb2MpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aW1lb3V0KDEwMDApXHJcbiAgICAgIC5jYXRjaChlcnJvciA9PiBPYnNlcnZhYmxlLm9mKFtdKSlcclxuICAgICAgLnN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShBcnJheS5mcm9tKGpkd3BQcm9jZXNzZXMpKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBkdW1wc3lzUGFja2FnZShwa2c6IHN0cmluZyk6IFByb21pc2U8P3N0cmluZz4ge1xyXG4gICAgaWYgKCEoYXdhaXQgdGhpcy5pc1BhY2thZ2VJbnN0YWxsZWQocGtnKSkpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZykudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBnZXREZXZpY2VBcmdzKCk6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlcmlhbCAhPT0gJycgPyBbJy1zJywgdGhpcy5fc2VyaWFsXSA6IFtdO1xyXG4gIH1cclxuXHJcbiAgZ2V0UHJvY2Vzc2VzKCk6IE9ic2VydmFibGU8QXJyYXk8U2ltcGxlUHJvY2Vzcz4+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1blBzQ29tbWFuZCgpLm1hcChzdGRvdXQgPT5cclxuICAgICAgc3Rkb3V0LnNwbGl0KC9cXG4vKS5tYXAobGluZSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5mbyA9IGxpbmUudHJpbSgpLnNwbGl0KC9cXHMrLyk7XHJcbiAgICAgICAgcmV0dXJuIHt1c2VyOiBpbmZvWzBdLCBwaWQ6IGluZm9bMV0sIG5hbWU6IGluZm9baW5mby5sZW5ndGggLSAxXX07XHJcbiAgICAgIH0pLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJ1blBzQ29tbWFuZCguLi5hZGRpdGlvbmFsQ29tbWFuZHM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFQSVZlcnNpb24oKS5zd2l0Y2hNYXAoYXBpVmVyc2lvbiA9PiB7XHJcbiAgICAgIGxldCBjb21tYW5kcyA9IFsnc2hlbGwnLCAncHMnXTtcclxuICAgICAgLy8gU3RhcnRpbmcgd2l0aCBBbmRyb2lkIDguMCBPcmVvIChBUEkgMjYpIHBzIG9ubHkgcmV0dXJucyBhbGwgcHJvY2Vzc2VzXHJcbiAgICAgIC8vIHdpdGggLUFcclxuICAgICAgaWYgKHBhcnNlSW50KGFwaVZlcnNpb24sIDEwKSA+PSAyNikge1xyXG4gICAgICAgIGNvbW1hbmRzLnB1c2goJy1BJyk7XHJcbiAgICAgIH1cclxuICAgICAgY29tbWFuZHMgPSBjb21tYW5kcy5jb25jYXQoYWRkaXRpb25hbENvbW1hbmRzKTtcclxuICAgICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKC4uLmNvbW1hbmRzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcnVuU2hvcnRDb21tYW5kKC4uLmNvbW1hbmQ6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiBydW5Db21tYW5kKCdhZGInLCB0aGlzLmdldERldmljZUFyZ3MoKS5jb25jYXQoY29tbWFuZCkpO1xyXG4gIH1cclxuXHJcbiAgcnVuTG9uZ0NvbW1hbmQoLi4uY29tbWFuZDogc3RyaW5nW10pOiBPYnNlcnZhYmxlPExlZ2FjeVByb2Nlc3NNZXNzYWdlPiB7XHJcbiAgICAvLyBUT0RPKFQxNzQ2MzYzNSlcclxuICAgIHJldHVybiBvYnNlcnZlUHJvY2VzcygnYWRiJywgdGhpcy5nZXREZXZpY2VBcmdzKCkuY29uY2F0KGNvbW1hbmQpLCB7XHJcbiAgICAgIGtpbGxUcmVlV2hlbkRvbmU6IHRydWUsXHJcbiAgICAgIC8qIFRPRE8oVDE3MzUzNTk5KSAqLyBpc0V4aXRFcnJvcjogKCkgPT4gZmFsc2UsXHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiBPYnNlcnZhYmxlLm9mKHtraW5kOiAnZXJyb3InLCBlcnJvcn0pKTsgLy8gVE9ETyhUMTc0NjM2MzUpXHJcbiAgfVxyXG5cclxuICBydW5Mb25nQ29tbWFuZE5ldyguLi5jb21tYW5kOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8UHJvY2Vzc01lc3NhZ2U+IHtcclxuICAgIHJldHVybiBvYnNlcnZlUHJvY2VzcygnYWRiJywgdGhpcy5nZXREZXZpY2VBcmdzKCkuY29uY2F0KGNvbW1hbmQpLCB7XHJcbiAgICAgIGtpbGxUcmVlV2hlbkRvbmU6IHRydWUsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBfcGFyc2VEZXZpY2VzQ29tbWFuZE91dHB1dChzdGRvdXQ6IHN0cmluZyk6IEFycmF5PEFkYkRldmljZT4ge1xyXG4gICAgY29uc3QgbmFtZUZyZXF1ZW5jeTogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICByZXR1cm4gc3Rkb3V0XHJcbiAgICAgIC5zcGxpdCgvXFxuKy9nKVxyXG4gICAgICAuc2xpY2UoMSlcclxuICAgICAgLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMCAmJiAhcy50cmltKCkuc3RhcnRzV2l0aCgnKicpKVxyXG4gICAgICAubWFwKHMgPT4gcy5zcGxpdCgvXFxzKy9nKSlcclxuICAgICAgLmZpbHRlcihhID0+IGFbMF0gIT09ICcnKVxyXG4gICAgICAubWFwKGEgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlcmlhbCA9IGFbMF07XHJcbiAgICAgICAgY29uc3QgcHJvcHMgPSBhLnNsaWNlKDIpO1xyXG4gICAgICAgIGxldCBwcm9kdWN0O1xyXG4gICAgICAgIGxldCBtb2RlbDtcclxuICAgICAgICBsZXQgZGV2aWNlO1xyXG4gICAgICAgIGxldCB1c2I7XHJcbiAgICAgICAgbGV0IHRyYW5zcG9ydElkO1xyXG4gICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wcykge1xyXG4gICAgICAgICAgY29uc3QgcGFpciA9IHByb3Auc3BsaXQoJzonKTtcclxuICAgICAgICAgIGlmIChwYWlyLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHN3aXRjaCAocGFpclswXSkge1xyXG4gICAgICAgICAgICBjYXNlICdwcm9kdWN0JzpcclxuICAgICAgICAgICAgICBwcm9kdWN0ID0gcGFpclsxXTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbW9kZWwnOlxyXG4gICAgICAgICAgICAgIG1vZGVsID0gcGFpclsxXTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZGV2aWNlJzpcclxuICAgICAgICAgICAgICBkZXZpY2UgPSBwYWlyWzFdO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd1c2InOlxyXG4gICAgICAgICAgICAgIHVzYiA9IHBhaXJbMV07XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RyYW5zcG9ydF9pZCc6XHJcbiAgICAgICAgICAgICAgdHJhbnNwb3J0SWQgPSBwYWlyWzFdO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9XHJcbiAgICAgICAgICBzZXJpYWwuc3RhcnRzV2l0aCgnZW11bGF0b3InKSB8fFxyXG4gICAgICAgICAgc2VyaWFsLnN0YXJ0c1dpdGgoJ2xvY2FsaG9zdDonKSB8fFxyXG4gICAgICAgICAgbW9kZWwgPT0gbnVsbFxyXG4gICAgICAgICAgICA/IHNlcmlhbFxyXG4gICAgICAgICAgICA6IG1vZGVsO1xyXG5cclxuICAgICAgICBjb25zdCBjb3VudCA9IG5hbWVGcmVxdWVuY3kuZ2V0KGRpc3BsYXlOYW1lKTtcclxuICAgICAgICBpZiAoY291bnQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgbmFtZUZyZXF1ZW5jeS5zZXQoZGlzcGxheU5hbWUsIDEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBuYW1lRnJlcXVlbmN5LnNldChkaXNwbGF5TmFtZSwgY291bnQgKyAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzZXJpYWwsXHJcbiAgICAgICAgICBkaXNwbGF5TmFtZSxcclxuICAgICAgICAgIHByb2R1Y3QsXHJcbiAgICAgICAgICBtb2RlbCxcclxuICAgICAgICAgIGRldmljZSxcclxuICAgICAgICAgIHVzYixcclxuICAgICAgICAgIHRyYW5zcG9ydElkLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pXHJcbiAgICAgIC5tYXAoZGV2aWNlID0+IHtcclxuICAgICAgICBjb25zdCB7ZGlzcGxheU5hbWUsIHNlcmlhbH0gPSBkZXZpY2U7XHJcbiAgICAgICAgaWYgKGRpc3BsYXlOYW1lID09PSBzZXJpYWwgfHwgbmFtZUZyZXF1ZW5jeS5nZXQoZGlzcGxheU5hbWUpID09PSAxKSB7XHJcbiAgICAgICAgICByZXR1cm4gZGV2aWNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAuLi5kZXZpY2UsXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBgJHtkaXNwbGF5TmFtZX0gLSAke3NlcmlhbH1gLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldERldmljZXMoKTogUHJvbWlzZTxBcnJheTxBZGJEZXZpY2U+PiB7XHJcbiAgICByZXR1cm4gcnVuQ29tbWFuZCgnYWRiJywgWydkZXZpY2VzJywgJy1sJ10pXHJcbiAgICAgIC5tYXAoc3Rkb3V0ID0+IHRoaXMuX3BhcnNlRGV2aWNlc0NvbW1hbmRPdXRwdXQoc3Rkb3V0KSlcclxuICAgICAgLnRpbWVvdXQoQURCX1RJTUVPVVQpXHJcbiAgICAgIC50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBraWxsU2VydmVyKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHJ1bkNvbW1hbmQoJ2FkYicsIFsna2lsbC1zZXJ2ZXInXSlcclxuICAgICAgLm1hcFRvKHVuZGVmaW5lZClcclxuICAgICAgLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldFZlcnNpb24oKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiBydW5Db21tYW5kKCdhZGInLCBbJ3ZlcnNpb24nXSlcclxuICAgICAgLm1hcCh2ZXJzaW9uU3RyaW5nID0+IHtcclxuICAgICAgICBjb25zdCB2ZXJzaW9uID0gdmVyc2lvblN0cmluZy5tYXRjaCgvdmVyc2lvbiAoXFxkKy5cXGQrLlxcZCspLyk7XHJcbiAgICAgICAgaWYgKHZlcnNpb24pIHtcclxuICAgICAgICAgIHJldHVybiB2ZXJzaW9uWzFdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHZlcnNpb24gZm91bmQgd2l0aCBcIiR7dmVyc2lvblN0cmluZ31cImApO1xyXG4gICAgICB9KVxyXG4gICAgICAudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==