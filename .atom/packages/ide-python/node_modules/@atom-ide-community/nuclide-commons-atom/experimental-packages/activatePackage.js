"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = activatePackage;

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
function activatePackage({
  main,
  providedServices,
  consumedServices
}, messageRouter) {
  const connections = Object.create(null);
  Object.keys(providedServices).forEach(key => {
    const {
      rawConnections
    } = providedServices[key];
    connections[key] = rawConnections.map(({
      socket,
      config
    }) => messageRouter.createConnection(socket, config));
  }); // Create clients for each consumed service.

  const clients = Object.create(null);
  Object.keys(consumedServices).forEach(key => {
    const {
      socket,
      client
    } = consumedServices[key]; // $FlowIgnore

    const clientClass = require(client).default;

    clients[key] = new clientClass(messageRouter.createConnection(socket));
  }); // $FlowIgnore

  const packageClass = require(main).default;

  return new packageClass(clients, connections);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLWF0b20vZXhwZXJpbWVudGFsLXBhY2thZ2VzL2FjdGl2YXRlUGFja2FnZS5qcyJdLCJuYW1lcyI6WyJhY3RpdmF0ZVBhY2thZ2UiLCJtYWluIiwicHJvdmlkZWRTZXJ2aWNlcyIsImNvbnN1bWVkU2VydmljZXMiLCJtZXNzYWdlUm91dGVyIiwiY29ubmVjdGlvbnMiLCJPYmplY3QiLCJjcmVhdGUiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJhd0Nvbm5lY3Rpb25zIiwibWFwIiwic29ja2V0IiwiY29uZmlnIiwiY3JlYXRlQ29ubmVjdGlvbiIsImNsaWVudHMiLCJjbGllbnQiLCJjbGllbnRDbGFzcyIsInJlcXVpcmUiLCJkZWZhdWx0IiwicGFja2FnZUNsYXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtlLFNBQVNBLGVBQVQsQ0FDYjtBQUFDQyxFQUFBQSxJQUFEO0FBQU9DLEVBQUFBLGdCQUFQO0FBQXlCQyxFQUFBQTtBQUF6QixDQURhLEVBRWJDLGFBRmEsRUFHQTtBQUNiLFFBQU1DLFdBQVcsR0FBR0MsTUFBTSxDQUFDQyxNQUFQLENBQWMsSUFBZCxDQUFwQjtBQUNBRCxFQUFBQSxNQUFNLENBQUNFLElBQVAsQ0FBWU4sZ0JBQVosRUFBOEJPLE9BQTlCLENBQXNDQyxHQUFHLElBQUk7QUFDM0MsVUFBTTtBQUFDQyxNQUFBQTtBQUFELFFBQW1CVCxnQkFBZ0IsQ0FBQ1EsR0FBRCxDQUF6QztBQUNBTCxJQUFBQSxXQUFXLENBQUNLLEdBQUQsQ0FBWCxHQUFtQkMsY0FBYyxDQUFDQyxHQUFmLENBQW1CLENBQUM7QUFBQ0MsTUFBQUEsTUFBRDtBQUFTQyxNQUFBQTtBQUFULEtBQUQsS0FDcENWLGFBQWEsQ0FBQ1csZ0JBQWQsQ0FBK0JGLE1BQS9CLEVBQXVDQyxNQUF2QyxDQURpQixDQUFuQjtBQUdELEdBTEQsRUFGYSxDQVNiOztBQUNBLFFBQU1FLE9BQU8sR0FBR1YsTUFBTSxDQUFDQyxNQUFQLENBQWMsSUFBZCxDQUFoQjtBQUNBRCxFQUFBQSxNQUFNLENBQUNFLElBQVAsQ0FBWUwsZ0JBQVosRUFBOEJNLE9BQTlCLENBQXNDQyxHQUFHLElBQUk7QUFDM0MsVUFBTTtBQUFDRyxNQUFBQSxNQUFEO0FBQVNJLE1BQUFBO0FBQVQsUUFBbUJkLGdCQUFnQixDQUFDTyxHQUFELENBQXpDLENBRDJDLENBRTNDOztBQUNBLFVBQU1RLFdBQVcsR0FBR0MsT0FBTyxDQUFDRixNQUFELENBQVAsQ0FBZ0JHLE9BQXBDOztBQUNBSixJQUFBQSxPQUFPLENBQUNOLEdBQUQsQ0FBUCxHQUFlLElBQUlRLFdBQUosQ0FBZ0JkLGFBQWEsQ0FBQ1csZ0JBQWQsQ0FBK0JGLE1BQS9CLENBQWhCLENBQWY7QUFDRCxHQUxELEVBWGEsQ0FrQmI7O0FBQ0EsUUFBTVEsWUFBWSxHQUFHRixPQUFPLENBQUNsQixJQUFELENBQVAsQ0FBY21CLE9BQW5DOztBQUNBLFNBQU8sSUFBSUMsWUFBSixDQUFpQkwsT0FBakIsRUFBMEJYLFdBQTFCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCB0eXBlIHtQYWNrYWdlUGFyYW1zfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHR5cGUgTWVzc2FnZVJvdXRlciBmcm9tICcuL01lc3NhZ2VSb3V0ZXInO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYWN0aXZhdGVQYWNrYWdlKFxyXG4gIHttYWluLCBwcm92aWRlZFNlcnZpY2VzLCBjb25zdW1lZFNlcnZpY2VzfTogUGFja2FnZVBhcmFtcyxcclxuICBtZXNzYWdlUm91dGVyOiBNZXNzYWdlUm91dGVyLFxyXG4pOiBJRGlzcG9zYWJsZSB7XHJcbiAgY29uc3QgY29ubmVjdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gIE9iamVjdC5rZXlzKHByb3ZpZGVkU2VydmljZXMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgIGNvbnN0IHtyYXdDb25uZWN0aW9uc30gPSBwcm92aWRlZFNlcnZpY2VzW2tleV07XHJcbiAgICBjb25uZWN0aW9uc1trZXldID0gcmF3Q29ubmVjdGlvbnMubWFwKCh7c29ja2V0LCBjb25maWd9KSA9PlxyXG4gICAgICBtZXNzYWdlUm91dGVyLmNyZWF0ZUNvbm5lY3Rpb24oc29ja2V0LCBjb25maWcpLFxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgLy8gQ3JlYXRlIGNsaWVudHMgZm9yIGVhY2ggY29uc3VtZWQgc2VydmljZS5cclxuICBjb25zdCBjbGllbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICBPYmplY3Qua2V5cyhjb25zdW1lZFNlcnZpY2VzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICBjb25zdCB7c29ja2V0LCBjbGllbnR9ID0gY29uc3VtZWRTZXJ2aWNlc1trZXldO1xyXG4gICAgLy8gJEZsb3dJZ25vcmVcclxuICAgIGNvbnN0IGNsaWVudENsYXNzID0gcmVxdWlyZShjbGllbnQpLmRlZmF1bHQ7XHJcbiAgICBjbGllbnRzW2tleV0gPSBuZXcgY2xpZW50Q2xhc3MobWVzc2FnZVJvdXRlci5jcmVhdGVDb25uZWN0aW9uKHNvY2tldCkpO1xyXG4gIH0pO1xyXG5cclxuICAvLyAkRmxvd0lnbm9yZVxyXG4gIGNvbnN0IHBhY2thZ2VDbGFzcyA9IHJlcXVpcmUobWFpbikuZGVmYXVsdDtcclxuICByZXR1cm4gbmV3IHBhY2thZ2VDbGFzcyhjbGllbnRzLCBjb25uZWN0aW9ucyk7XHJcbn1cclxuIl19