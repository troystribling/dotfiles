"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.goToLocation = goToLocation;
exports.goToLocationInEditor = goToLocationInEditor;
exports.observeNavigatingEditors = observeNavigatingEditors;

var _log4js = require("log4js");

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _assert = _interopRequireDefault(require("assert"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/**
 * Opens the given file.
 *
 * Optionally include a line and column to navigate to. If a line is given, by default it will
 * center it in the opened text editor.
 *
 * This should be preferred over `atom.workspace.open()` in typical cases. The motivations are:
 * - We call `atom.workspace.open()` with the `searchAllPanes` option. This looks in other panes for
 *   the current file, rather just opening a new copy in the current pane. People often forget this
 *   option which typically leads to a subpar experience for people who use multiple panes.
 * - When moving around in the current file, `goToLocation` explicitly publishes events that the nav
 *   stack uses.
 *
 * Currently, `atom.workspace.open()` should be used only in these cases:
 * - When the URI to open is not a file URI. For example, if we want to open some tool like find
 *   references in a pane.
 * - When we want to open an untitled file (providing no file argument). Currently, goToLocation
 *   requires a file to open.
 * - When we want to open a file as a pending pane item. Currently goToLocation cannot do this.
 *
 * In these cases, you may disable the lint rule against `atom.workspace.open` by adding the
 * following comment above its use:
 * // eslint-disable-next-line nuclide-internal/atom-apis
 */
async function goToLocation(file, options) {
  var _options$center, _options$moveCursor, _options$activatePane;

  const center = (_options$center = options === null || options === void 0 ? void 0 : options.center) !== null && _options$center !== void 0 ? _options$center : true;
  const moveCursor = (_options$moveCursor = options === null || options === void 0 ? void 0 : options.moveCursor) !== null && _options$moveCursor !== void 0 ? _options$moveCursor : true;
  const activatePane = (_options$activatePane = options === null || options === void 0 ? void 0 : options.activatePane) !== null && _options$activatePane !== void 0 ? _options$activatePane : true;
  const activateItem = options === null || options === void 0 ? void 0 : options.activateItem;
  const line = options === null || options === void 0 ? void 0 : options.line;
  const column = options === null || options === void 0 ? void 0 : options.column;
  const pending = options === null || options === void 0 ? void 0 : options.pending; // Prefer going to the current editor rather than the leftmost editor.

  const currentEditor = atom.workspace.getActiveTextEditor();

  if (currentEditor != null && currentEditor.getPath() === file) {
    const paneContainer = atom.workspace.paneContainerForItem(currentEditor);
    (0, _assert.default)(paneContainer != null);

    if (activatePane) {
      paneContainer.activate();
    }

    if (line != null) {
      goToLocationInEditor(currentEditor, {
        line,
        column: column == null ? 0 : column,
        center,
        moveCursor
      });
    } else {
      (0, _assert.default)(column == null, 'goToLocation: Cannot specify just column');
    }

    return currentEditor;
  } else {
    // Obviously, calling goToLocation isn't a viable alternative here :P
    // eslint-disable-next-line nuclide-internal/atom-apis
    const editor = await atom.workspace.open(file, {
      initialLine: line,
      initialColumn: column,
      searchAllPanes: true,
      activatePane,
      activateItem,
      pending
    }); // TODO(T28305560) Investigate offenders for this error

    if (editor == null) {
      const tmp = {};
      Error.captureStackTrace(tmp);
      const error = Error(`atom.workspace.open returned null on ${file}`);
      (0, _log4js.getLogger)('goToLocation').error(error);
      throw error;
    }

    if (center && line != null) {
      editor.scrollToBufferPosition([line, column], {
        center: true
      });
    }

    return editor;
  }
}

const goToLocationSubject = new _rxjsCompatUmdMin.Subject();

// Scrolls to the given line/column at the given editor
// broadcasts the editor instance on an observable (subject) available
// through the getGoToLocation
function goToLocationInEditor(editor, options) {
  const center = options.center == null ? true : options.center;
  const moveCursor = options.moveCursor == null ? true : options.moveCursor;
  const {
    line,
    column
  } = options;

  if (moveCursor) {
    editor.setCursorBufferPosition([line, column]);
  }

  if (center) {
    editor.scrollToBufferPosition([line, column], {
      center: true
    });
  }

  goToLocationSubject.next(editor);
}

function observeNavigatingEditors() {
  return goToLocationSubject;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLWF0b20vZ28tdG8tbG9jYXRpb24uanMiXSwibmFtZXMiOlsiZ29Ub0xvY2F0aW9uIiwiZmlsZSIsIm9wdGlvbnMiLCJjZW50ZXIiLCJtb3ZlQ3Vyc29yIiwiYWN0aXZhdGVQYW5lIiwiYWN0aXZhdGVJdGVtIiwibGluZSIsImNvbHVtbiIsInBlbmRpbmciLCJjdXJyZW50RWRpdG9yIiwiYXRvbSIsIndvcmtzcGFjZSIsImdldEFjdGl2ZVRleHRFZGl0b3IiLCJnZXRQYXRoIiwicGFuZUNvbnRhaW5lciIsInBhbmVDb250YWluZXJGb3JJdGVtIiwiYWN0aXZhdGUiLCJnb1RvTG9jYXRpb25JbkVkaXRvciIsImVkaXRvciIsIm9wZW4iLCJpbml0aWFsTGluZSIsImluaXRpYWxDb2x1bW4iLCJzZWFyY2hBbGxQYW5lcyIsInRtcCIsIkVycm9yIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJlcnJvciIsInNjcm9sbFRvQnVmZmVyUG9zaXRpb24iLCJnb1RvTG9jYXRpb25TdWJqZWN0IiwiU3ViamVjdCIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwibmV4dCIsIm9ic2VydmVOYXZpZ2F0aW5nRWRpdG9ycyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7Ozs7QUFoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sZUFBZUEsWUFBZixDQUNMQyxJQURLLEVBRUxDLE9BRkssRUFHcUI7QUFBQTs7QUFDMUIsUUFBTUMsTUFBTSxzQkFBR0QsT0FBSCxhQUFHQSxPQUFILHVCQUFHQSxPQUFPLENBQUVDLE1BQVosNkRBQXNC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QWtCLElBQWxCLEdBQXlCLElBQXpCLEdBQWdDRCxPQUFPLENBQUNDLE1BQXZEO0FBQ0EsUUFBTUMsVUFBVSxHQUFHRixPQUFPLENBQUNFLFVBQVIsSUFBc0IsSUFBdEIsR0FBNkIsSUFBN0IsR0FBb0NGLE9BQU8sQ0FBQ0UsVUFBL0Q7QUFDQSxRQUFNO0FBQUNHLElBQUFBLElBQUQ7QUFBT0MsSUFBQUE7QUFBUCxNQUFpQk4sT0FBdkI7O0FBRUEsTUFBSUUsVUFBSixFQUFnQjtBQUNkZSxJQUFBQSxNQUFNLENBQUNZLHVCQUFQLENBQStCLENBQUN4QixJQUFELEVBQU9DLE1BQVAsQ0FBL0I7QUFDRDs7QUFDRCxNQUFJTCxNQUFKLEVBQVk7QUFDVmdCLElBQUFBLE1BQU0sQ0FBQ1Msc0JBQVAsQ0FBOEIsQ0FBQ3JCLElBQUQsRUFBT0MsTUFBUCxDQUE5QixFQUE4QztBQUFDTCxNQUFBQSxNQUFNLEVBQUU7QUFBVCxLQUE5QztBQUNEOztBQUVEMEIsRUFBQUEsbUJBQW1CLENBQUNHLElBQXBCLENBQXlCYixNQUF6QjtBQUNEOztBQUVNLFNBQVNjLHdCQUFULEdBQWlFO0FBQ3RFLFNBQU9KLG1CQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge09ic2VydmFibGV9IGZyb20gJ3J4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qcyc7XHJcblxyXG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSAnbG9nNGpzJztcclxuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzLWNvbXBhdC9idW5kbGVzL3J4anMtY29tcGF0LnVtZC5taW4uanMnO1xyXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XHJcblxyXG5leHBvcnQgdHlwZSBHb1RvTG9jYXRpb25PcHRpb25zID0ge3xcclxuICBsaW5lPzogbnVtYmVyLFxyXG4gIGNvbHVtbj86IG51bWJlcixcclxuICBjZW50ZXI/OiBib29sZWFuLFxyXG4gIGFjdGl2YXRlSXRlbT86IGJvb2xlYW4sXHJcbiAgYWN0aXZhdGVQYW5lPzogYm9vbGVhbixcclxuICBwZW5kaW5nPzogYm9vbGVhbixcclxuICBtb3ZlQ3Vyc29yPzogYm9vbGVhbixcclxufH07XHJcblxyXG4vKipcclxuICogT3BlbnMgdGhlIGdpdmVuIGZpbGUuXHJcbiAqXHJcbiAqIE9wdGlvbmFsbHkgaW5jbHVkZSBhIGxpbmUgYW5kIGNvbHVtbiB0byBuYXZpZ2F0ZSB0by4gSWYgYSBsaW5lIGlzIGdpdmVuLCBieSBkZWZhdWx0IGl0IHdpbGxcclxuICogY2VudGVyIGl0IGluIHRoZSBvcGVuZWQgdGV4dCBlZGl0b3IuXHJcbiAqXHJcbiAqIFRoaXMgc2hvdWxkIGJlIHByZWZlcnJlZCBvdmVyIGBhdG9tLndvcmtzcGFjZS5vcGVuKClgIGluIHR5cGljYWwgY2FzZXMuIFRoZSBtb3RpdmF0aW9ucyBhcmU6XHJcbiAqIC0gV2UgY2FsbCBgYXRvbS53b3Jrc3BhY2Uub3BlbigpYCB3aXRoIHRoZSBgc2VhcmNoQWxsUGFuZXNgIG9wdGlvbi4gVGhpcyBsb29rcyBpbiBvdGhlciBwYW5lcyBmb3JcclxuICogICB0aGUgY3VycmVudCBmaWxlLCByYXRoZXIganVzdCBvcGVuaW5nIGEgbmV3IGNvcHkgaW4gdGhlIGN1cnJlbnQgcGFuZS4gUGVvcGxlIG9mdGVuIGZvcmdldCB0aGlzXHJcbiAqICAgb3B0aW9uIHdoaWNoIHR5cGljYWxseSBsZWFkcyB0byBhIHN1YnBhciBleHBlcmllbmNlIGZvciBwZW9wbGUgd2hvIHVzZSBtdWx0aXBsZSBwYW5lcy5cclxuICogLSBXaGVuIG1vdmluZyBhcm91bmQgaW4gdGhlIGN1cnJlbnQgZmlsZSwgYGdvVG9Mb2NhdGlvbmAgZXhwbGljaXRseSBwdWJsaXNoZXMgZXZlbnRzIHRoYXQgdGhlIG5hdlxyXG4gKiAgIHN0YWNrIHVzZXMuXHJcbiAqXHJcbiAqIEN1cnJlbnRseSwgYGF0b20ud29ya3NwYWNlLm9wZW4oKWAgc2hvdWxkIGJlIHVzZWQgb25seSBpbiB0aGVzZSBjYXNlczpcclxuICogLSBXaGVuIHRoZSBVUkkgdG8gb3BlbiBpcyBub3QgYSBmaWxlIFVSSS4gRm9yIGV4YW1wbGUsIGlmIHdlIHdhbnQgdG8gb3BlbiBzb21lIHRvb2wgbGlrZSBmaW5kXHJcbiAqICAgcmVmZXJlbmNlcyBpbiBhIHBhbmUuXHJcbiAqIC0gV2hlbiB3ZSB3YW50IHRvIG9wZW4gYW4gdW50aXRsZWQgZmlsZSAocHJvdmlkaW5nIG5vIGZpbGUgYXJndW1lbnQpLiBDdXJyZW50bHksIGdvVG9Mb2NhdGlvblxyXG4gKiAgIHJlcXVpcmVzIGEgZmlsZSB0byBvcGVuLlxyXG4gKiAtIFdoZW4gd2Ugd2FudCB0byBvcGVuIGEgZmlsZSBhcyBhIHBlbmRpbmcgcGFuZSBpdGVtLiBDdXJyZW50bHkgZ29Ub0xvY2F0aW9uIGNhbm5vdCBkbyB0aGlzLlxyXG4gKlxyXG4gKiBJbiB0aGVzZSBjYXNlcywgeW91IG1heSBkaXNhYmxlIHRoZSBsaW50IHJ1bGUgYWdhaW5zdCBgYXRvbS53b3Jrc3BhY2Uub3BlbmAgYnkgYWRkaW5nIHRoZVxyXG4gKiBmb2xsb3dpbmcgY29tbWVudCBhYm92ZSBpdHMgdXNlOlxyXG4gKiAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbnVjbGlkZS1pbnRlcm5hbC9hdG9tLWFwaXNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnb1RvTG9jYXRpb24oXHJcbiAgZmlsZTogc3RyaW5nLFxyXG4gIG9wdGlvbnM/OiA/R29Ub0xvY2F0aW9uT3B0aW9ucyxcclxuKTogUHJvbWlzZTxhdG9tJFRleHRFZGl0b3I+IHtcclxuICBjb25zdCBjZW50ZXIgPSBvcHRpb25zPy5jZW50ZXIgPz8gdHJ1ZTtcclxuICBjb25zdCBtb3ZlQ3Vyc29yID0gb3B0aW9ucz8ubW92ZUN1cnNvciA/PyB0cnVlO1xyXG4gIGNvbnN0IGFjdGl2YXRlUGFuZSA9IG9wdGlvbnM/LmFjdGl2YXRlUGFuZSA/PyB0cnVlO1xyXG4gIGNvbnN0IGFjdGl2YXRlSXRlbSA9IG9wdGlvbnM/LmFjdGl2YXRlSXRlbTtcclxuICBjb25zdCBsaW5lID0gb3B0aW9ucz8ubGluZTtcclxuICBjb25zdCBjb2x1bW4gPSBvcHRpb25zPy5jb2x1bW47XHJcbiAgY29uc3QgcGVuZGluZyA9IG9wdGlvbnM/LnBlbmRpbmc7XHJcblxyXG4gIC8vIFByZWZlciBnb2luZyB0byB0aGUgY3VycmVudCBlZGl0b3IgcmF0aGVyIHRoYW4gdGhlIGxlZnRtb3N0IGVkaXRvci5cclxuICBjb25zdCBjdXJyZW50RWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpO1xyXG4gIGlmIChjdXJyZW50RWRpdG9yICE9IG51bGwgJiYgY3VycmVudEVkaXRvci5nZXRQYXRoKCkgPT09IGZpbGUpIHtcclxuICAgIGNvbnN0IHBhbmVDb250YWluZXIgPSBhdG9tLndvcmtzcGFjZS5wYW5lQ29udGFpbmVyRm9ySXRlbShjdXJyZW50RWRpdG9yKTtcclxuICAgIGludmFyaWFudChwYW5lQ29udGFpbmVyICE9IG51bGwpO1xyXG4gICAgaWYgKGFjdGl2YXRlUGFuZSkge1xyXG4gICAgICBwYW5lQ29udGFpbmVyLmFjdGl2YXRlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobGluZSAhPSBudWxsKSB7XHJcbiAgICAgIGdvVG9Mb2NhdGlvbkluRWRpdG9yKGN1cnJlbnRFZGl0b3IsIHtcclxuICAgICAgICBsaW5lLFxyXG4gICAgICAgIGNvbHVtbjogY29sdW1uID09IG51bGwgPyAwIDogY29sdW1uLFxyXG4gICAgICAgIGNlbnRlcixcclxuICAgICAgICBtb3ZlQ3Vyc29yLFxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGludmFyaWFudChjb2x1bW4gPT0gbnVsbCwgJ2dvVG9Mb2NhdGlvbjogQ2Fubm90IHNwZWNpZnkganVzdCBjb2x1bW4nKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJyZW50RWRpdG9yO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBPYnZpb3VzbHksIGNhbGxpbmcgZ29Ub0xvY2F0aW9uIGlzbid0IGEgdmlhYmxlIGFsdGVybmF0aXZlIGhlcmUgOlBcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBudWNsaWRlLWludGVybmFsL2F0b20tYXBpc1xyXG4gICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlLCB7XHJcbiAgICAgIGluaXRpYWxMaW5lOiBsaW5lLFxyXG4gICAgICBpbml0aWFsQ29sdW1uOiBjb2x1bW4sXHJcbiAgICAgIHNlYXJjaEFsbFBhbmVzOiB0cnVlLFxyXG4gICAgICBhY3RpdmF0ZVBhbmUsXHJcbiAgICAgIGFjdGl2YXRlSXRlbSxcclxuICAgICAgcGVuZGluZyxcclxuICAgIH0pO1xyXG4gICAgLy8gVE9ETyhUMjgzMDU1NjApIEludmVzdGlnYXRlIG9mZmVuZGVycyBmb3IgdGhpcyBlcnJvclxyXG4gICAgaWYgKGVkaXRvciA9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHRtcCA9IHt9O1xyXG4gICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0bXApO1xyXG4gICAgICBjb25zdCBlcnJvciA9IEVycm9yKGBhdG9tLndvcmtzcGFjZS5vcGVuIHJldHVybmVkIG51bGwgb24gJHtmaWxlfWApO1xyXG4gICAgICBnZXRMb2dnZXIoJ2dvVG9Mb2NhdGlvbicpLmVycm9yKGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNlbnRlciAmJiBsaW5lICE9IG51bGwpIHtcclxuICAgICAgZWRpdG9yLnNjcm9sbFRvQnVmZmVyUG9zaXRpb24oW2xpbmUsIGNvbHVtbl0sIHtjZW50ZXI6IHRydWV9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBlZGl0b3I7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBnb1RvTG9jYXRpb25TdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbnR5cGUgR290b0xvY2F0aW9uSW5FZGl0b3JPcHRpb25zID0ge3xcclxuICBsaW5lOiBudW1iZXIsXHJcbiAgY29sdW1uOiBudW1iZXIsXHJcbiAgY2VudGVyPzogYm9vbGVhbixcclxuICBtb3ZlQ3Vyc29yPzogYm9vbGVhbixcclxufH07XHJcblxyXG4vLyBTY3JvbGxzIHRvIHRoZSBnaXZlbiBsaW5lL2NvbHVtbiBhdCB0aGUgZ2l2ZW4gZWRpdG9yXHJcbi8vIGJyb2FkY2FzdHMgdGhlIGVkaXRvciBpbnN0YW5jZSBvbiBhbiBvYnNlcnZhYmxlIChzdWJqZWN0KSBhdmFpbGFibGVcclxuLy8gdGhyb3VnaCB0aGUgZ2V0R29Ub0xvY2F0aW9uXHJcbmV4cG9ydCBmdW5jdGlvbiBnb1RvTG9jYXRpb25JbkVkaXRvcihcclxuICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcclxuICBvcHRpb25zOiBHb3RvTG9jYXRpb25JbkVkaXRvck9wdGlvbnMsXHJcbik6IHZvaWQge1xyXG4gIGNvbnN0IGNlbnRlciA9IG9wdGlvbnMuY2VudGVyID09IG51bGwgPyB0cnVlIDogb3B0aW9ucy5jZW50ZXI7XHJcbiAgY29uc3QgbW92ZUN1cnNvciA9IG9wdGlvbnMubW92ZUN1cnNvciA9PSBudWxsID8gdHJ1ZSA6IG9wdGlvbnMubW92ZUN1cnNvcjtcclxuICBjb25zdCB7bGluZSwgY29sdW1ufSA9IG9wdGlvbnM7XHJcblxyXG4gIGlmIChtb3ZlQ3Vyc29yKSB7XHJcbiAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oW2xpbmUsIGNvbHVtbl0pO1xyXG4gIH1cclxuICBpZiAoY2VudGVyKSB7XHJcbiAgICBlZGl0b3Iuc2Nyb2xsVG9CdWZmZXJQb3NpdGlvbihbbGluZSwgY29sdW1uXSwge2NlbnRlcjogdHJ1ZX0pO1xyXG4gIH1cclxuXHJcbiAgZ29Ub0xvY2F0aW9uU3ViamVjdC5uZXh0KGVkaXRvcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvYnNlcnZlTmF2aWdhdGluZ0VkaXRvcnMoKTogT2JzZXJ2YWJsZTxhdG9tJFRleHRFZGl0b3I+IHtcclxuICByZXR1cm4gZ29Ub0xvY2F0aW9uU3ViamVjdDtcclxufVxyXG4iXX0=