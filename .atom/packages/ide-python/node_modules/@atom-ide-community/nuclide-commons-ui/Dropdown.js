"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "ButtonSizes", {
  enumerable: true,
  get: function () {
    return _Button.ButtonSizes;
  }
});
exports.DropdownButton = exports.Dropdown = void 0;

var _classnames = _interopRequireDefault(require("classnames"));

var _assert = _interopRequireDefault(require("assert"));

var React = _interopRequireWildcard(require("react"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _Button = require("./Button");

var _Icon = require("./Icon");

var _electronRemote = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/electron-remote"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
(0, _assert.default)(_electronRemote.default != null); // For backwards compat, we have to do some conversion here.

class Dropdown extends React.Component {
  constructor(...args) {
    super(...args);
    this._menu = void 0;
    this._button = void 0;

    this._updateButtonRef = button => {
      this._button = button;
    };

    this._openMenu = event => {
      const buttonRect = (0, _nullthrows.default)(this._button).getBoundingClientRect();
      this._menu = this._menuFromOptions(this.props.options);

      this._menu.popup({
        x: Math.floor(buttonRect.left),
        y: Math.floor(buttonRect.bottom),
        async: true
      });

      event.stopPropagation();
    };
  }

  componentWillUnmount() {
    this._closeMenu();
  }

  componentDidUpdate() {
    this._closeMenu();
  }

  _closeMenu() {
    if (this._menu != null) {
      this._menu.closePopup();

      this._menu = null;
    }
  }

  render() {
    const {
      label: providedLabel,
      options,
      placeholder
    } = this.props;
    let label;

    if (providedLabel != null) {
      label = providedLabel;
    } else {
      const selectedOption = this._findSelectedOption(options);

      if (selectedOption == null) {
        if (placeholder != null) {
          label = placeholder;
        } else {
          label = this._renderSelectedLabel(options[0]);
        }
      } else {
        label = this._renderSelectedLabel(selectedOption);
      }
    }

    return /*#__PURE__*/React.createElement(DropdownButton, {
      buttonType: this.props.buttonType,
      className: this.props.className,
      disabled: this.props.disabled,
      onButtonDOMNodeChange: this._updateButtonRef,
      isFlat: this.props.isFlat,
      buttonComponent: this.props.buttonComponent,
      onExpand: this._openMenu,
      size: this.props.size,
      tooltip: this.props.tooltip,
      tabIndex: this.props.tabIndex
    }, label);
  }

  _renderSelectedLabel(option) {
    let text = null;

    if (option == null) {
      text = '';
    } else if (typeof option.selectedLabel === 'string') {
      text = option.selectedLabel;
    } else if (typeof option.label === 'string') {
      text = option.label;
    }

    if (text == null || text === '') {
      return null;
    }

    return text;
  }

  _menuFromOptions(options) {
    const menu = new _electronRemote.default.Menu();
    options.forEach(option => {
      if (option.type === 'separator') {
        menu.append(new _electronRemote.default.MenuItem({
          type: 'separator'
        }));
      } else if (option.type === 'submenu') {
        const submenu = option.submenu;
        menu.append(new _electronRemote.default.MenuItem({
          type: 'submenu',
          label: option.label,
          enabled: option.disabled !== true,
          submenu: this._menuFromOptions(submenu)
        }));
      } else if (!Boolean(option.hidden)) {
        menu.append(new _electronRemote.default.MenuItem({
          type: 'checkbox',
          checked: this._optionIsSelected(this.props.value, option.value),
          label: option.label,
          enabled: option.disabled !== true,
          click: () => {
            if (this.props.onChange != null) {
              this.props.onChange(option.value);
            }
          }
        }));
      }
    });
    return menu;
  }

  _optionIsSelected(dropdownValue, optionValue) {
    return this.props.selectionComparator ? this.props.selectionComparator(dropdownValue, optionValue) : dropdownValue === optionValue;
  }

  _findSelectedOption(options) {
    let result = null;

    for (const option of options) {
      if (option.type === 'separator') {
        continue;
      } else if (option.type === 'submenu') {
        const submenu = option.submenu;
        result = this._findSelectedOption(submenu);
      } else if (this._optionIsSelected(this.props.value, option.value)) {
        result = option;
      }

      if (result) {
        break;
      }
    }

    return result;
  }

}

exports.Dropdown = Dropdown;
Dropdown.defaultProps = {
  className: '',
  disabled: false,
  isFlat: false,
  options: [],
  value: null,
  title: ''
};

const noop = () => {};
/**
 * Just the button part. This is useful for when you want to customize the dropdown behavior (e.g.)
 * show it asynchronously.
 */


class DropdownButton extends React.Component {
  constructor(...args) {
    super(...args);
    this._button = void 0;
    this._disposable = void 0;

    this._handleButtonDOMNodeChange = button => {
      this._button = button;

      if (this.props.onButtonDOMNodeChange != null) {
        this.props.onButtonDOMNodeChange(button);
      }
    };
  }

  componentDidMount() {
    this._disposable = atom.commands.add((0, _nullthrows.default)(this._button), 'core:move-down', ({
      originalEvent
    }) => {
      (0, _assert.default)(originalEvent instanceof KeyboardEvent);

      if (this.props.onExpand != null) {
        this.props.onExpand(originalEvent);
      }
    });
  }

  componentWillUnmount() {
    (0, _nullthrows.default)(this._disposable).dispose();
  }

  render() {
    const {
      buttonComponent,
      buttonType,
      children,
      disabled,
      isFlat,
      onExpand,
      size,
      tooltip
    } = this.props;
    const ButtonComponent = buttonComponent || _Button.Button;
    const className = (0, _classnames.default)('nuclide-ui-dropdown', this.props.className, {
      'nuclide-ui-dropdown-flat': isFlat === true
    });
    const label = children == null ? /*#__PURE__*/React.createElement("span", {
      className: "sr-only"
    }, "Open Dropdown") : /*#__PURE__*/React.createElement("span", {
      className: "nuclide-dropdown-label-text-wrapper"
    }, children);
    return /*#__PURE__*/React.createElement(ButtonComponent, {
      buttonType: buttonType,
      onButtonDOMNodeChange: this._handleButtonDOMNodeChange,
      tooltip: tooltip,
      size: getButtonSize(size),
      className: className,
      disabled: disabled === true,
      onClick: onExpand || noop,
      tabIndex: this.props.tabIndex
    }, label, /*#__PURE__*/React.createElement(_Icon.Icon, {
      icon: "triangle-down",
      className: "nuclide-ui-dropdown-icon"
    }));
  }

}

exports.DropdownButton = DropdownButton;

function getButtonSize(size) {
  switch (size) {
    case 'xs':
      return 'EXTRA_SMALL';

    case 'sm':
      return 'SMALL';

    case 'lg':
      return 'LARGE';

    default:
      return 'SMALL';
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL0Ryb3Bkb3duLmpzIl0sIm5hbWVzIjpbInJlbW90ZSIsIkRyb3Bkb3duIiwiUmVhY3QiLCJDb21wb25lbnQiLCJfbWVudSIsIl9idXR0b24iLCJfdXBkYXRlQnV0dG9uUmVmIiwiYnV0dG9uIiwiX29wZW5NZW51IiwiZXZlbnQiLCJidXR0b25SZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiX21lbnVGcm9tT3B0aW9ucyIsInByb3BzIiwib3B0aW9ucyIsInBvcHVwIiwieCIsIk1hdGgiLCJmbG9vciIsImxlZnQiLCJ5IiwiYm90dG9tIiwiYXN5bmMiLCJzdG9wUHJvcGFnYXRpb24iLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIl9jbG9zZU1lbnUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJjbG9zZVBvcHVwIiwicmVuZGVyIiwibGFiZWwiLCJwcm92aWRlZExhYmVsIiwicGxhY2Vob2xkZXIiLCJzZWxlY3RlZE9wdGlvbiIsIl9maW5kU2VsZWN0ZWRPcHRpb24iLCJfcmVuZGVyU2VsZWN0ZWRMYWJlbCIsImJ1dHRvblR5cGUiLCJjbGFzc05hbWUiLCJkaXNhYmxlZCIsImlzRmxhdCIsImJ1dHRvbkNvbXBvbmVudCIsInNpemUiLCJ0b29sdGlwIiwidGFiSW5kZXgiLCJvcHRpb24iLCJ0ZXh0Iiwic2VsZWN0ZWRMYWJlbCIsIm1lbnUiLCJNZW51IiwiZm9yRWFjaCIsInR5cGUiLCJhcHBlbmQiLCJNZW51SXRlbSIsInN1Ym1lbnUiLCJlbmFibGVkIiwiQm9vbGVhbiIsImhpZGRlbiIsImNoZWNrZWQiLCJfb3B0aW9uSXNTZWxlY3RlZCIsInZhbHVlIiwiY2xpY2siLCJvbkNoYW5nZSIsImRyb3Bkb3duVmFsdWUiLCJvcHRpb25WYWx1ZSIsInNlbGVjdGlvbkNvbXBhcmF0b3IiLCJyZXN1bHQiLCJkZWZhdWx0UHJvcHMiLCJ0aXRsZSIsIm5vb3AiLCJEcm9wZG93bkJ1dHRvbiIsIl9kaXNwb3NhYmxlIiwiX2hhbmRsZUJ1dHRvbkRPTU5vZGVDaGFuZ2UiLCJvbkJ1dHRvbkRPTU5vZGVDaGFuZ2UiLCJjb21wb25lbnREaWRNb3VudCIsImF0b20iLCJjb21tYW5kcyIsImFkZCIsIm9yaWdpbmFsRXZlbnQiLCJLZXlib2FyZEV2ZW50Iiwib25FeHBhbmQiLCJkaXNwb3NlIiwiY2hpbGRyZW4iLCJCdXR0b25Db21wb25lbnQiLCJCdXR0b24iLCJnZXRCdXR0b25TaXplIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBZUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0FBdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFlQSxxQkFBVUEsMkJBQVUsSUFBcEIsRSxDQUVBOztBQXlETyxNQUFNQyxRQUFOLFNBQXVCQyxLQUFLLENBQUNDLFNBQTdCLENBQThDO0FBQUE7QUFBQTtBQUFBLFNBV25EQyxLQVhtRDtBQUFBLFNBWW5EQyxPQVptRDs7QUFBQSxTQTZCbkRDLGdCQTdCbUQsR0E2Qi9CQyxNQUFELElBQWdDO0FBQ2pELFdBQUtGLE9BQUwsR0FBZUUsTUFBZjtBQUNELEtBL0JrRDs7QUFBQSxTQXFGbkRDLFNBckZtRCxHQXFGdENDLEtBQUQsSUFBbUQ7QUFDN0QsWUFBTUMsVUFBVSxHQUFHLHlCQUFXLEtBQUtMLE9BQWhCLEVBQXlCTSxxQkFBekIsRUFBbkI7QUFDQSxXQUFLUCxLQUFMLEdBQWEsS0FBS1EsZ0JBQUwsQ0FBc0IsS0FBS0MsS0FBTCxDQUFXQyxPQUFqQyxDQUFiOztBQUNBLFdBQUtWLEtBQUwsQ0FBV1csS0FBWCxDQUFpQjtBQUNmQyxRQUFBQSxDQUFDLEVBQUVDLElBQUksQ0FBQ0MsS0FBTCxDQUFXUixVQUFVLENBQUNTLElBQXRCLENBRFk7QUFFZkMsUUFBQUEsQ0FBQyxFQUFFSCxJQUFJLENBQUNDLEtBQUwsQ0FBV1IsVUFBVSxDQUFDVyxNQUF0QixDQUZZO0FBR2ZDLFFBQUFBLEtBQUssRUFB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QyxJQUF2QixFQUEyRDtBQUN6RCxVQUFRQSxJQUFSO0FBQ0UsU0FBSyxJQUFMO0FBQ0UsYUFBTyxhQUFQOztBQUNGLFNBQUssSUFBTDtBQUNFLGFBQU8sT0FBUDs7QUFDRixTQUFLLElBQUw7QUFDRSxhQUFPLE9BQVA7O0FBQ0Y7QUFDRSxhQUFPLE9BQVA7QUFSSjtBQVVEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge0ljb25OYW1lfSBmcm9tICcuL0ljb24nO1xyXG5pbXBvcnQgdHlwZSB7QnV0dG9uVHlwZX0gZnJvbSAnLi9CdXR0b24nO1xyXG5cclxuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgbnVsbHRocm93cyBmcm9tICdudWxsdGhyb3dzJztcclxuXHJcbmltcG9ydCB7QnV0dG9uLCBCdXR0b25TaXplc30gZnJvbSAnLi9CdXR0b24nO1xyXG5pbXBvcnQge0ljb259IGZyb20gJy4vSWNvbic7XHJcblxyXG5pbXBvcnQgcmVtb3RlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2VsZWN0cm9uLXJlbW90ZSc7XHJcblxyXG5pbnZhcmlhbnQocmVtb3RlICE9IG51bGwpO1xyXG5cclxuLy8gRm9yIGJhY2t3YXJkcyBjb21wYXQsIHdlIGhhdmUgdG8gZG8gc29tZSBjb252ZXJzaW9uIGhlcmUuXHJcbnR5cGUgU2hvcnRCdXR0b25TaXplID0gJ3hzJyB8ICdzbScgfCAnbGcnO1xyXG50eXBlIEJ1dHRvblNpemUgPSAnRVhUUkFfU01BTEwnIHwgJ1NNQUxMJyB8ICdMQVJHRSc7XHJcblxyXG50eXBlIFNlcGFyYXRvciA9IHtcclxuICB0eXBlOiAnc2VwYXJhdG9yJyxcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIE1lbnVJdGVtID0ge1xyXG4gIHR5cGU/OiB2b2lkLFxyXG4gIHZhbHVlOiBhbnksXHJcbiAgbGFiZWw6IHN0cmluZyxcclxuICBzZWxlY3RlZExhYmVsPzogc3RyaW5nLFxyXG4gIHN1Ym1lbnU/OiB2b2lkLFxyXG4gIGljb24/OiBJY29uTmFtZSxcclxuICBpY29uc2V0Pzogc3RyaW5nLFxyXG4gIGRpc2FibGVkPzogYm9vbGVhbixcclxuICBoaWRkZW4/OiBib29sZWFuLFxyXG59O1xyXG5cclxudHlwZSBTdWJNZW51SXRlbSA9IHtcclxuICB0eXBlOiAnc3VibWVudScsXHJcbiAgbGFiZWw6IHN0cmluZyxcclxuICBzdWJtZW51OiBBcnJheTxPcHRpb24+LFxyXG4gIGljb24/OiBJY29uTmFtZSxcclxuICBpY29uc2V0Pzogc3RyaW5nLFxyXG4gIGRpc2FibGVkPzogYm9vbGVhbixcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIE9wdGlvbiA9IFNlcGFyYXRvciB8IE1lbnVJdGVtIHwgU3ViTWVudUl0ZW07XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIGNsYXNzTmFtZTogc3RyaW5nLFxyXG4gIGRpc2FibGVkPzogYm9vbGVhbixcclxuXHJcbiAgLy8gTm9ybWFsbHksIGEgZHJvcGRvd24gaXMgc3R5bGVkIGxpa2UgYSBidXR0b24uIFRoaXMgcHJvcCBhbGxvd3MgeW91IHRvIGF2b2lkIHRoYXQuXHJcbiAgaXNGbGF0OiBib29sZWFuLFxyXG5cclxuICB2YWx1ZTogYW55LFxyXG4gIC8vIElmIHByb3ZpZGVkLCB0aGlzIHdpbGwgYmUgcmVuZGVyZWQgYXMgdGhlIGxhYmVsIGlmIHRoZSB2YWx1ZSBpcyBudWxsLlxyXG4gIC8vIE90aGVyd2lzZSwgd2UnbGwgZGlzcGxheSB0aGUgZmlyc3Qgb3B0aW9uIGFzIHNlbGVjdGVkIGJ5IGRlZmF1bHQuXHJcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmcsXHJcbiAgLy8gSWYgcHJvdmlkZWQsIHRoaXMgc3RyaW5nIHdpbGwgYWx3YXlzIGJlIHVzZWQgYXMgdGhlIGxhYmVsXHJcbiAgbGFiZWw/OiBzdHJpbmcsXHJcbiAgYnV0dG9uQ29tcG9uZW50PzogUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+LFxyXG4gIGJ1dHRvblR5cGU/OiA/QnV0dG9uVHlwZSxcclxuICBvcHRpb25zOiAkUmVhZE9ubHlBcnJheTxPcHRpb24+LFxyXG4gIG9uQ2hhbmdlPzogKHZhbHVlOiBhbnkpID0+IG1peGVkLFxyXG4gIHNpemU/OiBTaG9ydEJ1dHRvblNpemUsXHJcbiAgdG9vbHRpcD86IGF0b20kVG9vbHRpcHNBZGRPcHRpb25zLFxyXG4gIHRhYkluZGV4Pzogc3RyaW5nLFxyXG5cclxuICAvLyBGdW5jdGlvbiB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIGFuIG9wdGlvbiBpcyBzZWxlY3RlZCwgdXNlZnVsIGlmIGl0c1xyXG4gIC8vIHZhbHVlIGRvZXNuJ3QgbWF0Y2ggdGhlIHBvaW50ZXIgdG8gYHZhbHVlYC4gPT09IGlzIHVzZWQgYnkgZGVmYXVsdC5cclxuICBzZWxlY3Rpb25Db21wYXJhdG9yPzogKGRyb3Bkb3duVmFsdWU6IGFueSwgb3B0aW9uVmFsdWU6IGFueSkgPT4gYm9vbGVhbixcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBEcm9wZG93biBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcz4ge1xyXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XHJcbiAgICBjbGFzc05hbWU6ICcnLFxyXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxyXG4gICAgaXNGbGF0OiBmYWxzZSxcclxuICAgIG9wdGlvbnM6IFtdLFxyXG4gICAgdmFsdWU6IChudWxsOiBhbnkpLFxyXG4gICAgdGl0bGU6ICcnLFxyXG4gIH07XHJcblxyXG4gIC8vIE1ha2Ugc3VyZSB0aGF0IG1lbnVzIGRvbid0IG91dGxpdmUgdGhlIGRyb3Bkb3duLlxyXG4gIF9tZW51OiA/cmVtb3RlLk1lbnU7XHJcbiAgX2J1dHRvbjogP0hUTUxCdXR0b25FbGVtZW50O1xyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIHRoaXMuX2Nsb3NlTWVudSgpO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xyXG4gICAgdGhpcy5fY2xvc2VNZW51KCk7XHJcbiAgfVxyXG5cclxuICBfY2xvc2VNZW51KCkge1xyXG4gICAgaWYgKHRoaXMuX21lbnUgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLl9tZW51LmNsb3NlUG9wdXAoKTtcclxuICAgICAgdGhpcy5fbWVudSA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlQnV0dG9uUmVmID0gKGJ1dHRvbjogP0hUTUxCdXR0b25FbGVtZW50KSA9PiB7XHJcbiAgICB0aGlzLl9idXR0b24gPSBidXR0b247XHJcbiAgfTtcclxuXHJcbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xyXG4gICAgY29uc3Qge2xhYmVsOiBwcm92aWRlZExhYmVsLCBvcHRpb25zLCBwbGFjZWhvbGRlcn0gPSB0aGlzLnByb3BzO1xyXG4gICAgbGV0IGxhYmVsO1xyXG4gICAgaWYgKHByb3ZpZGVkTGFiZWwgIT0gbnVsbCkge1xyXG4gICAgICBsYWJlbCA9IHByb3ZpZGVkTGFiZWw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IHRoaXMuX2ZpbmRTZWxlY3RlZE9wdGlvbihvcHRpb25zKTtcclxuXHJcbiAgICAgIGlmIChzZWxlY3RlZE9wdGlvbiA9PSBudWxsKSB7XHJcbiAgICAgICAgaWYgKHBsYWNlaG9sZGVyICE9IG51bGwpIHtcclxuICAgICAgICAgIGxhYmVsID0gcGxhY2Vob2xkZXI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxhYmVsID0gdGhpcy5fcmVuZGVyU2VsZWN0ZWRMYWJlbChvcHRpb25zWzBdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGFiZWwgPSB0aGlzLl9yZW5kZXJTZWxlY3RlZExhYmVsKHNlbGVjdGVkT3B0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxEcm9wZG93bkJ1dHRvblxyXG4gICAgICAgIGJ1dHRvblR5cGU9e3RoaXMucHJvcHMuYnV0dG9uVHlwZX1cclxuICAgICAgICBjbGFzc05hbWU9e3RoaXMucHJvcHMuY2xhc3NOYW1lfVxyXG4gICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkfVxyXG4gICAgICAgIG9uQnV0dG9uRE9NTm9kZUNoYW5nZT17dGhpcy5fdXBkYXRlQnV0dG9uUmVmfVxyXG4gICAgICAgIGlzRmxhdD17dGhpcy5wcm9wcy5pc0ZsYXR9XHJcbiAgICAgICAgYnV0dG9uQ29tcG9uZW50PXt0aGlzLnByb3BzLmJ1dHRvbkNvbXBvbmVudH1cclxuICAgICAgICBvbkV4cGFuZD17dGhpcy5fb3Blbk1lbnV9XHJcbiAgICAgICAgc2l6ZT17dGhpcy5wcm9wcy5zaXplfVxyXG4gICAgICAgIHRvb2x0aXA9e3RoaXMucHJvcHMudG9vbHRpcH1cclxuICAgICAgICB0YWJJbmRleD17dGhpcy5wcm9wcy50YWJJbmRleH0+XHJcbiAgICAgICAge2xhYmVsfVxyXG4gICAgICA8L0Ryb3Bkb3duQnV0dG9uPlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJTZWxlY3RlZExhYmVsKG9wdGlvbjogP09wdGlvbik6ID9zdHJpbmcge1xyXG4gICAgbGV0IHRleHQgPSBudWxsO1xyXG4gICAgaWYgKG9wdGlvbiA9PSBudWxsKSB7XHJcbiAgICAgIHRleHQgPSAnJztcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbi5zZWxlY3RlZExhYmVsID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0ZXh0ID0gb3B0aW9uLnNlbGVjdGVkTGFiZWw7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb24ubGFiZWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRleHQgPSBvcHRpb24ubGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRleHQgPT0gbnVsbCB8fCB0ZXh0ID09PSAnJykge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiB0ZXh0O1xyXG4gIH1cclxuXHJcbiAgX29wZW5NZW51ID0gKGV2ZW50OiBTeW50aGV0aWNFdmVudDw+IHwgS2V5Ym9hcmRFdmVudCk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3QgYnV0dG9uUmVjdCA9IG51bGx0aHJvd3ModGhpcy5fYnV0dG9uKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIHRoaXMuX21lbnUgPSB0aGlzLl9tZW51RnJvbU9wdGlvbnModGhpcy5wcm9wcy5vcHRpb25zKTtcclxuICAgIHRoaXMuX21lbnUucG9wdXAoe1xyXG4gICAgICB4OiBNYXRoLmZsb29yKGJ1dHRvblJlY3QubGVmdCksXHJcbiAgICAgIHk6IE1hdGguZmxvb3IoYnV0dG9uUmVjdC5ib3R0b20pLFxyXG4gICAgICBhc3luYzogdHJ1ZSxcclxuICAgIH0pO1xyXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgfTtcclxuXHJcbiAgX21lbnVGcm9tT3B0aW9ucyhvcHRpb25zOiAkUmVhZE9ubHlBcnJheTxPcHRpb24+KTogcmVtb3RlLk1lbnUge1xyXG4gICAgY29uc3QgbWVudSA9IG5ldyByZW1vdGUuTWVudSgpO1xyXG4gICAgb3B0aW9ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XHJcbiAgICAgIGlmIChvcHRpb24udHlwZSA9PT0gJ3NlcGFyYXRvcicpIHtcclxuICAgICAgICBtZW51LmFwcGVuZChuZXcgcmVtb3RlLk1lbnVJdGVtKHt0eXBlOiAnc2VwYXJhdG9yJ30pKTtcclxuICAgICAgfSBlbHNlIGlmIChvcHRpb24udHlwZSA9PT0gJ3N1Ym1lbnUnKSB7XHJcbiAgICAgICAgY29uc3Qgc3VibWVudSA9ICgob3B0aW9uLnN1Ym1lbnU6IGFueSk6IEFycmF5PE9wdGlvbj4pO1xyXG4gICAgICAgIG1lbnUuYXBwZW5kKFxyXG4gICAgICAgICAgbmV3IHJlbW90ZS5NZW51SXRlbSh7XHJcbiAgICAgICAgICAgIHR5cGU6ICdzdWJtZW51JyxcclxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbi5sYWJlbCxcclxuICAgICAgICAgICAgZW5hYmxlZDogb3B0aW9uLmRpc2FibGVkICE9PSB0cnVlLFxyXG4gICAgICAgICAgICBzdWJtZW51OiB0aGlzLl9tZW51RnJvbU9wdGlvbnMoc3VibWVudSksXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICApO1xyXG4gICAgICB9IGVsc2UgaWYgKCFCb29sZWFuKG9wdGlvbi5oaWRkZW4pKSB7XHJcbiAgICAgICAgbWVudS5hcHBlbmQoXHJcbiAgICAgICAgICBuZXcgcmVtb3RlLk1lbnVJdGVtKHtcclxuICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JyxcclxuICAgICAgICAgICAgY2hlY2tlZDogdGhpcy5fb3B0aW9uSXNTZWxlY3RlZCh0aGlzLnByb3BzLnZhbHVlLCBvcHRpb24udmFsdWUpLFxyXG4gICAgICAgICAgICBsYWJlbDogb3B0aW9uLmxhYmVsLFxyXG4gICAgICAgICAgICBlbmFibGVkOiBvcHRpb24uZGlzYWJsZWQgIT09IHRydWUsXHJcbiAgICAgICAgICAgIGNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25DaGFuZ2UgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZShvcHRpb24udmFsdWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1lbnU7XHJcbiAgfVxyXG5cclxuICBfb3B0aW9uSXNTZWxlY3RlZChkcm9wZG93blZhbHVlOiBhbnksIG9wdGlvblZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnByb3BzLnNlbGVjdGlvbkNvbXBhcmF0b3JcclxuICAgICAgPyB0aGlzLnByb3BzLnNlbGVjdGlvbkNvbXBhcmF0b3IoZHJvcGRvd25WYWx1ZSwgb3B0aW9uVmFsdWUpXHJcbiAgICAgIDogZHJvcGRvd25WYWx1ZSA9PT0gb3B0aW9uVmFsdWU7XHJcbiAgfVxyXG5cclxuICBfZmluZFNlbGVjdGVkT3B0aW9uKG9wdGlvbnM6ICRSZWFkT25seUFycmF5PE9wdGlvbj4pOiA/T3B0aW9uIHtcclxuICAgIGxldCByZXN1bHQgPSBudWxsO1xyXG4gICAgZm9yIChjb25zdCBvcHRpb24gb2Ygb3B0aW9ucykge1xyXG4gICAgICBpZiAob3B0aW9uLnR5cGUgPT09ICdzZXBhcmF0b3InKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9uLnR5cGUgPT09ICdzdWJtZW51Jykge1xyXG4gICAgICAgIGNvbnN0IHN1Ym1lbnUgPSAoKG9wdGlvbi5zdWJtZW51OiBhbnkpOiBBcnJheTxPcHRpb24+KTtcclxuICAgICAgICByZXN1bHQgPSB0aGlzLl9maW5kU2VsZWN0ZWRPcHRpb24oc3VibWVudSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fb3B0aW9uSXNTZWxlY3RlZCh0aGlzLnByb3BzLnZhbHVlLCBvcHRpb24udmFsdWUpKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gb3B0aW9uO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG59XHJcblxyXG50eXBlIERyb3Bkb3duQnV0dG9uUHJvcHMgPSB7XHJcbiAgYnV0dG9uQ29tcG9uZW50PzogUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+LFxyXG4gIGJ1dHRvblR5cGU/OiA/QnV0dG9uVHlwZSxcclxuICBjaGlsZHJlbj86IGFueSxcclxuICBjbGFzc05hbWU6IHN0cmluZyxcclxuICBkaXNhYmxlZD86IGJvb2xlYW4sXHJcbiAgaXNGbGF0PzogYm9vbGVhbixcclxuICBzaXplPzogU2hvcnRCdXR0b25TaXplLFxyXG4gIHRvb2x0aXA/OiBhdG9tJFRvb2x0aXBzQWRkT3B0aW9ucyxcclxuICBvbkV4cGFuZD86IChldmVudDogU3ludGhldGljTW91c2VFdmVudDw+IHwgS2V5Ym9hcmRFdmVudCkgPT4gdm9pZCxcclxuICBvbkJ1dHRvbkRPTU5vZGVDaGFuZ2U/OiAoP0hUTUxCdXR0b25FbGVtZW50KSA9PiBtaXhlZCxcclxuICB0YWJJbmRleD86IHN0cmluZyxcclxufTtcclxuXHJcbmNvbnN0IG5vb3AgPSAoKSA9PiB7fTtcclxuXHJcbi8qKlxyXG4gKiBKdXN0IHRoZSBidXR0b24gcGFydC4gVGhpcyBpcyB1c2VmdWwgZm9yIHdoZW4geW91IHdhbnQgdG8gY3VzdG9taXplIHRoZSBkcm9wZG93biBiZWhhdmlvciAoZS5nLilcclxuICogc2hvdyBpdCBhc3luY2hyb25vdXNseS5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBEcm9wZG93bkJ1dHRvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxEcm9wZG93bkJ1dHRvblByb3BzPiB7XHJcbiAgX2J1dHRvbjogP0hUTUxCdXR0b25FbGVtZW50O1xyXG4gIF9kaXNwb3NhYmxlOiA/SURpc3Bvc2FibGU7XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZSA9IGF0b20uY29tbWFuZHMuYWRkKFxyXG4gICAgICBudWxsdGhyb3dzKHRoaXMuX2J1dHRvbiksXHJcbiAgICAgICdjb3JlOm1vdmUtZG93bicsXHJcbiAgICAgICh7b3JpZ2luYWxFdmVudH0pID0+IHtcclxuICAgICAgICBpbnZhcmlhbnQob3JpZ2luYWxFdmVudCBpbnN0YW5jZW9mIEtleWJvYXJkRXZlbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uRXhwYW5kICE9IG51bGwpIHtcclxuICAgICAgICAgIHRoaXMucHJvcHMub25FeHBhbmQob3JpZ2luYWxFdmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgbnVsbHRocm93cyh0aGlzLl9kaXNwb3NhYmxlKS5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlQnV0dG9uRE9NTm9kZUNoYW5nZSA9IChidXR0b246ID9IVE1MQnV0dG9uRWxlbWVudCkgPT4ge1xyXG4gICAgdGhpcy5fYnV0dG9uID0gYnV0dG9uO1xyXG4gICAgaWYgKHRoaXMucHJvcHMub25CdXR0b25ET01Ob2RlQ2hhbmdlICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5wcm9wcy5vbkJ1dHRvbkRPTU5vZGVDaGFuZ2UoYnV0dG9uKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGJ1dHRvbkNvbXBvbmVudCxcclxuICAgICAgYnV0dG9uVHlwZSxcclxuICAgICAgY2hpbGRyZW4sXHJcbiAgICAgIGRpc2FibGVkLFxyXG4gICAgICBpc0ZsYXQsXHJcbiAgICAgIG9uRXhwYW5kLFxyXG4gICAgICBzaXplLFxyXG4gICAgICB0b29sdGlwLFxyXG4gICAgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgQnV0dG9uQ29tcG9uZW50ID0gYnV0dG9uQ29tcG9uZW50IHx8IEJ1dHRvbjtcclxuICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNsYXNzbmFtZXMoJ251Y2xpZGUtdWktZHJvcGRvd24nLCB0aGlzLnByb3BzLmNsYXNzTmFtZSwge1xyXG4gICAgICAnbnVjbGlkZS11aS1kcm9wZG93bi1mbGF0JzogaXNGbGF0ID09PSB0cnVlLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgbGFiZWwgPVxyXG4gICAgICBjaGlsZHJlbiA9PSBudWxsID8gKFxyXG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cInNyLW9ubHlcIj5PcGVuIERyb3Bkb3duPC9zcGFuPlxyXG4gICAgICApIDogKFxyXG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm51Y2xpZGUtZHJvcGRvd24tbGFiZWwtdGV4dC13cmFwcGVyXCI+e2NoaWxkcmVufTwvc3Bhbj5cclxuICAgICAgKTtcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8QnV0dG9uQ29tcG9uZW50XHJcbiAgICAgICAgYnV0dG9uVHlwZT17YnV0dG9uVHlwZX1cclxuICAgICAgICBvbkJ1dHRvbkRPTU5vZGVDaGFuZ2U9e3RoaXMuX2hhbmRsZUJ1dHRvbkRPTU5vZGVDaGFuZ2V9XHJcbiAgICAgICAgdG9vbHRpcD17dG9vbHRpcH1cclxuICAgICAgICBzaXplPXtnZXRCdXR0b25TaXplKHNpemUpfVxyXG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxyXG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZCA9PT0gdHJ1ZX1cclxuICAgICAgICBvbkNsaWNrPXtvbkV4cGFuZCB8fCBub29wfVxyXG4gICAgICAgIHRhYkluZGV4PXt0aGlzLnByb3BzLnRhYkluZGV4fT5cclxuICAgICAgICB7bGFiZWx9XHJcbiAgICAgICAgPEljb24gaWNvbj1cInRyaWFuZ2xlLWRvd25cIiBjbGFzc05hbWU9XCJudWNsaWRlLXVpLWRyb3Bkb3duLWljb25cIiAvPlxyXG4gICAgICA8L0J1dHRvbkNvbXBvbmVudD5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRCdXR0b25TaXplKHNpemU6ID9TaG9ydEJ1dHRvblNpemUpOiBCdXR0b25TaXplIHtcclxuICBzd2l0Y2ggKHNpemUpIHtcclxuICAgIGNhc2UgJ3hzJzpcclxuICAgICAgcmV0dXJuICdFWFRSQV9TTUFMTCc7XHJcbiAgICBjYXNlICdzbSc6XHJcbiAgICAgIHJldHVybiAnU01BTEwnO1xyXG4gICAgY2FzZSAnbGcnOlxyXG4gICAgICByZXR1cm4gJ0xBUkdFJztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiAnU01BTEwnO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHtCdXR0b25TaXplc307XHJcbiJdfQ==