"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _assert = _interopRequireDefault(require("assert"));

var _collection = require("@atom-ide-community/nuclide-commons/collection");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class HighlightedText extends React.Component {
  shouldComponentUpdate(nextProps) {
    return this.props.text !== nextProps.text || !(0, _collection.arrayEqual)(this.props.highlightedRanges, nextProps.highlightedRanges, rangeEqual);
  }

  render() {
    const {
      className,
      highlightedRanges,
      style,
      text
    } = this.props; // generate counterpart unhighlightedRanges for the highlightedRanges

    const unhighlightedRanges = [];

    for (let i = 0; i < highlightedRanges.length; i++) {
      const lastHighlighted = highlightedRanges[i - 1];
      const currentHighlighted = highlightedRanges[i];

      if (lastHighlighted == null) {
        // there's an opportunity for a minor correctness/optimization to not
        // include a [0, 0] range, but this is an internal process and it
        // preserves a handy property that unmatched always preceeds matched.
        // We don't render zero-length slices below anyway.
        unhighlightedRanges.push([0, currentHighlighted[0]]);
      } else {
        unhighlightedRanges.push([lastHighlighted[1], currentHighlighted[0]]);
      }

      if ( // if the last matched range
      i === highlightedRanges.length - 1 && // doesn't end perfectly at the end of the text,
      currentHighlighted[1] !== text.length) {
        // add an additional unmatched range to cover the rest of the text
        unhighlightedRanges.push([currentHighlighted[1], text.length]);
      }
    }

    if (unhighlightedRanges.length === 0) {
      unhighlightedRanges.push([0, text.length]);
    }

    (0, _assert.default)(unhighlightedRanges.length === highlightedRanges.length || unhighlightedRanges.length === highlightedRanges.length + 1);
    const renderedSequences = [];

    for (let i = 0; i < unhighlightedRanges.length; i++) {
      const unhighlightedRange = unhighlightedRanges[i];
      const highlightedRange = highlightedRanges[i];

      if (!rangeEmpty(unhighlightedRange)) {
        renderedSequences.push(renderUnmatchedSubsequence(text.slice(unhighlightedRange[0], unhighlightedRange[1]), unhighlightedRange.join(',')));
      }

      if (highlightedRange != null && !rangeEmpty(highlightedRange)) {
        renderedSequences.push(renderMatchedSubsequence(text.slice(highlightedRange[0], highlightedRange[1]), highlightedRange.join(',')));
      }
    }

    return /*#__PURE__*/React.createElement("span", {
      className: className,
      style: style
    }, renderedSequences);
  }

}

exports.default = HighlightedText;

function renderSubsequence(seq, props) {
  return /*#__PURE__*/React.createElement("span", props, seq);
}

function renderUnmatchedSubsequence(seq, key) {
  return renderSubsequence(seq, {
    key
  });
}

function renderMatchedSubsequence(seq, key) {
  return renderSubsequence(seq, {
    key,
    className: 'nuclide-match-highlighted-text-match'
  });
}

function rangeEqual(a, b) {
  return a[0] === b[0] && a[1] === b[1];
}

function rangeEmpty(range) {
  return range[0] === range[1];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL0hpZ2hsaWdodGVkVGV4dC5qcyJdLCJuYW1lcyI6WyJIaWdobGlnaHRlZFRleHQiLCJSZWFjdCIsIkNvbXBvbmVudCIsInNob3VsZENvbXBvbmVudFVwZGF0ZSIsIm5leHRQcm9wcyIsInByb3BzIiwidGV4dCIsImhpZ2hsaWdodGVkUmFuZ2VzIiwicmFuZ2VFcXVhbCIsInJlbmRlciIsImNsYXNzTmFtZSIsInN0eWxlIiwidW5oaWdobGlnaHRlZFJhbmdlcyIsImkiLCJsZW5ndGgiLCJsYXN0SGlnaGxpZ2h0ZWQiLCJjdXJyZW50SGlnaGxpZ2h0ZWQiLCJwdXNoIiwicmVuZGVyZWRTZXF1ZW5jZXMiLCJ1bmhpZ2hsaWdodGVkUmFuZ2UiLCJoaWdobGlnaHRlZFJhbmdlIiwicmFuZ2VFbXB0eSIsInJlbmRlclVubWF0Y2hlZFN1YnNlcXVlbmNlIiwic2xpY2UiLCJqb2luIiwicmVuZGVyTWF0Y2hlZFN1YnNlcXVlbmNlIiwicmVuZGVyU3Vic2VxdWVuY2UiLCJzZXEiLCJrZXkiLCJhIiwiYiIsInJhbmdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW1CZSxNQUFNQSxlQUFOLFNBQThCQyxLQUFLLENBQUNDLFNBQXBDLENBQXFEO0FBQ2xFQyxFQUFBQSxxQkFBcUIsQ0FBQ0MsU0FBRCxFQUFtQjtBQUN0QyxXQUNFLEtBQUtDLEtBQUwsQ0FBV0MsSUFBWCxLQUFvQkYsU0FBUyxDQUFDRSxJQUE5QixJQUNBLENBQUMsNEJBQ0MsS0FBS0QsS0FBTCxDQUFXRSxpQkFEWixFQUVDSCxTQUFTLENBQUNHLGlCQUZYLEVBR0NDLFVBSEQsQ0FGSDtBQVFEOztBQUVEQyxFQUFBQSxNQUFNLEdBQXVCO0FBQzNCLFVBQU07QUFBQ0MsTUFBQUEsU0FBRDtBQUFZSCxNQUFBQSxp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LEVBQUVkLFNBQWpCO0FBQTRCLE1BQUEsS0FBSyxFQUFFQztBQUFuQyxPQUNHTyxpQkFESCxDQURGO0FBS0Q7O0FBOUVpRTs7OztBQWlGcEUsU0FBU1EsaUJBQVQsQ0FBMkJDLEdBQTNCLEVBQXdDdEIsS0FBeEMsRUFBMkU7QUFDekUsc0JBQU8sNEJBQVVBLEtBQVYsRUFBa0JzQixHQUFsQixDQUFQO0FBQ0Q7O0FBRUQsU0FBU0wsMEJBQVQsQ0FDRUssR0FERixFQUVFQyxHQUZGLEVBR3NCO0FBQ3BCLFNBQU9GLGlCQUFpQixDQUFDQyxHQUFELEVBQU07QUFBQ0MsSUFBQUE7QUFBRCxHQUFOLENBQXhCO0FBQ0Q7O0FBRUQsU0FBU0gsd0JBQVQsQ0FDRUUsR0FERixFQUVFQyxHQUZGLEVBR3NCO0FBQ3BCLFNBQU9GLGlCQUFpQixDQUFDQyxHQUFELEVBQU07QUFDNUJDLElBQUFBLEdBRDRCO0FBRTVCbEIsSUFBQUEsU0FBUyxFQUFFO0FBRmlCLEdBQU4sQ0FBeEI7QUFJRDs7QUFFRCxTQUFTRixVQUFULENBQW9CcUIsQ0FBcEIsRUFBa0NDLENBQWxDLEVBQXlEO0FBQ3ZELFNBQU9ELENBQUMsQ0FBQyxDQUFELENBQUQsS0FBU0MsQ0FBQyxDQUFDLENBQUQsQ0FBVixJQUFpQkQsQ0FBQyxDQUFDLENBQUQsQ0FBRCxLQUFTQyxDQUFDLENBQUMsQ0FBRCxDQUFsQztBQUNEOztBQUVELFNBQVNULFVBQVQsQ0FBb0JVLEtBQXBCLEVBQStDO0FBQzdDLFNBQU9BLEtBQUssQ0FBQyxDQUFELENBQUwsS0FBYUEsS0FBSyxDQUFDLENBQUQsQ0FBekI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IGludmFyaWFudCBmcm9tICdhc3NlcnQnO1xyXG5pbXBvcnQge2FycmF5RXF1YWx9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2NvbGxlY3Rpb24nO1xyXG5cclxuZXhwb3J0IHR5cGUgVGV4dFJhbmdlID0gWy8qIHN0YXJ0ICovIG51bWJlciwgLyogZW5kICovIG51bWJlcl07XHJcbnR5cGUgUHJvcHMgPSB7fFxyXG4gIGNsYXNzTmFtZT86ID9zdHJpbmcsXHJcbiAgLypcclxuICAgKiBBIGxpc3Qgb2YgcmFuZ2VzIG9mIHRoZSB0ZXh0IHN0cmluZyAocGFpcnMgb2YgaW5kZXhlcywgaW5jbHVzaXZlIGxvd2VyXHJcbiAgICogYm91bmQsIGV4Y2x1c2l2ZSB1cHBlciBib3VuZCAtLSBqdXN0IGxpa2UgLnNsaWNlKCkpIHRoYXQgc2hvdWxkIGJlXHJcbiAgICogaGlnaGxpZ2h0ZWRcclxuICAgKi9cclxuICBoaWdobGlnaHRlZFJhbmdlczogQXJyYXk8VGV4dFJhbmdlPixcclxuICBzdHlsZT86ID9PYmplY3QsXHJcbiAgdGV4dDogc3RyaW5nLFxyXG58fTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhpZ2hsaWdodGVkVGV4dCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcz4ge1xyXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHM6IFByb3BzKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLnByb3BzLnRleHQgIT09IG5leHRQcm9wcy50ZXh0IHx8XHJcbiAgICAgICFhcnJheUVxdWFsKFxyXG4gICAgICAgIHRoaXMucHJvcHMuaGlnaGxpZ2h0ZWRSYW5nZXMsXHJcbiAgICAgICAgbmV4dFByb3BzLmhpZ2hsaWdodGVkUmFuZ2VzLFxyXG4gICAgICAgIHJhbmdlRXF1YWwsXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKTogUmVhY3QuRWxlbWVudDxhbnk+IHtcclxuICAgIGNvbnN0IHtjbGFzc05hbWUsIGhpZ2hsaWdodGVkUmFuZ2VzLCBzdHlsZSwgdGV4dH0gPSB0aGlzLnByb3BzO1xyXG5cclxuICAgIC8vIGdlbmVyYXRlIGNvdW50ZXJwYXJ0IHVuaGlnaGxpZ2h0ZWRSYW5nZXMgZm9yIHRoZSBoaWdobGlnaHRlZFJhbmdlc1xyXG4gICAgY29uc3QgdW5oaWdobGlnaHRlZFJhbmdlczogQXJyYXk8VGV4dFJhbmdlPiA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaWdobGlnaHRlZFJhbmdlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBsYXN0SGlnaGxpZ2h0ZWQgPSBoaWdobGlnaHRlZFJhbmdlc1tpIC0gMV07XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRIaWdobGlnaHRlZCA9IGhpZ2hsaWdodGVkUmFuZ2VzW2ldO1xyXG5cclxuICAgICAgaWYgKGxhc3RIaWdobGlnaHRlZCA9PSBudWxsKSB7XHJcbiAgICAgICAgLy8gdGhlcmUncyBhbiBvcHBvcnR1bml0eSBmb3IgYSBtaW5vciBjb3JyZWN0bmVzcy9vcHRpbWl6YXRpb24gdG8gbm90XHJcbiAgICAgICAgLy8gaW5jbHVkZSBhIFswLCAwXSByYW5nZSwgYnV0IHRoaXMgaXMgYW4gaW50ZXJuYWwgcHJvY2VzcyBhbmQgaXRcclxuICAgICAgICAvLyBwcmVzZXJ2ZXMgYSBoYW5keSBwcm9wZXJ0eSB0aGF0IHVubWF0Y2hlZCBhbHdheXMgcHJlY2VlZHMgbWF0Y2hlZC5cclxuICAgICAgICAvLyBXZSBkb24ndCByZW5kZXIgemVyby1sZW5ndGggc2xpY2VzIGJlbG93IGFueXdheS5cclxuICAgICAgICB1bmhpZ2hsaWdodGVkUmFuZ2VzLnB1c2goWzAsIGN1cnJlbnRIaWdobGlnaHRlZFswXV0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVuaGlnaGxpZ2h0ZWRSYW5nZXMucHVzaChbbGFzdEhpZ2hsaWdodGVkWzFdLCBjdXJyZW50SGlnaGxpZ2h0ZWRbMF1dKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKFxyXG4gICAgICAgIC8vIGlmIHRoZSBsYXN0IG1hdGNoZWQgcmFuZ2VcclxuICAgICAgICBpID09PSBoaWdobGlnaHRlZFJhbmdlcy5sZW5ndGggLSAxICYmXHJcbiAgICAgICAgLy8gZG9lc24ndCBlbmQgcGVyZmVjdGx5IGF0IHRoZSBlbmQgb2YgdGhlIHRleHQsXHJcbiAgICAgICAgY3VycmVudEhpZ2hsaWdodGVkWzFdICE9PSB0ZXh0Lmxlbmd0aFxyXG4gICAgICApIHtcclxuICAgICAgICAvLyBhZGQgYW4gYWRkaXRpb25hbCB1bm1hdGNoZWQgcmFuZ2UgdG8gY292ZXIgdGhlIHJlc3Qgb2YgdGhlIHRleHRcclxuICAgICAgICB1bmhpZ2hsaWdodGVkUmFuZ2VzLnB1c2goW2N1cnJlbnRIaWdobGlnaHRlZFsxXSwgdGV4dC5sZW5ndGhdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh1bmhpZ2hsaWdodGVkUmFuZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB1bmhpZ2hsaWdodGVkUmFuZ2VzLnB1c2goWzAsIHRleHQubGVuZ3RoXSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW52YXJpYW50KFxyXG4gICAgICB1bmhpZ2hsaWdodGVkUmFuZ2VzLmxlbmd0aCA9PT0gaGlnaGxpZ2h0ZWRSYW5nZXMubGVuZ3RoIHx8XHJcbiAgICAgICAgdW5oaWdobGlnaHRlZFJhbmdlcy5sZW5ndGggPT09IGhpZ2hsaWdodGVkUmFuZ2VzLmxlbmd0aCArIDEsXHJcbiAgICApO1xyXG4gICAgY29uc3QgcmVuZGVyZWRTZXF1ZW5jZXM6IEFycmF5PFJlYWN0LkVsZW1lbnQ8YW55Pj4gPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5oaWdobGlnaHRlZFJhbmdlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB1bmhpZ2hsaWdodGVkUmFuZ2UgPSB1bmhpZ2hsaWdodGVkUmFuZ2VzW2ldO1xyXG4gICAgICBjb25zdCBoaWdobGlnaHRlZFJhbmdlID0gaGlnaGxpZ2h0ZWRSYW5nZXNbaV07XHJcbiAgICAgIGlmICghcmFuZ2VFbXB0eSh1bmhpZ2hsaWdodGVkUmFuZ2UpKSB7XHJcbiAgICAgICAgcmVuZGVyZWRTZXF1ZW5jZXMucHVzaChcclxuICAgICAgICAgIHJlbmRlclVubWF0Y2hlZFN1YnNlcXVlbmNlKFxyXG4gICAgICAgICAgICB0ZXh0LnNsaWNlKHVuaGlnaGxpZ2h0ZWRSYW5nZVswXSwgdW5oaWdobGlnaHRlZFJhbmdlWzFdKSxcclxuICAgICAgICAgICAgdW5oaWdobGlnaHRlZFJhbmdlLmpvaW4oJywnKSxcclxuICAgICAgICAgICksXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGhpZ2hsaWdodGVkUmFuZ2UgIT0gbnVsbCAmJiAhcmFuZ2VFbXB0eShoaWdobGlnaHRlZFJhbmdlKSkge1xyXG4gICAgICAgIHJlbmRlcmVkU2VxdWVuY2VzLnB1c2goXHJcbiAgICAgICAgICByZW5kZXJNYXRjaGVkU3Vic2VxdWVuY2UoXHJcbiAgICAgICAgICAgIHRleHQuc2xpY2UoaGlnaGxpZ2h0ZWRSYW5nZVswXSwgaGlnaGxpZ2h0ZWRSYW5nZVsxXSksXHJcbiAgICAgICAgICAgIGhpZ2hsaWdodGVkUmFuZ2Uuam9pbignLCcpLFxyXG4gICAgICAgICAgKSxcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IHN0eWxlPXtzdHlsZX0+XHJcbiAgICAgICAge3JlbmRlcmVkU2VxdWVuY2VzfVxyXG4gICAgICA8L3NwYW4+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyU3Vic2VxdWVuY2Uoc2VxOiBzdHJpbmcsIHByb3BzOiBPYmplY3QpOiBSZWFjdC5FbGVtZW50PGFueT4ge1xyXG4gIHJldHVybiA8c3BhbiB7Li4ucHJvcHN9PntzZXF9PC9zcGFuPjtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyVW5tYXRjaGVkU3Vic2VxdWVuY2UoXHJcbiAgc2VxOiBzdHJpbmcsXHJcbiAga2V5OiBudW1iZXIgfCBzdHJpbmcsXHJcbik6IFJlYWN0LkVsZW1lbnQ8YW55PiB7XHJcbiAgcmV0dXJuIHJlbmRlclN1YnNlcXVlbmNlKHNlcSwge2tleX0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXJNYXRjaGVkU3Vic2VxdWVuY2UoXHJcbiAgc2VxOiBzdHJpbmcsXHJcbiAga2V5OiBudW1iZXIgfCBzdHJpbmcsXHJcbik6IFJlYWN0LkVsZW1lbnQ8YW55PiB7XHJcbiAgcmV0dXJuIHJlbmRlclN1YnNlcXVlbmNlKHNlcSwge1xyXG4gICAga2V5LFxyXG4gICAgY2xhc3NOYW1lOiAnbnVjbGlkZS1tYXRjaC1oaWdobGlnaHRlZC10ZXh0LW1hdGNoJyxcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmFuZ2VFcXVhbChhOiBUZXh0UmFuZ2UsIGI6IFRleHRSYW5nZSk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJhbmdlRW1wdHkocmFuZ2U6IFRleHRSYW5nZSk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiByYW5nZVswXSA9PT0gcmFuZ2VbMV07XHJcbn1cclxuIl19