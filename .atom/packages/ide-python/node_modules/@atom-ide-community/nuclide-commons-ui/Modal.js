"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Modal = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

/**
 * Shows a modal dialog when rendered, using Atom's APIs (atom.workspace.addModalPanel).
 */
class Modal extends React.Component {
  constructor(...args) {
    super(...args);
    this._container = void 0;
    this._cancelDisposable = void 0;
    this._innerElement = void 0;
    this._panel = void 0;

    this._handleWindowClick = event => {
      // If the user clicks outside of the modal, and not on a tooltip or
      // notification, close it.
      if (this._innerElement && !this._innerElement.contains(event.target) && event.target.closest('atom-notifications, .tooltip') == null) {
        this.props.onDismiss();
      }
    };

    this._handleContainerInnerElement = el => {
      if (this._cancelDisposable != null) {
        this._cancelDisposable.dispose();
      }

      this._innerElement = el;

      if (el == null) {
        return;
      }

      el.focus();
      this._cancelDisposable = new _UniversalDisposable.default(atom.commands.add(window, 'core:cancel', () => {
        this.props.onDismiss();
      }), _rxjsCompatUmdMin.Observable.fromEvent(window, 'mousedown') // Ignore clicks in the current tick. We don't want to capture the click that showed this
      // modal.
      .skipUntil(_rxjsCompatUmdMin.Observable.interval(0).first()).subscribe(this._handleWindowClick));
    };
  }

  UNSAFE_componentWillMount() {
    this._container = document.createElement('div');
    this._panel = atom.workspace.addModalPanel({
      item: this._container,
      className: this.props.modalClassName
    });
  }

  componentWillUnmount() {
    this._panel.destroy();
  }

  componentDidUpdate(prevProps) {
    const {
      modalClassName
    } = this.props;
    const {
      modalClassName: prevModalClassName
    } = prevProps;

    const panelElement = this._panel.getElement();

    if (prevModalClassName != null) {
      panelElement.classList.remove(...prevModalClassName.split(/\s+/).filter(token => token.length > 0));
    }

    if (modalClassName != null) {
      panelElement.classList.add(...modalClassName.split(/\s+/).filter(token => token.length > 0));
    }
  }

  render() {
    const {
      modalClassName,
      children,
      onDismiss,
      ...props
    } = this.props;
    return /*#__PURE__*/_reactDom.default.createPortal( /*#__PURE__*/React.createElement("div", _extends({
      tabIndex: "0"
    }, props, {
      ref: this._handleContainerInnerElement
    }), this.props.children), this._container);
  }

}

exports.Modal = Modal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL01vZGFsLmpzIl0sIm5hbWVzIjpbIk1vZGFsIiwiUmVhY3QiLCJDb21wb25lbnQiLCJfY29udGFpbmVyIiwiX2NhbmNlbERpc3Bvc2FibGUiLCJfaW5uZXJFbGVtZW50IiwiX3BhbmVsIiwiX2hhbmRsZVdpbmRvd0NsaWNrIiwiZXZlbnQiLCJjb250YWlucyIsInRhcmdldCIsImNsb3Nlc3QiLCJwcm9wcyIsIm9uRGlzbWlzcyIsIl9oYW5kbGVDb250YWluZXJJbm5lckVsZW1lbnQiLCJlbCIsImRpc3Bvc2UiLCJmb2N1cyIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJhdG9tIiwiY29tbWFuZHMiLCJhZGQiLCJ3aW5kb3ciLCJPYnNlcnZhYmxlIiwiZnJvbUV2ZW50Iiwic2tpcFVudGlsIiwiaW50ZXJ2YWwiLCJmaXJzdCIsInN1YnNjcmliZSIsIlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ3b3Jrc3BhY2UiLCJhZGRNb2RhbFBhbmVsIiwiaXRlbSIsImNsYXNzTmFtZSIsIm1vZGFsQ2xhc3NOYW1lIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkZXN0cm95IiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwicHJldk1vZGFsQ2xhc3NOYW1lIiwicGFuZWxFbGVtZW50IiwiZ2V0RWxlbWVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNwbGl0IiwiZmlsdGVyIiwidG9rZW4iLCJsZW5ndGgiLCJyZW5kZXIiLCJjaGlsZHJlbiIsIlJlYWN0RE9NIiwiY3JlYXRlUG9ydGFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQSxLQUFOLFNBQW9CQyxLQUFLLENBQUNDLFNBQTFCLENBQTJDO0FBQUE7QUFBQTtBQUFBLFNBQ2hEQyxVQURnRDtBQUFB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QjtBQUFzQyxTQUFHRDtBQUF6QyxRQUFrRCxLQUFLQSxLQUE3RDtBQUNBLHdCQUFPd0Msa0JBQVNDLFlBQVQsZUFDTDtBQUFLLE1BQUEsUUFBUSxFQUFDO0FBQWQsT0FBc0J6QyxLQUF0QjtBQUE2QixNQUFBLEdBQUcsRUFBRSxLQUFLRTtBQUF2QyxRQUNHLEtBQUtGLEtBQUwsQ0FBV3VDLFFBRGQsQ0FESyxFQUlMLEtBQUtoRCxVQUpBLENBQVA7QUFNRDs7QUE5RStDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuLy8gREVQUkVDQVRFRCwgQVZPSUQgVVNJTkcgVEhJUy4gVXNlICdzaG93TW9kYWwnIGluIEBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLXVpIGluc3RlYWRcclxuXHJcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xyXG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qcyc7XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIGNoaWxkcmVuPzogYW55LFxyXG4gIG1vZGFsQ2xhc3NOYW1lPzogc3RyaW5nLFxyXG4gIG9uRGlzbWlzczogKCkgPT4gdm9pZCxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTaG93cyBhIG1vZGFsIGRpYWxvZyB3aGVuIHJlbmRlcmVkLCB1c2luZyBBdG9tJ3MgQVBJcyAoYXRvbS53b3Jrc3BhY2UuYWRkTW9kYWxQYW5lbCkuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTW9kYWwgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcclxuICBfY29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICBfY2FuY2VsRGlzcG9zYWJsZTogP0lEaXNwb3NhYmxlO1xyXG4gIF9pbm5lckVsZW1lbnQ6ID9IVE1MRWxlbWVudDtcclxuICBfcGFuZWw6IGF0b20kUGFuZWw7XHJcblxyXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHRoaXMuX3BhbmVsID0gYXRvbS53b3Jrc3BhY2UuYWRkTW9kYWxQYW5lbCh7XHJcbiAgICAgIGl0ZW06IHRoaXMuX2NvbnRhaW5lcixcclxuICAgICAgY2xhc3NOYW1lOiB0aGlzLnByb3BzLm1vZGFsQ2xhc3NOYW1lLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3BhbmVsLmRlc3Ryb3koKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzKTogdm9pZCB7XHJcbiAgICBjb25zdCB7bW9kYWxDbGFzc05hbWV9ID0gdGhpcy5wcm9wcztcclxuICAgIGNvbnN0IHttb2RhbENsYXNzTmFtZTogcHJldk1vZGFsQ2xhc3NOYW1lfSA9IHByZXZQcm9wcztcclxuICAgIGNvbnN0IHBhbmVsRWxlbWVudCA9IHRoaXMuX3BhbmVsLmdldEVsZW1lbnQoKTtcclxuICAgIGlmIChwcmV2TW9kYWxDbGFzc05hbWUgIT0gbnVsbCkge1xyXG4gICAgICBwYW5lbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcclxuICAgICAgICAuLi5wcmV2TW9kYWxDbGFzc05hbWUuc3BsaXQoL1xccysvKS5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubGVuZ3RoID4gMCksXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBpZiAobW9kYWxDbGFzc05hbWUgIT0gbnVsbCkge1xyXG4gICAgICBwYW5lbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcclxuICAgICAgICAuLi5tb2RhbENsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLmZpbHRlcih0b2tlbiA9PiB0b2tlbi5sZW5ndGggPiAwKSxcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVXaW5kb3dDbGljayA9IChldmVudDogU3ludGhldGljTW91c2VFdmVudDw+KTogdm9pZCA9PiB7XHJcbiAgICAvLyBJZiB0aGUgdXNlciBjbGlja3Mgb3V0c2lkZSBvZiB0aGUgbW9kYWwsIGFuZCBub3Qgb24gYSB0b29sdGlwIG9yXHJcbiAgICAvLyBub3RpZmljYXRpb24sIGNsb3NlIGl0LlxyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLl9pbm5lckVsZW1lbnQgJiZcclxuICAgICAgIXRoaXMuX2lubmVyRWxlbWVudC5jb250YWlucygoKGV2ZW50LnRhcmdldDogYW55KTogTm9kZSkpICYmXHJcbiAgICAgIChldmVudC50YXJnZXQ6IGFueSkuY2xvc2VzdCgnYXRvbS1ub3RpZmljYXRpb25zLCAudG9vbHRpcCcpID09IG51bGxcclxuICAgICkge1xyXG4gICAgICB0aGlzLnByb3BzLm9uRGlzbWlzcygpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIFNpbmNlIHdlJ3JlIHJlbmRlcmluZyBudWxsLCB3ZSBjYW4ndCB1c2UgYGZpbmRET01Ob2RlKHRoaXMpYC5cclxuICBfaGFuZGxlQ29udGFpbmVySW5uZXJFbGVtZW50ID0gKGVsOiA/SFRNTEVsZW1lbnQpOiB2b2lkID0+IHtcclxuICAgIGlmICh0aGlzLl9jYW5jZWxEaXNwb3NhYmxlICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fY2FuY2VsRGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5faW5uZXJFbGVtZW50ID0gZWw7XHJcbiAgICBpZiAoZWwgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZWwuZm9jdXMoKTtcclxuICAgIHRoaXMuX2NhbmNlbERpc3Bvc2FibGUgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZShcclxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQod2luZG93LCAnY29yZTpjYW5jZWwnLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkRpc21pc3MoKTtcclxuICAgICAgfSksXHJcbiAgICAgIE9ic2VydmFibGUuZnJvbUV2ZW50KHdpbmRvdywgJ21vdXNlZG93bicpXHJcbiAgICAgICAgLy8gSWdub3JlIGNsaWNrcyBpbiB0aGUgY3VycmVudCB0aWNrLiBXZSBkb24ndCB3YW50IHRvIGNhcHR1cmUgdGhlIGNsaWNrIHRoYXQgc2hvd2VkIHRoaXNcclxuICAgICAgICAvLyBtb2RhbC5cclxuICAgICAgICAuc2tpcFVudGlsKE9ic2VydmFibGUuaW50ZXJ2YWwoMCkuZmlyc3QoKSlcclxuICAgICAgICAuc3Vic2NyaWJlKHRoaXMuX2hhbmRsZVdpbmRvd0NsaWNrKSxcclxuICAgICk7XHJcbiAgfTtcclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgY29uc3Qge21vZGFsQ2xhc3NOYW1lLCBjaGlsZHJlbiwgb25EaXNtaXNzLCAuLi5wcm9wc30gPSB0aGlzLnByb3BzO1xyXG4gICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChcclxuICAgICAgPGRpdiB0YWJJbmRleD1cIjBcIiB7Li4ucHJvcHN9IHJlZj17dGhpcy5faGFuZGxlQ29udGFpbmVySW5uZXJFbGVtZW50fT5cclxuICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cclxuICAgICAgPC9kaXY+LFxyXG4gICAgICB0aGlzLl9jb250YWluZXIsXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=