"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MultiSelectList = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _classnames = _interopRequireDefault(require("classnames"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class MultiSelectList extends React.Component {
  constructor(props) {
    super(props);
    this._commandsDisposables = void 0;
    this.state = {
      selectedValue: null
    };
  }

  componentDidMount() {
    this._updateCommands();
  }

  componentDidUpdate(prevProps) {
    if (prevProps.commandScope !== this.props.commandScope) {
      this._updateCommands();
    }
  }

  _updateCommands() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }

    const el = this.props.commandScope || _reactDom.default.findDOMNode(this);

    this._commandsDisposables = new _UniversalDisposable.default(atom.commands.add( // $FlowFixMe
    el, {
      'core:move-up': () => {
        this._moveSelectionIndex(-1);
      },
      'core:move-down': () => {
        this._moveSelectionIndex(1);
      },
      'core:confirm': () => {
        const {
          selectedValue
        } = this.state;

        if (selectedValue != null) {
          this._toggleActive(selectedValue);
        }
      }
    }));
  }

  _moveSelectionIndex(delta) {
    const currentIndex = this.props.options.findIndex(option => option.value === this.state.selectedValue);
    const nextIndex = currentIndex + delta;

    if (nextIndex >= 0 && nextIndex < this.props.options.length) {
      this.setState({
        selectedValue: this.props.options[nextIndex].value
      });
    }
  }

  componentWillUnmount() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }
  }

  _toggleActive(value) {
    const activeValues = this.props.value.slice();
    const index = activeValues.indexOf(value);

    if (index === -1) {
      activeValues.push(value);
    } else {
      activeValues.splice(index, 1);
    }

    this.props.onChange(activeValues);
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "nuclide-multi-select-list select-list block",
      tabIndex: "0"
    }, /*#__PURE__*/React.createElement("ol", {
      className: "list-group mark-active"
    }, this._renderOptions()));
  }

  _renderOptions() {
    const OptionComponent = this.props.optionComponent || DefaultOptionComponent;
    return this.props.options.map((option, index) => {
      const selected = this.state.selectedValue === option.value;
      const active = this.props.value.indexOf(option.value) !== -1;
      const className = (0, _classnames.default)({
        clearfix: true,
        selected,
        active
      });
      return /*#__PURE__*/React.createElement("li", {
        key: index,
        className: className,
        onMouseOver: () => {
          this.setState({
            selectedValue: option.value
          });
        },
        onClick: () => {
          this._toggleActive(option.value);
        }
      }, /*#__PURE__*/React.createElement(OptionComponent, {
        option: option,
        active: active,
        selected: selected
      }));
    });
  }

}

exports.MultiSelectList = MultiSelectList;
MultiSelectList.defaultProps = {
  onChange: values => {},
  optionComponent: DefaultOptionComponent,
  options: [],
  value: []
};

function DefaultOptionComponent(props) {
  return /*#__PURE__*/React.createElement("span", null, props.option.label);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL011bHRpU2VsZWN0TGlzdC5qcyJdLCJuYW1lcyI6WyJNdWx0aVNlbGVjdExpc3QiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfY29tbWFuZHNEaXNwb3NhYmxlcyIsInN0YXRlIiwic2VsZWN0ZWRWYWx1ZSIsImNvbXBvbmVudERpZE1vdW50IiwiX3VwZGF0ZUNvbW1hbmRzIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwiY29tbWFuZFNjb3BlIiwiZGlzcG9zZSIsImVsIiwiUmVhY3RET00iLCJmaW5kRE9NTm9kZSIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJhdG9tIiwiY29tbWFuZHMiLCJhZGQiLCJfbW92ZVNlbGVjdGlvbkluZGV4IiwiX3RvZ2dsZUFjdGl2ZSIsImRlbHRhIiwiY3VycmVudEluZGV4Iiwib3B0aW9ucyIsImZpbmRJbmRleCIsIm9wdGlvbiIsInZhbHVlIiwibmV4dEluZGV4IiwibGVuZ3RoIiwic2V0U3RhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImFjdGl2ZVZhbHVlcyIsInNsaWNlIiwiaW5kZXgiLCJpbmRleE9mIiwicHVzaCIsInNwbGljZSIsIm9uQ2hhbmdlIiwicmVuZGVyIiwiX3JlbmRlck9wdGlvbnMiLCJPcHRpb25Db21wb25lbnQiLCJvcHRpb25Db21wb25lbnQiLCJEZWZhdWx0T3B0aW9uQ29tcG9uZW50IiwibWFwIiwic2VsZWN0ZWQiLCJhY3RpdmUiLCJjbGFzc05hbWUiLCJjbGVhcmZpeCIsImRlZmF1bHRQcm9wcyIsInZhbHVlcyIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW9DTyxNQUFNQSxlQUFOLFNBQThCQyxLQUFLLENBQUNDLFNB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QXpCTSxDQUFQO0FBMEJEOztBQXRIZ0U7OztBQUF0RDlDLGUsQ0FHSmtELFksR0FBNkI7QUFDbENYLEVBQUFBLFFBQVEsRUFBRVksTUFBTSxJQUFJLENBQUUsQ0FEWTtBQUVsQ1IsRUFBQUEsZUFBZSxFQUFFQyxzQkFGaUI7QUFHbENuQixFQUFBQSxPQUFPLEVBQUUsRUFIeUI7QUFJbENHLEVBQUFBLEtBQUssRUFBRTtBQUoyQixDOztBQStIdEMsU0FBU2dCLHNCQUFULENBQWdDeEMsS0FBaEMsRUFBNkQ7QUFDM0Qsc0JBQU8sa0NBQU9BLEtBQUssQ0FBQ3VCLE1BQU4sQ0FBYXlCLEtBQXBCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xyXG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuXHJcbnR5cGUgT3B0aW9uID0ge1xyXG4gIC8vICRGbG93Rml4TWUoPj0wLjUzLjApIEZsb3cgc3VwcHJlc3NcclxuICBsYWJlbDogUmVhY3QuQ2hpbGRyZW4sXHJcbiAgdmFsdWU6IGFueSxcclxufTtcclxuXHJcbnR5cGUgUHJvcHMgPSB7XHJcbiAgLy8gJEZsb3dGaXhNZSg+PTAuNTMuMCkgRmxvdyBzdXBwcmVzc1xyXG4gIG9wdGlvbkNvbXBvbmVudD86IChwcm9wczogT3B0aW9uQ29tcG9uZW50UHJvcHMpID0+IFJlYWN0LkVsZW1lbnQ8YW55PixcclxuICAvLyBUT0RPOiByZW1vdmUgZGlzYWJsZVxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby11bnVzZWQtcHJvcC10eXBlc1xyXG4gIGNsYXNzTmFtZT86IHN0cmluZyxcclxuICBvcHRpb25zOiBBcnJheTxPcHRpb24+LFxyXG4gIHZhbHVlOiBBcnJheTxhbnk+LFxyXG4gIG9uQ2hhbmdlOiAodmFsdWU6IEFycmF5PGFueT4pID0+IHZvaWQsXHJcbiAgY29tbWFuZFNjb3BlPzogSFRNTEVsZW1lbnQsXHJcbn07XHJcblxyXG50eXBlIFN0YXRlID0ge1xyXG4gIHNlbGVjdGVkVmFsdWU6IGFueSxcclxufTtcclxuXHJcbnR5cGUgRGVmYXVsdFByb3BzID0ge1xyXG4gIG9uQ2hhbmdlOiAodmFsdWU6IEFycmF5PGFueT4pID0+IHZvaWQsXHJcbiAgb3B0aW9uQ29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPE9wdGlvbkNvbXBvbmVudFByb3BzPixcclxuICB2YWx1ZTogQXJyYXk8YW55PixcclxuICBvcHRpb25zOiBBcnJheTxPcHRpb24+LFxyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIE11bHRpU2VsZWN0TGlzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBfY29tbWFuZHNEaXNwb3NhYmxlczogVW5pdmVyc2FsRGlzcG9zYWJsZTtcclxuXHJcbiAgc3RhdGljIGRlZmF1bHRQcm9wczogRGVmYXVsdFByb3BzID0ge1xyXG4gICAgb25DaGFuZ2U6IHZhbHVlcyA9PiB7fSxcclxuICAgIG9wdGlvbkNvbXBvbmVudDogRGVmYXVsdE9wdGlvbkNvbXBvbmVudCxcclxuICAgIG9wdGlvbnM6IFtdLFxyXG4gICAgdmFsdWU6IFtdLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgc2VsZWN0ZWRWYWx1ZTogbnVsbCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3VwZGF0ZUNvbW1hbmRzKCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcyk6IHZvaWQge1xyXG4gICAgaWYgKHByZXZQcm9wcy5jb21tYW5kU2NvcGUgIT09IHRoaXMucHJvcHMuY29tbWFuZFNjb3BlKSB7XHJcbiAgICAgIHRoaXMuX3VwZGF0ZUNvbW1hbmRzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlQ29tbWFuZHMoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcyAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZWwgPSB0aGlzLnByb3BzLmNvbW1hbmRTY29wZSB8fCBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcclxuICAgIHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZShcclxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoXHJcbiAgICAgICAgLy8gJEZsb3dGaXhNZVxyXG4gICAgICAgIGVsLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICdjb3JlOm1vdmUtdXAnOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdmVTZWxlY3Rpb25JbmRleCgtMSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgJ2NvcmU6bW92ZS1kb3duJzogKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9tb3ZlU2VsZWN0aW9uSW5kZXgoMSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgJ2NvcmU6Y29uZmlybSc6ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qge3NlbGVjdGVkVmFsdWV9ID0gdGhpcy5zdGF0ZTtcclxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkVmFsdWUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuX3RvZ2dsZUFjdGl2ZShzZWxlY3RlZFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICApLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9tb3ZlU2VsZWN0aW9uSW5kZXgoZGVsdGE6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5wcm9wcy5vcHRpb25zLmZpbmRJbmRleChcclxuICAgICAgb3B0aW9uID0+IG9wdGlvbi52YWx1ZSA9PT0gdGhpcy5zdGF0ZS5zZWxlY3RlZFZhbHVlLFxyXG4gICAgKTtcclxuICAgIGNvbnN0IG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIGRlbHRhO1xyXG4gICAgaWYgKG5leHRJbmRleCA+PSAwICYmIG5leHRJbmRleCA8IHRoaXMucHJvcHMub3B0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7c2VsZWN0ZWRWYWx1ZTogdGhpcy5wcm9wcy5vcHRpb25zW25leHRJbmRleF0udmFsdWV9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLl9jb21tYW5kc0Rpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF90b2dnbGVBY3RpdmUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc3QgYWN0aXZlVmFsdWVzID0gdGhpcy5wcm9wcy52YWx1ZS5zbGljZSgpO1xyXG4gICAgY29uc3QgaW5kZXggPSBhY3RpdmVWYWx1ZXMuaW5kZXhPZih2YWx1ZSk7XHJcbiAgICBpZiAoaW5kZXggPT09IC0xKSB7XHJcbiAgICAgIGFjdGl2ZVZhbHVlcy5wdXNoKHZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFjdGl2ZVZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZShhY3RpdmVWYWx1ZXMpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJudWNsaWRlLW11bHRpLXNlbGVjdC1saXN0IHNlbGVjdC1saXN0IGJsb2NrXCIgdGFiSW5kZXg9XCIwXCI+XHJcbiAgICAgICAgPG9sIGNsYXNzTmFtZT1cImxpc3QtZ3JvdXAgbWFyay1hY3RpdmVcIj57dGhpcy5fcmVuZGVyT3B0aW9ucygpfTwvb2w+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJPcHRpb25zKCk6IEFycmF5PFJlYWN0LkVsZW1lbnQ8YW55Pj4ge1xyXG4gICAgY29uc3QgT3B0aW9uQ29tcG9uZW50ID1cclxuICAgICAgdGhpcy5wcm9wcy5vcHRpb25Db21wb25lbnQgfHwgRGVmYXVsdE9wdGlvbkNvbXBvbmVudDtcclxuICAgIHJldHVybiB0aGlzLnByb3BzLm9wdGlvbnMubWFwKChvcHRpb24sIGluZGV4KSA9PiB7XHJcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zdGF0ZS5zZWxlY3RlZFZhbHVlID09PSBvcHRpb24udmFsdWU7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZSA9IHRoaXMucHJvcHMudmFsdWUuaW5kZXhPZihvcHRpb24udmFsdWUpICE9PSAtMTtcclxuICAgICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NuYW1lcyh7XHJcbiAgICAgICAgY2xlYXJmaXg6IHRydWUsXHJcbiAgICAgICAgc2VsZWN0ZWQsXHJcbiAgICAgICAgYWN0aXZlLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICA8bGlcclxuICAgICAgICAgIGtleT17aW5kZXh9XHJcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cclxuICAgICAgICAgIG9uTW91c2VPdmVyPXsoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe3NlbGVjdGVkVmFsdWU6IG9wdGlvbi52YWx1ZX0pO1xyXG4gICAgICAgICAgfX1cclxuICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlQWN0aXZlKG9wdGlvbi52YWx1ZSk7XHJcbiAgICAgICAgICB9fT5cclxuICAgICAgICAgIDxPcHRpb25Db21wb25lbnRcclxuICAgICAgICAgICAgb3B0aW9uPXtvcHRpb259XHJcbiAgICAgICAgICAgIGFjdGl2ZT17YWN0aXZlfVxyXG4gICAgICAgICAgICBzZWxlY3RlZD17c2VsZWN0ZWR9XHJcbiAgICAgICAgICAvPlxyXG4gICAgICAgIDwvbGk+XHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIE9wdGlvbkNvbXBvbmVudFByb3BzID0ge1xyXG4gIG9wdGlvbjogT3B0aW9uLFxyXG4gIC8vIFRPRE86IHJlbW92ZSBkaXNhYmxlXHJcbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3Qvbm8tdW51c2VkLXByb3AtdHlwZXMgKi9cclxuICBhY3RpdmU6IGJvb2xlYW4sXHJcbiAgc2VsZWN0ZWQ6IGJvb2xlYW4sXHJcbiAgLyogZXNsaW50LWVuYWJsZSByZWFjdC9uby11bnVzZWQtcHJvcC10eXBlcyAqL1xyXG59O1xyXG5cclxuZnVuY3Rpb24gRGVmYXVsdE9wdGlvbkNvbXBvbmVudChwcm9wczogT3B0aW9uQ29tcG9uZW50UHJvcHMpIHtcclxuICByZXR1cm4gPHNwYW4+e3Byb3BzLm9wdGlvbi5sYWJlbH08L3NwYW4+O1xyXG59XHJcbiJdfQ==