"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DecorationIcons = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _classnames = _interopRequireDefault(require("classnames"));

var _log4js = require("log4js");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _Icon = require("./Icon");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function WarningIconWithShadow() {
  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("svg", {
    className: "nuclide-ui-path-with-file-icon-warning-icon-background",
    width: "20",
    height: "18",
    viewBox: "0 0 20 20",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/React.createElement("polygon", {
    points: "10,2 0,18 20,18"
  })), /*#__PURE__*/React.createElement(_Icon.Icon, {
    className: "text-warning",
    icon: "alert"
  }));
}

function ErrorIconWithShadow() {
  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("svg", {
    className: "nuclide-ui-path-with-file-icon-error-icon-background",
    width: "16",
    height: "16",
    viewBox: "0 0 16 16",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/React.createElement("circle", {
    cx: "10",
    cy: "10",
    r: "8"
  })), /*#__PURE__*/React.createElement(_Icon.Icon, {
    className: "text-error",
    icon: "stop"
  }));
} // The decoration icons require a backdrop to be fully visible,
// so we only allow the following, blessed decorations:


const DecorationIcons = Object.freeze({
  Warning: WarningIconWithShadow,
  Error: ErrorIconWithShadow
});
exports.DecorationIcons = DecorationIcons;
let addItemToElement;
atom.packages.serviceHub.consume('file-icons.element-icons', '1.0.0', _addItemToElement => {
  addItemToElement = (element, path) => {
    try {
      return _addItemToElement(element, path);
    } catch (e) {
      (0, _log4js.getLogger)('nuclide-ui-path-with-file-icon').error('Error adding item to element', e);
      return new _UniversalDisposable.default();
    }
  };

  return new _UniversalDisposable.default(() => {
    addItemToElement = null;
  });
});

class PathWithFileIcon extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;
    this._fileIconsDisposable = void 0;
    this._mounted = void 0;

    this._handleRef = element => {
      if (this.props.isFolder) {
        return;
      }

      this._ensureIconRemoved();

      if (addItemToElement == null) {
        // file-icons service not available; ignore.
        return;
      }

      if (element == null) {
        // Element is unmounting.
        return;
      }

      this._fileIconsDisposable = addItemToElement(element, this.props.path);
    };

    this._mounted = false;
    this._disposables = new _UniversalDisposable.default(() => {
      if (this._fileIconsDisposable != null) {
        this._fileIconsDisposable.dispose();
      }
    });
  }

  componentDidMount() {
    this._mounted = true;
  }

  componentDidUpdate(prevProps) {
    if (prevProps.path !== this.props.path) {
      this._forceIconUpdate();
    }
  }

  _getDefaultClassName() {
    const {
      className,
      isFolder
    } = this.props;
    return (0, _classnames.default)('icon', 'name', 'nuclide-ui-path-with-file-icon', {
      'icon-file-text': isFolder !== true,
      'icon-file-directory': isFolder === true
    }, className);
  }

  _forceIconUpdate() {
    if (!this._mounted) {
      return;
    }

    const element = _reactDom.default.findDOMNode(this); // $FlowIssue `element` is an HTMLElement


    this._handleRef(element);
  }

  _ensureIconRemoved() {
    if (this._fileIconsDisposable == null) {
      return;
    }

    this._fileIconsDisposable.dispose();

    this._fileIconsDisposable = null;
  }

  componentWillUnmount() {
    this._disposables.dispose();

    this._mounted = false;
  }

  render() {
    const {
      className,
      children,
      decorationIcon: DecorationIcon,
      isFolder,
      path,
      // forward properties such as `data-path`, etc
      ...rest
    } = this.props;
    const displayPath = children == null ? path : children;
    const decoration = DecorationIcon == null ? null : /*#__PURE__*/React.createElement("div", {
      className: "nuclide-ui-path-with-file-icon-decoration-icon"
    }, /*#__PURE__*/React.createElement(DecorationIcon, null));
    return /*#__PURE__*/React.createElement("div", _extends({
      className: this._getDefaultClassName(),
      ref: this._handleRef
    }, rest), displayPath, decoration);
  }

}

exports.default = PathWithFileIcon;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1BhdGhXaXRoRmlsZUljb24uanMiXSwibmFtZXMiOlsiV2FybmluZ0ljb25XaXRoU2hhZG93IiwiRXJyb3JJY29uV2l0aFNoYWRvdyIsIkRlY29yYXRpb25JY29ucyIsIk9iamVjdCIsImZyZWV6ZSIsIldhcm5pbmciLCJFcnJvciIsImFkZEl0ZW1Ub0VsZW1lbnQiLCJhdG9tIiwicGFja2FnZXMiLCJzZXJ2aWNlSHViIiwiY29uc3VtZSIsIl9hZGRJdGVtVG9FbGVtZW50IiwiZWxlbWVudCIsInBhdGgiLCJlIiwiZXJyb3IiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiUGF0aFdpdGhGaWxlSWNvbiIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsIl9kaXNwb3NhYmxlcyIsIl9maWxlSWNvbnNEaXNwb3NhYmxlIiwiX21vdW50ZWQiLCJfaGFuZGxlUmVmIiwiaXNGb2xkZXIiLCJfZW5zdXJlSWNvblJlbW92ZWQiLCJkaXNwb3NlIiwiY29tcG9uZW50RGlkTW91bnQiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJfZm9yY2VJY29uVXBkYXRlIiwiX2dldERlZmF1bHRDbGFzc05hbWUiLCJjbGFzc05hbWUiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW5kZXIiLCJjaGlsZHJlbiIsImRlY29yYXRpb25JY29uIiwiRGVjb3JhdGlvbkljb24iLCJyZXN0IiwiZGlzcGxheVBhdGgiLCJkZWNvcmF0aW9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxxQkFBVCxHQUE2QztBQUMzQyxzQkFDRSw4Q0FDRTtBQUNFLElBQUEsU0FBUyxFQUFDLHdEQURaO0FBRUUsSUFBQSxLQUFLLEVBQUMsSUFGUjtBQUdFLElBQUEsTUFBTSxF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UlQ7QUFTQSxVQUFNc0IsV0FBVyxHQUFHSixRQUFRLElBQUksSUFBWixHQUFtQjFCLElBQW5CLEdBQTBCMEIsUUFBOUM7QUFDQSxVQUFNSyxVQUFVLEdBQ2RILGNBQWMsSUFBSSxJQUFsQixHQUF5QixJQUF6QixnQkFDRTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBRUUsb0JBQUMsY0FBRCxPQUZGLENBRko7QUFPQSx3QkFDRTtBQUNFLE1BQUEsU0FBUyxFQUFFLEtBQUtSLG9CQUFMLEVBRGI7QUFFRSxNQUFBLEdBQUcsRUFBRSxLQUFLUjtBQUZaLE9BR01pQixJQUhOLEdBSUdDLFdBSkgsRUFLR0MsVUFMSCxDQURGO0FBU0Q7O0FBeEdrRSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XHJcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xyXG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSAnbG9nNGpzJztcclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XHJcbmltcG9ydCB7SWNvbn0gZnJvbSAnLi9JY29uJztcclxuXHJcbmZ1bmN0aW9uIFdhcm5pbmdJY29uV2l0aFNoYWRvdygpOiBSZWFjdC5Ob2RlIHtcclxuICByZXR1cm4gKFxyXG4gICAgPGRpdj5cclxuICAgICAgPHN2Z1xyXG4gICAgICAgIGNsYXNzTmFtZT1cIm51Y2xpZGUtdWktcGF0aC13aXRoLWZpbGUtaWNvbi13YXJuaW5nLWljb24tYmFja2dyb3VuZFwiXHJcbiAgICAgICAgd2lkdGg9XCIyMFwiXHJcbiAgICAgICAgaGVpZ2h0PVwiMThcIlxyXG4gICAgICAgIHZpZXdCb3g9XCIwIDAgMjAgMjBcIlxyXG4gICAgICAgIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cclxuICAgICAgICA8cG9seWdvbiBwb2ludHM9XCIxMCwyIDAsMTggMjAsMThcIiAvPlxyXG4gICAgICA8L3N2Zz5cclxuICAgICAgPEljb24gY2xhc3NOYW1lPVwidGV4dC13YXJuaW5nXCIgaWNvbj1cImFsZXJ0XCIgLz5cclxuICAgIDwvZGl2PlxyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEVycm9ySWNvbldpdGhTaGFkb3coKTogUmVhY3QuTm9kZSB7XHJcbiAgcmV0dXJuIChcclxuICAgIDxkaXY+XHJcbiAgICAgIDxzdmdcclxuICAgICAgICBjbGFzc05hbWU9XCJudWNsaWRlLXVpLXBhdGgtd2l0aC1maWxlLWljb24tZXJyb3ItaWNvbi1iYWNrZ3JvdW5kXCJcclxuICAgICAgICB3aWR0aD1cIjE2XCJcclxuICAgICAgICBoZWlnaHQ9XCIxNlwiXHJcbiAgICAgICAgdmlld0JveD1cIjAgMCAxNiAxNlwiXHJcbiAgICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxyXG4gICAgICAgIDxjaXJjbGUgY3g9XCIxMFwiIGN5PVwiMTBcIiByPVwiOFwiIC8+XHJcbiAgICAgIDwvc3ZnPlxyXG4gICAgICA8SWNvbiBjbGFzc05hbWU9XCJ0ZXh0LWVycm9yXCIgaWNvbj1cInN0b3BcIiAvPlxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufVxyXG5cclxuLy8gVGhlIGRlY29yYXRpb24gaWNvbnMgcmVxdWlyZSBhIGJhY2tkcm9wIHRvIGJlIGZ1bGx5IHZpc2libGUsXHJcbi8vIHNvIHdlIG9ubHkgYWxsb3cgdGhlIGZvbGxvd2luZywgYmxlc3NlZCBkZWNvcmF0aW9uczpcclxuZXhwb3J0IGNvbnN0IERlY29yYXRpb25JY29ucyA9IE9iamVjdC5mcmVlemUoe1xyXG4gIFdhcm5pbmc6IFdhcm5pbmdJY29uV2l0aFNoYWRvdyxcclxuICBFcnJvcjogRXJyb3JJY29uV2l0aFNoYWRvdyxcclxufSk7XHJcblxyXG5leHBvcnQgdHlwZSBGaWxlSWNvbnNBZGRJdGVtVG9FbGVtZW50Rm4gPSAoXHJcbiAgZWxlbWVudDogSFRNTEVsZW1lbnQsXHJcbiAgcGF0aDogc3RyaW5nLFxyXG4pID0+IElEaXNwb3NhYmxlO1xyXG5cclxudHlwZSBQcm9wcyA9IHtcclxuICBjbGFzc05hbWU/OiBzdHJpbmcsXHJcbiAgY2hpbGRyZW4/OiBSZWFjdC5Ob2RlLFxyXG4gIC8vIE9wdGlvbmFsIDxJY29uIC8+IGVsZW1lbnQuIElmIHNldCwgd2lsbCByZW5kZXIgYSBzbWFsbCB2ZXJzaW9uIG9mXHJcbiAgLy8gdGhlIGRlY29yYXRpb25JY29uIG9uIHRvcCBvZiB0aGUgZmlsZSBpY29uLlxyXG4gIGRlY29yYXRpb25JY29uPzogdHlwZW9mIFdhcm5pbmdJY29uV2l0aFNoYWRvdyB8IHR5cGVvZiBFcnJvckljb25XaXRoU2hhZG93LFxyXG4gIGlzRm9sZGVyPzogYm9vbGVhbixcclxuICBwYXRoOiBzdHJpbmcsXHJcbn07XHJcblxyXG5sZXQgYWRkSXRlbVRvRWxlbWVudDogP0ZpbGVJY29uc0FkZEl0ZW1Ub0VsZW1lbnRGbjtcclxuYXRvbS5wYWNrYWdlcy5zZXJ2aWNlSHViLmNvbnN1bWUoXHJcbiAgJ2ZpbGUtaWNvbnMuZWxlbWVudC1pY29ucycsXHJcbiAgJzEuMC4wJyxcclxuICAoX2FkZEl0ZW1Ub0VsZW1lbnQ6IEZpbGVJY29uc0FkZEl0ZW1Ub0VsZW1lbnRGbikgPT4ge1xyXG4gICAgYWRkSXRlbVRvRWxlbWVudCA9IChlbGVtZW50OiBIVE1MRWxlbWVudCwgcGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIF9hZGRJdGVtVG9FbGVtZW50KGVsZW1lbnQsIHBhdGgpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgZ2V0TG9nZ2VyKCdudWNsaWRlLXVpLXBhdGgtd2l0aC1maWxlLWljb24nKS5lcnJvcihcclxuICAgICAgICAgICdFcnJvciBhZGRpbmcgaXRlbSB0byBlbGVtZW50JyxcclxuICAgICAgICAgIGUsXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIGFkZEl0ZW1Ub0VsZW1lbnQgPSBudWxsO1xyXG4gICAgfSk7XHJcbiAgfSxcclxuKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhdGhXaXRoRmlsZUljb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcclxuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XHJcbiAgX2ZpbGVJY29uc0Rpc3Bvc2FibGU6ID9JRGlzcG9zYWJsZTtcclxuICBfbW91bnRlZDogYm9vbGVhbjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgICB0aGlzLl9tb3VudGVkID0gZmFsc2U7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuX2ZpbGVJY29uc0Rpc3Bvc2FibGUgIT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX2ZpbGVJY29uc0Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fbW91bnRlZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcykge1xyXG4gICAgaWYgKHByZXZQcm9wcy5wYXRoICE9PSB0aGlzLnByb3BzLnBhdGgpIHtcclxuICAgICAgdGhpcy5fZm9yY2VJY29uVXBkYXRlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlUmVmID0gKGVsZW1lbnQ6ID9IVE1MRWxlbWVudCk6IHZvaWQgPT4ge1xyXG4gICAgaWYgKHRoaXMucHJvcHMuaXNGb2xkZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fZW5zdXJlSWNvblJlbW92ZWQoKTtcclxuICAgIGlmIChhZGRJdGVtVG9FbGVtZW50ID09IG51bGwpIHtcclxuICAgICAgLy8gZmlsZS1pY29ucyBzZXJ2aWNlIG5vdCBhdmFpbGFibGU7IGlnbm9yZS5cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGVsZW1lbnQgPT0gbnVsbCkge1xyXG4gICAgICAvLyBFbGVtZW50IGlzIHVubW91bnRpbmcuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuX2ZpbGVJY29uc0Rpc3Bvc2FibGUgPSBhZGRJdGVtVG9FbGVtZW50KGVsZW1lbnQsIHRoaXMucHJvcHMucGF0aCk7XHJcbiAgfTtcclxuXHJcbiAgX2dldERlZmF1bHRDbGFzc05hbWUoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHtjbGFzc05hbWUsIGlzRm9sZGVyfSA9IHRoaXMucHJvcHM7XHJcbiAgICByZXR1cm4gY2xhc3NuYW1lcyhcclxuICAgICAgJ2ljb24nLFxyXG4gICAgICAnbmFtZScsXHJcbiAgICAgICdudWNsaWRlLXVpLXBhdGgtd2l0aC1maWxlLWljb24nLFxyXG4gICAgICB7XHJcbiAgICAgICAgJ2ljb24tZmlsZS10ZXh0JzogaXNGb2xkZXIgIT09IHRydWUsXHJcbiAgICAgICAgJ2ljb24tZmlsZS1kaXJlY3RvcnknOiBpc0ZvbGRlciA9PT0gdHJ1ZSxcclxuICAgICAgfSxcclxuICAgICAgY2xhc3NOYW1lLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9mb3JjZUljb25VcGRhdGUoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuX21vdW50ZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZWxlbWVudCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xyXG4gICAgLy8gJEZsb3dJc3N1ZSBgZWxlbWVudGAgaXMgYW4gSFRNTEVsZW1lbnRcclxuICAgIHRoaXMuX2hhbmRsZVJlZihlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIF9lbnN1cmVJY29uUmVtb3ZlZCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9maWxlSWNvbnNEaXNwb3NhYmxlID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fZmlsZUljb25zRGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLl9maWxlSWNvbnNEaXNwb3NhYmxlID0gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5fbW91bnRlZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBjbGFzc05hbWUsXHJcbiAgICAgIGNoaWxkcmVuLFxyXG4gICAgICBkZWNvcmF0aW9uSWNvbjogRGVjb3JhdGlvbkljb24sXHJcbiAgICAgIGlzRm9sZGVyLFxyXG4gICAgICBwYXRoLFxyXG4gICAgICAvLyBmb3J3YXJkIHByb3BlcnRpZXMgc3VjaCBhcyBgZGF0YS1wYXRoYCwgZXRjXHJcbiAgICAgIC4uLnJlc3RcclxuICAgIH0gPSB0aGlzLnByb3BzO1xyXG4gICAgY29uc3QgZGlzcGxheVBhdGggPSBjaGlsZHJlbiA9PSBudWxsID8gcGF0aCA6IGNoaWxkcmVuO1xyXG4gICAgY29uc3QgZGVjb3JhdGlvbiA9XHJcbiAgICAgIERlY29yYXRpb25JY29uID09IG51bGwgPyBudWxsIDogKFxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibnVjbGlkZS11aS1wYXRoLXdpdGgtZmlsZS1pY29uLWRlY29yYXRpb24taWNvblwiPlxyXG4gICAgICAgICAgey8qICRGbG93SXNzdWUgXCJleHBlY3RlZCBSZWFjdCBjb21wb25lbnQgaW5zdGVhZCBvZiBwcm90b3R5cGVcIiAqL31cclxuICAgICAgICAgIDxEZWNvcmF0aW9uSWNvbiAvPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICApO1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgPGRpdlxyXG4gICAgICAgIGNsYXNzTmFtZT17dGhpcy5fZ2V0RGVmYXVsdENsYXNzTmFtZSgpfVxyXG4gICAgICAgIHJlZj17dGhpcy5faGFuZGxlUmVmfVxyXG4gICAgICAgIHsuLi5yZXN0fT5cclxuICAgICAgICB7ZGlzcGxheVBhdGh9XHJcbiAgICAgICAge2RlY29yYXRpb259XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19