"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _PulseButton = _interopRequireDefault(require("./PulseButton"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class PulseButtonWithTooltip extends React.Component {
  constructor(...args) {
    super(...args);
    this._divEl = void 0;
    this._disposables = void 0;
    this._tooltipDisposable = void 0;
    this.state = {
      isDismissing: false,
      dismissed: false
    };

    this._handleDivRef = el => {
      this._divEl = el;
    };

    this._handleDismiss = () => {
      this.setState({
        isDismissing: true
      });

      if (this.props.onDismiss != null) {
        this.props.onDismiss();
      }
    };

    this._handleButtonClick = e => {
      const {
        onClick
      } = this.props;

      const tooltip = this._getTooltip();

      if (tooltip != null) {
        tooltip.show();
      }

      if (onClick != null) {
        onClick(e);
      }
    };
  }

  componentDidMount() {
    this._tooltipDisposable = this._updateTooltip();
    (0, _nullthrows.default)(this._getTooltip()).hide();
    this._disposables = new _UniversalDisposable.default(this._tooltipDisposable);
  }

  componentDidUpdate(prevProps, prevState) {
    if (!prevState.isDismissing && this.state.isDismissing) {
      const tooltip = this._getTooltip();

      if (tooltip != null) {
        tooltip.hide();
      }

      this.setState({
        dismissed: true
      });
    }

    if (prevProps.tooltipText !== this.props.tooltipText) {
      this._tooltipDisposable.dispose();

      this._tooltipDisposable = this._updateTooltip();
    }
  }

  componentWillUnmount() {
    (0, _nullthrows.default)(this._disposables).dispose();
  }

  _updateTooltip() {
    return atom.tooltips.add((0, _nullthrows.default)(this._divEl), {
      item: createTooltipBody(this.props.tooltipText, this._handleDismiss),
      trigger: 'manual'
    });
  }

  _getTooltip() {
    if (this._divEl == null) {
      return;
    }

    return atom.tooltips.findTooltips(this._divEl)[0];
  }

  render() {
    const {
      ariaLabel,
      className,
      isSelected,
      size,
      style,
      onMouseOver,
      onMouseLeave,
      wrapperStyle
    } = this.props;

    if (this.state.dismissed) {
      return null;
    }

    return /*#__PURE__*/React.createElement("div", {
      ref: this._handleDivRef,
      style: wrapperStyle
    }, /*#__PURE__*/React.createElement(_PulseButton.default, {
      ariaLabel: ariaLabel,
      className: className,
      isSelected: isSelected,
      onClick: this._handleButtonClick,
      size: size,
      style: style,
      onMouseOver: onMouseOver,
      onMouseLeave: onMouseLeave
    }));
  }

}

exports.default = PulseButtonWithTooltip;

function createTooltipBody(title, onDismiss) {
  const div = document.createElement('div');
  const p = document.createElement('p');
  p.innerText = title;
  div.appendChild(p);
  const button = document.createElement('button');
  button.classList.add('btn', 'btn-primary');
  button.innerText = 'Got it';
  button.addEventListener('click', onDismiss);
  div.appendChild(button);
  return div;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1B1bHNlQnV0dG9uV2l0aFRvb2x0aXAuanMiXSwibmFtZXMiOlsiUHVsc2VCdXR0b25XaXRoVG9vbHRpcCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiX2RpdkVsIiwiX2Rpc3Bvc2FibGVzIiwiX3Rvb2x0aXBEaXNwb3NhYmxlIiwic3RhdGUiLCJpc0Rpc21pc3NpbmciLCJkaXNtaXNzZWQiLCJfaGFuZGxlRGl2UmVmIiwiZWwiLCJfaGFuZGxlRGlzbWlzcyIsInNldFN0YXRlIiwicHJvcHMiLCJvbkRpc21pc3MiLCJfaGFuZGxlQnV0dG9uQ2xpY2siLCJlIiwib25DbGljayIsInRvb2x0aXAiLCJfZ2V0VG9vbHRpcCIsInNob3ciLCJjb21wb25lbnREaWRNb3VudCIsIl91cGRhdGVUb29sdGlwIiwiaGlkZSIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJwcmV2U3RhdGUiLCJ0b29sdGlwVGV4dCIsImRpc3Bvc2UiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImF0b20iLCJ0b29sdGlwcyIsImFkZCIsIml0ZW0iLCJjcmVhdGVUb29sdGlwQm9keSIsInRyaWdnZXIiLCJmaW5kVG9vbHRpcHMiLCJyZW5kZXIiLCJhcmlhTGFiZWwiLCJjbGFzc05hbWUiLCJpc1NlbGVjdGVkIiwic2l6ZSIsInN0eWxlIiwib25Nb3VzZU92ZXIiLCJvbk1vdXNlTGVhdmUiLCJ3cmFwcGVyU3R5bGUiLCJ0aXRsZSIsImRpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInAiLCJpbm5lclRleHQiLCJhcHBlbmRDaGlsZCIsImJ1dHRvbiIsImNsYXNzTGlzdCIsImFkZEV2ZW50TGlzdGVuZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFZQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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U0FBUCxDQUFpQnRCLEdBQWpCLENBQXFCLEtBQXJCLEVBQTRCLGFBQTVCO0FBQ0FxQixFQUFBQSxNQUFNLENBQUNGLFNBQVAsR0FBbUIsUUFBbkI7QUFDQUUsRUFBQUEsTUFBTSxDQUFDRSxnQkFBUCxDQUF3QixPQUF4QixFQUFpQzFDLFNBQWpDO0FBQ0FrQyxFQUFBQSxHQUFHLENBQUNLLFdBQUosQ0FBZ0JDLE1BQWhCO0FBQ0EsU0FBT04sR0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBudWxsdGhyb3dzIGZyb20gJ251bGx0aHJvd3MnO1xyXG5pbXBvcnQgUHVsc2VCdXR0b24gZnJvbSAnLi9QdWxzZUJ1dHRvbic7XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIGFyaWFMYWJlbDogc3RyaW5nLFxyXG4gIGNsYXNzTmFtZT86IHN0cmluZyxcclxuICBpc1NlbGVjdGVkPzogYm9vbGVhbixcclxuICBvbkNsaWNrPzogKFN5bnRoZXRpY01vdXNlRXZlbnQ8PikgPT4gbWl4ZWQsXHJcbiAgb25EaXNtaXNzPzogKCkgPT4gbWl4ZWQsXHJcbiAgc2l6ZT86IG51bWJlcixcclxuICBzdHlsZT86IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9LFxyXG4gIHdyYXBwZXJTdHlsZT86IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9LFxyXG4gIG9uTW91c2VPdmVyPzogKFN5bnRoZXRpY01vdXNlRXZlbnQ8PikgPT4gbWl4ZWQsXHJcbiAgb25Nb3VzZUxlYXZlPzogKFN5bnRoZXRpY01vdXNlRXZlbnQ8PikgPT4gbWl4ZWQsXHJcbiAgdG9vbHRpcFRleHQ6IHN0cmluZyxcclxufTtcclxuXHJcbnR5cGUgU3RhdGUgPSB7XHJcbiAgZGlzbWlzc2VkOiBib29sZWFuLFxyXG4gIGlzRGlzbWlzc2luZzogYm9vbGVhbixcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFB1bHNlQnV0dG9uV2l0aFRvb2x0aXAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8XHJcbiAgUHJvcHMsXHJcbiAgU3RhdGUsXHJcbj4ge1xyXG4gIF9kaXZFbDogP0hUTUxEaXZFbGVtZW50O1xyXG4gIF9kaXNwb3NhYmxlczogP1VuaXZlcnNhbERpc3Bvc2FibGU7XHJcbiAgX3Rvb2x0aXBEaXNwb3NhYmxlOiBJRGlzcG9zYWJsZTtcclxuICBzdGF0ZSA9IHtcclxuICAgIGlzRGlzbWlzc2luZzogZmFsc2UsXHJcbiAgICBkaXNtaXNzZWQ6IGZhbHNlLFxyXG4gIH07XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdGhpcy5fdG9vbHRpcERpc3Bvc2FibGUgPSB0aGlzLl91cGRhdGVUb29sdGlwKCk7XHJcbiAgICBudWxsdGhyb3dzKHRoaXMuX2dldFRvb2x0aXAoKSkuaGlkZSgpO1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSh0aGlzLl90b29sdGlwRGlzcG9zYWJsZSk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcywgcHJldlN0YXRlOiBTdGF0ZSkge1xyXG4gICAgaWYgKCFwcmV2U3RhdGUuaXNEaXNtaXNzaW5nICYmIHRoaXMuc3RhdGUuaXNEaXNtaXNzaW5nKSB7XHJcbiAgICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLl9nZXRUb29sdGlwKCk7XHJcbiAgICAgIGlmICh0b29sdGlwICE9IG51bGwpIHtcclxuICAgICAgICB0b29sdGlwLmhpZGUoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNldFN0YXRlKHtkaXNtaXNzZWQ6IHRydWV9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJldlByb3BzLnRvb2x0aXBUZXh0ICE9PSB0aGlzLnByb3BzLnRvb2x0aXBUZXh0KSB7XHJcbiAgICAgIHRoaXMuX3Rvb2x0aXBEaXNwb3NhYmxlLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5fdG9vbHRpcERpc3Bvc2FibGUgPSB0aGlzLl91cGRhdGVUb29sdGlwKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIG51bGx0aHJvd3ModGhpcy5fZGlzcG9zYWJsZXMpLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIF91cGRhdGVUb29sdGlwKCk6IElEaXNwb3NhYmxlIHtcclxuICAgIHJldHVybiBhdG9tLnRvb2x0aXBzLmFkZChudWxsdGhyb3dzKHRoaXMuX2RpdkVsKSwge1xyXG4gICAgICBpdGVtOiBjcmVhdGVUb29sdGlwQm9keSh0aGlzLnByb3BzLnRvb2x0aXBUZXh0LCB0aGlzLl9oYW5kbGVEaXNtaXNzKSxcclxuICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVEaXZSZWYgPSAoZWw6ID9IVE1MRGl2RWxlbWVudCkgPT4ge1xyXG4gICAgdGhpcy5fZGl2RWwgPSBlbDtcclxuICB9O1xyXG5cclxuICBfaGFuZGxlRGlzbWlzcyA9ICgpID0+IHtcclxuICAgIHRoaXMuc2V0U3RhdGUoe2lzRGlzbWlzc2luZzogdHJ1ZX0pO1xyXG4gICAgaWYgKHRoaXMucHJvcHMub25EaXNtaXNzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5wcm9wcy5vbkRpc21pc3MoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBfaGFuZGxlQnV0dG9uQ2xpY2sgPSAoZTogU3ludGhldGljTW91c2VFdmVudDw+KSA9PiB7XHJcbiAgICBjb25zdCB7b25DbGlja30gPSB0aGlzLnByb3BzO1xyXG4gICAgY29uc3QgdG9vbHRpcCA9IHRoaXMuX2dldFRvb2x0aXAoKTtcclxuICAgIGlmICh0b29sdGlwICE9IG51bGwpIHtcclxuICAgICAgdG9vbHRpcC5zaG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG9uQ2xpY2sgIT0gbnVsbCkge1xyXG4gICAgICBvbkNsaWNrKGUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIF9nZXRUb29sdGlwKCk6ID9hdG9tJFRvb2x0aXAge1xyXG4gICAgaWYgKHRoaXMuX2RpdkVsID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhdG9tLnRvb2x0aXBzLmZpbmRUb29sdGlwcyh0aGlzLl9kaXZFbClbMF07XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGFyaWFMYWJlbCxcclxuICAgICAgY2xhc3NOYW1lLFxyXG4gICAgICBpc1NlbGVjdGVkLFxyXG4gICAgICBzaXplLFxyXG4gICAgICBzdHlsZSxcclxuICAgICAgb25Nb3VzZU92ZXIsXHJcbiAgICAgIG9uTW91c2VMZWF2ZSxcclxuICAgICAgd3JhcHBlclN0eWxlLFxyXG4gICAgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgaWYgKHRoaXMuc3RhdGUuZGlzbWlzc2VkKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgcmVmPXt0aGlzLl9oYW5kbGVEaXZSZWZ9IHN0eWxlPXt3cmFwcGVyU3R5bGV9PlxyXG4gICAgICAgIDxQdWxzZUJ1dHRvblxyXG4gICAgICAgICAgYXJpYUxhYmVsPXthcmlhTGFiZWx9XHJcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cclxuICAgICAgICAgIGlzU2VsZWN0ZWQ9e2lzU2VsZWN0ZWR9XHJcbiAgICAgICAgICBvbkNsaWNrPXt0aGlzLl9oYW5kbGVCdXR0b25DbGlja31cclxuICAgICAgICAgIHNpemU9e3NpemV9XHJcbiAgICAgICAgICBzdHlsZT17c3R5bGV9XHJcbiAgICAgICAgICBvbk1vdXNlT3Zlcj17b25Nb3VzZU92ZXJ9XHJcbiAgICAgICAgICBvbk1vdXNlTGVhdmU9e29uTW91c2VMZWF2ZX1cclxuICAgICAgICAvPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVUb29sdGlwQm9keSh0aXRsZSwgb25EaXNtaXNzKSB7XHJcbiAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBwLmlubmVyVGV4dCA9IHRpdGxlO1xyXG4gIGRpdi5hcHBlbmRDaGlsZChwKTtcclxuXHJcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2J0bicsICdidG4tcHJpbWFyeScpO1xyXG4gIGJ1dHRvbi5pbm5lclRleHQgPSAnR290IGl0JztcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkRpc21pc3MpO1xyXG4gIGRpdi5hcHBlbmRDaGlsZChidXR0b24pO1xyXG4gIHJldHVybiBkaXY7XHJcbn1cclxuIl19