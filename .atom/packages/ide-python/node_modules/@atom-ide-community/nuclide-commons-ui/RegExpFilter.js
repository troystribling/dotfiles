"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getFilterPattern = getFilterPattern;
exports.default = void 0;

var _AtomInput = require("./AtomInput");

var _classnames = _interopRequireDefault(require("classnames"));

var _Button = require("./Button");

var _ButtonGroup = require("./ButtonGroup");

var _escapeStringRegexp = _interopRequireDefault(require("escape-string-regexp"));

var React = _interopRequireWildcard(require("react"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class RegExpFilter extends React.Component {
  constructor(props) {
    super(props);
    this._currentValue = void 0;
    this._input = void 0;

    this._handleReToggleButtonClick = () => {
      this.props.onChange({
        text: this._currentValue.text,
        isRegExp: !this._currentValue.isRegExp
      });
    };

    this._handleTextChange = text => {
      if (text === this._currentValue.text) {
        return;
      }

      this.props.onChange({
        text,
        isRegExp: this._currentValue.isRegExp
      });
    };

    this._currentValue = props.value;
  }

  UNSAFE_componentWillReceiveProps(props) {
    // We need to store this so that we can use it in the event handlers.
    this._currentValue = props.value;
  }

  render() {
    const {
      value: {
        text,
        isRegExp,
        invalid
      }
    } = this.props;
    const size = this.props.size || 'sm';
    const buttonSize = getButtonSize(size);
    const inputWidth = this.props.inputWidth == null ? 200 : this.props.inputWidth;
    const inputClassName = (0, _classnames.default)('nuclide-ui-regexp-filter-input', this.props.inputClassName);
    return /*#__PURE__*/React.createElement(_ButtonGroup.ButtonGroup, {
      className: "inline-block"
    }, /*#__PURE__*/React.createElement(_AtomInput.AtomInput, {
      ref: el => {
        this._input = el;
      },
      invalid: invalid,
      className: inputClassName,
      size: size,
      width: inputWidth,
      placeholderText: "Filter",
      onDidChange: this._handleTextChange,
      value: text
    }), /*#__PURE__*/React.createElement(_Button.Button, {
      className: "nuclide-ui-regexp-filter-button",
      size: buttonSize,
      selected: isRegExp,
      onClick: this._handleReToggleButtonClick,
      tooltip: {
        title: 'Use Regex'
      }
    }, ".*"));
  }

  focus() {
    if (this._input == null) {
      return;
    }

    this._input.focus();
  }

}

exports.default = RegExpFilter;

function getButtonSize(size) {
  switch (size) {
    case 'xs':
      return _Button.ButtonSizes.EXTRA_SMALL;

    case 'sm':
      return _Button.ButtonSizes.SMALL;

    case 'lg':
      return _Button.ButtonSizes.LARGE;

    default:
      size;
      throw new Error(`Invalid size: ${size}`);
  }
}

function getFilterPattern(text, isRegExp) {
  if (text === '') {
    return {
      pattern: null,
      invalid: false
    };
  }

  const source = isRegExp ? text : (0, _escapeStringRegexp.default)(text);

  try {
    return {
      pattern: new RegExp(source, 'i'),
      invalid: false
    };
  } catch (err) {
    return {
      pattern: null,
      invalid: true
    };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1JlZ0V4cEZpbHRlci5qcyJdLCJuYW1lcyI6WyJSZWdFeHBGaWx0ZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfY3VycmVudFZhbHVlIiwiX2lucHV0IiwiX2hhbmRsZVJlVG9nZ2xlQnV0dG9uQ2xpY2siLCJvbkNoYW5nZSIsInRleHQiLCJpc1JlZ0V4cCIsIl9oYW5kbGVUZXh0Q2hhbmdlIiwidmFsdWUiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsInJlbmRlciIsImludmFsaWQiLCJzaXplIiwiYnV0dG9uU2l6ZSIsImdldEJ1dHRvblNpemUiLCJpbnB1dFdpZHRoIiwiaW5wdXRDbGFzc05hbWUiLCJlbCIsInRpdGxlIiwiZm9jdXMiLCJCdXR0b25TaXplcyIsIkVYVFJBX1NNQUxMIiwiU01BTEwiLCJMQVJHRSIsIkVycm9yIiwiZ2V0RmlsdGVyUGF0dGVybiIsInBhdHRlcm4iLCJzb3VyY2UiLCJSZWdFeHAiLCJlcnIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEyQ2UsTUFBTUEsWUFBTixTQUEyQkMsS0FBSyxDQUFDQyxTQUFqQyxDQUF5RDtBQUl0RUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWU7QUFDeEIsVUFBTUEsS0FBTjtBQUR3QixTQUgxQkMsYUFHMEI7QUFBQSxTQUYxQkMsTUFFMEI7O0FBQUEsU0F3RDFCQywwQkF4RDBCLEdBd0RHLE1BQVk7QUFDdkMsV0FBS0gsS0FBTCxDQUFXSSxRQUFYLENBQW9CO0FBQ2xCQyxRQUFBQSxJQUFJLEVBQUUsS0FBS0osYUFBTCxDQUFtQkksSUFEUDtBQUVsQkMsUUFBQUEsUUFBUSxFQUFFLENBQUMsS0FBS0ws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QUFBZ0JmLE1BQUFBLE9BQU8sRUFBRTtBQUF6QixLQUFQO0FBQ0Q7O0FBQ0QsUUFBTWdCLE1BQU0sR0FBR3JCLFFBQVEsR0FBR0QsSUFBSCxHQUFVLGlDQUFtQkEsSUFBbkIsQ0FBakM7O0FBQ0EsTUFBSTtBQUNGLFdBQU87QUFDTHFCLE1BQUFBLE9BQU8sRUFBRSxJQUFJRSxNQUFKLENBQVdELE1BQVgsRUFBbUIsR0FBbkIsQ0FESjtBQUVMaEIsTUFBQUEsT0FBTyxFQUFFO0FBRkosS0FBUDtBQUlELEdBTEQsQ0FLRSxPQUFPa0IsR0FBUCxFQUFZO0FBQ1osV0FBTztBQUNMSCxNQUFBQSxPQUFPLEVBQUUsSUFESjtBQUVMZixNQUFBQSxPQUFPLEVBQUU7QUFGSixLQUFQO0FBSUQ7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3cgc3RyaWN0LWxvY2FsXHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG5pbXBvcnQgdHlwZSB7QnV0dG9uU2l6ZX0gZnJvbSAnLi9CdXR0b24nO1xyXG5cclxuaW1wb3J0IHtBdG9tSW5wdXR9IGZyb20gJy4vQXRvbUlucHV0JztcclxuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcbmltcG9ydCB7QnV0dG9uLCBCdXR0b25TaXplc30gZnJvbSAnLi9CdXR0b24nO1xyXG5pbXBvcnQge0J1dHRvbkdyb3VwfSBmcm9tICcuL0J1dHRvbkdyb3VwJztcclxuaW1wb3J0IGVzY2FwZVN0cmluZ1JlZ2V4cCBmcm9tICdlc2NhcGUtc3RyaW5nLXJlZ2V4cCc7XHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuXHJcbnR5cGUgU2l6ZSA9ICd4cycgfCAnc20nIHwgJ2xnJztcclxuXHJcbnR5cGUgUHJvcHMgPSB7XHJcbiAgdmFsdWU6IFJlZ0V4cEZpbHRlclZhbHVlLFxyXG4gIGlucHV0V2lkdGg/OiBudW1iZXIsXHJcbiAgaW5wdXRDbGFzc05hbWU/OiBzdHJpbmcsXHJcbiAgb25DaGFuZ2U6ICh2YWx1ZTogUmVnRXhwRmlsdGVyQ2hhbmdlKSA9PiBtaXhlZCxcclxuICBzaXplPzogU2l6ZSxcclxufTtcclxuXHJcbnR5cGUgU3RhdGUgPSB7XHJcbiAgdGV4dDogc3RyaW5nLFxyXG4gIGlzUmVnRXhwOiBib29sZWFuLFxyXG4gIGludmFsaWQ6IGJvb2xlYW4sXHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSZWdFeHBGaWx0ZXJWYWx1ZSA9IHtcclxuICB0ZXh0OiBzdHJpbmcsXHJcbiAgaXNSZWdFeHA6IGJvb2xlYW4sXHJcbiAgaW52YWxpZDogYm9vbGVhbixcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEZpbHRlclBhdHRlcm4gPSB7XHJcbiAgcGF0dGVybjogP1JlZ0V4cCxcclxuICBpbnZhbGlkOiBib29sZWFuLFxyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgUmVnRXhwRmlsdGVyQ2hhbmdlID0ge1xyXG4gIHRleHQ6IHN0cmluZyxcclxuICBpc1JlZ0V4cDogYm9vbGVhbixcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlZ0V4cEZpbHRlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBfY3VycmVudFZhbHVlOiBSZWdFeHBGaWx0ZXJWYWx1ZTtcclxuICBfaW5wdXQ6ID9BdG9tSW5wdXQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgdGhpcy5fY3VycmVudFZhbHVlID0gcHJvcHMudmFsdWU7XHJcbiAgfVxyXG5cclxuICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhwcm9wczogUHJvcHMpOiB2b2lkIHtcclxuICAgIC8vIFdlIG5lZWQgdG8gc3RvcmUgdGhpcyBzbyB0aGF0IHdlIGNhbiB1c2UgaXQgaW4gdGhlIGV2ZW50IGhhbmRsZXJzLlxyXG4gICAgdGhpcy5fY3VycmVudFZhbHVlID0gcHJvcHMudmFsdWU7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIHZhbHVlOiB7dGV4dCwgaXNSZWdFeHAsIGludmFsaWR9LFxyXG4gICAgfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5wcm9wcy5zaXplIHx8ICdzbSc7XHJcbiAgICBjb25zdCBidXR0b25TaXplID0gZ2V0QnV0dG9uU2l6ZShzaXplKTtcclxuICAgIGNvbnN0IGlucHV0V2lkdGggPVxyXG4gICAgICB0aGlzLnByb3BzLmlucHV0V2lkdGggPT0gbnVsbCA/IDIwMCA6IHRoaXMucHJvcHMuaW5wdXRXaWR0aDtcclxuICAgIGNvbnN0IGlucHV0Q2xhc3NOYW1lID0gY2xhc3NuYW1lcyhcclxuICAgICAgJ251Y2xpZGUtdWktcmVnZXhwLWZpbHRlci1pbnB1dCcsXHJcbiAgICAgIHRoaXMucHJvcHMuaW5wdXRDbGFzc05hbWUsXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxCdXR0b25Hcm91cCBjbGFzc05hbWU9XCJpbmxpbmUtYmxvY2tcIj5cclxuICAgICAgICA8QXRvbUlucHV0XHJcbiAgICAgICAgICByZWY9e2VsID0+IHtcclxuICAgICAgICAgICAgdGhpcy5faW5wdXQgPSBlbDtcclxuICAgICAgICAgIH19XHJcbiAgICAgICAgICBpbnZhbGlkPXtpbnZhbGlkfVxyXG4gICAgICAgICAgY2xhc3NOYW1lPXtpbnB1dENsYXNzTmFtZX1cclxuICAgICAgICAgIHNpemU9e3NpemV9XHJcbiAgICAgICAgICB3aWR0aD17aW5wdXRXaWR0aH1cclxuICAgICAgICAgIHBsYWNlaG9sZGVyVGV4dD1cIkZpbHRlclwiXHJcbiAgICAgICAgICBvbkRpZENoYW5nZT17dGhpcy5faGFuZGxlVGV4dENoYW5nZX1cclxuICAgICAgICAgIHZhbHVlPXt0ZXh0fVxyXG4gICAgICAgIC8+XHJcbiAgICAgICAgPEJ1dHRvblxyXG4gICAgICAgICAgY2xhc3NOYW1lPVwibnVjbGlkZS11aS1yZWdleHAtZmlsdGVyLWJ1dHRvblwiXHJcbiAgICAgICAgICBzaXplPXtidXR0b25TaXplfVxyXG4gICAgICAgICAgc2VsZWN0ZWQ9e2lzUmVnRXhwfVxyXG4gICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlUmVUb2dnbGVCdXR0b25DbGlja31cclxuICAgICAgICAgIHRvb2x0aXA9e3t0aXRsZTogJ1VzZSBSZWdleCd9fT5cclxuICAgICAgICAgIC4qXHJcbiAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgIDwvQnV0dG9uR3JvdXA+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZm9jdXMoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5faW5wdXQgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLl9pbnB1dC5mb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVJlVG9nZ2xlQnV0dG9uQ2xpY2sgPSAoKTogdm9pZCA9PiB7XHJcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHtcclxuICAgICAgdGV4dDogdGhpcy5fY3VycmVudFZhbHVlLnRleHQsXHJcbiAgICAgIGlzUmVnRXhwOiAhdGhpcy5fY3VycmVudFZhbHVlLmlzUmVnRXhwLFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgX2hhbmRsZVRleHRDaGFuZ2UgPSAodGV4dDogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBpZiAodGV4dCA9PT0gdGhpcy5fY3VycmVudFZhbHVlLnRleHQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh7XHJcbiAgICAgIHRleHQsXHJcbiAgICAgIGlzUmVnRXhwOiB0aGlzLl9jdXJyZW50VmFsdWUuaXNSZWdFeHAsXHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRCdXR0b25TaXplKHNpemU6IFNpemUpOiBCdXR0b25TaXplIHtcclxuICBzd2l0Y2ggKHNpemUpIHtcclxuICAgIGNhc2UgJ3hzJzpcclxuICAgICAgcmV0dXJuIEJ1dHRvblNpemVzLkVYVFJBX1NNQUxMO1xyXG4gICAgY2FzZSAnc20nOlxyXG4gICAgICByZXR1cm4gQnV0dG9uU2l6ZXMuU01BTEw7XHJcbiAgICBjYXNlICdsZyc6XHJcbiAgICAgIHJldHVybiBCdXR0b25TaXplcy5MQVJHRTtcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIChzaXplOiBlbXB0eSk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzaXplOiAke3NpemV9YCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsdGVyUGF0dGVybihcclxuICB0ZXh0OiBzdHJpbmcsXHJcbiAgaXNSZWdFeHA6IGJvb2xlYW4sXHJcbik6IEZpbHRlclBhdHRlcm4ge1xyXG4gIGlmICh0ZXh0ID09PSAnJykge1xyXG4gICAgcmV0dXJuIHtwYXR0ZXJuOiBudWxsLCBpbnZhbGlkOiBmYWxzZX07XHJcbiAgfVxyXG4gIGNvbnN0IHNvdXJjZSA9IGlzUmVnRXhwID8gdGV4dCA6IGVzY2FwZVN0cmluZ1JlZ2V4cCh0ZXh0KTtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcGF0dGVybjogbmV3IFJlZ0V4cChzb3VyY2UsICdpJyksXHJcbiAgICAgIGludmFsaWQ6IGZhbHNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHBhdHRlcm46IG51bGwsXHJcbiAgICAgIGludmFsaWQ6IHRydWUsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=