"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _classnames = _interopRequireDefault(require("classnames"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _scrollIntoView = require("./scrollIntoView");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class SelectList extends React.Component {
  constructor(...args) {
    super(...args);
    this._commandsDisposables = void 0;
    this._activeElement = void 0;
  }

  componentDidMount() {
    this._updateCommands();
  }

  componentDidUpdate(prevProps) {
    if (prevProps.commandScope !== this.props.commandScope) {
      this._updateCommands();
    }

    if (prevProps.value !== this.props.value) {
      this._scrollActiveElementIntoView();
    }
  }

  _scrollActiveElementIntoView() {
    if (this._activeElement == null) {
      return;
    }

    (0, _scrollIntoView.scrollIntoViewIfNeeded)(this._activeElement);
  }

  _updateCommands() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }

    const el = this.props.commandScope || _reactDom.default.findDOMNode(this);

    this._commandsDisposables = new _UniversalDisposable.default(atom.commands.add( // $FlowFixMe
    el, {
      'core:move-up': () => {
        this._moveSelectionIndex(-1);
      },
      'core:move-down': () => {
        this._moveSelectionIndex(1);
      }
    }));
  }

  _moveSelectionIndex(delta) {
    var _this$props$options$n;

    const currentIndex = this.props.options.findIndex(option => option.value === this.props.value);
    const nextIndex = currentIndex + delta;

    if (nextIndex < 0 || nextIndex >= this.props.options.length) {
      return;
    }

    this.props.onChange((_this$props$options$n = this.props.options[nextIndex]) === null || _this$props$options$n === void 0 ? void 0 : _this$props$options$n.value, nextIndex);
  }

  componentWillUnmount() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }
  }

  render() {
    var _this$props$tabIndex;

    return /*#__PURE__*/React.createElement("div", {
      className: "nuclide-select-list select-list block",
      tabIndex: (_this$props$tabIndex = this.props.tabIndex) !== null && _this$props$tabIndex !== void 0 ? _this$props$tabIndex : '0'
    }, /*#__PURE__*/React.createElement("ol", {
      className: "list-group mark-active"
    }, this._renderOptions()));
  }

  _renderOptions() {
    const OptionComponent = this.props.optionComponent || DefaultOptionComponent;
    return this.props.options.map((option, index) => {
      const active = this.props.value === option.value;
      const className = (0, _classnames.default)({
        clearfix: true,
        active
      });
      let ref;

      if (active) {
        ref = el => {
          this._activeElement = el;
        };
      }

      return /*#__PURE__*/React.createElement("li", {
        key: index,
        className: className // eslint-disable-next-line nuclide-internal/jsx-simple-callback-refs
        ,
        ref: ref,
        onClick: () => {
          this.props.onChange(option.value, index);
        }
      }, /*#__PURE__*/React.createElement(OptionComponent, {
        option: option,
        active: active
      }));
    });
  }

}

exports.default = SelectList;
SelectList.defaultProps = {
  onChange: () => {},
  optionComponent: DefaultOptionComponent,
  options: [],
  value: null
};

function DefaultOptionComponent(props) {
  return /*#__PURE__*/React.createElement("span", null, props.option.label);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1NlbGVjdExpc3QuanMiXSwibmFtZXMiOlsiU2VsZWN0TGlzdCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiX2NvbW1hbmRzRGlzcG9zYWJsZXMiLCJfYWN0aXZlRWxlbWVudCIsImNvbXBvbmVudERpZE1vdW50IiwiX3VwZGF0ZUNvbW1hbmRzIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwiY29tbWFuZFNjb3BlIiwicHJvcHMiLCJ2YWx1ZSIsIl9zY3JvbGxBY3RpdmVFbGVtZW50SW50b1ZpZXciLCJkaXNwb3NlIiwiZWwiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwiVW5pdmVyc2FsRGlzcG9zYWJsZSIsImF0b20iLCJjb21tYW5kcyIsImFkZCIsIl9tb3ZlU2VsZWN0aW9uSW5kZXgiLCJkZWx0YSIsImN1cnJlbnRJbmRleCIsIm9wdGlvbnMiLCJmaW5kSW5kZXgiLCJvcHRpb24iLCJuZXh0SW5kZXgiLCJsZW5ndGgiLCJvbkNoYW5nZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVuZGVyIiwidGFiSW5kZXgiLCJfcmVuZGVyT3B0aW9ucyIsIk9wdGlvbkNvbXBvbmVudCIsIm9wdGlvbkNvbXBvbmVudCIsIkRlZmF1bHRPcHRpb25Db21wb25lbnQiLCJtYXAiLCJpbmRleCIsImFjdGl2ZSIsImNsYXNzTmFtZSIsImNsZWFyZml4IiwicmVmIiwiZGVmYXVsdFByb3BzIiwibGFiZWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFZQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWtDZSxNQUFNQSxVQUFOLFNBQXlCQyxLQUFLLENBQUNDLFNBQS9CLENBQWdEO0FBQUE7QUFBQTtBQUFBLFNBQzdEQyxvQkFENkQ7QUFBQSxTQUU3REMsY0FGNkQ7QUFBQTs7QUFXN0RDLEVB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QkYsUUFBQUE7QUFGMkIsT0FBWCxDQUFsQjtBQUlBLFVBQUlHLEdBQUo7O0FBQ0EsVUFBSUgsTUFBSixFQUFZO0FBQ1ZHLFFBQUFBLEdBQUcsR0FBRzVCLEVBQUUsSUFBSTtBQUNWLGVBQUtWLGNBQUwsR0FBc0JVLEVBQXRCO0FBQ0QsU0FGRDtBQUdEOztBQUNELDBCQUNFO0FBQ0UsUUFBQSxHQUFHLEVBQUV3QixLQURQO0FBRUUsUUFBQSxTQUFTLEVBQUVFLFNBRmIsQ0FHRTtBQUhGO0FBSUUsUUFBQSxHQUFHLEVBQUVFLEdBSlA7QUFLRSxRQUFBLE9BQU8sRUFBRSxNQUFNO0FBQ2IsZUFBS2hDLEtBQUwsQ0FBV21CLFFBQVgsQ0FBb0JILE1BQU0sQ0FBQ2YsS0FBM0IsRUFBa0MyQixLQUFsQztBQUNEO0FBUEgsc0JBUUUsb0JBQUMsZUFBRDtBQUFpQixRQUFBLE1BQU0sRUFBRVosTUFBekI7QUFBaUMsUUFBQSxNQUFNLEVBQUVhO0FBQXpDLFFBUkYsQ0FERjtBQVlELEtBeEJNLENBQVA7QUF5QkQ7O0FBNUc0RDs7O0FBQTFDdkMsVSxDQUlaMkMsWSxHQUE2QjtBQUNsQ2QsRUFBQUEsUUFBUSxFQUFFLE1BQU0sQ0FBRSxDQURnQjtBQUVsQ00sRUFBQUEsZUFBZSxFQUFFQyxzQkFGaUI7QUFHbENaLEVBQUFBLE9BQU8sRUFBRSxFQUh5QjtBQUlsQ2IsRUFBQUEsS0FBSyxFQUFFO0FBSjJCLEM7O0FBa0h0QyxTQUFTeUIsc0JBQVQsQ0FBZ0MxQixLQUFoQyxFQUE2RDtBQUMzRCxzQkFBTyxrQ0FBT0EsS0FBSyxDQUFDZ0IsTUFBTixDQUFha0IsS0FBcEIsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XHJcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xyXG5pbXBvcnQge3Njcm9sbEludG9WaWV3SWZOZWVkZWR9IGZyb20gJy4vc2Nyb2xsSW50b1ZpZXcnO1xyXG5cclxudHlwZSBPcHRpb24gPSB7XHJcbiAgLy8gJEZsb3dGaXhNZSg+PTAuNTMuMCkgRmxvdyBzdXBwcmVzc1xyXG4gIGxhYmVsOiBSZWFjdC5DaGlsZHJlbixcclxuICB2YWx1ZTogYW55LFxyXG59O1xyXG5cclxudHlwZSBQcm9wcyA9IHtcclxuICAvLyAkRmxvd0ZpeE1lKD49MC41My4wKSBGbG93IHN1cHByZXNzXHJcbiAgb3B0aW9uQ29tcG9uZW50PzogKHByb3BzOiBPcHRpb25Db21wb25lbnRQcm9wcykgPT4gUmVhY3QuRWxlbWVudDxhbnk+LFxyXG4gIC8vIFRPRE86IHJlbW92ZSBkaXNhYmxlXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLXVudXNlZC1wcm9wLXR5cGVzXHJcbiAgY2xhc3NOYW1lPzogc3RyaW5nLFxyXG4gIG9wdGlvbnM6IEFycmF5PE9wdGlvbj4sXHJcbiAgdmFsdWU6IGFueSxcclxuICBvbkNoYW5nZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHZvaWQsXHJcbiAgY29tbWFuZFNjb3BlPzogSFRNTEVsZW1lbnQsXHJcbiAgdGFiSW5kZXg/OiBzdHJpbmcsXHJcbn07XHJcblxyXG50eXBlIERlZmF1bHRQcm9wcyA9IHtcclxuICBvbkNoYW5nZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHZvaWQsXHJcbiAgb3B0aW9uQ29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPE9wdGlvbkNvbXBvbmVudFByb3BzPixcclxuICB2YWx1ZTogYW55LFxyXG4gIG9wdGlvbnM6IEFycmF5PE9wdGlvbj4sXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWxlY3RMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XHJcbiAgX2NvbW1hbmRzRGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XHJcbiAgX2FjdGl2ZUVsZW1lbnQ6ID9IVE1MRWxlbWVudDtcclxuXHJcbiAgc3RhdGljIGRlZmF1bHRQcm9wczogRGVmYXVsdFByb3BzID0ge1xyXG4gICAgb25DaGFuZ2U6ICgpID0+IHt9LFxyXG4gICAgb3B0aW9uQ29tcG9uZW50OiBEZWZhdWx0T3B0aW9uQ29tcG9uZW50LFxyXG4gICAgb3B0aW9uczogW10sXHJcbiAgICB2YWx1ZTogbnVsbCxcclxuICB9O1xyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3VwZGF0ZUNvbW1hbmRzKCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcyk6IHZvaWQge1xyXG4gICAgaWYgKHByZXZQcm9wcy5jb21tYW5kU2NvcGUgIT09IHRoaXMucHJvcHMuY29tbWFuZFNjb3BlKSB7XHJcbiAgICAgIHRoaXMuX3VwZGF0ZUNvbW1hbmRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZXZQcm9wcy52YWx1ZSAhPT0gdGhpcy5wcm9wcy52YWx1ZSkge1xyXG4gICAgICB0aGlzLl9zY3JvbGxBY3RpdmVFbGVtZW50SW50b1ZpZXcoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zY3JvbGxBY3RpdmVFbGVtZW50SW50b1ZpZXcoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fYWN0aXZlRWxlbWVudCA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHNjcm9sbEludG9WaWV3SWZOZWVkZWQodGhpcy5fYWN0aXZlRWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlQ29tbWFuZHMoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcyAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZWwgPSB0aGlzLnByb3BzLmNvbW1hbmRTY29wZSB8fCBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcclxuICAgIHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZShcclxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoXHJcbiAgICAgICAgLy8gJEZsb3dGaXhNZVxyXG4gICAgICAgIGVsLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICdjb3JlOm1vdmUtdXAnOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdmVTZWxlY3Rpb25JbmRleCgtMSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgJ2NvcmU6bW92ZS1kb3duJzogKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9tb3ZlU2VsZWN0aW9uSW5kZXgoMSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgX21vdmVTZWxlY3Rpb25JbmRleChkZWx0YTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLnByb3BzLm9wdGlvbnMuZmluZEluZGV4KFxyXG4gICAgICBvcHRpb24gPT4gb3B0aW9uLnZhbHVlID09PSB0aGlzLnByb3BzLnZhbHVlLFxyXG4gICAgKTtcclxuICAgIGNvbnN0IG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIGRlbHRhO1xyXG4gICAgaWYgKG5leHRJbmRleCA8IDAgfHwgbmV4dEluZGV4ID49IHRoaXMucHJvcHMub3B0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnByb3BzLm9wdGlvbnNbbmV4dEluZGV4XT8udmFsdWUsIG5leHRJbmRleCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9jb21tYW5kc0Rpc3Bvc2FibGVzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2XHJcbiAgICAgICAgY2xhc3NOYW1lPVwibnVjbGlkZS1zZWxlY3QtbGlzdCBzZWxlY3QtbGlzdCBibG9ja1wiXHJcbiAgICAgICAgdGFiSW5kZXg9e3RoaXMucHJvcHMudGFiSW5kZXggPz8gJzAnfT5cclxuICAgICAgICA8b2wgY2xhc3NOYW1lPVwibGlzdC1ncm91cCBtYXJrLWFjdGl2ZVwiPnt0aGlzLl9yZW5kZXJPcHRpb25zKCl9PC9vbD5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgX3JlbmRlck9wdGlvbnMoKTogQXJyYXk8UmVhY3QuRWxlbWVudDxhbnk+PiB7XHJcbiAgICBjb25zdCBPcHRpb25Db21wb25lbnQgPVxyXG4gICAgICB0aGlzLnByb3BzLm9wdGlvbkNvbXBvbmVudCB8fCBEZWZhdWx0T3B0aW9uQ29tcG9uZW50O1xyXG4gICAgcmV0dXJuIHRoaXMucHJvcHMub3B0aW9ucy5tYXAoKG9wdGlvbiwgaW5kZXgpID0+IHtcclxuICAgICAgY29uc3QgYWN0aXZlID0gdGhpcy5wcm9wcy52YWx1ZSA9PT0gb3B0aW9uLnZhbHVlO1xyXG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBjbGFzc25hbWVzKHtcclxuICAgICAgICBjbGVhcmZpeDogdHJ1ZSxcclxuICAgICAgICBhY3RpdmUsXHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgcmVmO1xyXG4gICAgICBpZiAoYWN0aXZlKSB7XHJcbiAgICAgICAgcmVmID0gZWwgPT4ge1xyXG4gICAgICAgICAgdGhpcy5fYWN0aXZlRWxlbWVudCA9IGVsO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICA8bGlcclxuICAgICAgICAgIGtleT17aW5kZXh9XHJcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cclxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBudWNsaWRlLWludGVybmFsL2pzeC1zaW1wbGUtY2FsbGJhY2stcmVmc1xyXG4gICAgICAgICAgcmVmPXtyZWZ9XHJcbiAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25DaGFuZ2Uob3B0aW9uLnZhbHVlLCBpbmRleCk7XHJcbiAgICAgICAgICB9fT5cclxuICAgICAgICAgIDxPcHRpb25Db21wb25lbnQgb3B0aW9uPXtvcHRpb259IGFjdGl2ZT17YWN0aXZlfSAvPlxyXG4gICAgICAgIDwvbGk+XHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIE9wdGlvbkNvbXBvbmVudFByb3BzID0ge1xyXG4gIG9wdGlvbjogT3B0aW9uLFxyXG4gIC8vIFRPRE86IHJlbW92ZSBkaXNhYmxlXHJcbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3Qvbm8tdW51c2VkLXByb3AtdHlwZXMgKi9cclxuICBhY3RpdmU6IGJvb2xlYW4sXHJcbn07XHJcblxyXG5mdW5jdGlvbiBEZWZhdWx0T3B0aW9uQ29tcG9uZW50KHByb3BzOiBPcHRpb25Db21wb25lbnRQcm9wcykge1xyXG4gIHJldHVybiA8c3Bhbj57cHJvcHMub3B0aW9uLmxhYmVsfTwvc3Bhbj47XHJcbn1cclxuIl19