"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = quickInputDialog;

var _AtomInput = require("./AtomInput");

var _Button = require("./Button");

var _ButtonGroup = require("./ButtonGroup");

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _assert = _interopRequireDefault(require("assert"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/* global Node */
function quickInputDialog(title, inputLabel, onConfirm, validateInput, initialValue = '') {
  const item = document.createElement('div');
  const panel = atom.workspace.addModalPanel({
    item
  });
  return new Promise((resolve, reject) => {
    const cancel = () => {
      panel.destroy();
      resolve(null);
    };

    _reactDom.default.render( /*#__PURE__*/React.createElement(QuickInputDialog, {
      validateInput: validateInput,
      initialValue: initialValue,
      inputLabel: inputLabel,
      onCancel: cancel,
      onConfirm: content => {
        if (onConfirm) {
          onConfirm(content);
        }

        resolve(content);
        panel.destroy();
      },
      title: title
    }), item);

    panel.onDidDestroy(() => _reactDom.default.unmountComponentAtNode(item));
  });
}

class QuickInputDialog extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;
    this._rootNode = void 0;

    this._handleOutsideClick = event => {
      const domNode = this._rootNode;
      (0, _assert.default)(event.target instanceof Node);

      if (!domNode || !domNode.contains(event.target)) {
        this.props.onCancel();
      }
    };

    this._handleConfirmClick = () => {
      this.props.onConfirm(this.state.content);
    };

    this._handleInputChange = content => {
      this.setState({
        content
      });
    };

    this.state = {
      content: props.initialValue
    };
    this._disposables = new _UniversalDisposable.default();
  }

  componentDidMount() {
    document.addEventListener('click', this._handleOutsideClick);
    const rootNode = (0, _nullthrows.default)(this._rootNode);

    this._disposables.add(() => document.removeEventListener('click', this._handleOutsideClick), atom.commands.add(rootNode, 'core:confirm', this._handleConfirmClick), atom.commands.add(rootNode, 'core:cancel', this.props.onCancel));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  render() {
    const errorMessage = this.props.validateInput(this.state.content);
    return /*#__PURE__*/React.createElement("div", {
      ref: rootNode => this._rootNode = rootNode
    }, /*#__PURE__*/React.createElement("h6", null, /*#__PURE__*/React.createElement("strong", null, this.props.title)), /*#__PURE__*/React.createElement("label", null, this.props.inputLabel), /*#__PURE__*/React.createElement(_AtomInput.AtomInput, {
      autofocus: true,
      initialValue: this.props.initialValue,
      onDidChange: this._handleInputChange,
      startSelected: true
    }), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between'
      }
    }, /*#__PURE__*/React.createElement("span", null, errorMessage), /*#__PURE__*/React.createElement(_ButtonGroup.ButtonGroup, {
      size: _ButtonGroup.ButtonGroupSizes.SMALL
    }, /*#__PURE__*/React.createElement(_Button.Button, {
      onClick: this.props.onCancel
    }, "Cancel"), /*#__PURE__*/React.createElement(_Button.Button, {
      buttonType: _Button.ButtonTypes.PRIMARY,
      disabled: errorMessage != null,
      onClick: this._handleConfirmClick
    }, "Confirm"))));
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL3F1aWNrSW5wdXREaWFsb2cuanMiXSwibmFtZXMiOlsicXVpY2tJbnB1dERpYWxvZyIsInRpdGxlIiwiaW5wdXRMYWJlbCIsIm9uQ29uZmlybSIsInZhbGlkYXRlSW5wdXQiLCJpbml0aWFsVmFsdWUiLCJpdGVtIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicGFuZWwiLCJhdG9tIiwid29ya3NwYWNlIiwiYWRkTW9kYWxQYW5lbCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY2FuY2VsIiwiZGVzdHJveSIsIlJlYWN0RE9NIiwicmVuZGVyIiwiY29udGVudCIsIm9uRGlkRGVzdHJveSIsInVubW91bnRDb21wb25lbnRBdE5vZGUiLCJRdWlja0lucHV0RGlhbG9nIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2Rpc3Bvc2FibGVzIiwiX3Jvb3ROb2RlIiwiX2hhbmRsZU91dHNpZGVDbGljayIsImV2ZW50IiwiZG9tTm9kZSIsInRhcmdldCIsIk5vZGUiLCJjb250YWlucyIsIm9uQ2FuY2VsIiwiX2hhbmRsZUNvbmZpcm1DbGljayIsInN0YXRlIiwiX2hhbmRsZUlucHV0Q2hhbmdlIiwic2V0U3RhdGUiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGRFdmVudExpc3RlbmVyIiwicm9vdE5vZGUiLCJhZGQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY29tbWFuZHMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJlcnJvck1lc3NhZ2UiLCJkaXNwbGF5IiwianVzdGlmeUNvbnRlbnQiLCJCdXR0b25Hcm91cFNpemVzIiwiU01BTEwiLCJCdXR0b25UeXBlcyIsIlBSSU1BUlkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFjQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7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M0IsS0FBTCxDQUFXUztBQUE1QixnQkFERixlQUVFLG9CQUFDLGNBQUQ7QUFDRSxNQUFBLFVBQVUsRUFBRW1CLG9CQUFZQyxPQUQxQjtBQUVFLE1BQUEsUUFBUSxFQUFFTixZQUFZLElBQUksSUFGNUI7QUFHRSxNQUFBLE9BQU8sRUFBRSxLQUFLYjtBQUhoQixpQkFGRixDQUZGLENBWEYsQ0FERjtBQTBCRDs7QUF6RTBEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbi8qIGdsb2JhbCBOb2RlICovXHJcblxyXG5pbXBvcnQge0F0b21JbnB1dH0gZnJvbSAnLi9BdG9tSW5wdXQnO1xyXG5pbXBvcnQge0J1dHRvbiwgQnV0dG9uVHlwZXN9IGZyb20gJy4vQnV0dG9uJztcclxuaW1wb3J0IHtCdXR0b25Hcm91cCwgQnV0dG9uR3JvdXBTaXplc30gZnJvbSAnLi9CdXR0b25Hcm91cCc7XHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XHJcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xyXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XHJcbmltcG9ydCBudWxsdGhyb3dzIGZyb20gJ251bGx0aHJvd3MnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcXVpY2tJbnB1dERpYWxvZyhcclxuICB0aXRsZTogc3RyaW5nLFxyXG4gIGlucHV0TGFiZWw6IHN0cmluZyxcclxuICBvbkNvbmZpcm06ID8oc3RyaW5nKSA9PiBtaXhlZCxcclxuICB2YWxpZGF0ZUlucHV0OiBzdHJpbmcgPT4gP3N0cmluZyxcclxuICBpbml0aWFsVmFsdWU6IHN0cmluZyA9ICcnLFxyXG4pOiBQcm9taXNlPD9zdHJpbmc+IHtcclxuICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgY29uc3QgcGFuZWwgPSBhdG9tLndvcmtzcGFjZS5hZGRNb2RhbFBhbmVsKHtpdGVtfSk7XHJcblxyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICBjb25zdCBjYW5jZWwgPSAoKSA9PiB7XHJcbiAgICAgIHBhbmVsLmRlc3Ryb3koKTtcclxuICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgIH07XHJcblxyXG4gICAgUmVhY3RET00ucmVuZGVyKFxyXG4gICAgICA8UXVpY2tJbnB1dERpYWxvZ1xyXG4gICAgICAgIHZhbGlkYXRlSW5wdXQ9e3ZhbGlkYXRlSW5wdXR9XHJcbiAgICAgICAgaW5pdGlhbFZhbHVlPXtpbml0aWFsVmFsdWV9XHJcbiAgICAgICAgaW5wdXRMYWJlbD17aW5wdXRMYWJlbH1cclxuICAgICAgICBvbkNhbmNlbD17Y2FuY2VsfVxyXG4gICAgICAgIG9uQ29uZmlybT17Y29udGVudCA9PiB7XHJcbiAgICAgICAgICBpZiAob25Db25maXJtKSB7XHJcbiAgICAgICAgICAgIG9uQ29uZmlybShjb250ZW50KTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXNvbHZlKGNvbnRlbnQpO1xyXG4gICAgICAgICAgcGFuZWwuZGVzdHJveSgpO1xyXG4gICAgICAgIH19XHJcbiAgICAgICAgdGl0bGU9e3RpdGxlfVxyXG4gICAgICAvPixcclxuICAgICAgaXRlbSxcclxuICAgICk7XHJcblxyXG4gICAgcGFuZWwub25EaWREZXN0cm95KCgpID0+IFJlYWN0RE9NLnVubW91bnRDb21wb25lbnRBdE5vZGUoaXRlbSkpO1xyXG4gIH0pO1xyXG59XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIHZhbGlkYXRlSW5wdXQ6IHN0cmluZyA9PiA/c3RyaW5nLFxyXG4gIGluaXRpYWxWYWx1ZTogc3RyaW5nLFxyXG4gIGlucHV0TGFiZWw6IHN0cmluZyxcclxuICBvbkNhbmNlbDogKCkgPT4gbWl4ZWQsXHJcbiAgb25Db25maXJtOiBzdHJpbmcgPT4gbWl4ZWQsXHJcbiAgdGl0bGU6IHN0cmluZyxcclxufTtcclxuXHJcbnR5cGUgU3RhdGUgPSB7XHJcbiAgY29udGVudDogc3RyaW5nLFxyXG59O1xyXG5cclxuY2xhc3MgUXVpY2tJbnB1dERpYWxvZyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XHJcbiAgX3Jvb3ROb2RlOiA/SFRNTERpdkVsZW1lbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG5cclxuICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICAgIGNvbnRlbnQ6IHByb3BzLmluaXRpYWxWYWx1ZSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZU91dHNpZGVDbGljayk7XHJcbiAgICBjb25zdCByb290Tm9kZSA9IG51bGx0aHJvd3ModGhpcy5fcm9vdE5vZGUpO1xyXG5cclxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZChcclxuICAgICAgKCkgPT4gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVPdXRzaWRlQ2xpY2spLFxyXG4gICAgICBhdG9tLmNvbW1hbmRzLmFkZChyb290Tm9kZSwgJ2NvcmU6Y29uZmlybScsIHRoaXMuX2hhbmRsZUNvbmZpcm1DbGljayksXHJcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKHJvb3ROb2RlLCAnY29yZTpjYW5jZWwnLCB0aGlzLnByb3BzLm9uQ2FuY2VsKSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVPdXRzaWRlQ2xpY2sgPSAoZXZlbnQ6IEV2ZW50KTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBkb21Ob2RlID0gdGhpcy5fcm9vdE5vZGU7XHJcbiAgICBpbnZhcmlhbnQoZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgTm9kZSk7XHJcbiAgICBpZiAoIWRvbU5vZGUgfHwgIWRvbU5vZGUuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xyXG4gICAgICB0aGlzLnByb3BzLm9uQ2FuY2VsKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgX2hhbmRsZUNvbmZpcm1DbGljayA9ICgpOiB2b2lkID0+IHtcclxuICAgIHRoaXMucHJvcHMub25Db25maXJtKHRoaXMuc3RhdGUuY29udGVudCk7XHJcbiAgfTtcclxuXHJcbiAgX2hhbmRsZUlucHV0Q2hhbmdlID0gKGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQgPT4ge1xyXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y29udGVudH0pO1xyXG4gIH07XHJcblxyXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcclxuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IHRoaXMucHJvcHMudmFsaWRhdGVJbnB1dCh0aGlzLnN0YXRlLmNvbnRlbnQpO1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgPGRpdiByZWY9e3Jvb3ROb2RlID0+ICh0aGlzLl9yb290Tm9kZSA9IHJvb3ROb2RlKX0+XHJcbiAgICAgICAgPGg2PlxyXG4gICAgICAgICAgPHN0cm9uZz57dGhpcy5wcm9wcy50aXRsZX08L3N0cm9uZz5cclxuICAgICAgICA8L2g2PlxyXG4gICAgICAgIDxsYWJlbD57dGhpcy5wcm9wcy5pbnB1dExhYmVsfTwvbGFiZWw+XHJcbiAgICAgICAgPEF0b21JbnB1dFxyXG4gICAgICAgICAgYXV0b2ZvY3VzPXt0cnVlfVxyXG4gICAgICAgICAgaW5pdGlhbFZhbHVlPXt0aGlzLnByb3BzLmluaXRpYWxWYWx1ZX1cclxuICAgICAgICAgIG9uRGlkQ2hhbmdlPXt0aGlzLl9oYW5kbGVJbnB1dENoYW5nZX1cclxuICAgICAgICAgIHN0YXJ0U2VsZWN0ZWQ9e3RydWV9XHJcbiAgICAgICAgLz5cclxuICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nfX0+XHJcbiAgICAgICAgICA8c3Bhbj57ZXJyb3JNZXNzYWdlfTwvc3Bhbj5cclxuICAgICAgICAgIDxCdXR0b25Hcm91cCBzaXplPXtCdXR0b25Hcm91cFNpemVzLlNNQUxMfT5cclxuICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXt0aGlzLnByb3BzLm9uQ2FuY2VsfT5DYW5jZWw8L0J1dHRvbj5cclxuICAgICAgICAgICAgPEJ1dHRvblxyXG4gICAgICAgICAgICAgIGJ1dHRvblR5cGU9e0J1dHRvblR5cGVzLlBSSU1BUll9XHJcbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Vycm9yTWVzc2FnZSAhPSBudWxsfVxyXG4gICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX2hhbmRsZUNvbmZpcm1DbGlja30+XHJcbiAgICAgICAgICAgICAgQ29uZmlybVxyXG4gICAgICAgICAgICA8L0J1dHRvbj5cclxuICAgICAgICAgIDwvQnV0dG9uR3JvdXA+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19