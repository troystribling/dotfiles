"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/**
 * Like a CompositeDisposable, but in addition to Disposable instances it can
 * also accept plain functions and Rx subscriptions.
 */
class UniversalDisposable {
  constructor(...teardowns) {
    this.disposed = void 0;
    this.teardowns = void 0;
    this.teardowns = new Set();
    this.disposed = false;

    if (teardowns.length) {
      this.add(...teardowns);
    }
  }

  add(...teardowns) {
    if (this.disposed) {
      throw new Error('Cannot add to an already disposed UniversalDisposable!');
    }

    for (let i = 0; i < teardowns.length; i++) {
      assertTeardown(teardowns[i]);
      this.teardowns.add(teardowns[i]);
    }
  }
  /**
   * Adds a list of teardowns but also ties them to the lifetime of `destructible`.
   * When `destructible` is destroyed (or `this.dispose()` gets called, whichever comes first),
   * all `teardowns` provided are also disposed.
   *
   * This is a subtle pattern to get right because of two factors:
   * - we need to make sure that all teardowns are also removed on destroy
   * - we also need to ensure that we don't leak the onDidDestroy disposable
   */


  addUntilDestroyed(destructible, ...teardowns) {
    if (this.disposed) {
      throw new Error('Cannot add to an already disposed UniversalDisposable!');
    }

    const destroyDisposable = new UniversalDisposable(...teardowns, destructible.onDidDestroy(() => {
      destroyDisposable.dispose();
      this.remove(destroyDisposable);
    }));
    this.add(destroyDisposable);
  }

  remove(teardown) {
    if (!this.disposed) {
      this.teardowns.delete(teardown);
    }
  }

  dispose() {
    if (!this.disposed) {
      this.disposed = true;
      this.teardowns.forEach(teardown => {
        if (typeof teardown.dispose === 'function') {
          teardown.dispose();
        } else if (typeof teardown.unsubscribe === 'function') {
          teardown.unsubscribe();
        } else if (typeof teardown.destroy === 'function') {
          teardown.destroy();
        } else if (typeof teardown === 'function') {
          teardown();
        }
      });
      this.teardowns = null;
    }
  }

  unsubscribe() {
    this.dispose();
  }

  clear() {
    if (!this.disposed) {
      this.teardowns.clear();
    }
  }

}

exports.default = UniversalDisposable;

function assertTeardown(teardown) {
  if (typeof teardown.dispose === 'function' || typeof teardown.unsubscribe === 'function' || typeof teardown.destroy === 'function' || typeof teardown === 'function') {
    return;
  }

  throw new TypeError('Arguments to UniversalDisposable.add must be disposable');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUuanMiXSwibmFtZXMiOlsiVW5pdmVyc2FsRGlzcG9zYWJsZSIsImNvbnN0cnVjdG9yIiwidGVhcmRvd25zIiwiZGlzcG9zZWQiLCJTZXQiLCJsZW5ndGgiLCJhZGQiLCJFcnJvciIsImkiLCJhc3NlcnRUZWFyZG93biIsImFkZFVudGlsRGVzdHJveWVkIiwiZGVzdHJ1Y3RpYmxlIiwiZGVzdHJveURpc3Bvc2FibGUiLCJvbkRpZERlc3Ryb3kiLCJkaXNwb3NlIiwicmVtb3ZlIiwidGVhcmRvd24iLCJkZWxldGUiLCJmb3JFYWNoIiwidW5zdWJzY3JpYmUiLCJkZXN0cm95IiwiY2xlYXIiLCJUeXBlRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ2UsTUFBTUEsbUJBQU4sQ0FBMEI7QUFJdkNDLEVBQUFBLFdBQVcsQ0FBQyxHQUFHQyxTQUFKLEVBQW1DO0FBQUEsU0FIOUNDLFFBRzhDO0FBQUEsU0FGOUNELFNBRThDO0FBQzVDLFNBQUtBLFNBQUwsR0FBaUIsSUFBSUUsR0FBSixFQUFqQjtBQUNBLFNBQUtELFFBQUwsR0FBZ0IsS0FBaEI7O0FBQ0EsUUFBSUQsU0FBUyxDQUFDRyxNQUFkLEVBQXNCO0FBQ3BCLFdBQUtDLEdBQUwsQ0FBUyxHQUFHSixTQUFaO0FBQ0Q7QUFDRjs7QUFFREksRUFBQUEsR0FBRyxDQUFDLEdBQUdKLFNBQUosRUFBeUM7QUFDMUMsUUFBSSxLQUFLQyxRQUFULEVBQW1CO0FBQ2pCLFlBQU0sSUFBSUksS0FBSixDQUFVLHdEQUFWLENBQU47QUFDRDs7QUFDRCxTQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdOLFNBQVMsQ0FBQ0csTUFBOUIsRUFBc0NHLENBQUMsRUFBdkMsRUFBMkM7QUFDekNDLE1BQUFBLGNBQWMsQ0FBQ1AsU0FBUyxDQUFDTSxDQUFELENBQVYsQ0FBZDtBQUNBLFdBQUtOLFNBQUwsQ0FBZUksR0FBZixDQUFtQkosU0FBUyxDQUFDTSxDQUFELENBQTVCO0FBQ0Q7QUFDRjtBQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0VFLEVBQUFBLGlCQUFpQixDQUNmQyxZQURlLEVBRWYsR0FBR1QsU0FGWSxFQUdmO0FBQ0EsUUFBSSxLQUFLQyxRQUFULEVBQW1CO0FBQ2pCLFlBQU0sSUFBSUksS0FBSixDQUFVLHdEQUFWLENBQU47QUFDRDs7QUFDRCxVQUFNSyxpQkFBaUIsR0FBRyxJQUFJWixtQkFBSixDQUN4QixHQUFHRSxTQURxQixFQUV4QlMsWUFBWSxDQUFDRSxZQUFiLENBQTBCLE1BQU07QUFDOUJELE1BQUFBLGlCQUFpQixDQUFDRSxPQUFsQjtBQUNBLFdBQUtDLE1BQUwsQ0FBWUgsaUJBQVo7QUFDRCxLQUhELENBRndCLENBQTFCO0FBT0EsU0FBS04sR0FBTCxDQUFTTSxpQkFBVDtBQUNEOztBQUVERyxFQUFBQSxNQUFNLENBQUNDLFFBQUQsRUFBOEI7QUFDbEMsUUFBSSxDQUFDLEtBQUtiLFFBQVYsRUFBb0I7QUFDbEIsV0FBS0QsU0FBTCxDQUFlZSxNQUFmLENBQXNCRCxRQUF0QjtBQUNEO0FBQ0Y7O0FBRURGLEVBQUFBLE9BQU8sR0FBUztBQUNkLFFBQUksQ0FBQyxLQUFLWCxRQUFWLEVBQW9CO0FBQ2xCLFdBQUtBLFFBQUwsR0FBZ0IsSUFBaEI7QUFDQSxXQUFLRCxTQUFMLENBQWVnQixPQUFmLENBQXVCRixRQUFRLElBQUk7QUFDakMsWUFBSSxPQUFPQSxRQUFRLENBQUNGLE9BQWhCLEtBQTRCLFVBQWhDLEVBQTRDO0FBQzFDRSxVQUFBQSxRQUFRLENBQUNGLE9BQVQ7QUFDRCxTQUZELE1BRU8sSUFBSSxPQUFPRSxRQUFRLENBQUNHLFdBQWhCLEtBQWdDLFVBQXBDLEVBQWdEO0FBQ3JESCxVQUFBQSxRQUFRLENBQUNHLFdBQVQ7QUFDRCxTQUZNLE1BRUEsSUFBSSxPQUFPSCxRQUFRLENBQUNJLE9BQWhCLEtBQTRCLFVBQWhDLEVBQTRDO0FBQ2pESixVQUFBQSxRQUFRLENBQUNJLE9BQVQ7QUFDRCxTQUZNLE1BRUEsSUFBSSxPQUFPSixRQUFQLEtBQW9CLFVBQXhCLEVBQW9DO0FBQ3pDQSxVQUFBQSxRQUFRO0FBQ1Q7QUFDRixPQVZEO0FBV0EsV0FBS2QsU0FBTCxHQUFrQixJQUFsQjtBQUNEO0FBQ0Y7O0FBRURpQixFQUFBQSxXQUFXLEdBQVM7QUFDbEIsU0FBS0wsT0FBTDtBQUNEOztBQUVETyxFQUFBQSxLQUFLLEdBQVM7QUFDWixRQUFJLENBQUMsS0FBS2xCLFFBQVYsRUFBb0I7QUFDbEIsV0FBS0QsU0FBTCxDQUFlbUIsS0FBZjtBQUNEO0FBQ0Y7O0FBaEZzQzs7OztBQW1GekMsU0FBU1osY0FBVCxDQUF3Qk8sUUFBeEIsRUFBcUQ7QUFDbkQsTUFDRSxPQUFPQSxRQUFRLENBQUNGLE9BQWhCLEtBQTRCLFVBQTVCLElBQ0EsT0FBT0UsUUFBUSxDQUFDRyxXQUFoQixLQUFnQyxVQURoQyxJQUVBLE9BQU9ILFFBQVEsQ0FBQ0ksT0FBaEIsS0FBNEIsVUFGNUIsSUFHQSxPQUFPSixRQUFQLEtBQW9CLFVBSnRCLEVBS0U7QUFDQTtBQUNEOztBQUNELFFBQU0sSUFBSU0sU0FBSixDQUNKLHlEQURJLENBQU47QUFHRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmV4cG9ydCB0eXBlIElEZXN0cnVjdGlibGUgPSB7XHJcbiAgZGVzdHJveSgpOiB2b2lkLFxyXG4gIG9uRGlkRGVzdHJveShjYWxsYmFjazogKCkgPT4gbWl4ZWQpOiBJRGlzcG9zYWJsZSxcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEFueVRlYXJkb3duID1cclxuICB8ICgoKSA9PiBtaXhlZClcclxuICB8IHJ4anMkSVN1YnNjcmlwdGlvblxyXG4gIHwgSURpc3Bvc2FibGVcclxuICB8IElEZXN0cnVjdGlibGU7XHJcblxyXG4vKipcclxuICogTGlrZSBhIENvbXBvc2l0ZURpc3Bvc2FibGUsIGJ1dCBpbiBhZGRpdGlvbiB0byBEaXNwb3NhYmxlIGluc3RhbmNlcyBpdCBjYW5cclxuICogYWxzbyBhY2NlcHQgcGxhaW4gZnVuY3Rpb25zIGFuZCBSeCBzdWJzY3JpcHRpb25zLlxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVW5pdmVyc2FsRGlzcG9zYWJsZSB7XHJcbiAgZGlzcG9zZWQ6IGJvb2xlYW47XHJcbiAgdGVhcmRvd25zOiBTZXQ8QW55VGVhcmRvd24+O1xyXG5cclxuICBjb25zdHJ1Y3RvciguLi50ZWFyZG93bnM6IEFycmF5PEFueVRlYXJkb3duPikge1xyXG4gICAgdGhpcy50ZWFyZG93bnMgPSBuZXcgU2V0KCk7XHJcbiAgICB0aGlzLmRpc3Bvc2VkID0gZmFsc2U7XHJcbiAgICBpZiAodGVhcmRvd25zLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLmFkZCguLi50ZWFyZG93bnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkKC4uLnRlYXJkb3duczogQXJyYXk8QW55VGVhcmRvd24+KTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5kaXNwb3NlZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBhZGQgdG8gYW4gYWxyZWFkeSBkaXNwb3NlZCBVbml2ZXJzYWxEaXNwb3NhYmxlIScpO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZWFyZG93bnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgYXNzZXJ0VGVhcmRvd24odGVhcmRvd25zW2ldKTtcclxuICAgICAgdGhpcy50ZWFyZG93bnMuYWRkKHRlYXJkb3duc1tpXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgbGlzdCBvZiB0ZWFyZG93bnMgYnV0IGFsc28gdGllcyB0aGVtIHRvIHRoZSBsaWZldGltZSBvZiBgZGVzdHJ1Y3RpYmxlYC5cclxuICAgKiBXaGVuIGBkZXN0cnVjdGlibGVgIGlzIGRlc3Ryb3llZCAob3IgYHRoaXMuZGlzcG9zZSgpYCBnZXRzIGNhbGxlZCwgd2hpY2hldmVyIGNvbWVzIGZpcnN0KSxcclxuICAgKiBhbGwgYHRlYXJkb3duc2AgcHJvdmlkZWQgYXJlIGFsc28gZGlzcG9zZWQuXHJcbiAgICpcclxuICAgKiBUaGlzIGlzIGEgc3VidGxlIHBhdHRlcm4gdG8gZ2V0IHJpZ2h0IGJlY2F1c2Ugb2YgdHdvIGZhY3RvcnM6XHJcbiAgICogLSB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IGFsbCB0ZWFyZG93bnMgYXJlIGFsc28gcmVtb3ZlZCBvbiBkZXN0cm95XHJcbiAgICogLSB3ZSBhbHNvIG5lZWQgdG8gZW5zdXJlIHRoYXQgd2UgZG9uJ3QgbGVhayB0aGUgb25EaWREZXN0cm95IGRpc3Bvc2FibGVcclxuICAgKi9cclxuICBhZGRVbnRpbERlc3Ryb3llZChcclxuICAgIGRlc3RydWN0aWJsZTogSURlc3RydWN0aWJsZSxcclxuICAgIC4uLnRlYXJkb3duczogQXJyYXk8QW55VGVhcmRvd24+XHJcbiAgKSB7XHJcbiAgICBpZiAodGhpcy5kaXNwb3NlZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBhZGQgdG8gYW4gYWxyZWFkeSBkaXNwb3NlZCBVbml2ZXJzYWxEaXNwb3NhYmxlIScpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVzdHJveURpc3Bvc2FibGUgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZShcclxuICAgICAgLi4udGVhcmRvd25zLFxyXG4gICAgICBkZXN0cnVjdGlibGUub25EaWREZXN0cm95KCgpID0+IHtcclxuICAgICAgICBkZXN0cm95RGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmUoZGVzdHJveURpc3Bvc2FibGUpO1xyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgICB0aGlzLmFkZChkZXN0cm95RGlzcG9zYWJsZSk7XHJcbiAgfVxyXG5cclxuICByZW1vdmUodGVhcmRvd246IEFueVRlYXJkb3duKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuZGlzcG9zZWQpIHtcclxuICAgICAgdGhpcy50ZWFyZG93bnMuZGVsZXRlKHRlYXJkb3duKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuZGlzcG9zZWQpIHtcclxuICAgICAgdGhpcy5kaXNwb3NlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMudGVhcmRvd25zLmZvckVhY2godGVhcmRvd24gPT4ge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGVhcmRvd24uZGlzcG9zZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgdGVhcmRvd24uZGlzcG9zZSgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRlYXJkb3duLnVuc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICB0ZWFyZG93bi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRlYXJkb3duLmRlc3Ryb3kgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIHRlYXJkb3duLmRlc3Ryb3koKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0ZWFyZG93biA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgdGVhcmRvd24oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnRlYXJkb3ducyA9IChudWxsOiBhbnkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdW5zdWJzY3JpYmUoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIGNsZWFyKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmRpc3Bvc2VkKSB7XHJcbiAgICAgIHRoaXMudGVhcmRvd25zLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhc3NlcnRUZWFyZG93bih0ZWFyZG93bjogQW55VGVhcmRvd24pOiB2b2lkIHtcclxuICBpZiAoXHJcbiAgICB0eXBlb2YgdGVhcmRvd24uZGlzcG9zZSA9PT0gJ2Z1bmN0aW9uJyB8fFxyXG4gICAgdHlwZW9mIHRlYXJkb3duLnVuc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nIHx8XHJcbiAgICB0eXBlb2YgdGVhcmRvd24uZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJyB8fFxyXG4gICAgdHlwZW9mIHRlYXJkb3duID09PSAnZnVuY3Rpb24nXHJcbiAgKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXHJcbiAgICAnQXJndW1lbnRzIHRvIFVuaXZlcnNhbERpc3Bvc2FibGUuYWRkIG11c3QgYmUgZGlzcG9zYWJsZScsXHJcbiAgKTtcclxufVxyXG4iXX0=