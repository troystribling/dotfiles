"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isRunningInServer = isRunningInServer;
exports.getAtomNuclideDir = getAtomNuclideDir;
exports.getAtomVersion = getAtomVersion;
exports.getNuclideVersion = getNuclideVersion;
exports.getNuclideRealDir = getNuclideRealDir;
exports.getOsType = getOsType;
exports.isRunningInWindows = isRunningInWindows;
exports.getOsVersion = getOsVersion;
exports.getRuntimePath = getRuntimePath;
exports.isRunningInTest = exports.NUCLIDE_VERSION_HEADER = exports.OS_TYPE = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _assert = _interopRequireDefault(require("assert"));

var _once = _interopRequireDefault(require("./once"));

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

var _nuclideUri = _interopRequireDefault(require("./nuclideUri"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
// eslint-disable-next-line
const NUCLIDE_PACKAGE_JSON_PATH = require.resolve('../../package.json');

const NUCLIDE_BASEDIR = _nuclideUri.default.dirname(NUCLIDE_PACKAGE_JSON_PATH);

const pkgJson = JSON.parse(_fs.default.readFileSync(NUCLIDE_PACKAGE_JSON_PATH, 'utf8'));
const OS_TYPE = {
  WIN32: 'win32',
  WIN64: 'win64',
  LINUX: 'linux',
  OSX: 'darwin'
};
exports.OS_TYPE = OS_TYPE;
const getMinorNuclideVersion = (0, _once.default)(() => {
  const nuclideVersion = getNuclideVersion();

  const semVersion = _semver.default.parse(nuclideVersion);

  (0, _assert.default)(semVersion != null);
  return `${semVersion.major}.${semVersion.minor}`;
});
const NUCLIDE_VERSION_HEADER = {
  'Nuclide-Version': getMinorNuclideVersion()
}; // Prior to Atom v1.7.0, `atom.inSpecMode` had a chance of performing an IPC call that could be
// expensive depending on how much work the other process was doing. Because this value will not
// change during run time, memoize the value to ensure the IPC call is performed only once.
//
// See [`getWindowLoadSettings`][1] for the sneaky getter and `remote` call that this memoization
// ensures happens only once.
//
// [1]: https://github.com/atom/atom/blob/v1.6.2/src/window-load-settings-helpers.coffee#L10-L14
// $FlowFixMe (>=0.85.0) (T35986896) Flow upgrade suppress

exports.NUCLIDE_VERSION_HEADER = NUCLIDE_VERSION_HEADER;
const isRunningInTest = (0, _once.default)(() => {
  try {
    if (typeof jest === 'object') {
      return true;
    }
  } catch (e) {}

  if (typeof atom === 'object') {
    return atom.inSpecMode();
  } else {
    return process.env.NODE_ENV === 'test';
  }
}); // Nuclide code can run in one of three situations:
//
// 1) Inside of Atom (just checking the Atom global is enough)
// 2) Inside of a forked Atom Helper (which has ELECTRON_RUN_AS_NODE)
// 3) Inside of the Nuclide server, or another plain Node script
//
// It's hard to explicitly check 3) so this checks for the absence of 1/2.

exports.isRunningInTest = isRunningInTest;

function isRunningInServer() {
  return typeof atom === 'undefined' && process.env.ELECTRON_RUN_AS_NODE !== '1';
} // This path may be a symlink.


function getAtomNuclideDir() {
  if (typeof atom !== 'object') {
    throw new Error('Not running in Atom.');
  }

  const nuclidePackageModule = atom.packages.getLoadedPackage('nuclide');
  (0, _assert.default)(nuclidePackageModule);
  return nuclidePackageModule.path;
}

function getAtomVersion() {
  if (typeof atom !== 'object') {
    throw new Error('Not running in Atom.');
  }

  return atom.getVersion();
}

function getNuclideVersion() {
  return pkgJson.version;
}

function getNuclideRealDir() {
  return NUCLIDE_BASEDIR;
}

function getOsType() {
  return _os.default.platform();
}

function isRunningInWindows() {
  return getOsType() === OS_TYPE.WIN32 || getOsType() === OS_TYPE.WIN64;
}

function getOsVersion() {
  return _os.default.release();
}

function getRuntimePath() {
  // "resourcesPath" only exists in Atom. It's as close as you can get to
  // Atom's path. In the general case, it looks like this:
  // Mac: "/Applications/Atom.app/Contents/Resources"
  // Linux: "/usr/share/atom/resources"
  // Windows: "C:\\Users\\asuarez\\AppData\\Local\\atom\\app-1.6.2\\resources"
  //          "C:\Atom\resources"
  // $FlowFixMe(>=0.68.0) Flow suppress (T27187857)
  if (global.atom && typeof process.resourcesPath === 'string') {
    const resourcesPath = process.resourcesPath;

    if (_os.default.platform() === 'darwin') {
      return resourcesPath.replace(/\/Contents\/Resources$/, '');
    } else if (_os.default.platform() === 'linux') {
      return resourcesPath.replace(/\/resources$/, '');
    } else {
      return resourcesPath.replace(/[\\]+resources$/, '');
    }
  } else {
    return process.execPath;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zL3N5c3RlbS1pbmZvLmpzIl0sIm5hbWVzIjpbIk5VQ0xJREVfUEFDS0FHRV9KU09OX1BBVEgiLCJyZXF1aXJlIiwicmVzb2x2ZSIsIk5VQ0xJREVfQkFTRURJUiIsIm51Y2xpZGVVcmkiLCJkaXJuYW1lIiwicGtnSnNvbiIsIkpTT04iLCJwYXJzZSIsImZzIiwicmVhZEZpbGVTeW5jIiwiT1NfVFlQRSIsIldJTjMyIiwiV0lONjQiLCJMSU5VWCIsIk9TWCIsImdldE1pbm9yTnVjbGlkZVZlcnNpb24iLCJudWNsaWRlVmVyc2lvbiIsImdldE51Y2xpZGVWZXJzaW9uIiwic2VtVmVyc2lvbiIsInNlbXZlciIsIm1ham9yIiwibWlub3IiLCJOVUNMSURFX1ZFUlNJT05fSEVBREVSIiwiaXNSdW5uaW5nSW5UZXN0IiwiamVzdCIsImUiLCJhdG9tIiwiaW5TcGVjTW9kZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImlzUnVubmluZ0luU2VydmVyIiwiRUxFQ1RST05fUlVOX0FTX05PREUiLCJnZXRBdG9tTnVjbGlkZURpciIsIkVycm9yIiwibnVjbGlkZVBhY2thZ2VNb2R1bGUiLCJwYWNrYWdlcyIsImdldExvYWRlZFBhY2thZ2UiLCJwYXRoIiwiZ2V0QXRvbVZlcnNpb24iLCJnZXRWZXJzaW9uIiwidmVyc2lvbiIsImdldE51Y2xpZGVSZWFsRGlyIiwiZ2V0T3NUeXBlIiwib3MiLCJwbGF0Zm9ybSIsImlzUnVubmluZ0luV2luZG93cyIsImdldE9zVmVyc2lvbiIsInJlbGVhc2UiLCJnZXRSdW50aW1lUGF0aCIsImdsb2JhbCIsInJlc291cmNlc1BhdGgiLCJyZXBsYWNlIiwiZXhlY1BhdGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFZQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQWpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFTbUMsWUFBVCxHQUFnQztBQUNyQyxTQUFPSCxZQUFHSSxPQUFILEVBQVA7QUFDRDs7QUFFTSxTQUFTQyxjQUFULEdBQWtDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSUMsTUFBTSxDQUFDeEIsSUFBUCxJQUFlLE9BQU9FLE9BQU8sQ0FBQ3VCLGFBQWYsS0FBaUMsUUFBcEQsRUFBOEQ7QUFDNUQsVUFBTUEsYUFBYSxHQUFHdkIsT0FBTyxDQUFDdUIsYUFBOUI7O0FBQ0EsUUFBSVAsWUFBR0MsUUFBSCxPQUFrQixRQUF0QixFQUFnQztBQUM5QixhQUFPTSxhQUFhLENBQUNDLE9BQWQsQ0FBc0Isd0JBQXRCLEVBQWdELEVBQWhELENBQVA7QUFDRCxLQUZELE1BRU8sSUFBSVIsWUFBR0MsUUFBSCxPQUFrQixPQUF0QixFQUErQjtBQUNwQyxhQUFPTSxhQUFhLENBQUNDLE9BQWQsQ0FBc0IsY0FBdEIsRUFBc0MsRUFBdEMsQ0FBUDtBQUNELEtBRk0sTUFFQTtBQUNMLGFBQU9ELGFBQWEsQ0FBQ0MsT0FBZCxDQUFzQixpQkFBdEIsRUFBeUMsRUFBekMsQ0FBUDtBQUNEO0FBQ0YsR0FURCxNQVNPO0FBQ0wsV0FBT3hCLE9BQU8sQ0FBQ3lCLFFBQWY7QUFDRDtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcclxuaW1wb3J0IG9uY2UgZnJvbSAnLi9vbmNlJztcclxuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xyXG5pbXBvcnQgb3MgZnJvbSAnb3MnO1xyXG5pbXBvcnQgbnVjbGlkZVVyaSBmcm9tICcuL251Y2xpZGVVcmknO1xyXG5cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXHJcbmNvbnN0IE5VQ0xJREVfUEFDS0FHRV9KU09OX1BBVEggPSByZXF1aXJlLnJlc29sdmUoJy4uLy4uL3BhY2thZ2UuanNvbicpO1xyXG5jb25zdCBOVUNMSURFX0JBU0VESVIgPSBudWNsaWRlVXJpLmRpcm5hbWUoTlVDTElERV9QQUNLQUdFX0pTT05fUEFUSCk7XHJcblxyXG5jb25zdCBwa2dKc29uID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoTlVDTElERV9QQUNLQUdFX0pTT05fUEFUSCwgJ3V0ZjgnKSk7XHJcblxyXG5leHBvcnQgY29uc3QgT1NfVFlQRSA9IHtcclxuICBXSU4zMjogJ3dpbjMyJyxcclxuICBXSU42NDogJ3dpbjY0JyxcclxuICBMSU5VWDogJ2xpbnV4JyxcclxuICBPU1g6ICdkYXJ3aW4nLFxyXG59O1xyXG5cclxuY29uc3QgZ2V0TWlub3JOdWNsaWRlVmVyc2lvbiA9IG9uY2UoKCkgPT4ge1xyXG4gIGNvbnN0IG51Y2xpZGVWZXJzaW9uID0gZ2V0TnVjbGlkZVZlcnNpb24oKTtcclxuICBjb25zdCBzZW1WZXJzaW9uID0gc2VtdmVyLnBhcnNlKG51Y2xpZGVWZXJzaW9uKTtcclxuICBpbnZhcmlhbnQoc2VtVmVyc2lvbiAhPSBudWxsKTtcclxuICByZXR1cm4gYCR7c2VtVmVyc2lvbi5tYWpvcn0uJHtzZW1WZXJzaW9uLm1pbm9yfWA7XHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IE5VQ0xJREVfVkVSU0lPTl9IRUFERVIgPSB7XHJcbiAgJ051Y2xpZGUtVmVyc2lvbic6IGdldE1pbm9yTnVjbGlkZVZlcnNpb24oKSxcclxufTtcclxuXHJcbi8vIFByaW9yIHRvIEF0b20gdjEuNy4wLCBgYXRvbS5pblNwZWNNb2RlYCBoYWQgYSBjaGFuY2Ugb2YgcGVyZm9ybWluZyBhbiBJUEMgY2FsbCB0aGF0IGNvdWxkIGJlXHJcbi8vIGV4cGVuc2l2ZSBkZXBlbmRpbmcgb24gaG93IG11Y2ggd29yayB0aGUgb3RoZXIgcHJvY2VzcyB3YXMgZG9pbmcuIEJlY2F1c2UgdGhpcyB2YWx1ZSB3aWxsIG5vdFxyXG4vLyBjaGFuZ2UgZHVyaW5nIHJ1biB0aW1lLCBtZW1vaXplIHRoZSB2YWx1ZSB0byBlbnN1cmUgdGhlIElQQyBjYWxsIGlzIHBlcmZvcm1lZCBvbmx5IG9uY2UuXHJcbi8vXHJcbi8vIFNlZSBbYGdldFdpbmRvd0xvYWRTZXR0aW5nc2BdWzFdIGZvciB0aGUgc25lYWt5IGdldHRlciBhbmQgYHJlbW90ZWAgY2FsbCB0aGF0IHRoaXMgbWVtb2l6YXRpb25cclxuLy8gZW5zdXJlcyBoYXBwZW5zIG9ubHkgb25jZS5cclxuLy9cclxuLy8gWzFdOiBodHRwczovL2dpdGh1Yi5jb20vYXRvbS9hdG9tL2Jsb2IvdjEuNi4yL3NyYy93aW5kb3ctbG9hZC1zZXR0aW5ncy1oZWxwZXJzLmNvZmZlZSNMMTAtTDE0XHJcbi8vICRGbG93Rml4TWUgKD49MC44NS4wKSAoVDM1OTg2ODk2KSBGbG93IHVwZ3JhZGUgc3VwcHJlc3NcclxuZXhwb3J0IGNvbnN0IGlzUnVubmluZ0luVGVzdCA9IG9uY2UoXHJcbiAgKCk6IGJvb2xlYW4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHR5cGVvZiBqZXN0ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7fVxyXG4gICAgaWYgKHR5cGVvZiBhdG9tID09PSAnb2JqZWN0Jykge1xyXG4gICAgICByZXR1cm4gYXRvbS5pblNwZWNNb2RlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JztcclxuICAgIH1cclxuICB9LFxyXG4pO1xyXG5cclxuLy8gTnVjbGlkZSBjb2RlIGNhbiBydW4gaW4gb25lIG9mIHRocmVlIHNpdHVhdGlvbnM6XHJcbi8vXHJcbi8vIDEpIEluc2lkZSBvZiBBdG9tIChqdXN0IGNoZWNraW5nIHRoZSBBdG9tIGdsb2JhbCBpcyBlbm91Z2gpXHJcbi8vIDIpIEluc2lkZSBvZiBhIGZvcmtlZCBBdG9tIEhlbHBlciAod2hpY2ggaGFzIEVMRUNUUk9OX1JVTl9BU19OT0RFKVxyXG4vLyAzKSBJbnNpZGUgb2YgdGhlIE51Y2xpZGUgc2VydmVyLCBvciBhbm90aGVyIHBsYWluIE5vZGUgc2NyaXB0XHJcbi8vXHJcbi8vIEl0J3MgaGFyZCB0byBleHBsaWNpdGx5IGNoZWNrIDMpIHNvIHRoaXMgY2hlY2tzIGZvciB0aGUgYWJzZW5jZSBvZiAxLzIuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1J1bm5pbmdJblNlcnZlcigpOiBib29sZWFuIHtcclxuICByZXR1cm4gKFxyXG4gICAgdHlwZW9mIGF0b20gPT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MuZW52LkVMRUNUUk9OX1JVTl9BU19OT0RFICE9PSAnMSdcclxuICApO1xyXG59XHJcblxyXG4vLyBUaGlzIHBhdGggbWF5IGJlIGEgc3ltbGluay5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEF0b21OdWNsaWRlRGlyKCk6IHN0cmluZyB7XHJcbiAgaWYgKHR5cGVvZiBhdG9tICE9PSAnb2JqZWN0Jykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgcnVubmluZyBpbiBBdG9tLicpO1xyXG4gIH1cclxuICBjb25zdCBudWNsaWRlUGFja2FnZU1vZHVsZSA9IGF0b20ucGFja2FnZXMuZ2V0TG9hZGVkUGFja2FnZSgnbnVjbGlkZScpO1xyXG4gIGludmFyaWFudChudWNsaWRlUGFja2FnZU1vZHVsZSk7XHJcbiAgcmV0dXJuIG51Y2xpZGVQYWNrYWdlTW9kdWxlLnBhdGg7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBdG9tVmVyc2lvbigpOiBzdHJpbmcge1xyXG4gIGlmICh0eXBlb2YgYXRvbSAhPT0gJ29iamVjdCcpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTm90IHJ1bm5pbmcgaW4gQXRvbS4nKTtcclxuICB9XHJcbiAgcmV0dXJuIGF0b20uZ2V0VmVyc2lvbigpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TnVjbGlkZVZlcnNpb24oKTogc3RyaW5nIHtcclxuICByZXR1cm4gcGtnSnNvbi52ZXJzaW9uO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TnVjbGlkZVJlYWxEaXIoKTogc3RyaW5nIHtcclxuICByZXR1cm4gTlVDTElERV9CQVNFRElSO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0T3NUeXBlKCk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIG9zLnBsYXRmb3JtKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1J1bm5pbmdJbldpbmRvd3MoKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIGdldE9zVHlwZSgpID09PSBPU19UWVBFLldJTjMyIHx8IGdldE9zVHlwZSgpID09PSBPU19UWVBFLldJTjY0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0T3NWZXJzaW9uKCk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIG9zLnJlbGVhc2UoKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJ1bnRpbWVQYXRoKCk6IHN0cmluZyB7XHJcbiAgLy8gXCJyZXNvdXJjZXNQYXRoXCIgb25seSBleGlzdHMgaW4gQXRvbS4gSXQncyBhcyBjbG9zZSBhcyB5b3UgY2FuIGdldCB0b1xyXG4gIC8vIEF0b20ncyBwYXRoLiBJbiB0aGUgZ2VuZXJhbCBjYXNlLCBpdCBsb29rcyBsaWtlIHRoaXM6XHJcbiAgLy8gTWFjOiBcIi9BcHBsaWNhdGlvbnMvQXRvbS5hcHAvQ29udGVudHMvUmVzb3VyY2VzXCJcclxuICAvLyBMaW51eDogXCIvdXNyL3NoYXJlL2F0b20vcmVzb3VyY2VzXCJcclxuICAvLyBXaW5kb3dzOiBcIkM6XFxcXFVzZXJzXFxcXGFzdWFyZXpcXFxcQXBwRGF0YVxcXFxMb2NhbFxcXFxhdG9tXFxcXGFwcC0xLjYuMlxcXFxyZXNvdXJjZXNcIlxyXG4gIC8vICAgICAgICAgIFwiQzpcXEF0b21cXHJlc291cmNlc1wiXHJcbiAgLy8gJEZsb3dGaXhNZSg+PTAuNjguMCkgRmxvdyBzdXBwcmVzcyAoVDI3MTg3ODU3KVxyXG4gIGlmIChnbG9iYWwuYXRvbSAmJiB0eXBlb2YgcHJvY2Vzcy5yZXNvdXJjZXNQYXRoID09PSAnc3RyaW5nJykge1xyXG4gICAgY29uc3QgcmVzb3VyY2VzUGF0aCA9IHByb2Nlc3MucmVzb3VyY2VzUGF0aDtcclxuICAgIGlmIChvcy5wbGF0Zm9ybSgpID09PSAnZGFyd2luJykge1xyXG4gICAgICByZXR1cm4gcmVzb3VyY2VzUGF0aC5yZXBsYWNlKC9cXC9Db250ZW50c1xcL1Jlc291cmNlcyQvLCAnJyk7XHJcbiAgICB9IGVsc2UgaWYgKG9zLnBsYXRmb3JtKCkgPT09ICdsaW51eCcpIHtcclxuICAgICAgcmV0dXJuIHJlc291cmNlc1BhdGgucmVwbGFjZSgvXFwvcmVzb3VyY2VzJC8sICcnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByZXNvdXJjZXNQYXRoLnJlcGxhY2UoL1tcXFxcXStyZXNvdXJjZXMkLywgJycpO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gcHJvY2Vzcy5leGVjUGF0aDtcclxuICB9XHJcbn1cclxuIl19