"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DeviceAndPackage = void 0;

var _nuclideAdb = require("@atom-ide-community/nuclide-adb");

var _Dropdown = require("@atom-ide-community/nuclide-commons-ui/Dropdown");

var _LoadingSpinner = require("@atom-ide-community/nuclide-commons-ui/LoadingSpinner");

var _expected = require("@atom-ide-community/nuclide-commons/expected");

var React = _interopRequireWildcard(require("react"));

var _AdbDeviceSelector = require("./AdbDeviceSelector");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class DeviceAndPackage extends React.Component {
  constructor(props) {
    super(props);

    this._handleDeviceChange = device => {
      const state = {
        selectedDeviceSerial: device === null || device === void 0 ? void 0 : device.serial,
        packages: device == null ? _expected.Expect.value([]) : _expected.Expect.pending()
      };
      const value = this.props.deserialize();

      if (device != null && (this.state.selectedDeviceSerial == null || device.serial !== this.state.selectedDeviceSerial) && value != null) {
        state.launchPackage = value;
      }

      this.setState(state, () => {
        this._refreshPackageList(device);
      });
    };

    this.state = {
      selectedDeviceSerial: null,
      launchPackage: '',
      packages: _expected.Expect.value([])
    };
  }

  async _refreshPackageList(device) {
    if (device != null) {
      const packages = _expected.Expect.value((await (0, _nuclideAdb.getAdbServiceByNuclideUri)(this.props.targetUri).getInstalledPackages(device.serial)).sort());

      this.setState({
        packages
      });
    } else {
      this.setState({
        packages: _expected.Expect.value([])
      });
    }
  }

  setState(partialState, callback) {
    const fullState = { ...this.state,
      ...partialState
    };
    super.setState(fullState, () => {
      this.props.onSelect(fullState.selectedDeviceSerial, fullState.launchPackage);
      callback && callback();
    });
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "block"
    }, /*#__PURE__*/React.createElement("label", null, "Device:"), /*#__PURE__*/React.createElement(_AdbDeviceSelector.AdbDeviceSelector, {
      onChange: this._handleDeviceChange,
      targetUri: this.props.targetUri
    }), /*#__PURE__*/React.createElement("label", null, "Package: "), this.state.packages.isPending ? /*#__PURE__*/React.createElement(_LoadingSpinner.LoadingSpinner, {
      size: "EXTRA_SMALL"
    }) : /*#__PURE__*/React.createElement(_Dropdown.Dropdown, {
      disabled: this.state.selectedDeviceSerial == null,
      options: this.state.packages.getOrDefault([]).map(packageName => {
        return {
          value: packageName,
          label: packageName
        };
      }),
      onChange: value => this.setState({
        launchPackage: value
      }),
      value: this.state.launchPackage
    }));
  }

}

exports.DeviceAndPackage = DeviceAndPackage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1kZWJ1Z2dlci1jb21tb24vRGV2aWNlQW5kUGFja2FnZS5qcyJdLCJuYW1lcyI6WyJEZXZpY2VBbmRQYWNrYWdlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2hhbmRsZURldmljZUNoYW5nZSIsImRldmljZSIsInN0YXRlIiwic2VsZWN0ZWREZXZpY2VTZXJpYWwiLCJzZXJpYWwiLCJwYWNrYWdlcyIsIkV4cGVjdCIsInZhbHVlIiwicGVuZGluZyIsImRlc2VyaWFsaXplIiwibGF1bmNoUGFja2FnZSIsInNldFN0YXRlIiwiX3JlZnJlc2hQYWNrYWdlTGlzdCIsInRhcmdldFVyaSIsImdldEluc3RhbGxlZFBhY2thZ2VzIiwic29ydCIsInBhcnRpYWxTdGF0ZSIsImNhbGxiYWNrIiwiZnVsbFN0YXRlIiwib25TZWxlY3QiLCJyZW5kZXIiLCJpc1BlbmRpbmciLCJnZXRPckRlZmF1bHQiLCJtYXAiLCJwYWNrYWdlTmFtZSIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXlCTyxNQUFNQSxnQkFBTixTQUErQkMsS0FBSyxDQUFDQyxTQUFyQyxDQUE2RDtBQUNsRUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWU7QUFDeEIsVUFBTUEsS0FBTjs7QUFEd0IsU0F3QzFCQyxtQkF4QzBCLEdBd0NIQyxNQUFELElBQThCO0FBQ2xELFlBQU1DLEtBQW9CLEdBQUc7QUFDM0JDLFFBQUFBLG9CQUFvQixFQUFFRixNQUFGLGFBQUVBLE1BQUYsdUJBQUVBLE1BQU0sQ0FBRUcsTUFESDtBQUUzQkMsUUFBQUEsUUFBUSxFQUFFSixNQUFNLElBQUksSUFBVixHQUFpQkssaUJBQU9DLEtBQVAsQ0FBYSxFQUFiLENBQWpC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V1E7QUFOcEIsTUFWSixDQURGO0FBc0JEOztBQXBGaUUiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93XHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG5pbXBvcnQgdHlwZSB7QWRiRGV2aWNlfSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtYWRiL2xpYi90eXBlcyc7XHJcbmltcG9ydCB0eXBlIHtFeHBlY3RlZH0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvZXhwZWN0ZWQnO1xyXG5pbXBvcnQgdHlwZSB7TnVjbGlkZVVyaX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XHJcblxyXG5pbXBvcnQge2dldEFkYlNlcnZpY2VCeU51Y2xpZGVVcml9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1hZGInO1xyXG5pbXBvcnQge0Ryb3Bkb3dufSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9Ecm9wZG93bic7XHJcbmltcG9ydCB7TG9hZGluZ1NwaW5uZXJ9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLXVpL0xvYWRpbmdTcGlubmVyJztcclxuaW1wb3J0IHtFeHBlY3R9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQge0FkYkRldmljZVNlbGVjdG9yfSBmcm9tICcuL0FkYkRldmljZVNlbGVjdG9yJztcclxuXHJcbnR5cGUgUHJvcHMgPSB7fFxyXG4gICt0YXJnZXRVcmk6IE51Y2xpZGVVcmksXHJcbiAgK29uU2VsZWN0OiAoZGV2aWNlU2VyaWFsOiA/c3RyaW5nLCBqYXZhUGFja2FnZTogc3RyaW5nKSA9PiB2b2lkLFxyXG4gICtkZXNlcmlhbGl6ZTogKCkgPT4gP3N0cmluZyxcclxufH07XHJcblxyXG50eXBlIFN0YXRlID0ge1xyXG4gIHNlbGVjdGVkRGV2aWNlU2VyaWFsOiA/c3RyaW5nLFxyXG4gIGxhdW5jaFBhY2thZ2U6IHN0cmluZyxcclxuICBwYWNrYWdlczogRXhwZWN0ZWQ8QXJyYXk8c3RyaW5nPj4sXHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgRGV2aWNlQW5kUGFja2FnZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wczogUHJvcHMpIHtcclxuICAgIHN1cGVyKHByb3BzKTtcclxuICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICAgIHNlbGVjdGVkRGV2aWNlU2VyaWFsOiBudWxsLFxyXG4gICAgICBsYXVuY2hQYWNrYWdlOiAnJyxcclxuICAgICAgcGFja2FnZXM6IEV4cGVjdC52YWx1ZShbXSksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgX3JlZnJlc2hQYWNrYWdlTGlzdChkZXZpY2U6ID9BZGJEZXZpY2UpIHtcclxuICAgIGlmIChkZXZpY2UgIT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBwYWNrYWdlcyA9IEV4cGVjdC52YWx1ZShcclxuICAgICAgICAoYXdhaXQgZ2V0QWRiU2VydmljZUJ5TnVjbGlkZVVyaShcclxuICAgICAgICAgIHRoaXMucHJvcHMudGFyZ2V0VXJpLFxyXG4gICAgICAgICkuZ2V0SW5zdGFsbGVkUGFja2FnZXMoZGV2aWNlLnNlcmlhbCkpLnNvcnQoKSxcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgcGFja2FnZXMsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgcGFja2FnZXM6IEV4cGVjdC52YWx1ZShbXSksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0U3RhdGUocGFydGlhbFN0YXRlOiBPYmplY3QsIGNhbGxiYWNrPzogKCkgPT4gbWl4ZWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IGZ1bGxTdGF0ZTogU3RhdGUgPSB7XHJcbiAgICAgIC4uLnRoaXMuc3RhdGUsXHJcbiAgICAgIC4uLnBhcnRpYWxTdGF0ZSxcclxuICAgIH07XHJcbiAgICBzdXBlci5zZXRTdGF0ZShmdWxsU3RhdGUsICgpID0+IHtcclxuICAgICAgdGhpcy5wcm9wcy5vblNlbGVjdChcclxuICAgICAgICBmdWxsU3RhdGUuc2VsZWN0ZWREZXZpY2VTZXJpYWwsXHJcbiAgICAgICAgZnVsbFN0YXRlLmxhdW5jaFBhY2thZ2UsXHJcbiAgICAgICk7XHJcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVEZXZpY2VDaGFuZ2UgPSAoZGV2aWNlOiA/QWRiRGV2aWNlKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzdGF0ZTogJFNoYXBlPFN0YXRlPiA9IHtcclxuICAgICAgc2VsZWN0ZWREZXZpY2VTZXJpYWw6IGRldmljZT8uc2VyaWFsLFxyXG4gICAgICBwYWNrYWdlczogZGV2aWNlID09IG51bGwgPyBFeHBlY3QudmFsdWUoW10pIDogRXhwZWN0LnBlbmRpbmcoKSxcclxuICAgIH07XHJcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMucHJvcHMuZGVzZXJpYWxpemUoKTtcclxuICAgIGlmIChcclxuICAgICAgZGV2aWNlICE9IG51bGwgJiZcclxuICAgICAgKHRoaXMuc3RhdGUuc2VsZWN0ZWREZXZpY2VTZXJpYWwgPT0gbnVsbCB8fFxyXG4gICAgICAgIGRldmljZS5zZXJpYWwgIT09IHRoaXMuc3RhdGUuc2VsZWN0ZWREZXZpY2VTZXJpYWwpICYmXHJcbiAgICAgIHZhbHVlICE9IG51bGxcclxuICAgICkge1xyXG4gICAgICBzdGF0ZS5sYXVuY2hQYWNrYWdlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9yZWZyZXNoUGFja2FnZUxpc3QoZGV2aWNlKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmxvY2tcIj5cclxuICAgICAgICA8bGFiZWw+RGV2aWNlOjwvbGFiZWw+XHJcbiAgICAgICAgPEFkYkRldmljZVNlbGVjdG9yXHJcbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy5faGFuZGxlRGV2aWNlQ2hhbmdlfVxyXG4gICAgICAgICAgdGFyZ2V0VXJpPXt0aGlzLnByb3BzLnRhcmdldFVyaX1cclxuICAgICAgICAvPlxyXG4gICAgICAgIDxsYWJlbD5QYWNrYWdlOiA8L2xhYmVsPlxyXG4gICAgICAgIHt0aGlzLnN0YXRlLnBhY2thZ2VzLmlzUGVuZGluZyA/IChcclxuICAgICAgICAgIDxMb2FkaW5nU3Bpbm5lciBzaXplPVwiRVhUUkFfU01BTExcIiAvPlxyXG4gICAgICAgICkgOiAoXHJcbiAgICAgICAgICA8RHJvcGRvd25cclxuICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMuc3RhdGUuc2VsZWN0ZWREZXZpY2VTZXJpYWwgPT0gbnVsbH1cclxuICAgICAgICAgICAgb3B0aW9ucz17dGhpcy5zdGF0ZS5wYWNrYWdlcy5nZXRPckRlZmF1bHQoW10pLm1hcChwYWNrYWdlTmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHt2YWx1ZTogcGFja2FnZU5hbWUsIGxhYmVsOiBwYWNrYWdlTmFtZX07XHJcbiAgICAgICAgICAgIH0pfVxyXG4gICAgICAgICAgICBvbkNoYW5nZT17dmFsdWUgPT4gdGhpcy5zZXRTdGF0ZSh7bGF1bmNoUGFja2FnZTogdmFsdWV9KX1cclxuICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUubGF1bmNoUGFja2FnZX1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgKX1cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=