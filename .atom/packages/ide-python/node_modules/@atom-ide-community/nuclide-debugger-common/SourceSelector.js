"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SourceSelector = void 0;

var _idx = _interopRequireDefault(require("idx"));

var _Dropdown = require("@atom-ide-community/nuclide-commons-ui/Dropdown");

var _nuclideUri = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/nuclideUri"));

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _utils = require("./utils");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class SourceSelector extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;

    this._sourceToOption = source => {
      const label = this._getLabelFromSource(source);

      return {
        value: source,
        label,
        selectedLabel: label
      };
    };

    this._disposables = new _UniversalDisposable.default();
    this.state = {
      selectableSources: [],
      selectedSource: null
    };
  }

  _getNewlySelectedSource(selectedSource, projectPaths, deserializedProjectPath) {
    let newSelectedSource = null;

    if (selectedSource != null) {
      newSelectedSource = projectPaths.includes(selectedSource) ? selectedSource : null;
    }

    if (newSelectedSource == null && projectPaths.length > 0) {
      const matches = projectPaths.filter(projectPath => projectPath.projectPath === deserializedProjectPath);
      newSelectedSource = matches.length > 0 ? matches[0] : projectPaths[0];
    }

    return newSelectedSource;
  }

  componentDidMount() {
    this._disposables.add((0, _utils.observeProjectPathsAllFromSourcePathsService)(projectPaths => {
      const newSelectedSource = this._getNewlySelectedSource( // TODO: (wbinnssmith) T30771435 this setState depends on current state
      // and should use an updater function rather than an object
      // eslint-disable-next-line react/no-access-state-in-setstate
      this.state.selectedSource, projectPaths, this.props.deserialize());

      this.setState({
        selectableSources: projectPaths,
        selectedSource: newSelectedSource
      });
    }));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  _getLabelFromSource(source) {
    const {
      projectPath,
      hostLabel
    } = source;

    const basename = _nuclideUri.default.basename(projectPath);

    return hostLabel + ' - ' + basename;
  }

  setState(partialState, callback) {
    const fullState = { ...this.state,
      ...partialState
    };
    super.setState(fullState, () => {
      this.props.onSelect((0, _idx.default)(fullState, _ => _.selectedSource.projectPath));
      callback && callback();
    });
  }

  render() {
    const {
      selectableSources,
      selectedSource
    } = this.state;
    const options = selectableSources.map(this._sourceToOption);

    if (options.length === 0) {
      return /*#__PURE__*/React.createElement("div", null, "No Projects Found. Please add a project to your file tree so the debugger can find sources.");
    }

    const potentiallyWrongSourceLabel = selectedSource != null && !selectedSource.suggested ? /*#__PURE__*/React.createElement("label", null, "Nuclide is not sure that you have selected a project which contains sources the debugger can use. Please double check that your selected source is correct.") : null;
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(_Dropdown.Dropdown, {
      options: options,
      onChange: option => this.setState({
        selectedSource: option
      }),
      placeholder: 'Select a source',
      value: selectedSource
    }), potentiallyWrongSourceLabel);
  }

}

exports.SourceSelector = SourceSelector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1kZWJ1Z2dlci1jb21tb24vU291cmNlU2VsZWN0b3IuanMiXSwibmFtZXMiOlsiU291cmNlU2VsZWN0b3IiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfZGlzcG9zYWJsZXMiLCJfc291cmNlVG9PcHRpb24iLCJzb3VyY2UiLCJsYWJlbCIsIl9nZXRMYWJlbEZyb21Tb3VyY2UiLCJ2YWx1ZSIsInNlbGVjdGVkTGFiZWwiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwic3RhdGUiLCJzZWxlY3RhYmxlU291cmNlcyIsInNlbGVjdGVkU291cmNlIiwiX2dldE5ld2x5U2VsZWN0ZWRTb3VyY2UiLCJwcm9qZWN0UGF0aHMiLCJkZXNlcmlhbGl6ZWRQcm9qZWN0UGF0aCIsIm5ld1NlbGVjdGVkU291cmNlIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJtYXRjaGVzIiwiZmlsdGVyIiwicHJvamVjdFBhdGgiLCJjb21wb25lbnREaWRNb3VudCIsImFkZCIsImRlc2VyaWFsaXplIiwic2V0U3RhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJob3N0TGFiZWwiLCJiYXNlbmFtZSIsIm51Y2xpZGVVcmkiLCJwYXJ0aWFsU3RhdGUiLCJjYWxsYmFjayIsImZ1bGxTdGF0ZSIsIm9uU2VsZWN0IiwiXyIsInJlbmRlciIsIm9wdGlvbnMiLCJtYXAiLCJwb3RlbnRpYWxseVdyb25nU291cmNlTGFiZWwiLCJzdWdnZXN0ZWQiLCJvcHRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFlQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXNCTyxNQUFNQSxjQUFOLFNBQTZCQyxLQUFLLENBQUNDLFNBQW5DLENBQTJEO0FBR2hFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFB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QixNQUFBQSxpQkFBRDtBQUFvQkMsTUFBQUE7QUFBcEIsUUFBc0MsS0FBS0YsS0FBakQ7QUFDQSxVQUFNMkIsT0FBTyxHQUFHMUIsaUJBQWlCLENBQUMyQixHQUFsQixDQUFzQixLQUFLbkMsZUFBM0IsQ0FBaEI7O0FBQ0EsUUFBSWtDLE9BQU8sQ0FBQ25CLE1BQVIsS0FBbUIsQ0FBdkIsRUFBMEI7QUFDeEIsMEJBQ0UsK0hBREY7QUFNRDs7QUFDRCxVQUFNcUIsMkJBQTJCLEdBQy9CM0IsY0FBYyxJQUFJLElBQWxCLElBQTBCLENBQUNBLGNBQWMsQ0FBQzRCLFNBQTFDLGdCQUNFLGlNQURGLEdBTUksSUFQTjtBQVFBLHdCQUNFLDhDQUNFLG9CQUFDLGtCQUFEO0FBQ0UsTUFBQSxPQUFPLEVBQUVILE9BRFg7QUFFRSxNQUFBLFFBQVEsRUFBRUksTUFBTSxJQUFJLEtBQUtoQixRQUFMLENBQWM7QUFBQ2IsUUFBQUEsY0FBYyxFQUFFNkI7QUFBakIsT0FBZCxDQUZ0QjtBQUdFLE1BQUEsV0FBVyxFQUFFLGlCQUhmO0FBSUUsTUFBQSxLQUFLLEVBQUU3QjtBQUpULE1BREYsRUFPRzJCLDJCQVBILENBREY7QUFXRDs7QUE5RytEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge1N1Z2dlc3RlZFByb2plY3RQYXRofSBmcm9tICdhdG9tLWlkZS1kZWJ1Z2dlci1qYXZhL3R5cGVzJztcclxuaW1wb3J0IHR5cGUge051Y2xpZGVVcml9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL251Y2xpZGVVcmknO1xyXG5cclxuaW1wb3J0IGlkeCBmcm9tICdpZHgnO1xyXG5pbXBvcnQge0Ryb3Bkb3dufSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9Ecm9wZG93bic7XHJcbmltcG9ydCBudWNsaWRlVXJpIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL251Y2xpZGVVcmknO1xyXG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQge29ic2VydmVQcm9qZWN0UGF0aHNBbGxGcm9tU291cmNlUGF0aHNTZXJ2aWNlfSBmcm9tICcuL3V0aWxzJztcclxuXHJcbnR5cGUgUHJvcHMgPSB7fFxyXG4gICtvblNlbGVjdDogKHNlbGVjdGVkU291cmNlOiA/TnVjbGlkZVVyaSkgPT4gdm9pZCxcclxuICArZGVzZXJpYWxpemU6ICgpID0+ID9zdHJpbmcsXHJcbnx9O1xyXG5cclxudHlwZSBTdGF0ZSA9IHtcclxuICBzZWxlY3RhYmxlU291cmNlczogQXJyYXk8U3VnZ2VzdGVkUHJvamVjdFBhdGg+LFxyXG4gIHNlbGVjdGVkU291cmNlOiA/U3VnZ2VzdGVkUHJvamVjdFBhdGgsXHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgU291cmNlU2VsZWN0b3IgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHMsIFN0YXRlPiB7XHJcbiAgX2Rpc3Bvc2FibGVzOiBVbml2ZXJzYWxEaXNwb3NhYmxlO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcm9wczogUHJvcHMpIHtcclxuICAgIHN1cGVyKHByb3BzKTtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoKTtcclxuICAgIHRoaXMuc3RhdGUgPSB7c2VsZWN0YWJsZVNvdXJjZXM6IFtdLCBzZWxlY3RlZFNvdXJjZTogbnVsbH07XHJcbiAgfVxyXG5cclxuICBfZ2V0TmV3bHlTZWxlY3RlZFNvdXJjZShcclxuICAgIHNlbGVjdGVkU291cmNlOiA/U3VnZ2VzdGVkUHJvamVjdFBhdGgsXHJcbiAgICBwcm9qZWN0UGF0aHM6IEFycmF5PFN1Z2dlc3RlZFByb2plY3RQYXRoPixcclxuICAgIGRlc2VyaWFsaXplZFByb2plY3RQYXRoOiA/c3RyaW5nLFxyXG4gICk6ID9TdWdnZXN0ZWRQcm9qZWN0UGF0aCB7XHJcbiAgICBsZXQgbmV3U2VsZWN0ZWRTb3VyY2UgPSBudWxsO1xyXG4gICAgaWYgKHNlbGVjdGVkU291cmNlICE9IG51bGwpIHtcclxuICAgICAgbmV3U2VsZWN0ZWRTb3VyY2UgPSBwcm9qZWN0UGF0aHMuaW5jbHVkZXMoc2VsZWN0ZWRTb3VyY2UpXHJcbiAgICAgICAgPyBzZWxlY3RlZFNvdXJjZVxyXG4gICAgICAgIDogbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChuZXdTZWxlY3RlZFNvdXJjZSA9PSBudWxsICYmIHByb2plY3RQYXRocy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBwcm9qZWN0UGF0aHMuZmlsdGVyKFxyXG4gICAgICAgIHByb2plY3RQYXRoID0+IHByb2plY3RQYXRoLnByb2plY3RQYXRoID09PSBkZXNlcmlhbGl6ZWRQcm9qZWN0UGF0aCxcclxuICAgICAgKTtcclxuICAgICAgbmV3U2VsZWN0ZWRTb3VyY2UgPSBtYXRjaGVzLmxlbmd0aCA+IDAgPyBtYXRjaGVzWzBdIDogcHJvamVjdFBhdGhzWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld1NlbGVjdGVkU291cmNlO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoXHJcbiAgICAgIG9ic2VydmVQcm9qZWN0UGF0aHNBbGxGcm9tU291cmNlUGF0aHNTZXJ2aWNlKFxyXG4gICAgICAgIChwcm9qZWN0UGF0aHM6IEFycmF5PFN1Z2dlc3RlZFByb2plY3RQYXRoPikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRTb3VyY2UgPSB0aGlzLl9nZXROZXdseVNlbGVjdGVkU291cmNlKFxyXG4gICAgICAgICAgICAvLyBUT0RPOiAod2Jpbm5zc21pdGgpIFQzMDc3MTQzNSB0aGlzIHNldFN0YXRlIGRlcGVuZHMgb24gY3VycmVudCBzdGF0ZVxyXG4gICAgICAgICAgICAvLyBhbmQgc2hvdWxkIHVzZSBhbiB1cGRhdGVyIGZ1bmN0aW9uIHJhdGhlciB0aGFuIGFuIG9iamVjdFxyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tYWNjZXNzLXN0YXRlLWluLXNldHN0YXRlXHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRTb3VyY2UsXHJcbiAgICAgICAgICAgIHByb2plY3RQYXRocyxcclxuICAgICAgICAgICAgdGhpcy5wcm9wcy5kZXNlcmlhbGl6ZSgpLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgICBzZWxlY3RhYmxlU291cmNlczogcHJvamVjdFBhdGhzLFxyXG4gICAgICAgICAgICBzZWxlY3RlZFNvdXJjZTogbmV3U2VsZWN0ZWRTb3VyY2UsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICApLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgX2dldExhYmVsRnJvbVNvdXJjZShzb3VyY2U6IFN1Z2dlc3RlZFByb2plY3RQYXRoKSB7XHJcbiAgICBjb25zdCB7cHJvamVjdFBhdGgsIGhvc3RMYWJlbH0gPSBzb3VyY2U7XHJcbiAgICBjb25zdCBiYXNlbmFtZSA9IG51Y2xpZGVVcmkuYmFzZW5hbWUocHJvamVjdFBhdGgpO1xyXG4gICAgcmV0dXJuIGhvc3RMYWJlbCArICcgLSAnICsgYmFzZW5hbWU7XHJcbiAgfVxyXG5cclxuICBfc291cmNlVG9PcHRpb24gPSAoc291cmNlOiBTdWdnZXN0ZWRQcm9qZWN0UGF0aCkgPT4ge1xyXG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLl9nZXRMYWJlbEZyb21Tb3VyY2Uoc291cmNlKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbHVlOiBzb3VyY2UsXHJcbiAgICAgIGxhYmVsLFxyXG4gICAgICBzZWxlY3RlZExhYmVsOiBsYWJlbCxcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgc2V0U3RhdGUocGFydGlhbFN0YXRlOiBPYmplY3QsIGNhbGxiYWNrPzogKCkgPT4gbWl4ZWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IGZ1bGxTdGF0ZTogU3RhdGUgPSB7XHJcbiAgICAgIC4uLnRoaXMuc3RhdGUsXHJcbiAgICAgIC4uLnBhcnRpYWxTdGF0ZSxcclxuICAgIH07XHJcbiAgICBzdXBlci5zZXRTdGF0ZShmdWxsU3RhdGUsICgpID0+IHtcclxuICAgICAgdGhpcy5wcm9wcy5vblNlbGVjdChpZHgoZnVsbFN0YXRlLCBfID0+IF8uc2VsZWN0ZWRTb3VyY2UucHJvamVjdFBhdGgpKTtcclxuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xyXG4gICAgY29uc3Qge3NlbGVjdGFibGVTb3VyY2VzLCBzZWxlY3RlZFNvdXJjZX0gPSB0aGlzLnN0YXRlO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHNlbGVjdGFibGVTb3VyY2VzLm1hcCh0aGlzLl9zb3VyY2VUb09wdGlvbik7XHJcbiAgICBpZiAob3B0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgTm8gUHJvamVjdHMgRm91bmQuIFBsZWFzZSBhZGQgYSBwcm9qZWN0IHRvIHlvdXIgZmlsZSB0cmVlIHNvIHRoZVxyXG4gICAgICAgICAgZGVidWdnZXIgY2FuIGZpbmQgc291cmNlcy5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBvdGVudGlhbGx5V3JvbmdTb3VyY2VMYWJlbCA9XHJcbiAgICAgIHNlbGVjdGVkU291cmNlICE9IG51bGwgJiYgIXNlbGVjdGVkU291cmNlLnN1Z2dlc3RlZCA/IChcclxuICAgICAgICA8bGFiZWw+XHJcbiAgICAgICAgICBOdWNsaWRlIGlzIG5vdCBzdXJlIHRoYXQgeW91IGhhdmUgc2VsZWN0ZWQgYSBwcm9qZWN0IHdoaWNoIGNvbnRhaW5zXHJcbiAgICAgICAgICBzb3VyY2VzIHRoZSBkZWJ1Z2dlciBjYW4gdXNlLiBQbGVhc2UgZG91YmxlIGNoZWNrIHRoYXQgeW91ciBzZWxlY3RlZFxyXG4gICAgICAgICAgc291cmNlIGlzIGNvcnJlY3QuXHJcbiAgICAgICAgPC9sYWJlbD5cclxuICAgICAgKSA6IG51bGw7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2PlxyXG4gICAgICAgIDxEcm9wZG93blxyXG4gICAgICAgICAgb3B0aW9ucz17b3B0aW9uc31cclxuICAgICAgICAgIG9uQ2hhbmdlPXtvcHRpb24gPT4gdGhpcy5zZXRTdGF0ZSh7c2VsZWN0ZWRTb3VyY2U6IG9wdGlvbn0pfVxyXG4gICAgICAgICAgcGxhY2Vob2xkZXI9eydTZWxlY3QgYSBzb3VyY2UnfVxyXG4gICAgICAgICAgdmFsdWU9e3NlbGVjdGVkU291cmNlfVxyXG4gICAgICAgIC8+XHJcbiAgICAgICAge3BvdGVudGlhbGx5V3JvbmdTb3VyY2VMYWJlbH1cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=