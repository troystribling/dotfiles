"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderMarkdown = exports.MarkdownView = void 0;
const solid_js_1 = require("solid-js");
const dompurify_1 = __importDefault(require("dompurify"));
const MarkdownRenderer_1 = require("../MarkdownRenderer");
/**
 * A react component that can hosts markdown texts
 */
function MarkdownView(props) {
    const [getMarkdown, setMarkdown] = solid_js_1.createSignal("");
    /**
      Calls `getDocumentationHtml` to convert Markdown to markdown
    */
    solid_js_1.onMount(async () => {
        var _a;
        setMarkdown((_a = (await renderMarkdown(props.markdown, props.grammarName, props.renderer))) !== null && _a !== void 0 ? _a : "");
    });
    return (<div className={props.containerClassName} onWheel={onWheel}>
      <div className={props.contentClassName} innerHTML={getMarkdown()}/>
    </div>);
}
exports.MarkdownView = MarkdownView;
/**
 * handles the mouse wheel event to enable scrolling over long text
 * @param evt the mouse wheel event being triggered
 */
function onWheel(evt) {
    return evt.stopPropagation();
}
/**
 * convert the markdown documentation to markdown
 * @param markdownTexts the documentation text in markdown format to be converted
 * @param grammarName  the default grammar used for embedded code samples
 * @param renderer markdown service to be used for rendering
 * @return a promise object to track the asynchronous operation
 */
async function renderMarkdown(markdownTexts, grammarName, renderer) {
    var _a, _b;
    if (grammarName === void 0) { grammarName = ((_b = (_a = atom.workspace.getActiveTextEditor()) === null || _a === void 0 ? void 0 : _a.getGrammar().scopeName) === null || _b === void 0 ? void 0 : _b.toLowerCase()) || ""; }
    if (markdownTexts === undefined) {
        return null;
    }
    let markdownText = "";
    // if Array
    if (Array.isArray(markdownTexts)) {
        if (markdownTexts.length === 0) {
            return null;
        }
        markdownText = markdownTexts.join("\r\n");
    }
    // if string
    else {
        markdownText = markdownTexts;
    }
    if (renderer) {
        return dompurify_1.default.sanitize(await renderer.render(markdownText, grammarName));
    }
    else {
        // Use built-in markdown renderer (it already does sanitization)
        const render = await MarkdownRenderer_1.getMarkdownRenderer();
        return render(markdownText, grammarName);
    }
}
exports.renderMarkdown = renderMarkdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFya2Rvd25WaWV3LmpzeCIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy1jb21tb25zLXVpL2Zsb2F0LXBhbmUvTWFya2Rvd25WaWV3LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSx1Q0FBZ0Q7QUFDaEQsMERBQWlDO0FBRWpDLDBEQUF5RDtBQVl6RDs7R0FFRztBQUNILFNBQWdCLFlBQVksQ0FBQyxLQUFZO0lBQ3ZDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLEdBQUcsdUJBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUVuRDs7TUFFRTtJQUNGLGtCQUFPLENBQUMsS0FBSyxJQUFJLEVBQUU7O1FBQ2pCLFdBQVcsQ0FBQyxNQUFBLENBQUMsTUFBTSxjQUFjLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxtQ0FBSSxFQUFFLENBQUMsQ0FBQTtJQUM5RixDQUFDLENBQUMsQ0FBQTtJQUVGLE9BQU8sQ0FDTCxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FDekQ7TUFBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUNuRTtJQUFBLEVBQUUsR0FBRyxDQUFDLENBQ1AsQ0FBQTtBQUNILENBQUM7QUFmRCxvQ0FlQztBQUVEOzs7R0FHRztBQUNILFNBQVMsT0FBTyxDQUFDLEdBQWU7SUFDOUIsT0FBTyxHQUFHLENBQUMsZUFBZSxFQUFFLENBQUE7QUFDOUIsQ0FBQztBQUVEOzs7Ozs7R0FNRztBQUNJLEtBQUssVUFBVSxjQUFjLENBQ2xDLGFBQXFDLEVBQ3JDLFdBQXVHLEVBQ3ZHLFFBQTBCOztnQ0FEMUIsRUFBQSxlQUFzQixNQUFBLE1BQUEsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsRUFBRSwwQ0FBRSxVQUFVLEdBQUcsU0FBUywwQ0FBRSxXQUFXLEVBQUUsS0FBSSxFQUFFO0lBR3ZHLElBQUksYUFBYSxLQUFLLFNBQVMsRUFBRTtRQUMvQixPQUFPLElBQUksQ0FBQTtLQUNaO0lBRUQsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLFdBQVc7SUFDWCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDaEMsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUM5QixPQUFPLElBQUksQ0FBQTtTQUNaO1FBQ0QsWUFBWSxHQUFJLGFBQStCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0tBQzdEO0lBQ0QsWUFBWTtTQUNQO1FBQ0gsWUFBWSxHQUFHLGFBQWEsQ0FBQTtLQUM3QjtJQUNELElBQUksUUFBUSxFQUFFO1FBQ1osT0FBTyxtQkFBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUE7S0FDNUU7U0FBTTtRQUNMLGdFQUFnRTtRQUNoRSxNQUFNLE1BQU0sR0FBRyxNQUFNLHNDQUFtQixFQUFFLENBQUE7UUFDMUMsT0FBTyxNQUFNLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFBO0tBQ3pDO0FBQ0gsQ0FBQztBQTVCRCx3Q0E0QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVTaWduYWwsIG9uTW91bnQgfSBmcm9tIFwic29saWQtanNcIlxuaW1wb3J0IERPTVB1cmlmeSBmcm9tIFwiZG9tcHVyaWZ5XCJcbmltcG9ydCB7IE1hcmtkb3duU2VydmljZSB9IGZyb20gXCIuLi8uLi90eXBlcy1wYWNrYWdlcy9tYWluXCJcbmltcG9ydCB7IGdldE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tIFwiLi4vTWFya2Rvd25SZW5kZXJlclwiXG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvcHMge1xuICBtYXJrZG93bjogQXJyYXk8c3RyaW5nPiB8IHN0cmluZ1xuICBncmFtbWFyTmFtZT86IHN0cmluZ1xuICByZW5kZXJlcj86IE1hcmtkb3duU2VydmljZVxuICBjb250YWluZXJDbGFzc05hbWU6IHN0cmluZ1xuICBjb250ZW50Q2xhc3NOYW1lOiBzdHJpbmdcbiAgLy8gYWxyZWFkeSByZW5kZXJlZCBtYXJrZG93blxuICBodG1sPzogQXJyYXk8c3RyaW5nPiB8IHN0cmluZ1xufVxuXG4vKipcbiAqIEEgcmVhY3QgY29tcG9uZW50IHRoYXQgY2FuIGhvc3RzIG1hcmtkb3duIHRleHRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBNYXJrZG93blZpZXcocHJvcHM6IFByb3BzKSB7XG4gIGNvbnN0IFtnZXRNYXJrZG93biwgc2V0TWFya2Rvd25dID0gY3JlYXRlU2lnbmFsKFwiXCIpXG5cbiAgLyoqXG4gICAgQ2FsbHMgYGdldERvY3VtZW50YXRpb25IdG1sYCB0byBjb252ZXJ0IE1hcmtkb3duIHRvIG1hcmtkb3duXG4gICovXG4gIG9uTW91bnQoYXN5bmMgKCkgPT4ge1xuICAgIHNldE1hcmtkb3duKChhd2FpdCByZW5kZXJNYXJrZG93bihwcm9wcy5tYXJrZG93biwgcHJvcHMuZ3JhbW1hck5hbWUsIHByb3BzLnJlbmRlcmVyKSkgPz8gXCJcIilcbiAgfSlcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtwcm9wcy5jb250YWluZXJDbGFzc05hbWV9IG9uV2hlZWw9e29uV2hlZWx9PlxuICAgICAgPGRpdiBjbGFzc05hbWU9e3Byb3BzLmNvbnRlbnRDbGFzc05hbWV9IGlubmVySFRNTD17Z2V0TWFya2Rvd24oKX0gLz5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG4vKipcbiAqIGhhbmRsZXMgdGhlIG1vdXNlIHdoZWVsIGV2ZW50IHRvIGVuYWJsZSBzY3JvbGxpbmcgb3ZlciBsb25nIHRleHRcbiAqIEBwYXJhbSBldnQgdGhlIG1vdXNlIHdoZWVsIGV2ZW50IGJlaW5nIHRyaWdnZXJlZFxuICovXG5mdW5jdGlvbiBvbldoZWVsKGV2dDogV2hlZWxFdmVudCkge1xuICByZXR1cm4gZXZ0LnN0b3BQcm9wYWdhdGlvbigpXG59XG5cbi8qKlxuICogY29udmVydCB0aGUgbWFya2Rvd24gZG9jdW1lbnRhdGlvbiB0byBtYXJrZG93blxuICogQHBhcmFtIG1hcmtkb3duVGV4dHMgdGhlIGRvY3VtZW50YXRpb24gdGV4dCBpbiBtYXJrZG93biBmb3JtYXQgdG8gYmUgY29udmVydGVkXG4gKiBAcGFyYW0gZ3JhbW1hck5hbWUgIHRoZSBkZWZhdWx0IGdyYW1tYXIgdXNlZCBmb3IgZW1iZWRkZWQgY29kZSBzYW1wbGVzXG4gKiBAcGFyYW0gcmVuZGVyZXIgbWFya2Rvd24gc2VydmljZSB0byBiZSB1c2VkIGZvciByZW5kZXJpbmdcbiAqIEByZXR1cm4gYSBwcm9taXNlIG9iamVjdCB0byB0cmFjayB0aGUgYXN5bmNocm9ub3VzIG9wZXJhdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyTWFya2Rvd24oXG4gIG1hcmtkb3duVGV4dHM6IEFycmF5PHN0cmluZz4gfCBzdHJpbmcsXG4gIGdyYW1tYXJOYW1lOiBzdHJpbmcgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKCk/LmdldEdyYW1tYXIoKS5zY29wZU5hbWU/LnRvTG93ZXJDYXNlKCkgfHwgXCJcIixcbiAgcmVuZGVyZXI/OiBNYXJrZG93blNlcnZpY2Vcbik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICBpZiAobWFya2Rvd25UZXh0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGxldCBtYXJrZG93blRleHQgPSBcIlwiXG4gIC8vIGlmIEFycmF5XG4gIGlmIChBcnJheS5pc0FycmF5KG1hcmtkb3duVGV4dHMpKSB7XG4gICAgaWYgKG1hcmtkb3duVGV4dHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBtYXJrZG93blRleHQgPSAobWFya2Rvd25UZXh0cyBhcyBBcnJheTxzdHJpbmc+KS5qb2luKFwiXFxyXFxuXCIpXG4gIH1cbiAgLy8gaWYgc3RyaW5nXG4gIGVsc2Uge1xuICAgIG1hcmtkb3duVGV4dCA9IG1hcmtkb3duVGV4dHNcbiAgfVxuICBpZiAocmVuZGVyZXIpIHtcbiAgICByZXR1cm4gRE9NUHVyaWZ5LnNhbml0aXplKGF3YWl0IHJlbmRlcmVyLnJlbmRlcihtYXJrZG93blRleHQsIGdyYW1tYXJOYW1lKSlcbiAgfSBlbHNlIHtcbiAgICAvLyBVc2UgYnVpbHQtaW4gbWFya2Rvd24gcmVuZGVyZXIgKGl0IGFscmVhZHkgZG9lcyBzYW5pdGl6YXRpb24pXG4gICAgY29uc3QgcmVuZGVyID0gYXdhaXQgZ2V0TWFya2Rvd25SZW5kZXJlcigpXG4gICAgcmV0dXJuIHJlbmRlcihtYXJrZG93blRleHQsIGdyYW1tYXJOYW1lKVxuICB9XG59XG4iXX0=