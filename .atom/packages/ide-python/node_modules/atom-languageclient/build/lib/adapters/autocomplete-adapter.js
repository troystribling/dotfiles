Object.defineProperty(exports, "__esModule", {
  value: true
});

var _languageclient = require('../languageclient');

var _atom = require('atom');

var _vscodeJsonrpc = require('vscode-jsonrpc');

require('../server-manager');

var _convert = require('../convert');

var _convert2 = _interopRequireDefault(_convert);

var _fuzzaldrinPlus = require('fuzzaldrin-plus');

var _utils = require('../utils');

var _utils2 = _interopRequireDefault(_utils);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Public: Adapts the language server protocol "textDocument/completion" to the Atom
// AutoComplete+ package.
class AutocompleteAdapter {
  constructor() {
    this._suggestionCache = new WeakMap();
    this._cancellationTokens = new WeakMap();
  }

  static canAdapt(serverCapabilities) {
    return serverCapabilities.completionProvider != null;
  }

  static canResolve(serverCapabilities) {
    return serverCapabilities.completionProvider != null && serverCapabilities.completionProvider.resolveProvider === true;
  }

  // Public: Obtain suggestion list for AutoComplete+ by querying the language server using
  // the `textDocument/completion` request.
  //
  // * `server` An {ActiveServer} pointing to the language server to query.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` An optional function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns a {Promise} of an {Array} of {atom$AutocompleteSuggestion}s containing the
  // AutoComplete+ suggestions to display.
  async getSuggestions(server, request, onDidConvertCompletionItem) {
    const triggerChars = server.capabilities.completionProvider != null ? server.capabilities.completionProvider.triggerCharacters || [] : [];
    const triggerPoint = AutocompleteAdapter.getTriggerPoint(request, triggerChars);
    const prefixWithTrigger = AutocompleteAdapter.getPrefixWithTrigger(request, triggerPoint);

    const cache = this._suggestionCache.get(server);

    // We have cached suggestions and should use them
    if (cache && !cache.isIncomplete && cache.triggerPoint.isEqual(triggerPoint)) {
      const suggestions = Array.from(cache.suggestionMap.keys());
      AutocompleteAdapter.setReplacementPrefixOnSuggestions(suggestions, request.prefix);
      return prefixWithTrigger.length === 1 ? suggestions : (0, _fuzzaldrinPlus.filter)(suggestions, request.prefix, { key: 'text' });
    }

    // We either don't have suggestions or they are incomplete so request from the language server
    const completions = await _utils2.default.doWithCancellationToken(server.connection, this._cancellationTokens, cancellationToken => server.connection.completion(AutocompleteAdapter.createCompletionParams(request, prefixWithTrigger[0]), cancellationToken));
    const isIncomplete = !Array.isArray(completions) && completions.isIncomplete;
    const suggestionMap = this.completionItemsToSuggestions(completions, request, onDidConvertCompletionItem);
    this._suggestionCache.set(server, { isIncomplete, triggerPoint, suggestionMap });
    return Array.from(suggestionMap.keys());
  }

  // Public: Obtain a complete version of a suggestion with additional information
  // the language server can provide by way of the `completionItem/resolve` request.
  //
  // * `server` An {ActiveServer} pointing to the language server to query.
  // * `suggestion` An {atom$AutocompleteSuggestion} suggestion that should be resolved.
  // * `request` An {Object} with the AutoComplete+ request to satisfy.
  // * `onDidConvertCompletionItem` An optional function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns a {Promise} of an {atom$AutocompleteSuggestion} with the resolved AutoComplete+ suggestion.
  async completeSuggestion(server, suggestion, request, onDidConvertCompletionItem) {
    const cache = this._suggestionCache.get(server);
    if (cache) {
      const originalCompletionItem = cache.suggestionMap.get(suggestion);
      if (originalCompletionItem != null && originalCompletionItem[1] === false) {
        const resolvedCompletionItem = await server.connection.completionItemResolve(originalCompletionItem[0]);
        if (resolvedCompletionItem != null) {
          AutocompleteAdapter.completionItemToSuggestion(resolvedCompletionItem, suggestion, request, onDidConvertCompletionItem);
          originalCompletionItem[1] = true;
        }
      }
    }

    return suggestion;
  }

  // Public: Set the replacementPrefix property on all given suggestions to the
  // prefix specified.
  //
  // * `suggestions` An {Array} of {atom$AutocompleteSuggestion}s to set the replacementPrefix on.
  // * `prefix` The {string} containing the prefix that should be set as replacementPrefix on all suggestions.
  static setReplacementPrefixOnSuggestions(suggestions, prefix) {
    for (const suggestion of suggestions) {
      suggestion.replacementPrefix = prefix;
    }
  }

  // Public: Get the point where the trigger character occurred.
  //
  // * `request` An {Array} of {atom$AutocompleteSuggestion}s to set the replacementPrefix on.
  // * `triggerChars` The {Array} of {string}s that can be trigger characters.
  //
  // Returns the {atom$Point} where the trigger occurred.
  static getTriggerPoint(request, triggerChars) {
    if (triggerChars.includes(request.prefix)) {
      return _atom.Point.fromObject(request.bufferPosition, true);
    }

    return new _atom.Point(request.bufferPosition.row, request.bufferPosition.column - request.prefix.length);
  }

  // Public: Create TextDocumentPositionParams to be sent to the language server
  // based on the editor and position from the AutoCompleteRequest.
  //
  // * `request` The {atom$AutocompleteRequest} to obtain the trigger and editor from.
  // * `triggerPoint` The {atom$Point} where the trigger started.
  //
  // Returns a {string} containing the prefix including the trigger character.
  static getPrefixWithTrigger(request, triggerPoint) {
    return request.editor.getBuffer().getTextInRange([[triggerPoint.row, triggerPoint.column - 1], request.bufferPosition]);
  }

  // Public: Create CompletionParams to be sent to the language server
  // based on the editor and position from the Autocomplete request etc.
  //
  // * `request` The {atom$AutocompleteRequest} containing the request details.
  // * `triggerCharacter` The {string} containing the trigger character.
  //
  // Returns an {CompletionParams} with the keys:
  //  * `textDocument` the language server protocol textDocument identification.
  //  * `position` the position within the text document to display completion request for.
  //  * `context` containing the trigger character and kind.
  static createCompletionParams(request, triggerCharacter) {
    return {
      textDocument: _convert2.default.editorToTextDocumentIdentifier(request.editor),
      position: _convert2.default.pointToPosition(request.bufferPosition),
      context: {
        triggerKind: triggerCharacter != null ? _languageclient.CompletionTriggerKind.TriggerCharacter : _languageclient.CompletionTriggerKind.Invoked,
        triggerCharacter: undefined
      }
    };
  }

  // Public: Convert a language server protocol CompletionItem array or CompletionList to
  // an array of ordered AutoComplete+ suggestions.
  //
  // * `completionItems` An {Array} of {CompletionItem} objects or a {CompletionList} containing completion
  //           items to be converted.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns a {Map} of AutoComplete+ suggestions ordered by the CompletionItems sortText.
  completionItemsToSuggestions(completionItems, request, onDidConvertCompletionItem) {
    return new Map((Array.isArray(completionItems) ? completionItems : completionItems.items || []).sort((a, b) => (a.sortText || a.label).localeCompare(b.sortText || b.label)).map(s => [AutocompleteAdapter.completionItemToSuggestion(s, {}, request, onDidConvertCompletionItem), [s, false]]));
  }

  // Public: Convert a language server protocol CompletionItem to an AutoComplete+ suggestion.
  //
  // * `item` An {CompletionItem} containing a completion item to be converted.
  // * `suggestion` A {atom$AutocompleteSuggestion} to have the conversion applied to.
  // * `request` The {atom$AutocompleteRequest} to satisfy.
  // * `onDidConvertCompletionItem` A function that takes a {CompletionItem}, an {atom$AutocompleteSuggestion}
  //   and a {atom$AutocompleteRequest} allowing you to adjust converted items.
  //
  // Returns the {atom$AutocompleteSuggestion} passed in as suggestion with the conversion applied.
  static completionItemToSuggestion(item, suggestion, request, onDidConvertCompletionItem) {
    AutocompleteAdapter.applyCompletionItemToSuggestion(item, suggestion);
    AutocompleteAdapter.applyTextEditToSuggestion(item.textEdit, request.editor, suggestion);
    AutocompleteAdapter.applySnippetToSuggestion(item, suggestion);
    if (onDidConvertCompletionItem != null) {
      onDidConvertCompletionItem(item, suggestion, request);
    }

    return suggestion;
  }

  // Public: Convert the primary parts of a language server protocol CompletionItem to an AutoComplete+ suggestion.
  //
  // * `item` An {CompletionItem} containing the completion items to be merged into.
  // * `suggestion` The {atom$AutocompleteSuggestion} to merge the conversion into.
  //
  // Returns an {atom$AutocompleteSuggestion} created from the {CompletionItem}.
  static applyCompletionItemToSuggestion(item, suggestion) {
    suggestion.text = item.insertText || item.label;
    suggestion.displayText = item.label;
    suggestion.type = AutocompleteAdapter.completionKindToSuggestionType(item.kind);
    suggestion.rightLabel = item.detail;
    suggestion.description = item.documentation;
    suggestion.descriptionMarkdown = item.documentation;
  }

  // Public: Applies the textEdit part of a language server protocol CompletionItem to an
  // AutoComplete+ Suggestion via the replacementPrefix and text properties.
  //
  // * `textEdit` A {TextEdit} from a CompletionItem to apply.
  // * `editor` An Atom {TextEditor} used to obtain the necessary text replacement.
  // * `suggestion` An {atom$AutocompleteSuggestion} to set the replacementPrefix and text properties of.
  static applyTextEditToSuggestion(textEdit, editor, suggestion) {
    if (textEdit != null) {
      suggestion.replacementPrefix = editor.getTextInBufferRange(_convert2.default.lsRangeToAtomRange(textEdit.range));
      suggestion.text = textEdit.newText;
    }
  }

  // Public: Adds a snippet to the suggestion if the CompletionItem contains
  // snippet-formatted text
  //
  // * `item` An {CompletionItem} containing the completion items to be merged into.
  // * `suggestion` The {atom$AutocompleteSuggestion} to merge the conversion into.
  //
  static applySnippetToSuggestion(item, suggestion) {
    if (item.insertTextFormat === _languageclient.InsertTextFormat.Snippet) {
      suggestion.snippet = item.textEdit != null ? item.textEdit.newText : item.insertText;
    }
  }

  // Public: Obtain the textual suggestion type required by AutoComplete+ that
  // most closely maps to the numeric completion kind supplies by the language server.
  //
  // * `kind` A {Number} that represents the suggestion kind to be converted.
  //
  // Returns a {String} containing the AutoComplete+ suggestion type equivalent
  // to the given completion kind.
  static completionKindToSuggestionType(kind) {
    switch (kind) {
      case _languageclient.CompletionItemKind.Constant:
        return 'constant';
      case _languageclient.CompletionItemKind.Method:
        return 'method';
      case _languageclient.CompletionItemKind.Function:
      case _languageclient.CompletionItemKind.Constructor:
        return 'function';
      case _languageclient.CompletionItemKind.Field:
      case _languageclient.CompletionItemKind.Property:
        return 'property';
      case _languageclient.CompletionItemKind.Variable:
        return 'variable';
      case _languageclient.CompletionItemKind.Class:
        return 'class';
      case _languageclient.CompletionItemKind.Struct:
      case _languageclient.CompletionItemKind.TypeParameter:
        return 'type';
      case _languageclient.CompletionItemKind.Operator:
        return 'selector';
      case _languageclient.CompletionItemKind.Interface:
        return 'mixin';
      case _languageclient.CompletionItemKind.Module:
        return 'module';
      case _languageclient.CompletionItemKind.Unit:
        return 'builtin';
      case _languageclient.CompletionItemKind.Enum:
      case _languageclient.CompletionItemKind.EnumMember:
        return 'enum';
      case _languageclient.CompletionItemKind.Keyword:
        return 'keyword';
      case _languageclient.CompletionItemKind.Snippet:
        return 'snippet';
      case _languageclient.CompletionItemKind.File:
      case _languageclient.CompletionItemKind.Folder:
        return 'import';
      case _languageclient.CompletionItemKind.Reference:
        return 'require';
      default:
        return 'value';
    }
  }
}
exports.default = AutocompleteAdapter;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlci5qcyJdLCJuYW1lcyI6WyJBdXRvY29tcGxldGVBZGFwdGVyIiwiX3N1Z2dlc3Rpb25DYWNoZSIsIldlYWtNYXAiLCJfY2FuY2VsbGF0aW9uVG9rZW5zIiwiY2FuQWRhcHQiLCJzZXJ2ZXJDYXBhYmlsaXRpZXMiLCJjb21wbGV0aW9uUHJvdmlkZXIiLCJjYW5SZXNvbHZlIiwicmVzb2x2ZVByb3ZpZGVyIiwiZ2V0U3VnZ2VzdGlvbnMiLCJzZXJ2ZXIiLCJyZXF1ZXN0Iiwib25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0iLCJ0cmlnZ2VyQ2hhcnMiLCJjYXBhYmlsaXRpZXMiLCJ0cmlnZ2VyQ2hhcmFjdGVycyIsInRyaWdnZXJQb2ludCIsImdldFRyaWdnZXJQb2ludCIsInByZWZpeFdpdGhUcmlnZ2VyIiwiZ2V0UHJlZml4V2l0aFRyaWdnZXIiLCJjYWNoZSIsImdldCIsImlzSW5jb21wbGV0ZSIsImlzRXF1YWwiLCJzdWdnZXN0aW9ucyIsIkFycmF5IiwiZnJvbSIsInN1Z2dlc3Rpb25NYXAiLCJrZXlzIiwic2V0UmVwbGFjZW1lbnRQcmVmaXhPblN1Z2dlc3Rpb25zIiwicHJlZml4IiwibGVuZ3RoIiwia2V5IiwiY29tcGxldGlvbnMiLCJkb1dpdGhDYW5jZWxsYXRpb25Ub2tlbiIsImNvbm5lY3Rpb24iLCJjYW5jZWxsYXRpb25Ub2tlbiIsImNvbXBsZXRpb24iLCJjcmVhdGVDb21wbGV0aW9uUGFyYW1zIiwiaXNBcnJheSIsImNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMiLCJzZXQiLCJjb21wbGV0ZVN1Z2dlc3Rpb24iLCJzdWdnZXN0aW9uIiwib3JpZ2luYWxDb21wbGV0aW9uSXRlbSIsInJlc29sdmVkQ29tcGxldGlvbkl0ZW0iLCJjb21wbGV0aW9uSXRlbVJlc29sdmUiLCJjb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsInJlcGxhY2VtZW50UHJlZml4IiwiaW5jbHVkZXMiLCJmcm9tT2JqZWN0IiwiYnVmZmVyUG9zaXRpb24iLCJyb3ciLCJjb2x1bW4iLCJlZGl0b3IiLCJnZXRCdWZmZXIiLCJnZXRUZXh0SW5SYW5nZSIsInRyaWdnZXJDaGFyYWN0ZXIiLCJ0ZXh0RG9jdW1lbnQiLCJlZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXIiLCJwb3NpdGlvbiIsInBvaW50VG9Qb3NpdGlvbiIsImNvbnRleHQiLCJ0cmlnZ2VyS2luZCIsIlRyaWdnZXJDaGFyYWN0ZXIiLCJJbnZva2VkIiwidW5kZWZpbmVkIiwiY29tcGxldGlvbkl0ZW1zIiwiTWFwIiwiaXRlbXMiLCJzb3J0IiwiYSIsImIiLCJzb3J0VGV4dCIsImxhYmVsIiwibG9jYWxlQ29tcGFyZSIsIm1hcCIsInMiLCJpdGVtIiwiYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImFwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24iLCJ0ZXh0RWRpdCIsImFwcGx5U25pcHBldFRvU3VnZ2VzdGlvbiIsInRleHQiLCJpbnNlcnRUZXh0IiwiZGlzcGxheVRleHQiLCJ0eXBlIiwiY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlIiwia2luZCIsInJpZ2h0TGFiZWwiLCJkZXRhaWwiLCJkZXNjcmlwdGlvbiIsImRvY3VtZW50YXRpb24iLCJkZXNjcmlwdGlvbk1hcmtkb3duIiwiZ2V0VGV4dEluQnVmZmVyUmFuZ2UiLCJsc1JhbmdlVG9BdG9tUmFuZ2UiLCJyYW5nZSIsIm5ld1RleHQiLCJpbnNlcnRUZXh0Rm9ybWF0IiwiU25pcHBldCIsInNuaXBwZXQiLCJDb25zdGFudCIsIk1ldGhvZCIsIkZ1bmN0aW9uIiwiQ29uc3RydWN0b3IiLCJGaWVsZCIsIlByb3BlcnR5IiwiVmFyaWFibGUiLCJDbGFzcyIsIlN0cnVjdCIsIlR5cGVQYXJhbWV0ZXIiLCJPcGVyYXRvciIsIkludGVyZmFjZSIsIk1vZHVsZSIsIlVuaXQiLCJFbnVtIiwiRW51bU1lbWJlciIsIktleXdvcmQiLCJGaWxlIiwiRm9sZGVyIiwi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QUFLLG1DQUFtQkMsUUFBeEI7QUFDRSxlQUFPLFVBQVA7QUFDRixXQUFLLG1DQUFtQkMsS0FBeEI7QUFDRSxlQUFPLE9BQVA7QUFDRixXQUFLLG1DQUFtQkMsTUFBeEI7QUFDQSxXQUFLLG1DQUFtQkMsYUFBeEI7QUFDRSxlQUFPLE1BQVA7QUFDRixXQUFLLG1DQUFtQkMsUUFBeEI7QUFDRSxlQUFPLFVBQVA7QUFDRixXQUFLLG1DQUFtQkMsU0FBeEI7QUFDRSxlQUFPLE9BQVA7QUFDRixXQUFLLG1DQUFtQkMsTUFBeEI7QUFDRSxlQUFPLFFBQVA7QUFDRixXQUFLLG1DQUFtQkMsSUFBeEI7QUFDRSxlQUFPLFNBQVA7QUFDRixXQUFLLG1DQUFtQkMsSUFBeEI7QUFDQSxXQUFLLG1DQUFtQkMsVUFBeEI7QUFDRSxlQUFPLE1BQVA7QUFDRixXQUFLLG1DQUFtQkMsT0FBeEI7QUFDRSxlQUFPLFNBQVA7QUFDRixXQUFLLG1DQUFtQmxCLE9BQXhCO0FBQ0UsZUFBTyxTQUFQO0FBQ0YsV0FBSyxtQ0FBbUJtQixJQUF4QjtBQUNBLFdBQUssbUNBQW1CQyxNQUF4QjtBQUNFLGVBQU8sUUFBUDtBQUNGLFdBQUssbUNBQW1CQyxTQUF4QjtBQUNFLGVBQU8sU0FBUDtBQUNGO0FBQ0UsZUFBTyxPQUFQO0FBdkNKO0FBeUNEO0FBdlJzQztrQkFBcEJ4SCxtQiIsImZpbGUiOiJhdXRvY29tcGxldGUtYWRhcHRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbmltcG9ydCB7XG4gIENvbXBsZXRpb25JdGVtS2luZCxcbiAgQ29tcGxldGlvblRyaWdnZXJLaW5kLFxuICBJbnNlcnRUZXh0Rm9ybWF0LFxuICBMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24sXG4gIHR5cGUgQ29tcGxldGlvbkl0ZW0sXG4gIHR5cGUgQ29tcGxldGlvbkxpc3QsXG4gIHR5cGUgQ29tcGxldGlvblBhcmFtcyxcbiAgdHlwZSBTZXJ2ZXJDYXBhYmlsaXRpZXMsXG4gIHR5cGUgVGV4dEVkaXQsXG59IGZyb20gJy4uL2xhbmd1YWdlY2xpZW50JztcbmltcG9ydCB7UG9pbnR9IGZyb20gJ2F0b20nO1xuaW1wb3J0IHtDYW5jZWxsYXRpb25Ub2tlblNvdXJjZX0gZnJvbSAndnNjb2RlLWpzb25ycGMnO1xuaW1wb3J0IHt0eXBlIEFjdGl2ZVNlcnZlcn0gZnJvbSAnLi4vc2VydmVyLW1hbmFnZXInO1xuaW1wb3J0IENvbnZlcnQgZnJvbSAnLi4vY29udmVydCc7XG5pbXBvcnQge2ZpbHRlcn0gZnJvbSAnZnV6emFsZHJpbi1wbHVzJztcbmltcG9ydCBVdGlscyBmcm9tICcuLi91dGlscyc7XG5cbnR5cGUgU3VnZ2VzdGlvbkNhY2hlRW50cnkgPSB7XG4gIGlzSW5jb21wbGV0ZTogYm9vbGVhbixcbiAgdHJpZ2dlclBvaW50OiBhdG9tJFBvaW50LFxuICBzdWdnZXN0aW9uTWFwOiBNYXA8YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBbQ29tcGxldGlvbkl0ZW0sIGJvb2xlYW5dPixcbn07XG5cbi8vIFB1YmxpYzogQWRhcHRzIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgXCJ0ZXh0RG9jdW1lbnQvY29tcGxldGlvblwiIHRvIHRoZSBBdG9tXG4vLyBBdXRvQ29tcGxldGUrIHBhY2thZ2UuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvY29tcGxldGVBZGFwdGVyIHtcbiAgc3RhdGljIGNhbkFkYXB0KHNlcnZlckNhcGFiaWxpdGllczogU2VydmVyQ2FwYWJpbGl0aWVzKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHNlcnZlckNhcGFiaWxpdGllcy5jb21wbGV0aW9uUHJvdmlkZXIgIT0gbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBjYW5SZXNvbHZlKHNlcnZlckNhcGFiaWxpdGllczogU2VydmVyQ2FwYWJpbGl0aWVzKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHNlcnZlckNhcGFiaWxpdGllcy5jb21wbGV0aW9uUHJvdmlkZXIgIT0gbnVsbCAmJiBzZXJ2ZXJDYXBhYmlsaXRpZXMuY29tcGxldGlvblByb3ZpZGVyLnJlc29sdmVQcm92aWRlciA9PT0gdHJ1ZTtcbiAgfVxuXG4gIF9zdWdnZXN0aW9uQ2FjaGU6IFdlYWtNYXA8QWN0aXZlU2VydmVyLCBTdWdnZXN0aW9uQ2FjaGVFbnRyeT4gPSBuZXcgV2Vha01hcCgpO1xuICBfY2FuY2VsbGF0aW9uVG9rZW5zOiBXZWFrTWFwPExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiwgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2U+ID0gbmV3IFdlYWtNYXAoKTtcblxuICAvLyBQdWJsaWM6IE9idGFpbiBzdWdnZXN0aW9uIGxpc3QgZm9yIEF1dG9Db21wbGV0ZSsgYnkgcXVlcnlpbmcgdGhlIGxhbmd1YWdlIHNlcnZlciB1c2luZ1xuICAvLyB0aGUgYHRleHREb2N1bWVudC9jb21wbGV0aW9uYCByZXF1ZXN0LlxuICAvL1xuICAvLyAqIGBzZXJ2ZXJgIEFuIHtBY3RpdmVTZXJ2ZXJ9IHBvaW50aW5nIHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgdG8gcXVlcnkuXG4gIC8vICogYHJlcXVlc3RgIFRoZSB7YXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0fSB0byBzYXRpc2Z5LlxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XG4gIC8vICAgYW5kIGEge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBjb252ZXJ0ZWQgaXRlbXMuXG4gIC8vXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gb2YgYW4ge0FycmF5fSBvZiB7YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9ufXMgY29udGFpbmluZyB0aGVcbiAgLy8gQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9ucyB0byBkaXNwbGF5LlxuICBhc3luYyBnZXRTdWdnZXN0aW9ucyhcbiAgICBzZXJ2ZXI6IEFjdGl2ZVNlcnZlcixcbiAgICByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsXG4gICAgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0/OiAoQ29tcGxldGlvbkl0ZW0sIGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbiwgYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0KSA9PiB2b2lkLFxuICApOiBQcm9taXNlPEFycmF5PGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4+IHtcbiAgICBjb25zdCB0cmlnZ2VyQ2hhcnMgPSBzZXJ2ZXIuY2FwYWJpbGl0aWVzLmNvbXBsZXRpb25Qcm92aWRlciAhPSBudWxsID8gc2VydmVyLmNhcGFiaWxpdGllcy5jb21wbGV0aW9uUHJvdmlkZXIudHJpZ2dlckNoYXJhY3RlcnMgfHwgW10gOiBbXTtcbiAgICBjb25zdCB0cmlnZ2VyUG9pbnQgPSBBdXRvY29tcGxldGVBZGFwdGVyLmdldFRyaWdnZXJQb2ludChyZXF1ZXN0LCB0cmlnZ2VyQ2hhcnMpO1xuICAgIGNvbnN0IHByZWZpeFdpdGhUcmlnZ2VyID0gQXV0b2NvbXBsZXRlQWRhcHRlci5nZXRQcmVmaXhXaXRoVHJpZ2dlcihyZXF1ZXN0LCB0cmlnZ2VyUG9pbnQpO1xuXG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLl9zdWdnZXN0aW9uQ2FjaGUuZ2V0KHNlcnZlcik7XG5cbiAgICAvLyBXZSBoYXZlIGNhY2hlZCBzdWdnZXN0aW9ucyBhbmQgc2hvdWxkIHVzZSB0aGVtXG4gICAgaWYgKGNhY2hlICYmICFjYWNoZS5pc0luY29tcGxldGUgJiYgY2FjaGUudHJpZ2dlclBvaW50LmlzRXF1YWwodHJpZ2dlclBvaW50KSkge1xuICAgICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSBBcnJheS5mcm9tKGNhY2hlLnN1Z2dlc3Rpb25NYXAua2V5cygpKTtcbiAgICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuc2V0UmVwbGFjZW1lbnRQcmVmaXhPblN1Z2dlc3Rpb25zKHN1Z2dlc3Rpb25zLCByZXF1ZXN0LnByZWZpeCk7XG4gICAgICByZXR1cm4gcHJlZml4V2l0aFRyaWdnZXIubGVuZ3RoID09PSAxID8gc3VnZ2VzdGlvbnMgOiBmaWx0ZXIoc3VnZ2VzdGlvbnMsIHJlcXVlc3QucHJlZml4LCB7a2V5OiAndGV4dCd9KTtcbiAgICB9XG5cbiAgICAvLyBXZSBlaXRoZXIgZG9uJ3QgaGF2ZSBzdWdnZXN0aW9ucyBvciB0aGV5IGFyZSBpbmNvbXBsZXRlIHNvIHJlcXVlc3QgZnJvbSB0aGUgbGFuZ3VhZ2Ugc2VydmVyXG4gICAgY29uc3QgY29tcGxldGlvbnMgPSBhd2FpdCBVdGlscy5kb1dpdGhDYW5jZWxsYXRpb25Ub2tlbihzZXJ2ZXIuY29ubmVjdGlvbiwgdGhpcy5fY2FuY2VsbGF0aW9uVG9rZW5zLCBjYW5jZWxsYXRpb25Ub2tlbiA9PlxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24uY29tcGxldGlvbihBdXRvY29tcGxldGVBZGFwdGVyLmNyZWF0ZUNvbXBsZXRpb25QYXJhbXMocmVxdWVzdCwgcHJlZml4V2l0aFRyaWdnZXJbMF0pLCBjYW5jZWxsYXRpb25Ub2tlbiksXG4gICAgKTtcbiAgICBjb25zdCBpc0luY29tcGxldGUgPSAhQXJyYXkuaXNBcnJheShjb21wbGV0aW9ucykgJiYgY29tcGxldGlvbnMuaXNJbmNvbXBsZXRlO1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25NYXAgPSB0aGlzLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoY29tcGxldGlvbnMsIHJlcXVlc3QsIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKTtcbiAgICB0aGlzLl9zdWdnZXN0aW9uQ2FjaGUuc2V0KHNlcnZlciwge2lzSW5jb21wbGV0ZSwgdHJpZ2dlclBvaW50LCBzdWdnZXN0aW9uTWFwfSk7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oc3VnZ2VzdGlvbk1hcC5rZXlzKCkpO1xuICB9XG5cbiAgLy8gUHVibGljOiBPYnRhaW4gYSBjb21wbGV0ZSB2ZXJzaW9uIG9mIGEgc3VnZ2VzdGlvbiB3aXRoIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAgLy8gdGhlIGxhbmd1YWdlIHNlcnZlciBjYW4gcHJvdmlkZSBieSB3YXkgb2YgdGhlIGBjb21wbGV0aW9uSXRlbS9yZXNvbHZlYCByZXF1ZXN0LlxuICAvL1xuICAvLyAqIGBzZXJ2ZXJgIEFuIHtBY3RpdmVTZXJ2ZXJ9IHBvaW50aW5nIHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgdG8gcXVlcnkuXG4gIC8vICogYHN1Z2dlc3Rpb25gIEFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHN1Z2dlc3Rpb24gdGhhdCBzaG91bGQgYmUgcmVzb2x2ZWQuXG4gIC8vICogYHJlcXVlc3RgIEFuIHtPYmplY3R9IHdpdGggdGhlIEF1dG9Db21wbGV0ZSsgcmVxdWVzdCB0byBzYXRpc2Z5LlxuICAvLyAqIGBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbWAgQW4gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XG4gIC8vICAgYW5kIGEge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBjb252ZXJ0ZWQgaXRlbXMuXG4gIC8vXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gb2YgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gd2l0aCB0aGUgcmVzb2x2ZWQgQXV0b0NvbXBsZXRlKyBzdWdnZXN0aW9uLlxuICBhc3luYyBjb21wbGV0ZVN1Z2dlc3Rpb24oXG4gICAgc2VydmVyOiBBY3RpdmVTZXJ2ZXIsXG4gICAgc3VnZ2VzdGlvbjogYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLFxuICAgIHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCxcbiAgICBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbT86IChDb21wbGV0aW9uSXRlbSwgYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QpID0+IHZvaWQsXG4gICk6IFByb21pc2U8YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uPiB7XG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLl9zdWdnZXN0aW9uQ2FjaGUuZ2V0KHNlcnZlcik7XG4gICAgaWYgKGNhY2hlKSB7XG4gICAgICBjb25zdCBvcmlnaW5hbENvbXBsZXRpb25JdGVtID0gY2FjaGUuc3VnZ2VzdGlvbk1hcC5nZXQoc3VnZ2VzdGlvbik7XG4gICAgICBpZiAob3JpZ2luYWxDb21wbGV0aW9uSXRlbSAhPSBudWxsICYmIG9yaWdpbmFsQ29tcGxldGlvbkl0ZW1bMV0gPT09IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkQ29tcGxldGlvbkl0ZW0gPSBhd2FpdCBzZXJ2ZXIuY29ubmVjdGlvbi5jb21wbGV0aW9uSXRlbVJlc29sdmUob3JpZ2luYWxDb21wbGV0aW9uSXRlbVswXSk7XG4gICAgICAgIGlmIChyZXNvbHZlZENvbXBsZXRpb25JdGVtICE9IG51bGwpIHtcbiAgICAgICAgICBBdXRvY29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKHJlc29sdmVkQ29tcGxldGlvbkl0ZW0sIHN1Z2dlc3Rpb24sIHJlcXVlc3QsIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKTtcbiAgICAgICAgICBvcmlnaW5hbENvbXBsZXRpb25JdGVtWzFdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzdWdnZXN0aW9uO1xuICB9XG5cbiAgLy8gUHVibGljOiBTZXQgdGhlIHJlcGxhY2VtZW50UHJlZml4IHByb3BlcnR5IG9uIGFsbCBnaXZlbiBzdWdnZXN0aW9ucyB0byB0aGVcbiAgLy8gcHJlZml4IHNwZWNpZmllZC5cbiAgLy9cbiAgLy8gKiBgc3VnZ2VzdGlvbnNgIEFuIHtBcnJheX0gb2Yge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn1zIHRvIHNldCB0aGUgcmVwbGFjZW1lbnRQcmVmaXggb24uXG4gIC8vICogYHByZWZpeGAgVGhlIHtzdHJpbmd9IGNvbnRhaW5pbmcgdGhlIHByZWZpeCB0aGF0IHNob3VsZCBiZSBzZXQgYXMgcmVwbGFjZW1lbnRQcmVmaXggb24gYWxsIHN1Z2dlc3Rpb25zLlxuICBzdGF0aWMgc2V0UmVwbGFjZW1lbnRQcmVmaXhPblN1Z2dlc3Rpb25zKHN1Z2dlc3Rpb25zOiBBcnJheTxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+LCBwcmVmaXg6IHN0cmluZyk6IHZvaWQge1xuICAgIGZvciAoY29uc3Qgc3VnZ2VzdGlvbiBvZiBzdWdnZXN0aW9ucykge1xuICAgICAgc3VnZ2VzdGlvbi5yZXBsYWNlbWVudFByZWZpeCA9IHByZWZpeDtcbiAgICB9XG4gIH1cblxuICAvLyBQdWJsaWM6IEdldCB0aGUgcG9pbnQgd2hlcmUgdGhlIHRyaWdnZXIgY2hhcmFjdGVyIG9jY3VycmVkLlxuICAvL1xuICAvLyAqIGByZXF1ZXN0YCBBbiB7QXJyYXl9IG9mIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259cyB0byBzZXQgdGhlIHJlcGxhY2VtZW50UHJlZml4IG9uLlxuICAvLyAqIGB0cmlnZ2VyQ2hhcnNgIFRoZSB7QXJyYXl9IG9mIHtzdHJpbmd9cyB0aGF0IGNhbiBiZSB0cmlnZ2VyIGNoYXJhY3RlcnMuXG4gIC8vXG4gIC8vIFJldHVybnMgdGhlIHthdG9tJFBvaW50fSB3aGVyZSB0aGUgdHJpZ2dlciBvY2N1cnJlZC5cbiAgc3RhdGljIGdldFRyaWdnZXJQb2ludChyZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsIHRyaWdnZXJDaGFyczogQXJyYXk8c3RyaW5nPik6IGF0b20kUG9pbnQge1xuICAgIGlmICh0cmlnZ2VyQ2hhcnMuaW5jbHVkZXMocmVxdWVzdC5wcmVmaXgpKSB7XG4gICAgICByZXR1cm4gUG9pbnQuZnJvbU9iamVjdChyZXF1ZXN0LmJ1ZmZlclBvc2l0aW9uLCB0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFBvaW50KHJlcXVlc3QuYnVmZmVyUG9zaXRpb24ucm93LCByZXF1ZXN0LmJ1ZmZlclBvc2l0aW9uLmNvbHVtbiAtIHJlcXVlc3QucHJlZml4Lmxlbmd0aCk7XG4gIH1cblxuICAvLyBQdWJsaWM6IENyZWF0ZSBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyB0byBiZSBzZW50IHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcbiAgLy8gYmFzZWQgb24gdGhlIGVkaXRvciBhbmQgcG9zaXRpb24gZnJvbSB0aGUgQXV0b0NvbXBsZXRlUmVxdWVzdC5cbiAgLy9cbiAgLy8gKiBgcmVxdWVzdGAgVGhlIHthdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3R9IHRvIG9idGFpbiB0aGUgdHJpZ2dlciBhbmQgZWRpdG9yIGZyb20uXG4gIC8vICogYHRyaWdnZXJQb2ludGAgVGhlIHthdG9tJFBvaW50fSB3aGVyZSB0aGUgdHJpZ2dlciBzdGFydGVkLlxuICAvL1xuICAvLyBSZXR1cm5zIGEge3N0cmluZ30gY29udGFpbmluZyB0aGUgcHJlZml4IGluY2x1ZGluZyB0aGUgdHJpZ2dlciBjaGFyYWN0ZXIuXG4gIHN0YXRpYyBnZXRQcmVmaXhXaXRoVHJpZ2dlcihyZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsIHRyaWdnZXJQb2ludDogYXRvbSRQb2ludCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHJlcXVlc3QuZWRpdG9yXG4gICAgICAuZ2V0QnVmZmVyKClcbiAgICAgIC5nZXRUZXh0SW5SYW5nZShbW3RyaWdnZXJQb2ludC5yb3csIHRyaWdnZXJQb2ludC5jb2x1bW4gLSAxXSwgcmVxdWVzdC5idWZmZXJQb3NpdGlvbl0pO1xuICB9XG5cbiAgLy8gUHVibGljOiBDcmVhdGUgQ29tcGxldGlvblBhcmFtcyB0byBiZSBzZW50IHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcbiAgLy8gYmFzZWQgb24gdGhlIGVkaXRvciBhbmQgcG9zaXRpb24gZnJvbSB0aGUgQXV0b2NvbXBsZXRlIHJlcXVlc3QgZXRjLlxuICAvL1xuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gY29udGFpbmluZyB0aGUgcmVxdWVzdCBkZXRhaWxzLlxuICAvLyAqIGB0cmlnZ2VyQ2hhcmFjdGVyYCBUaGUge3N0cmluZ30gY29udGFpbmluZyB0aGUgdHJpZ2dlciBjaGFyYWN0ZXIuXG4gIC8vXG4gIC8vIFJldHVybnMgYW4ge0NvbXBsZXRpb25QYXJhbXN9IHdpdGggdGhlIGtleXM6XG4gIC8vICAqIGB0ZXh0RG9jdW1lbnRgIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wgdGV4dERvY3VtZW50IGlkZW50aWZpY2F0aW9uLlxuICAvLyAgKiBgcG9zaXRpb25gIHRoZSBwb3NpdGlvbiB3aXRoaW4gdGhlIHRleHQgZG9jdW1lbnQgdG8gZGlzcGxheSBjb21wbGV0aW9uIHJlcXVlc3QgZm9yLlxuICAvLyAgKiBgY29udGV4dGAgY29udGFpbmluZyB0aGUgdHJpZ2dlciBjaGFyYWN0ZXIgYW5kIGtpbmQuXG4gIHN0YXRpYyBjcmVhdGVDb21wbGV0aW9uUGFyYW1zKHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCwgdHJpZ2dlckNoYXJhY3RlcjogP3N0cmluZyk6IENvbXBsZXRpb25QYXJhbXMge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0RG9jdW1lbnQ6IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKHJlcXVlc3QuZWRpdG9yKSxcbiAgICAgIHBvc2l0aW9uOiBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihyZXF1ZXN0LmJ1ZmZlclBvc2l0aW9uKSxcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgdHJpZ2dlcktpbmQ6IHRyaWdnZXJDaGFyYWN0ZXIgIT0gbnVsbCA/IENvbXBsZXRpb25UcmlnZ2VyS2luZC5UcmlnZ2VyQ2hhcmFjdGVyIDogQ29tcGxldGlvblRyaWdnZXJLaW5kLkludm9rZWQsXG4gICAgICAgIHRyaWdnZXJDaGFyYWN0ZXI6IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCBDb21wbGV0aW9uSXRlbSBhcnJheSBvciBDb21wbGV0aW9uTGlzdCB0b1xuICAvLyBhbiBhcnJheSBvZiBvcmRlcmVkIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbnMuXG4gIC8vXG4gIC8vICogYGNvbXBsZXRpb25JdGVtc2AgQW4ge0FycmF5fSBvZiB7Q29tcGxldGlvbkl0ZW19IG9iamVjdHMgb3IgYSB7Q29tcGxldGlvbkxpc3R9IGNvbnRhaW5pbmcgY29tcGxldGlvblxuICAvLyAgICAgICAgICAgaXRlbXMgdG8gYmUgY29udmVydGVkLlxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gdG8gc2F0aXNmeS5cbiAgLy8gKiBgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW1gIEEgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XG4gIC8vICAgYW5kIGEge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBjb252ZXJ0ZWQgaXRlbXMuXG4gIC8vXG4gIC8vIFJldHVybnMgYSB7TWFwfSBvZiBBdXRvQ29tcGxldGUrIHN1Z2dlc3Rpb25zIG9yZGVyZWQgYnkgdGhlIENvbXBsZXRpb25JdGVtcyBzb3J0VGV4dC5cbiAgY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhcbiAgICBjb21wbGV0aW9uSXRlbXM6IEFycmF5PENvbXBsZXRpb25JdGVtPiB8IENvbXBsZXRpb25MaXN0LFxuICAgIHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCxcbiAgICBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbT86IChDb21wbGV0aW9uSXRlbSwgYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uLCBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QpID0+IHZvaWQsXG4gICk6IE1hcDxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sIFtDb21wbGV0aW9uSXRlbSwgYm9vbGVhbl0+IHtcbiAgICByZXR1cm4gbmV3IE1hcCgoQXJyYXkuaXNBcnJheShjb21wbGV0aW9uSXRlbXMpID8gY29tcGxldGlvbkl0ZW1zIDogY29tcGxldGlvbkl0ZW1zLml0ZW1zIHx8IFtdKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IChhLnNvcnRUZXh0IHx8IGEubGFiZWwpLmxvY2FsZUNvbXBhcmUoYi5zb3J0VGV4dCB8fCBiLmxhYmVsKSlcbiAgICAgIC5tYXAocyA9PiBbQXV0b2NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihzLCB7IH0sIHJlcXVlc3QsIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtKSwgW3MsIGZhbHNlXV0pKTtcbiAgfVxuXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCBDb21wbGV0aW9uSXRlbSB0byBhbiBBdXRvQ29tcGxldGUrIHN1Z2dlc3Rpb24uXG4gIC8vXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyBhIGNvbXBsZXRpb24gaXRlbSB0byBiZSBjb252ZXJ0ZWQuXG4gIC8vICogYHN1Z2dlc3Rpb25gIEEge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gdG8gaGF2ZSB0aGUgY29udmVyc2lvbiBhcHBsaWVkIHRvLlxuICAvLyAqIGByZXF1ZXN0YCBUaGUge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gdG8gc2F0aXNmeS5cbiAgLy8gKiBgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW1gIEEgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHtDb21wbGV0aW9uSXRlbX0sIGFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259XG4gIC8vICAgYW5kIGEge2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdH0gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBjb252ZXJ0ZWQgaXRlbXMuXG4gIC8vXG4gIC8vIFJldHVybnMgdGhlIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHBhc3NlZCBpbiBhcyBzdWdnZXN0aW9uIHdpdGggdGhlIGNvbnZlcnNpb24gYXBwbGllZC5cbiAgc3RhdGljIGNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKFxuICAgIGl0ZW06IENvbXBsZXRpb25JdGVtLFxuICAgIHN1Z2dlc3Rpb246IGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbixcbiAgICByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QsXG4gICAgb25EaWRDb252ZXJ0Q29tcGxldGlvbkl0ZW0/OiAoQ29tcGxldGlvbkl0ZW0sIGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbiwgYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0KSA9PiB2b2lkLFxuICApOiBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24ge1xuICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihpdGVtLCBzdWdnZXN0aW9uKTtcbiAgICBBdXRvY29tcGxldGVBZGFwdGVyLmFwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24oaXRlbS50ZXh0RWRpdCwgcmVxdWVzdC5lZGl0b3IsIHN1Z2dlc3Rpb24pO1xuICAgIEF1dG9jb21wbGV0ZUFkYXB0ZXIuYXBwbHlTbmlwcGV0VG9TdWdnZXN0aW9uKGl0ZW0sIHN1Z2dlc3Rpb24pO1xuICAgIGlmIChvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbSAhPSBudWxsKSB7XG4gICAgICBvbkRpZENvbnZlcnRDb21wbGV0aW9uSXRlbShpdGVtLCBzdWdnZXN0aW9uLCByZXF1ZXN0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VnZ2VzdGlvbjtcbiAgfVxuXG4gIC8vIFB1YmxpYzogQ29udmVydCB0aGUgcHJpbWFyeSBwYXJ0cyBvZiBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCBDb21wbGV0aW9uSXRlbSB0byBhbiBBdXRvQ29tcGxldGUrIHN1Z2dlc3Rpb24uXG4gIC8vXG4gIC8vICogYGl0ZW1gIEFuIHtDb21wbGV0aW9uSXRlbX0gY29udGFpbmluZyB0aGUgY29tcGxldGlvbiBpdGVtcyB0byBiZSBtZXJnZWQgaW50by5cbiAgLy8gKiBgc3VnZ2VzdGlvbmAgVGhlIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHRvIG1lcmdlIHRoZSBjb252ZXJzaW9uIGludG8uXG4gIC8vXG4gIC8vIFJldHVybnMgYW4ge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gY3JlYXRlZCBmcm9tIHRoZSB7Q29tcGxldGlvbkl0ZW19LlxuICBzdGF0aWMgYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihpdGVtOiBDb21wbGV0aW9uSXRlbSwgc3VnZ2VzdGlvbjogYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uKSB7XG4gICAgc3VnZ2VzdGlvbi50ZXh0ID0gaXRlbS5pbnNlcnRUZXh0IHx8IGl0ZW0ubGFiZWw7XG4gICAgc3VnZ2VzdGlvbi5kaXNwbGF5VGV4dCA9IGl0ZW0ubGFiZWw7XG4gICAgc3VnZ2VzdGlvbi50eXBlID0gQXV0b2NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUoaXRlbS5raW5kKTtcbiAgICBzdWdnZXN0aW9uLnJpZ2h0TGFiZWwgPSBpdGVtLmRldGFpbDtcbiAgICBzdWdnZXN0aW9uLmRlc2NyaXB0aW9uID0gaXRlbS5kb2N1bWVudGF0aW9uO1xuICAgIHN1Z2dlc3Rpb24uZGVzY3JpcHRpb25NYXJrZG93biA9IGl0ZW0uZG9jdW1lbnRhdGlvbjtcbiAgfVxuXG4gIC8vIFB1YmxpYzogQXBwbGllcyB0aGUgdGV4dEVkaXQgcGFydCBvZiBhIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCBDb21wbGV0aW9uSXRlbSB0byBhblxuICAvLyBBdXRvQ29tcGxldGUrIFN1Z2dlc3Rpb24gdmlhIHRoZSByZXBsYWNlbWVudFByZWZpeCBhbmQgdGV4dCBwcm9wZXJ0aWVzLlxuICAvL1xuICAvLyAqIGB0ZXh0RWRpdGAgQSB7VGV4dEVkaXR9IGZyb20gYSBDb21wbGV0aW9uSXRlbSB0byBhcHBseS5cbiAgLy8gKiBgZWRpdG9yYCBBbiBBdG9tIHtUZXh0RWRpdG9yfSB1c2VkIHRvIG9idGFpbiB0aGUgbmVjZXNzYXJ5IHRleHQgcmVwbGFjZW1lbnQuXG4gIC8vICogYHN1Z2dlc3Rpb25gIEFuIHthdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb259IHRvIHNldCB0aGUgcmVwbGFjZW1lbnRQcmVmaXggYW5kIHRleHQgcHJvcGVydGllcyBvZi5cbiAgc3RhdGljIGFwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24oXG4gICAgdGV4dEVkaXQ6ID9UZXh0RWRpdCxcbiAgICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcbiAgICBzdWdnZXN0aW9uOiBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24sXG4gICk6IHZvaWQge1xuICAgIGlmICh0ZXh0RWRpdCAhPSBudWxsKSB7XG4gICAgICBzdWdnZXN0aW9uLnJlcGxhY2VtZW50UHJlZml4ID0gZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKENvbnZlcnQubHNSYW5nZVRvQXRvbVJhbmdlKHRleHRFZGl0LnJhbmdlKSk7XG4gICAgICBzdWdnZXN0aW9uLnRleHQgPSB0ZXh0RWRpdC5uZXdUZXh0O1xuICAgIH1cbiAgfVxuXG4gIC8vIFB1YmxpYzogQWRkcyBhIHNuaXBwZXQgdG8gdGhlIHN1Z2dlc3Rpb24gaWYgdGhlIENvbXBsZXRpb25JdGVtIGNvbnRhaW5zXG4gIC8vIHNuaXBwZXQtZm9ybWF0dGVkIHRleHRcbiAgLy9cbiAgLy8gKiBgaXRlbWAgQW4ge0NvbXBsZXRpb25JdGVtfSBjb250YWluaW5nIHRoZSBjb21wbGV0aW9uIGl0ZW1zIHRvIGJlIG1lcmdlZCBpbnRvLlxuICAvLyAqIGBzdWdnZXN0aW9uYCBUaGUge2F0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbn0gdG8gbWVyZ2UgdGhlIGNvbnZlcnNpb24gaW50by5cbiAgLy9cbiAgc3RhdGljIGFwcGx5U25pcHBldFRvU3VnZ2VzdGlvbihpdGVtOiBDb21wbGV0aW9uSXRlbSwgc3VnZ2VzdGlvbjogYXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uKTogdm9pZCB7XG4gICAgaWYgKGl0ZW0uaW5zZXJ0VGV4dEZvcm1hdCA9PT0gSW5zZXJ0VGV4dEZvcm1hdC5TbmlwcGV0KSB7XG4gICAgICBzdWdnZXN0aW9uLnNuaXBwZXQgPSBpdGVtLnRleHRFZGl0ICE9IG51bGwgPyBpdGVtLnRleHRFZGl0Lm5ld1RleHQgOiBpdGVtLmluc2VydFRleHQ7XG4gICAgfVxuICB9XG5cblxuICAvLyBQdWJsaWM6IE9idGFpbiB0aGUgdGV4dHVhbCBzdWdnZXN0aW9uIHR5cGUgcmVxdWlyZWQgYnkgQXV0b0NvbXBsZXRlKyB0aGF0XG4gIC8vIG1vc3QgY2xvc2VseSBtYXBzIHRvIHRoZSBudW1lcmljIGNvbXBsZXRpb24ga2luZCBzdXBwbGllcyBieSB0aGUgbGFuZ3VhZ2Ugc2VydmVyLlxuICAvL1xuICAvLyAqIGBraW5kYCBBIHtOdW1iZXJ9IHRoYXQgcmVwcmVzZW50cyB0aGUgc3VnZ2VzdGlvbiBraW5kIHRvIGJlIGNvbnZlcnRlZC5cbiAgLy9cbiAgLy8gUmV0dXJucyBhIHtTdHJpbmd9IGNvbnRhaW5pbmcgdGhlIEF1dG9Db21wbGV0ZSsgc3VnZ2VzdGlvbiB0eXBlIGVxdWl2YWxlbnRcbiAgLy8gdG8gdGhlIGdpdmVuIGNvbXBsZXRpb24ga2luZC5cbiAgc3RhdGljIGNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShraW5kOiA/bnVtYmVyKTogc3RyaW5nIHtcbiAgICBzd2l0Y2ggKGtpbmQpIHtcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkNvbnN0YW50OlxuICAgICAgICByZXR1cm4gJ2NvbnN0YW50JztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLk1ldGhvZDpcbiAgICAgICAgcmV0dXJuICdtZXRob2QnO1xuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRnVuY3Rpb246XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Db25zdHJ1Y3RvcjpcbiAgICAgICAgcmV0dXJuICdmdW5jdGlvbic7XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5GaWVsZDpcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlByb3BlcnR5OlxuICAgICAgICByZXR1cm4gJ3Byb3BlcnR5JztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlZhcmlhYmxlOlxuICAgICAgICByZXR1cm4gJ3ZhcmlhYmxlJztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkNsYXNzOlxuICAgICAgICByZXR1cm4gJ2NsYXNzJztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlN0cnVjdDpcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlR5cGVQYXJhbWV0ZXI6XG4gICAgICAgIHJldHVybiAndHlwZSc7XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5PcGVyYXRvcjpcbiAgICAgICAgcmV0dXJuICdzZWxlY3Rvcic7XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5JbnRlcmZhY2U6XG4gICAgICAgIHJldHVybiAnbWl4aW4nO1xuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuTW9kdWxlOlxuICAgICAgICByZXR1cm4gJ21vZHVsZSc7XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Vbml0OlxuICAgICAgICByZXR1cm4gJ2J1aWx0aW4nO1xuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuRW51bTpcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkVudW1NZW1iZXI6XG4gICAgICAgIHJldHVybiAnZW51bSc7XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkOlxuICAgICAgICByZXR1cm4gJ2tleXdvcmQnO1xuICAgICAgY2FzZSBDb21wbGV0aW9uSXRlbUtpbmQuU25pcHBldDpcbiAgICAgICAgcmV0dXJuICdzbmlwcGV0JztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLkZpbGU6XG4gICAgICBjYXNlIENvbXBsZXRpb25JdGVtS2luZC5Gb2xkZXI6XG4gICAgICAgIHJldHVybiAnaW1wb3J0JztcbiAgICAgIGNhc2UgQ29tcGxldGlvbkl0ZW1LaW5kLlJlZmVyZW5jZTpcbiAgICAgICAgcmV0dXJuICdyZXF1aXJlJztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAndmFsdWUnO1xuICAgIH1cbiAgfVxufVxuIl19