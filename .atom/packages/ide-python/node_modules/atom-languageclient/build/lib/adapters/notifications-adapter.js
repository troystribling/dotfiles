"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const languageclient_1 = require("../languageclient");
// Public: Adapts Atom's user notifications to those of the language server protocol.
class NotificationsAdapter {
    // Public: Attach to a {LanguageClientConnection} to recieve events indicating
    // when user notifications should be displayed.
    static attach(connection, name, projectPath) {
        connection.onShowMessage((m) => NotificationsAdapter.onShowMessage(m, name, projectPath));
        connection.onShowMessageRequest((m) => NotificationsAdapter.onShowMessageRequest(m, name, projectPath));
    }
    // Public: Show a notification message with buttons using the Atom notifications API.
    //
    // * `params` The {ShowMessageRequestParams} received from the language server
    //            indicating the details of the notification to be displayed.
    // * `name`   The name of the language server so the user can identify the
    //            context of the message.
    // * `projectPath`   The path of the current project.
    static onShowMessageRequest(params, name, projectPath) {
        return new Promise((resolve, reject) => {
            const options = {
                dismissable: true,
                detail: `${name} ${projectPath}`,
            };
            if (params.actions) {
                options.buttons = params.actions.map((a) => ({
                    text: a.title,
                    onDidClick: () => {
                        resolve(a);
                        if (notification != null) {
                            notification.dismiss();
                        }
                    },
                }));
            }
            const notification = addNotificationForMessage(params.type, params.message, options);
            if (notification != null) {
                notification.onDidDismiss(() => {
                    resolve(null);
                });
            }
        });
    }
    // Public: Show a notification message using the Atom notifications API.
    //
    // * `params` The {ShowMessageParams} received from the language server
    //            indicating the details of the notification to be displayed.
    // * `name`   The name of the language server so the user can identify the
    //            context of the message.
    // * `projectPath`   The path of the current project.
    static onShowMessage(params, name, projectPath) {
        addNotificationForMessage(params.type, params.message, {
            dismissable: true,
            detail: `${name} ${projectPath}`,
        });
    }
    // Public: Convert a {MessageActionItem} from the language server into an
    // equivalent {NotificationButton} within Atom.
    //
    // * `actionItem` The {MessageActionItem} to be converted.
    //
    // Returns a {NotificationButton} equivalent to the {MessageActionItem} given.
    static actionItemToNotificationButton(actionItem) {
        return {
            text: actionItem.title,
        };
    }
}
exports.default = NotificationsAdapter;
function messageTypeToString(messageType) {
    switch (messageType) {
        case languageclient_1.MessageType.Error: return 'error';
        case languageclient_1.MessageType.Warning: return 'warning';
        default: return 'info';
    }
}
function addNotificationForMessage(messageType, message, options) {
    function isDuplicate(note) {
        const noteDismissed = note.isDismissed && note.isDismissed();
        const noteOptions = note.getOptions && note.getOptions() || {};
        return !noteDismissed &&
            note.getType() === messageTypeToString(messageType) &&
            noteOptions.detail === options.detail;
    }
    if (atom.notifications.getNotifications().some(isDuplicate)) {
        return null;
    }
    switch (messageType) {
        case languageclient_1.MessageType.Error:
            return atom.notifications.addError(message, options);
        case languageclient_1.MessageType.Warning:
            return atom.notifications.addWarning(message, options);
        case languageclient_1.MessageType.Log:
            // console.log(params.message);
            return null;
        case languageclient_1.MessageType.Info:
        default:
            return atom.notifications.addInfo(message, options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9ucy1hZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNEQU0yQjtBQVEzQixxRkFBcUY7QUFDckY7SUFDRSw4RUFBOEU7SUFDOUUsK0NBQStDO0lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQ2xCLFVBQW9DLEVBQ3BDLElBQVksRUFDWixXQUFtQjtRQUVuQixVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzFGLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsb0JBQW9CLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQzFHLENBQUM7SUFFRCxxRkFBcUY7SUFDckYsRUFBRTtJQUNGLDhFQUE4RTtJQUM5RSx5RUFBeUU7SUFDekUsMEVBQTBFO0lBQzFFLHFDQUFxQztJQUNyQyxxREFBcUQ7SUFDOUMsTUFBTSxDQUFDLG9CQUFvQixDQUNoQyxNQUFnQyxFQUNoQyxJQUFZLEVBQ1osV0FBbUI7UUFFbkIsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQ3JDLE1BQU0sT0FBTyxHQUF3QjtnQkFDbkMsV0FBVyxFQUFFLElBQUk7Z0JBQ2pCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxXQUFXLEVBQUU7YUFDakMsQ0FBQztZQUNGLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNuQixPQUFPLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMs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Q0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdkQsS0FBSyw0QkFBVyxDQUFDLE9BQU87WUFDdEIsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN6RCxLQUFLLDRCQUFXLENBQUMsR0FBRztZQUNsQiwrQkFBK0I7WUFDL0IsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNkLEtBQUssNEJBQVcsQ0FBQyxJQUFJLENBQUM7UUFDdEI7WUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3hELENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24sXHJcbiAgTWVzc2FnZVR5cGUsXHJcbiAgTWVzc2FnZUFjdGlvbkl0ZW0sXHJcbiAgU2hvd01lc3NhZ2VQYXJhbXMsXHJcbiAgU2hvd01lc3NhZ2VSZXF1ZXN0UGFyYW1zLFxyXG59IGZyb20gJy4uL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0IHtcclxuICBOb3RpZmljYXRpb24sXHJcbiAgTm90aWZpY2F0aW9uQnV0dG9uLFxyXG4gIE5vdGlmaWNhdGlvbk9wdGlvbnMsXHJcbiAgTm90aWZpY2F0aW9uRXh0LFxyXG59IGZyb20gJ2F0b20nO1xyXG5cclxuLy8gUHVibGljOiBBZGFwdHMgQXRvbSdzIHVzZXIgbm90aWZpY2F0aW9ucyB0byB0aG9zZSBvZiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb3RpZmljYXRpb25zQWRhcHRlciB7XHJcbiAgLy8gUHVibGljOiBBdHRhY2ggdG8gYSB7TGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9ufSB0byByZWNpZXZlIGV2ZW50cyBpbmRpY2F0aW5nXHJcbiAgLy8gd2hlbiB1c2VyIG5vdGlmaWNhdGlvbnMgc2hvdWxkIGJlIGRpc3BsYXllZC5cclxuICBwdWJsaWMgc3RhdGljIGF0dGFjaChcclxuICAgIGNvbm5lY3Rpb246IExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbixcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHByb2plY3RQYXRoOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICBjb25uZWN0aW9uLm9uU2hvd01lc3NhZ2UoKG0pID0+IE5vdGlmaWNhdGlvbnNBZGFwdGVyLm9uU2hvd01lc3NhZ2UobSwgbmFtZSwgcHJvamVjdFBhdGgpKTtcclxuICAgIGNvbm5lY3Rpb24ub25TaG93TWVzc2FnZVJlcXVlc3QoKG0pID0+IE5vdGlmaWNhdGlvbnNBZGFwdGVyLm9uU2hvd01lc3NhZ2VSZXF1ZXN0KG0sIG5hbWUsIHByb2plY3RQYXRoKSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNob3cgYSBub3RpZmljYXRpb24gbWVzc2FnZSB3aXRoIGJ1dHRvbnMgdXNpbmcgdGhlIEF0b20gbm90aWZpY2F0aW9ucyBBUEkuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7U2hvd01lc3NhZ2VSZXF1ZXN0UGFyYW1zfSByZWNlaXZlZCBmcm9tIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcclxuICAvLyAgICAgICAgICAgIGluZGljYXRpbmcgdGhlIGRldGFpbHMgb2YgdGhlIG5vdGlmaWNhdGlvbiB0byBiZSBkaXNwbGF5ZWQuXHJcbiAgLy8gKiBgbmFtZWAgICBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHNvIHRoZSB1c2VyIGNhbiBpZGVudGlmeSB0aGVcclxuICAvLyAgICAgICAgICAgIGNvbnRleHQgb2YgdGhlIG1lc3NhZ2UuXHJcbiAgLy8gKiBgcHJvamVjdFBhdGhgICAgVGhlIHBhdGggb2YgdGhlIGN1cnJlbnQgcHJvamVjdC5cclxuICBwdWJsaWMgc3RhdGljIG9uU2hvd01lc3NhZ2VSZXF1ZXN0KFxyXG4gICAgcGFyYW1zOiBTaG93TWVzc2FnZVJlcXVlc3RQYXJhbXMsXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBwcm9qZWN0UGF0aDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8TWVzc2FnZUFjdGlvbkl0ZW0gfCBudWxsPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zdCBvcHRpb25zOiBOb3RpZmljYXRpb25PcHRpb25zID0ge1xyXG4gICAgICAgIGRpc21pc3NhYmxlOiB0cnVlLFxyXG4gICAgICAgIGRldGFpbDogYCR7bmFtZX0gJHtwcm9qZWN0UGF0aH1gLFxyXG4gICAgICB9O1xyXG4gICAgICBpZiAocGFyYW1zLmFjdGlvbnMpIHtcclxuICAgICAgICBvcHRpb25zLmJ1dHRvbnMgPSBwYXJhbXMuYWN0aW9ucy5tYXAoKGEpID0+ICh7XHJcbiAgICAgICAgICB0ZXh0OiBhLnRpdGxlLFxyXG4gICAgICAgICAgb25EaWRDbGljazogKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKGEpO1xyXG4gICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICBub3RpZmljYXRpb24uZGlzbWlzcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYWRkTm90aWZpY2F0aW9uRm9yTWVzc2FnZShcclxuICAgICAgICBwYXJhbXMudHlwZSxcclxuICAgICAgICBwYXJhbXMubWVzc2FnZSxcclxuICAgICAgICBvcHRpb25zKTtcclxuXHJcbiAgICAgIGlmIChub3RpZmljYXRpb24gIT0gbnVsbCkge1xyXG4gICAgICAgIG5vdGlmaWNhdGlvbi5vbkRpZERpc21pc3MoKCkgPT4ge1xyXG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNob3cgYSBub3RpZmljYXRpb24gbWVzc2FnZSB1c2luZyB0aGUgQXRvbSBub3RpZmljYXRpb25zIEFQSS5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtTaG93TWVzc2FnZVBhcmFtc30gcmVjZWl2ZWQgZnJvbSB0aGUgbGFuZ3VhZ2Ugc2VydmVyXHJcbiAgLy8gICAgICAgICAgICBpbmRpY2F0aW5nIHRoZSBkZXRhaWxzIG9mIHRoZSBub3RpZmljYXRpb24gdG8gYmUgZGlzcGxheWVkLlxyXG4gIC8vICogYG5hbWVgICAgVGhlIG5hbWUgb2YgdGhlIGxhbmd1YWdlIHNlcnZlciBzbyB0aGUgdXNlciBjYW4gaWRlbnRpZnkgdGhlXHJcbiAgLy8gICAgICAgICAgICBjb250ZXh0IG9mIHRoZSBtZXNzYWdlLlxyXG4gIC8vICogYHByb2plY3RQYXRoYCAgIFRoZSBwYXRoIG9mIHRoZSBjdXJyZW50IHByb2plY3QuXHJcbiAgcHVibGljIHN0YXRpYyBvblNob3dNZXNzYWdlKFxyXG4gICAgcGFyYW1zOiBTaG93TWVzc2FnZVBhcmFtcyxcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHByb2plY3RQYXRoOiBzdHJpbmcsXHJcbiAgKTogdm9pZCB7XHJcbiAgICBhZGROb3RpZmljYXRpb25Gb3JNZXNzYWdlKHBhcmFtcy50eXBlLCBwYXJhbXMubWVzc2FnZSwge1xyXG4gICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcclxuICAgICAgZGV0YWlsOiBgJHtuYW1lfSAke3Byb2plY3RQYXRofWAsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIHtNZXNzYWdlQWN0aW9uSXRlbX0gZnJvbSB0aGUgbGFuZ3VhZ2Ugc2VydmVyIGludG8gYW5cclxuICAvLyBlcXVpdmFsZW50IHtOb3RpZmljYXRpb25CdXR0b259IHdpdGhpbiBBdG9tLlxyXG4gIC8vXHJcbiAgLy8gKiBgYWN0aW9uSXRlbWAgVGhlIHtNZXNzYWdlQWN0aW9uSXRlbX0gdG8gYmUgY29udmVydGVkLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtOb3RpZmljYXRpb25CdXR0b259IGVxdWl2YWxlbnQgdG8gdGhlIHtNZXNzYWdlQWN0aW9uSXRlbX0gZ2l2ZW4uXHJcbiAgcHVibGljIHN0YXRpYyBhY3Rpb25JdGVtVG9Ob3RpZmljYXRpb25CdXR0b24oXHJcbiAgICBhY3Rpb25JdGVtOiBNZXNzYWdlQWN0aW9uSXRlbSxcclxuICApOiBOb3RpZmljYXRpb25CdXR0b24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGV4dDogYWN0aW9uSXRlbS50aXRsZSxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBtZXNzYWdlVHlwZVRvU3RyaW5nKFxyXG4gIG1lc3NhZ2VUeXBlOiBudW1iZXIsXHJcbik6IHN0cmluZyB7XHJcbiAgc3dpdGNoIChtZXNzYWdlVHlwZSkge1xyXG4gICAgY2FzZSBNZXNzYWdlVHlwZS5FcnJvcjogcmV0dXJuICdlcnJvcic7XHJcbiAgICBjYXNlIE1lc3NhZ2VUeXBlLldhcm5pbmc6IHJldHVybiAnd2FybmluZyc7XHJcbiAgICBkZWZhdWx0OiByZXR1cm4gJ2luZm8nO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYWRkTm90aWZpY2F0aW9uRm9yTWVzc2FnZShcclxuICBtZXNzYWdlVHlwZTogbnVtYmVyLFxyXG4gIG1lc3NhZ2U6IHN0cmluZyxcclxuICBvcHRpb25zOiBOb3RpZmljYXRpb25PcHRpb25zLFxyXG4pOiBOb3RpZmljYXRpb24gfCBudWxsIHtcclxuICBmdW5jdGlvbiBpc0R1cGxpY2F0ZShub3RlOiBOb3RpZmljYXRpb25FeHQpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IG5vdGVEaXNtaXNzZWQgPSBub3RlLmlzRGlzbWlzc2VkICYmIG5vdGUuaXNEaXNtaXNzZWQoKTtcclxuICAgIGNvbnN0IG5vdGVPcHRpb25zID0gbm90ZS5nZXRPcHRpb25zICYmIG5vdGUuZ2V0T3B0aW9ucygpIHx8IHt9O1xyXG4gICAgcmV0dXJuICFub3RlRGlzbWlzc2VkICYmXHJcbiAgICAgIG5vdGUuZ2V0VHlwZSgpID09PSBtZXNzYWdlVHlwZVRvU3RyaW5nKG1lc3NhZ2VUeXBlKSAmJlxyXG4gICAgICBub3RlT3B0aW9ucy5kZXRhaWwgPT09IG9wdGlvbnMuZGV0YWlsO1xyXG4gIH1cclxuICBpZiAoYXRvbS5ub3RpZmljYXRpb25zLmdldE5vdGlmaWNhdGlvbnMoKS5zb21lKGlzRHVwbGljYXRlKSkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKG1lc3NhZ2VUeXBlKSB7XHJcbiAgICBjYXNlIE1lc3NhZ2VUeXBlLkVycm9yOlxyXG4gICAgICByZXR1cm4gYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKG1lc3NhZ2UsIG9wdGlvbnMpO1xyXG4gICAgY2FzZSBNZXNzYWdlVHlwZS5XYXJuaW5nOlxyXG4gICAgICByZXR1cm4gYXRvbS5ub3RpZmljYXRpb25zLmFkZFdhcm5pbmcobWVzc2FnZSwgb3B0aW9ucyk7XHJcbiAgICBjYXNlIE1lc3NhZ2VUeXBlLkxvZzpcclxuICAgICAgLy8gY29uc29sZS5sb2cocGFyYW1zLm1lc3NhZ2UpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIGNhc2UgTWVzc2FnZVR5cGUuSW5mbzpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkSW5mbyhtZXNzYWdlLCBvcHRpb25zKTtcclxuICB9XHJcbn1cclxuIl19