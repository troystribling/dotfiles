Object.defineProperty(exports, "__esModule", {
  value: true
});

var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _atom = require('atom');

var _languageclient = require('../languageclient');

var _convert = require('../convert');

var _convert2 = _interopRequireDefault(_convert);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class SignatureHelpAdapter {

  constructor(server, grammarScopes) {
    this._disposables = new _atom.CompositeDisposable();

    this._connection = server.connection;
    this._capabilities = server.capabilities;
    this._grammarScopes = grammarScopes;
  }

  // Returns a {Boolean} indicating this adapter can adapt the server based on the
  // given serverCapabilities.
  static canAdapt(serverCapabilities) {
    return serverCapabilities.signatureHelpProvider != null;
  }

  dispose() {
    this._disposables.dispose();
  }

  attach(register) {
    const { signatureHelpProvider } = this._capabilities;
    (0, _assert2.default)(signatureHelpProvider != null);

    let triggerCharacters = null;
    if (Array.isArray(signatureHelpProvider.triggerCharacters)) {
      triggerCharacters = new Set(signatureHelpProvider.triggerCharacters);
    }

    this._disposables.add(register({
      priority: 1,
      grammarScopes: this._grammarScopes,
      triggerCharacters,
      getSignatureHelp: this.getSignatureHelp.bind(this)
    }));
  }

  // Public: Retrieves signature help for a given editor and position.
  getSignatureHelp(editor, point) {
    return this._connection.signatureHelp(_convert2.default.editorToTextDocumentPositionParams(editor, point));
  }
}
exports.default = SignatureHelpAdapter;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9hZGFwdGVycy9zaWduYXR1cmUtaGVscC1hZGFwdGVyLmpzIl0sIm5hbWVzIjpbIlNpZ25hdHVyZUhlbHBBZGFwdGVyIiwiY29uc3RydWN0b3IiLCJzZXJ2ZXIiLCJncmFtbWFyU2NvcGVzIiwiX2Rpc3Bvc2FibGVzIiwiX2Nvbm5lY3Rpb24iLCJjb25uZWN0aW9uIiwiX2NhcGFiaWxpdGllcyIsImNhcGFiaWxpdGllcyIsIl9ncmFtbWFyU2NvcGVzIiwiY2FuQWRhcHQiLCJzZXJ2ZXJDYXBhYmlsaXRpZXMiLCJzaWduYXR1cmVIZWxwUHJvdmlkZXIiLCJkaXNwb3NlIiwiYXR0YWNoIiwicmVnaXN0ZXIiLCJ0cmlnZ2VyQ2hhcmFjdGVycyIsIkFycmF5IiwiaXNBcnJheSIsIlNldCIsImFkZCIsInByaW9yaXR5IiwiZ2V0U2lnbmF0dXJlSGVscCIsImJpbmQiLCJlZGl0b3IiLCJwb2ludCIsInNpZ25hdHVyZUhlbHAiLCJlZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zIl0sIm1hcHBpbmdzIjoiOzs7O0FBRUE7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBR2UsTUFBTUEsb0JBQU4sQ0FBMkI7O0FBTXhDQyxjQUFZQyxNQUFaLEVBQWtDQyxhQUFsQyxFQUFnRTtBQUFBLFNBTGhFQyxZQUtnRSxHQUw1QiwrQkFLNEI7O0FBQzlELFNBQUtDLFdBQUwsR0FBbUJILE9BQU9JLFVBQTFCO0FBQ0EsU0FBS0MsYUFBTCxHQUFxQkwsT0FBT00sWUFBNUI7QUFDQSxTQUFLQyxjQUFMLEdBQXNCTixhQUF0QjtBQUNEOztBQUVEO0FBQ0E7QUFDQSxTQUFPTyxRQUFQLENBQWdCQyxrQkFBaEIsRUFBaUU7QUFDL0QsV0FBT0EsbUJBQW1CQyxxQkFBbkIsSUFBNEMsSUFBbkQ7QUFDRDs7QUFFREMsWUFBVTtBQUNSLFNBQUtULFlBQUwsQ0FBa0JTLE9BQWxCO0FBQ0Q7O0FBRURDLFNBQU9DLFFBQVAsRUFBc0Q7QUFDcEQsVUFBTSxFQUFDSCxxQkFBRCxLQUEwQixLQUFLTCxhQUFyQztBQUNBLDBCQUFVSyx5QkFBeUIsSUFBbkM7O0FBRUEsUUFBSUksb0JBQW9CLElBQXhCO0FBQ0EsUUFBSUMsTUFBTUMsT0FBTixDQUFjTixzQkFBc0JJLGlCQUFwQyxDQUFKLEVBQTREO0FBQzFEQSwwQkFBb0IsSUFBSUcsR0FBSixDQUFRUCxzQkFBc0JJLGlCQUE5QixDQUFwQjtBQUNEOztBQUVELFNBQUtaLFlBQUwsQ0FBa0JnQixHQUFsQixDQUNFTCxTQUFTO0FBQ1BNLGdCQUFVLENBREg7QUFFUGxCLHFCQUFlLEtBQUtNLGNBRmI7QUFHUE8sdUJBSE87QUFJUE0sd0JBQWtCLEtBQUtBLGdCQUFMLENBQXNCQyxJQUF0QixDQUEyQixJQUEzQjtBQUpYLEtBQVQsQ0FERjtBQVFEOztBQUVEO0FBQ0FELG1CQUFpQkUsTUFBakIsRUFBMENDLEtBQTFDLEVBQThGO0FBQzVGLFdBQU8sS0FBS3BCLFdBQUwsQ0FBaUJxQixhQUFqQixDQUErQixrQkFBUUMsa0NBQVIsQ0FBMkNILE1BQTNDLEVBQW1EQyxLQUFuRCxDQUEvQixDQUFQO0FBQ0Q7QUE1Q3VDO2tCQUFyQnpCLG9CIiwiZmlsZSI6InNpZ25hdHVyZS1oZWxwLWFkYXB0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGV9IGZyb20gJ2F0b20nO1xuaW1wb3J0IHtMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24sIHR5cGUgU2VydmVyQ2FwYWJpbGl0aWVzfSBmcm9tICcuLi9sYW5ndWFnZWNsaWVudCc7XG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi9jb252ZXJ0JztcbmltcG9ydCB0eXBlIHtBY3RpdmVTZXJ2ZXJ9IGZyb20gJy4uL3NlcnZlci1tYW5hZ2VyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2lnbmF0dXJlSGVscEFkYXB0ZXIge1xuICBfZGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICBfY29ubmVjdGlvbjogTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uO1xuICBfY2FwYWJpbGl0aWVzOiBTZXJ2ZXJDYXBhYmlsaXRpZXM7XG4gIF9ncmFtbWFyU2NvcGVzOiBBcnJheTxzdHJpbmc+O1xuXG4gIGNvbnN0cnVjdG9yKHNlcnZlcjogQWN0aXZlU2VydmVyLCBncmFtbWFyU2NvcGVzOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgdGhpcy5fY29ubmVjdGlvbiA9IHNlcnZlci5jb25uZWN0aW9uO1xuICAgIHRoaXMuX2NhcGFiaWxpdGllcyA9IHNlcnZlci5jYXBhYmlsaXRpZXM7XG4gICAgdGhpcy5fZ3JhbW1hclNjb3BlcyA9IGdyYW1tYXJTY29wZXM7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEge0Jvb2xlYW59IGluZGljYXRpbmcgdGhpcyBhZGFwdGVyIGNhbiBhZGFwdCB0aGUgc2VydmVyIGJhc2VkIG9uIHRoZVxuICAvLyBnaXZlbiBzZXJ2ZXJDYXBhYmlsaXRpZXMuXG4gIHN0YXRpYyBjYW5BZGFwdChzZXJ2ZXJDYXBhYmlsaXRpZXM6IFNlcnZlckNhcGFiaWxpdGllcyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBzZXJ2ZXJDYXBhYmlsaXRpZXMuc2lnbmF0dXJlSGVscFByb3ZpZGVyICE9IG51bGw7XG4gIH1cblxuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIGF0dGFjaChyZWdpc3RlcjogYXRvbUlkZSRTaWduYXR1cmVIZWxwUmVnaXN0cnkpOiB2b2lkIHtcbiAgICBjb25zdCB7c2lnbmF0dXJlSGVscFByb3ZpZGVyfSA9IHRoaXMuX2NhcGFiaWxpdGllcztcbiAgICBpbnZhcmlhbnQoc2lnbmF0dXJlSGVscFByb3ZpZGVyICE9IG51bGwpO1xuXG4gICAgbGV0IHRyaWdnZXJDaGFyYWN0ZXJzID0gbnVsbDtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzaWduYXR1cmVIZWxwUHJvdmlkZXIudHJpZ2dlckNoYXJhY3RlcnMpKSB7XG4gICAgICB0cmlnZ2VyQ2hhcmFjdGVycyA9IG5ldyBTZXQoc2lnbmF0dXJlSGVscFByb3ZpZGVyLnRyaWdnZXJDaGFyYWN0ZXJzKTtcbiAgICB9XG5cbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoXG4gICAgICByZWdpc3Rlcih7XG4gICAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLl9ncmFtbWFyU2NvcGVzLFxuICAgICAgICB0cmlnZ2VyQ2hhcmFjdGVycyxcbiAgICAgICAgZ2V0U2lnbmF0dXJlSGVscDogdGhpcy5nZXRTaWduYXR1cmVIZWxwLmJpbmQodGhpcyksXG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgLy8gUHVibGljOiBSZXRyaWV2ZXMgc2lnbmF0dXJlIGhlbHAgZm9yIGEgZ2l2ZW4gZWRpdG9yIGFuZCBwb3NpdGlvbi5cbiAgZ2V0U2lnbmF0dXJlSGVscChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9hdG9tSWRlJFNpZ25hdHVyZUhlbHA+IHtcbiAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zaWduYXR1cmVIZWxwKENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhlZGl0b3IsIHBvaW50KSk7XG4gIH1cbn1cbiJdfQ==