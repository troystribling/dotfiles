"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ls = require("./languageclient");
const URL = require("url");
const atom_1 = require("atom");
// Public: Class that contains a number of helper methods for general conversions
// between the language server protocol and Atom/Atom packages.
class Convert {
    // Public: Convert a path to a Uri.
    //
    // * `filePath` A file path to convert to a Uri.
    //
    // Returns the Uri corresponding to the path. e.g. file:///a/b/c.txt
    static pathToUri(filePath) {
        let newPath = filePath.replace(/\\/g, '/');
        if (newPath[0] !== '/') {
            newPath = `/${newPath}`;
        }
        return encodeURI(`file://${newPath}`).replace(/[?#]/g, encodeURIComponent);
    }
    // Public: Convert a Uri to a path.
    //
    // * `uri` A Uri to convert to a file path.
    //
    // Returns a file path corresponding to the Uri. e.g. /a/b/c.txt
    // If the Uri does not begin file: then it is returned as-is to allow Atom
    // to deal with http/https sources in the future.
    static uriToPath(uri) {
        const url = URL.parse(uri);
        if (url.protocol !== 'file:' || url.path === undefined) {
            return uri;
        }
        let filePath = decodeURIComponent(url.path);
        if (process.platform === 'win32') {
            // Deal with Windows drive names
            if (filePath[0] === '/') {
                filePath = filePath.substr(1);
            }
            return filePath.replace(/\//g, '\\');
        }
        return filePath;
    }
    // Public: Convert an Atom {Point} to a language server {Position}.
    //
    // * `point` An Atom {Point} to convert from.
    //
    // Returns the {Position} representation of the Atom {PointObject}.
    static pointToPosition(point) {
        return { line: point.row, character: point.column };
    }
    // Public: Convert a language server {Position} into an Atom {PointObject}.
    //
    // * 'position' A language server {Position} to convert from.
    //
    // Returns the Atom {PointObject} representation of the given {Position}.
    static positionToPoint(position) {
        return new atom_1.Point(position.line, position.character);
    }
    // Public: Convert a language server {Range} into an Atom {Range}.
    //
    // * 'range' A language server {Range} to convert from.
    //
    // Returns the Atom {Range} representation of the given language server {Range}.
    static lsRangeToAtomRange(range) {
        return new atom_1.Range(Convert.positionToPoint(range.start), Convert.positionToPoint(range.end));
    }
    // Public: Convert an Atom {Range} into an language server {Range}.
    //
    // * 'range' An Atom {Range} to convert from.
    //
    // Returns the language server {Range} representation of the given Atom {Range}.
    static atomRangeToLSRange(range) {
        return {
            start: Convert.pointToPosition(range.start),
            end: Convert.pointToPosition(range.end),
        };
    }
    // Public: Create a {TextDocumentIdentifier} from an Atom {TextEditor}.
    //
    // * `editor` A {TextEditor} that will be used to form the uri property.
    //
    // Returns a {TextDocumentIdentifier} that has a `uri` property with the Uri for the
    // given editor's path.
    static editorToTextDocumentIdentifier(editor) {
        return { uri: Convert.pathToUri(editor.getPath() || '') };
    }
    // Public: Create a {TextDocumentPositionParams} from a {TextEditor} and optional {Point}.
    //
    // * `editor` A {TextEditor} that will be used to form the uri property.
    // * `point`  An optional {Point} that will supply the position property. If not specified
    //            the current cursor position will be used.
    //
    // Returns a {TextDocumentPositionParams} that has textDocument property with the editors {TextDocumentIdentifier}
    // and a position property with the supplied point (or current cursor position when not specified).
    static editorToTextDocumentPositionParams(editor, point) {
        return {
            textDocument: Convert.editorToTextDocumentIdentifier(editor),
            position: Convert.pointToPosition(point != null ? point : editor.getCursorBufferPosition()),
        };
    }
    // Public: Create a string of scopes for the atom text editor using the data-grammar selector from an
    // {Array} of grammarScope strings.
    //
    // * `grammarScopes` An {Array} of grammar scope string to convert from.
    //
    // Returns a single comma-separated list of CSS selectors targetting the grammars of Atom text editors.
    // e.g. `['c', 'cpp']` => `'atom-text-editor[data-grammar='c'], atom-text-editor[data-grammar='cpp']`
    static grammarScopesToTextEditorScopes(grammarScopes) {
        return grammarScopes
            .map((g) => `atom-text-editor[data-grammar="${Convert.encodeHTMLAttribute(g.replace(/\./g, ' '))}"]`)
            .join(', ');
    }
    // Public: Encode a string so that it can be safely used within a HTML attribute - i.e. replacing all quoted
    // values with their HTML entity encoded versions.  e.g. `Hello"` becomes `Hello&quot;`
    //
    // * 's' A string to be encoded.
    //
    // Returns a string that is HTML attribute encoded by replacing &, <, >, " and ' with their HTML entity
    // named equivalents.
    static encodeHTMLAttribute(s) {
        const attributeMap = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&apos;',
        };
        return s.replace(/[&<>'"]/g, (c) => attributeMap[c]);
    }
    // Public: Convert an Atom File Event as received from atom.project.onDidChangeFiles and convert
    // it into an Array of Language Server Protocol {FileEvent} objects. Normally this will be a 1-to-1
    // but renames will be represented by a deletion and a subsequent creation as LSP does not know about
    // renames.
    //
    // * 'fileEvent' An {atom$ProjectFileEvent} to be converted.
    //
    // Returns an array of LSP {ls.FileEvent} objects that equivalent conversions to the fileEvent parameter.
    static atomFileEventToLSFileEvents(fileEvent) {
        switch (fileEvent.action) {
            case 'created':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Created }];
            case 'modified':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Changed }];
            case 'deleted':
                return [{ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Deleted }];
            case 'renamed': {
                const results = [];
                if (fileEvent.oldPath) {
                    results.push({ uri: Convert.pathToUri(fileEvent.oldPath), type: ls.FileChangeType.Deleted });
                }
                if (fileEvent.path) {
                    results.push({ uri: Convert.pathToUri(fileEvent.path), type: ls.FileChangeType.Created });
                }
                return results;
            }
            default:
                return [];
        }
    }
    static atomIdeDiagnosticToLSDiagnostic(diagnostic) {
        return {
            range: Convert.atomRangeToLSRange(diagnostic.range),
            severity: Convert.diagnosticTypeToLSSeverity(diagnostic.type),
            source: diagnostic.providerName,
            message: diagnostic.text || '',
        };
    }
    static diagnosticTypeToLSSeverity(type) {
        switch (type) {
            case 'Error':
                return ls.DiagnosticSeverity.Error;
            case 'Warning':
                return ls.DiagnosticSeverity.Warning;
            case 'Info':
                return ls.DiagnosticSeverity.Information;
            default:
                throw Error(`Unexpected diagnostic type ${type}`);
        }
    }
    // Public: Convert an array of language server protocol {TextEdit} objects to an
    // equivalent array of Atom {TextEdit} objects.
    //
    // * `textEdits` The language server protocol {TextEdit} objects to convert.
    //
    // Returns an {Array} of Atom {TextEdit} objects.
    static convertLsTextEdits(textEdits) {
        return (textEdits || []).map(Convert.convertLsTextEdit);
    }
    // Public: Convert a language server protocol {TextEdit} object to the
    // Atom equivalent {TextEdit}.
    //
    // * `textEdits` The language server protocol {TextEdit} objects to convert.
    //
    // Returns an Atom {TextEdit} object.
    static convertLsTextEdit(textEdit) {
        return {
            oldRange: Convert.lsRangeToAtomRange(textEdit.range),
            newText: textEdit.newText,
        };
    }
}
exports.default = Convert;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb252ZXJ0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsdUNBQXVDO0FBQ3ZDLDJCQUEyQjtBQUMzQiwrQkFLYztBQU9kLGlGQUFpRjtBQUNqRiwrREFBK0Q7QUFDL0Q7SUFDRSxtQ0FBbUM7SUFDbkMsRUFBRTtJQUNGLGdEQUFnRDtJQUNoRCxFQUFFO0lBQ0Ysb0VBQW9FO0lBQzdELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBZ0I7UUFDdEMsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDM0MsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDdkIsT0FBTyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFDMUIsQ0FBQztRQUNELE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxPQUFPLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQsbUNBQW1DO0lBQ25DLEVBQUU7SUFDRiwyQ0FBMkM7SUFDM0MsRUFBRTtJQUNGLGdFQUFnRTtJQUNoRSwwRUFBMEU7SUFDMUUsaURBQWlEO0lBQzFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBVztRQUNqQyxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssT0FBTyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN2RCxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQ2IsQ0FBQztRQUVELElBQUksUUFBUSxHQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztR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cEQsT0FBTyxFQUFFLFFBQVEsQ0FBQyxPQUFPO1NBQzFCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFuTkQsMEJBbU5DIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4vbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgKiBhcyBVUkwgZnJvbSAndXJsJztcclxuaW1wb3J0IHtcclxuICBQb2ludCxcclxuICBQcm9qZWN0RmlsZUV2ZW50LFxyXG4gIFJhbmdlLFxyXG4gIFRleHRFZGl0b3IsXHJcbn0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7XHJcbiAgRGlhZ25vc3RpYyxcclxuICBEaWFnbm9zdGljVHlwZSxcclxuICBUZXh0RWRpdCxcclxufSBmcm9tICdhdG9tLWlkZSc7XHJcblxyXG4vLyBQdWJsaWM6IENsYXNzIHRoYXQgY29udGFpbnMgYSBudW1iZXIgb2YgaGVscGVyIG1ldGhvZHMgZm9yIGdlbmVyYWwgY29udmVyc2lvbnNcclxuLy8gYmV0d2VlbiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sIGFuZCBBdG9tL0F0b20gcGFja2FnZXMuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnZlcnQge1xyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIHBhdGggdG8gYSBVcmkuXHJcbiAgLy9cclxuICAvLyAqIGBmaWxlUGF0aGAgQSBmaWxlIHBhdGggdG8gY29udmVydCB0byBhIFVyaS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIFVyaSBjb3JyZXNwb25kaW5nIHRvIHRoZSBwYXRoLiBlLmcuIGZpbGU6Ly8vYS9iL2MudHh0XHJcbiAgcHVibGljIHN0YXRpYyBwYXRoVG9VcmkoZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBsZXQgbmV3UGF0aCA9IGZpbGVQYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgIGlmIChuZXdQYXRoWzBdICE9PSAnLycpIHtcclxuICAgICAgbmV3UGF0aCA9IGAvJHtuZXdQYXRofWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZW5jb2RlVVJJKGBmaWxlOi8vJHtuZXdQYXRofWApLnJlcGxhY2UoL1s/I10vZywgZW5jb2RlVVJJQ29tcG9uZW50KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhIFVyaSB0byBhIHBhdGguXHJcbiAgLy9cclxuICAvLyAqIGB1cmlgIEEgVXJpIHRvIGNvbnZlcnQgdG8gYSBmaWxlIHBhdGguXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEgZmlsZSBwYXRoIGNvcnJlc3BvbmRpbmcgdG8gdGhlIFVyaS4gZS5nLiAvYS9iL2MudHh0XHJcbiAgLy8gSWYgdGhlIFVyaSBkb2VzIG5vdCBiZWdpbiBmaWxlOiB0aGVuIGl0IGlzIHJldHVybmVkIGFzLWlzIHRvIGFsbG93IEF0b21cclxuICAvLyB0byBkZWFsIHdpdGggaHR0cC9odHRwcyBzb3VyY2VzIGluIHRoZSBmdXR1cmUuXHJcbiAgcHVibGljIHN0YXRpYyB1cmlUb1BhdGgodXJpOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgdXJsID0gVVJMLnBhcnNlKHVyaSk7XHJcbiAgICBpZiAodXJsLnByb3RvY29sICE9PSAnZmlsZTonIHx8IHVybC5wYXRoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIHVyaTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZmlsZVBhdGggPSBkZWNvZGVVUklDb21wb25lbnQodXJsLnBhdGgpO1xyXG4gICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicpIHtcclxuICAgICAgLy8gRGVhbCB3aXRoIFdpbmRvd3MgZHJpdmUgbmFtZXNcclxuICAgICAgaWYgKGZpbGVQYXRoWzBdID09PSAnLycpIHtcclxuICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoLnN1YnN0cigxKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmlsZVBhdGgucmVwbGFjZSgvXFwvL2csICdcXFxcJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmlsZVBhdGg7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYW4gQXRvbSB7UG9pbnR9IHRvIGEgbGFuZ3VhZ2Ugc2VydmVyIHtQb3NpdGlvbn0uXHJcbiAgLy9cclxuICAvLyAqIGBwb2ludGAgQW4gQXRvbSB7UG9pbnR9IHRvIGNvbnZlcnQgZnJvbS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIHtQb3NpdGlvbn0gcmVwcmVzZW50YXRpb24gb2YgdGhlIEF0b20ge1BvaW50T2JqZWN0fS5cclxuICBwdWJsaWMgc3RhdGljIHBvaW50VG9Qb3NpdGlvbihwb2ludDogUG9pbnQpOiBscy5Qb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge2xpbmU6IHBvaW50LnJvdywgY2hhcmFjdGVyOiBwb2ludC5jb2x1bW59O1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgbGFuZ3VhZ2Ugc2VydmVyIHtQb3NpdGlvbn0gaW50byBhbiBBdG9tIHtQb2ludE9iamVjdH0uXHJcbiAgLy9cclxuICAvLyAqICdwb3NpdGlvbicgQSBsYW5ndWFnZSBzZXJ2ZXIge1Bvc2l0aW9ufSB0byBjb252ZXJ0IGZyb20uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBBdG9tIHtQb2ludE9iamVjdH0gcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIHtQb3NpdGlvbn0uXHJcbiAgcHVibGljIHN0YXRpYyBwb3NpdGlvblRvUG9pbnQocG9zaXRpb246IGxzLlBvc2l0aW9uKTogUG9pbnQge1xyXG4gICAgcmV0dXJuIG5ldyBQb2ludChwb3NpdGlvbi5saW5lLCBwb3NpdGlvbi5jaGFyYWN0ZXIpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGEgbGFuZ3VhZ2Ugc2VydmVyIHtSYW5nZX0gaW50byBhbiBBdG9tIHtSYW5nZX0uXHJcbiAgLy9cclxuICAvLyAqICdyYW5nZScgQSBsYW5ndWFnZSBzZXJ2ZXIge1JhbmdlfSB0byBjb252ZXJ0IGZyb20uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBBdG9tIHtSYW5nZX0gcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIGxhbmd1YWdlIHNlcnZlciB7UmFuZ2V9LlxyXG4gIHB1YmxpYyBzdGF0aWMgbHNSYW5nZVRvQXRvbVJhbmdlKHJhbmdlOiBscy5SYW5nZSk6IFJhbmdlIHtcclxuICAgIHJldHVybiBuZXcgUmFuZ2UoQ29udmVydC5wb3NpdGlvblRvUG9pbnQocmFuZ2Uuc3RhcnQpLCBDb252ZXJ0LnBvc2l0aW9uVG9Qb2ludChyYW5nZS5lbmQpKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhbiBBdG9tIHtSYW5nZX0gaW50byBhbiBsYW5ndWFnZSBzZXJ2ZXIge1JhbmdlfS5cclxuICAvL1xyXG4gIC8vICogJ3JhbmdlJyBBbiBBdG9tIHtSYW5nZX0gdG8gY29udmVydCBmcm9tLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHtSYW5nZX0gcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIEF0b20ge1JhbmdlfS5cclxuICBwdWJsaWMgc3RhdGljIGF0b21SYW5nZVRvTFNSYW5nZShyYW5nZTogUmFuZ2UpOiBscy5SYW5nZSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGFydDogQ29udmVydC5wb2ludFRvUG9zaXRpb24ocmFuZ2Uuc3RhcnQpLFxyXG4gICAgICBlbmQ6IENvbnZlcnQucG9pbnRUb1Bvc2l0aW9uKHJhbmdlLmVuZCksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDcmVhdGUgYSB7VGV4dERvY3VtZW50SWRlbnRpZmllcn0gZnJvbSBhbiBBdG9tIHtUZXh0RWRpdG9yfS5cclxuICAvL1xyXG4gIC8vICogYGVkaXRvcmAgQSB7VGV4dEVkaXRvcn0gdGhhdCB3aWxsIGJlIHVzZWQgdG8gZm9ybSB0aGUgdXJpIHByb3BlcnR5LlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtUZXh0RG9jdW1lbnRJZGVudGlmaWVyfSB0aGF0IGhhcyBhIGB1cmlgIHByb3BlcnR5IHdpdGggdGhlIFVyaSBmb3IgdGhlXHJcbiAgLy8gZ2l2ZW4gZWRpdG9yJ3MgcGF0aC5cclxuICBwdWJsaWMgc3RhdGljIGVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcihlZGl0b3I6IFRleHRFZGl0b3IpOiBscy5UZXh0RG9jdW1lbnRJZGVudGlmaWVyIHtcclxuICAgIHJldHVybiB7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShlZGl0b3IuZ2V0UGF0aCgpIHx8ICcnKX07XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZSBhIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gZnJvbSBhIHtUZXh0RWRpdG9yfSBhbmQgb3B0aW9uYWwge1BvaW50fS5cclxuICAvL1xyXG4gIC8vICogYGVkaXRvcmAgQSB7VGV4dEVkaXRvcn0gdGhhdCB3aWxsIGJlIHVzZWQgdG8gZm9ybSB0aGUgdXJpIHByb3BlcnR5LlxyXG4gIC8vICogYHBvaW50YCAgQW4gb3B0aW9uYWwge1BvaW50fSB0aGF0IHdpbGwgc3VwcGx5IHRoZSBwb3NpdGlvbiBwcm9wZXJ0eS4gSWYgbm90IHNwZWNpZmllZFxyXG4gIC8vICAgICAgICAgICAgdGhlIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIHdpbGwgYmUgdXNlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7VGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXN9IHRoYXQgaGFzIHRleHREb2N1bWVudCBwcm9wZXJ0eSB3aXRoIHRoZSBlZGl0b3JzIHtUZXh0RG9jdW1lbnRJZGVudGlmaWVyfVxyXG4gIC8vIGFuZCBhIHBvc2l0aW9uIHByb3BlcnR5IHdpdGggdGhlIHN1cHBsaWVkIHBvaW50IChvciBjdXJyZW50IGN1cnNvciBwb3NpdGlvbiB3aGVuIG5vdCBzcGVjaWZpZWQpLlxyXG4gIHB1YmxpYyBzdGF0aWMgZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhcclxuICAgIGVkaXRvcjogVGV4dEVkaXRvcixcclxuICAgIHBvaW50PzogUG9pbnQsXHJcbiAgKTogbHMuVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGV4dERvY3VtZW50OiBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcihlZGl0b3IpLFxyXG4gICAgICBwb3NpdGlvbjogQ29udmVydC5wb2ludFRvUG9zaXRpb24ocG9pbnQgIT0gbnVsbCA/IHBvaW50IDogZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCkpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ3JlYXRlIGEgc3RyaW5nIG9mIHNjb3BlcyBmb3IgdGhlIGF0b20gdGV4dCBlZGl0b3IgdXNpbmcgdGhlIGRhdGEtZ3JhbW1hciBzZWxlY3RvciBmcm9tIGFuXHJcbiAgLy8ge0FycmF5fSBvZiBncmFtbWFyU2NvcGUgc3RyaW5ncy5cclxuICAvL1xyXG4gIC8vICogYGdyYW1tYXJTY29wZXNgIEFuIHtBcnJheX0gb2YgZ3JhbW1hciBzY29wZSBzdHJpbmcgdG8gY29udmVydCBmcm9tLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHNpbmdsZSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBDU1Mgc2VsZWN0b3JzIHRhcmdldHRpbmcgdGhlIGdyYW1tYXJzIG9mIEF0b20gdGV4dCBlZGl0b3JzLlxyXG4gIC8vIGUuZy4gYFsnYycsICdjcHAnXWAgPT4gYCdhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj0nYyddLCBhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj0nY3BwJ11gXHJcbiAgcHVibGljIHN0YXRpYyBncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzKGdyYW1tYXJTY29wZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBncmFtbWFyU2NvcGVzXHJcbiAgICAgIC5tYXAoKGcpID0+IGBhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cIiR7Q29udmVydC5lbmNvZGVIVE1MQXR0cmlidXRlKGcucmVwbGFjZSgvXFwuL2csICcgJykpfVwiXWApXHJcbiAgICAgIC5qb2luKCcsICcpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBFbmNvZGUgYSBzdHJpbmcgc28gdGhhdCBpdCBjYW4gYmUgc2FmZWx5IHVzZWQgd2l0aGluIGEgSFRNTCBhdHRyaWJ1dGUgLSBpLmUuIHJlcGxhY2luZyBhbGwgcXVvdGVkXHJcbiAgLy8gdmFsdWVzIHdpdGggdGhlaXIgSFRNTCBlbnRpdHkgZW5jb2RlZCB2ZXJzaW9ucy4gIGUuZy4gYEhlbGxvXCJgIGJlY29tZXMgYEhlbGxvJnF1b3Q7YFxyXG4gIC8vXHJcbiAgLy8gKiAncycgQSBzdHJpbmcgdG8gYmUgZW5jb2RlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSBzdHJpbmcgdGhhdCBpcyBIVE1MIGF0dHJpYnV0ZSBlbmNvZGVkIGJ5IHJlcGxhY2luZyAmLCA8LCA+LCBcIiBhbmQgJyB3aXRoIHRoZWlyIEhUTUwgZW50aXR5XHJcbiAgLy8gbmFtZWQgZXF1aXZhbGVudHMuXHJcbiAgcHVibGljIHN0YXRpYyBlbmNvZGVIVE1MQXR0cmlidXRlKHM6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBhdHRyaWJ1dGVNYXA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XHJcbiAgICAgICcmJzogJyZhbXA7JyxcclxuICAgICAgJzwnOiAnJmx0OycsXHJcbiAgICAgICc+JzogJyZndDsnLFxyXG4gICAgICAnXCInOiAnJnF1b3Q7JyxcclxuICAgICAgXCInXCI6ICcmYXBvczsnLFxyXG4gICAgfTtcclxuICAgIHJldHVybiBzLnJlcGxhY2UoL1smPD4nXCJdL2csIChjKSA9PiBhdHRyaWJ1dGVNYXBbY10pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBDb252ZXJ0IGFuIEF0b20gRmlsZSBFdmVudCBhcyByZWNlaXZlZCBmcm9tIGF0b20ucHJvamVjdC5vbkRpZENoYW5nZUZpbGVzIGFuZCBjb252ZXJ0XHJcbiAgLy8gaXQgaW50byBhbiBBcnJheSBvZiBMYW5ndWFnZSBTZXJ2ZXIgUHJvdG9jb2wge0ZpbGVFdmVudH0gb2JqZWN0cy4gTm9ybWFsbHkgdGhpcyB3aWxsIGJlIGEgMS10by0xXHJcbiAgLy8gYnV0IHJlbmFtZXMgd2lsbCBiZSByZXByZXNlbnRlZCBieSBhIGRlbGV0aW9uIGFuZCBhIHN1YnNlcXVlbnQgY3JlYXRpb24gYXMgTFNQIGRvZXMgbm90IGtub3cgYWJvdXRcclxuICAvLyByZW5hbWVzLlxyXG4gIC8vXHJcbiAgLy8gKiAnZmlsZUV2ZW50JyBBbiB7YXRvbSRQcm9qZWN0RmlsZUV2ZW50fSB0byBiZSBjb252ZXJ0ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIGFycmF5IG9mIExTUCB7bHMuRmlsZUV2ZW50fSBvYmplY3RzIHRoYXQgZXF1aXZhbGVudCBjb252ZXJzaW9ucyB0byB0aGUgZmlsZUV2ZW50IHBhcmFtZXRlci5cclxuICBwdWJsaWMgc3RhdGljIGF0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cyhmaWxlRXZlbnQ6IFByb2plY3RGaWxlRXZlbnQpOiBscy5GaWxlRXZlbnRbXSB7XHJcbiAgICBzd2l0Y2ggKGZpbGVFdmVudC5hY3Rpb24pIHtcclxuICAgICAgY2FzZSAnY3JlYXRlZCc6XHJcbiAgICAgICAgcmV0dXJuIFt7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShmaWxlRXZlbnQucGF0aCksIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNyZWF0ZWR9XTtcclxuICAgICAgY2FzZSAnbW9kaWZpZWQnOlxyXG4gICAgICAgIHJldHVybiBbe3VyaTogQ29udmVydC5wYXRoVG9VcmkoZmlsZUV2ZW50LnBhdGgpLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5DaGFuZ2VkfV07XHJcbiAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxyXG4gICAgICAgIHJldHVybiBbe3VyaTogQ29udmVydC5wYXRoVG9VcmkoZmlsZUV2ZW50LnBhdGgpLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5EZWxldGVkfV07XHJcbiAgICAgIGNhc2UgJ3JlbmFtZWQnOiB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0czogQXJyYXk8eyB1cmk6IHN0cmluZywgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUgfT4gPSBbXTtcclxuICAgICAgICBpZiAoZmlsZUV2ZW50Lm9sZFBhdGgpIHtcclxuICAgICAgICAgIHJlc3VsdHMucHVzaCh7dXJpOiBDb252ZXJ0LnBhdGhUb1VyaShmaWxlRXZlbnQub2xkUGF0aCksIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZpbGVFdmVudC5wYXRoKSB7XHJcbiAgICAgICAgICByZXN1bHRzLnB1c2goe3VyaTogQ29udmVydC5wYXRoVG9VcmkoZmlsZUV2ZW50LnBhdGgpLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5DcmVhdGVkfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgICB9XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBhdG9tSWRlRGlhZ25vc3RpY1RvTFNEaWFnbm9zdGljKGRpYWdub3N0aWM6IERpYWdub3N0aWMpOiBscy5EaWFnbm9zdGljIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJhbmdlOiBDb252ZXJ0LmF0b21SYW5nZVRvTFNSYW5nZShkaWFnbm9zdGljLnJhbmdlKSxcclxuICAgICAgc2V2ZXJpdHk6IENvbnZlcnQuZGlhZ25vc3RpY1R5cGVUb0xTU2V2ZXJpdHkoZGlhZ25vc3RpYy50eXBlKSxcclxuICAgICAgc291cmNlOiBkaWFnbm9zdGljLnByb3ZpZGVyTmFtZSxcclxuICAgICAgbWVzc2FnZTogZGlhZ25vc3RpYy50ZXh0IHx8ICcnLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgZGlhZ25vc3RpY1R5cGVUb0xTU2V2ZXJpdHkodHlwZTogRGlhZ25vc3RpY1R5cGUpOiBscy5EaWFnbm9zdGljU2V2ZXJpdHkge1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgIGNhc2UgJ0Vycm9yJzpcclxuICAgICAgICByZXR1cm4gbHMuRGlhZ25vc3RpY1NldmVyaXR5LkVycm9yO1xyXG4gICAgICBjYXNlICdXYXJuaW5nJzpcclxuICAgICAgICByZXR1cm4gbHMuRGlhZ25vc3RpY1NldmVyaXR5Lldhcm5pbmc7XHJcbiAgICAgIGNhc2UgJ0luZm8nOlxyXG4gICAgICAgIHJldHVybiBscy5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb247XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoYFVuZXhwZWN0ZWQgZGlhZ25vc3RpYyB0eXBlICR7dHlwZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ29udmVydCBhbiBhcnJheSBvZiBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wge1RleHRFZGl0fSBvYmplY3RzIHRvIGFuXHJcbiAgLy8gZXF1aXZhbGVudCBhcnJheSBvZiBBdG9tIHtUZXh0RWRpdH0gb2JqZWN0cy5cclxuICAvL1xyXG4gIC8vICogYHRleHRFZGl0c2AgVGhlIGxhbmd1YWdlIHNlcnZlciBwcm90b2NvbCB7VGV4dEVkaXR9IG9iamVjdHMgdG8gY29udmVydC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYW4ge0FycmF5fSBvZiBBdG9tIHtUZXh0RWRpdH0gb2JqZWN0cy5cclxuICBwdWJsaWMgc3RhdGljIGNvbnZlcnRMc1RleHRFZGl0cyh0ZXh0RWRpdHM6IGxzLlRleHRFZGl0W10pOiBUZXh0RWRpdFtdIHtcclxuICAgIHJldHVybiAodGV4dEVkaXRzIHx8IFtdKS5tYXAoQ29udmVydC5jb252ZXJ0THNUZXh0RWRpdCk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wge1RleHRFZGl0fSBvYmplY3QgdG8gdGhlXHJcbiAgLy8gQXRvbSBlcXVpdmFsZW50IHtUZXh0RWRpdH0uXHJcbiAgLy9cclxuICAvLyAqIGB0ZXh0RWRpdHNgIFRoZSBsYW5ndWFnZSBzZXJ2ZXIgcHJvdG9jb2wge1RleHRFZGl0fSBvYmplY3RzIHRvIGNvbnZlcnQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIEF0b20ge1RleHRFZGl0fSBvYmplY3QuXHJcbiAgcHVibGljIHN0YXRpYyBjb252ZXJ0THNUZXh0RWRpdCh0ZXh0RWRpdDogbHMuVGV4dEVkaXQpOiBUZXh0RWRpdCB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBvbGRSYW5nZTogQ29udmVydC5sc1JhbmdlVG9BdG9tUmFuZ2UodGV4dEVkaXQucmFuZ2UpLFxyXG4gICAgICBuZXdUZXh0OiB0ZXh0RWRpdC5uZXdUZXh0LFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIl19