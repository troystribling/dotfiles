"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chai_1 = require("chai");
const languageclient_1 = require("../../lib/languageclient");
const document_sync_adapter_1 = require("../../lib/adapters/document-sync-adapter");
describe('DocumentSyncAdapter', () => {
    describe('canAdapt', () => {
        it('returns true if v2 incremental change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: languageclient_1.TextDocumentSyncKind.Incremental,
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns true if v2 full change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: languageclient_1.TextDocumentSyncKind.Full,
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns false if v2 none change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: languageclient_1.TextDocumentSyncKind.None,
            });
            chai_1.expect(result).to.be.false;
        });
        it('returns true if v3 incremental change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: { change: languageclient_1.TextDocumentSyncKind.Incremental },
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns true if v3 full change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: { change: languageclient_1.TextDocumentSyncKind.Full },
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns false if v3 none change notifications are supported', () => {
            const result = document_sync_adapter_1.default.canAdapt({
                textDocumentSync: { change: languageclient_1.TextDocumentSyncKind.None },
            });
            chai_1.expect(result).to.be.false;
        });
    });
    describe('constructor', () => {
        function create(textDocumentSync) {
            return new document_sync_adapter_1.default(null, () => false, textDocumentSync, (_t, f) => f());
        }
        it('sets _documentSync.change correctly Incremental for v2 capabilities', () => {
            const result = create(languageclient_1.TextDocumentSyncKind.Incremental)._documentSync.change;
            chai_1.expect(result).equals(languageclient_1.TextDocumentSyncKind.Incremental);
        });
        it('sets _documentSync.change correctly Full for v2 capabilities', () => {
            const result = create(languageclient_1.TextDocumentSyncKind.Full)._documentSync.change;
            chai_1.expect(result).equals(languageclient_1.TextDocumentSyncKind.Full);
        });
        it('sets _documentSync.change correctly Incremental for v3 capabilities', () => {
            const result = create({ change: languageclient_1.TextDocumentSyncKind.Incremental })._documentSync.change;
            chai_1.expect(result).equals(languageclient_1.TextDocumentSyncKind.Incremental);
        });
        it('sets _documentSync.change correctly Full for v3 capabilities', () => {
            const result = create({ change: languageclient_1.TextDocumentSyncKind.Full })._documentSync.change;
            chai_1.expect(result).equals(languageclient_1.TextDocumentSyncKind.Full);
        });
        it('sets _documentSync.change correctly Full for unset capabilities', () => {
            const result = create()._documentSync.change;
            chai_1.expect(result).equals(languageclient_1.TextDocumentSyncKind.Full);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQtc3luYy1hZGFwdGVyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L2FkYXB0ZXJzL2RvY3VtZW50LXN5bmMtYWRhcHRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0JBQThCO0FBQzlCLDZEQUF5RjtBQUN6RixvRkFBMkU7QUFFM0UsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsbUVBQW1FLEVBQUUsR0FBRyxFQUFFO1lBQzNFLE1BQU0sTUFBTSxHQUFHLCtCQUFtQixDQUFDLFFBQVEsQ0FBQztnQkFDMUMsZ0JBQWdCLEVBQUUscUNBQW9CLENBQUMsV0FBVzthQUNuRCxDQUFDLENBQUM7WUFDSCxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNERBQTRELEVBQUUsR0FBRyxFQUFFO1lBQ3BFLE1BQU0sTUFBTSxHQUFHLCtCQUFtQixDQUFDLFFBQVEsQ0FBQztnQkFDMUMsZ0JBQWdCLEVBQUUscUNBQW9CLENBQUMsSUFBSTthQUM1QyxDQUFDLENBQUM7WUFDSCxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkRBQTZELEVBQUUsR0FBRyxFQUFFO1lBQ3JFLE1BQU0sTUFBTSxHQUFHLCtCQUFtQixDQUFDLFFBQVEsQ0FBQztnQkFDMUMsZ0JBQWdCLEVBQUUscUNBQW9CLENBQUMsSUFBSTthQUM1QyxDQUFDLENBQUM7WUFDSCxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7UUFDN0IsQ0FB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LENBQUMsaUVBQWlFLEVBQUUsR0FBRyxFQUFFO1lBQ3pFLE1BQU0sTUFBTSxHQUFHLE1BQU0sRUFBRSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUM7WUFDN0MsYUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxxQ0FBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcclxuaW1wb3J0IHsgVGV4dERvY3VtZW50U3luY0tpbmQsIFRleHREb2N1bWVudFN5bmNPcHRpb25zIH0gZnJvbSAnLi4vLi4vbGliL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0IERvY3VtZW50U3luY0FkYXB0ZXIgZnJvbSAnLi4vLi4vbGliL2FkYXB0ZXJzL2RvY3VtZW50LXN5bmMtYWRhcHRlcic7XHJcblxyXG5kZXNjcmliZSgnRG9jdW1lbnRTeW5jQWRhcHRlcicsICgpID0+IHtcclxuICBkZXNjcmliZSgnY2FuQWRhcHQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIHYyIGluY3JlbWVudGFsIGNoYW5nZSBub3RpZmljYXRpb25zIGFyZSBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IERvY3VtZW50U3luY0FkYXB0ZXIuY2FuQWRhcHQoe1xyXG4gICAgICAgIHRleHREb2N1bWVudFN5bmM6IFRleHREb2N1bWVudFN5bmNLaW5kLkluY3JlbWVudGFsLFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXR1cm5zIHRydWUgaWYgdjIgZnVsbCBjaGFuZ2Ugbm90aWZpY2F0aW9ucyBhcmUgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHtcclxuICAgICAgICB0ZXh0RG9jdW1lbnRTeW5jOiBUZXh0RG9jdW1lbnRTeW5jS2luZC5GdWxsLFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIHYyIG5vbmUgY2hhbmdlIG5vdGlmaWNhdGlvbnMgYXJlIHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gRG9jdW1lbnRTeW5jQWRhcHRlci5jYW5BZGFwdCh7XHJcbiAgICAgICAgdGV4dERvY3VtZW50U3luYzogVGV4dERvY3VtZW50U3luY0tpbmQuTm9uZSxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiB2MyBpbmNyZW1lbnRhbCBjaGFuZ2Ugbm90aWZpY2F0aW9ucyBhcmUgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHtcclxuICAgICAgICB0ZXh0RG9jdW1lbnRTeW5jOiB7Y2hhbmdlOiBUZXh0RG9jdW1lbnRTeW5jS2luZC5JbmNyZW1lbnRhbH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiB2MyBmdWxsIGNoYW5nZSBub3RpZmljYXRpb25zIGFyZSBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IERvY3VtZW50U3luY0FkYXB0ZXIuY2FuQWRhcHQoe1xyXG4gICAgICAgIHRleHREb2N1bWVudFN5bmM6IHtjaGFuZ2U6IFRleHREb2N1bWVudFN5bmNLaW5kLkZ1bGx9LFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIHYzIG5vbmUgY2hhbmdlIG5vdGlmaWNhdGlvbnMgYXJlIHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gRG9jdW1lbnRTeW5jQWRhcHRlci5jYW5BZGFwdCh7XHJcbiAgICAgICAgdGV4dERvY3VtZW50U3luYzoge2NoYW5nZTogVGV4dERvY3VtZW50U3luY0tpbmQuTm9uZX0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS5mYWxzZTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICBmdW5jdGlvbiBjcmVhdGUodGV4dERvY3VtZW50U3luYz86IFRleHREb2N1bWVudFN5bmNLaW5kIHwgVGV4dERvY3VtZW50U3luY09wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFN5bmNBZGFwdGVyKG51bGwgYXMgYW55LCAoKSA9PiBmYWxzZSwgdGV4dERvY3VtZW50U3luYywgKF90LCBmKSA9PiBmKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGl0KCdzZXRzIF9kb2N1bWVudFN5bmMuY2hhbmdlIGNvcnJlY3RseSBJbmNyZW1lbnRhbCBmb3IgdjIgY2FwYWJpbGl0aWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGUoVGV4dERvY3VtZW50U3luY0tpbmQuSW5jcmVtZW50YWwpLl9kb2N1bWVudFN5bmMuY2hhbmdlO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS5lcXVhbHMoVGV4dERvY3VtZW50U3luY0tpbmQuSW5jcmVtZW50YWwpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3NldHMgX2RvY3VtZW50U3luYy5jaGFuZ2UgY29ycmVjdGx5IEZ1bGwgZm9yIHYyIGNhcGFiaWxpdGllcycsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gY3JlYXRlKFRleHREb2N1bWVudFN5bmNLaW5kLkZ1bGwpLl9kb2N1bWVudFN5bmMuY2hhbmdlO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS5lcXVhbHMoVGV4dERvY3VtZW50U3luY0tpbmQuRnVsbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2V0cyBfZG9jdW1lbnRTeW5jLmNoYW5nZSBjb3JyZWN0bHkgSW5jcmVtZW50YWwgZm9yIHYzIGNhcGFiaWxpdGllcycsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gY3JlYXRlKHtjaGFuZ2U6IFRleHREb2N1bWVudFN5bmNLaW5kLkluY3JlbWVudGFsfSkuX2RvY3VtZW50U3luYy5jaGFuZ2U7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLmVxdWFscyhUZXh0RG9jdW1lbnRTeW5jS2luZC5JbmNyZW1lbnRhbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2V0cyBfZG9jdW1lbnRTeW5jLmNoYW5nZSBjb3JyZWN0bHkgRnVsbCBmb3IgdjMgY2FwYWJpbGl0aWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGUoe2NoYW5nZTogVGV4dERvY3VtZW50U3luY0tpbmQuRnVsbH0pLl9kb2N1bWVudFN5bmMuY2hhbmdlO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS5lcXVhbHMoVGV4dERvY3VtZW50U3luY0tpbmQuRnVsbCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2V0cyBfZG9jdW1lbnRTeW5jLmNoYW5nZSBjb3JyZWN0bHkgRnVsbCBmb3IgdW5zZXQgY2FwYWJpbGl0aWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGUoKS5fZG9jdW1lbnRTeW5jLmNoYW5nZTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkuZXF1YWxzKFRleHREb2N1bWVudFN5bmNLaW5kLkZ1bGwpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=