"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const linter_push_v2_adapter_1 = require("../../lib/adapters/linter-push-v2-adapter");
const convert_1 = require("../../lib/convert");
const ls = require("../../lib/languageclient");
const path = require("path");
const sinon = require("sinon");
const chai_1 = require("chai");
const atom_1 = require("atom");
const helpers_js_1 = require("../helpers.js");
describe('LinterPushV2Adapter', () => {
    beforeEach(() => {
        global.sinon = sinon.sandbox.create();
    });
    afterEach(() => {
        global.sinon.restore();
    });
    describe('constructor', () => {
        it('subscribes to onPublishDiagnostics', () => {
            const languageClient = new ls.LanguageClientConnection(helpers_js_1.createSpyConnection());
            sinon.spy(languageClient, 'onPublishDiagnostics');
            new linter_push_v2_adapter_1.default(languageClient);
            chai_1.expect(languageClient.onPublishDiagnostics.called).equals(true);
        });
    });
    describe('diagnosticToMessage', () => {
        it('converts Diagnostic and path to a linter$Message', () => {
            const filePath = '/a/b/c/d';
            const diagnostic = {
                message: 'This is a message',
                range: {
                    start: { line: 1, character: 2 },
                    end: { line: 3, character: 4 },
                },
                source: 'source',
                code: 'code',
                severity: ls.DiagnosticSeverity.Information,
            };
            const connection = { onPublishDiagnostics() { } };
            const adapter = new linter_push_v2_adapter_1.default(connection);
            const result = adapter.diagnosticToV2Message(filePath, diagnostic);
            chai_1.expect(result.excerpt).equals(diagnostic.message);
            chai_1.expect(result.linterName).equals(diagnostic.source);
            chai_1.expect(result.location.file).equals(filePath);
            chai_1.expect(result.location.position).deep.equals(new atom_1.Range(new atom_1.Point(1, 2), new atom_1.Point(3, 4)));
            chai_1.expect(result.severity).equals('info');
        });
    });
    describe('diagnosticSeverityToSeverity', () => {
        it('converts DiagnosticSeverity.Error to "error"', () => {
            const severity = linter_push_v2_adapter_1.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Error);
            chai_1.expect(severity).equals('error');
        });
        it('converts DiagnosticSeverity.Warning to "warning"', () => {
            const severity = linter_push_v2_adapter_1.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Warning);
            chai_1.expect(severity).equals('warning');
        });
        it('converts DiagnosticSeverity.Information to "info"', () => {
            const severity = linter_push_v2_adapter_1.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Information);
            chai_1.expect(severity).equals('info');
        });
        it('converts DiagnosticSeverity.Hint to "info"', () => {
            const severity = linter_push_v2_adapter_1.default.diagnosticSeverityToSeverity(ls.DiagnosticSeverity.Hint);
            chai_1.expect(severity).equals('info');
        });
    });
    describe('captureDiagnostics', () => {
        it('stores diagnostic codes and allows their retrival', () => {
            const languageClient = new ls.LanguageClientConnection(helpers_js_1.createSpyConnection());
            const adapter = new linter_push_v2_adapter_1.default(languageClient);
            const testPath = path.join(__dirname, 'test.txt');
            adapter.captureDiagnostics({
                uri: convert_1.default.pathToUri(testPath),
                diagnostics: [
                    {
                        message: 'Test message',
                        range: {
                            start: { line: 1, character: 2 },
                            end: { line: 3, character: 4 },
                        },
                        source: 'source',
                        code: 'test code',
                        severity: ls.DiagnosticSeverity.Information,
                    },
                ],
            });
            const mockEditor = helpers_js_1.createFakeEditor(testPath);
            chai_1.expect(adapter.getDiagnosticCode(mockEditor, new atom_1.Range([1, 2], [3, 4]), 'Test message')).to.equal('test code');
            chai_1.expect(adapter.getDiagnosticCode(mockEditor, new atom_1.Range([1, 2], [3, 4]), 'Test message2')).to.not.exist;
            chai_1.expect(adapter.getDiagnosticCode(mockEditor, new atom_1.Range([1, 2], [3, 5]), 'Test message')).to.not.exist;
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGludGVyLXB1c2gtdjItYWRhcHRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdC9hZGFwdGVycy9saW50ZXItcHVzaC12Mi1hZGFwdGVyLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzRkFBNEU7QUFDNUUsK0NBQXdDO0FBQ3hDLCtDQUErQztBQUMvQyw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLCtCQUE4QjtBQUM5QiwrQkFBb0M7QUFDcEMsOENBQXNFO0FBRXRFLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNiLE1BQWMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDWixNQUFjLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLGNBQWMsR0FBRyxJQUFJLEVBQUUsQ0FBQyx3QkFBd0IsQ0FBQyxnQ0FBbUIsRUFBRSxDQUFDLENBQUM7WUFDOUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztZQUNsRCxJQUFJLGdDQUFtQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3hDLGFBQU0sQ0FBRSxjQUFzQixDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENB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QUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDL0csYUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsSUFBSSxZQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1lBQ3ZHLGFBQU0sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLElBQUksWUFBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUN4RyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTGludGVyUHVzaFYyQWRhcHRlciBmcm9tICcuLi8uLi9saWIvYWRhcHRlcnMvbGludGVyLXB1c2gtdjItYWRhcHRlcic7XHJcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4uLy4uL2xpYi9jb252ZXJ0JztcclxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi4vLi4vbGliL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0ICogYXMgc2lub24gZnJvbSAnc2lub24nO1xyXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcclxuaW1wb3J0IHsgUG9pbnQsIFJhbmdlIH0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7IGNyZWF0ZVNweUNvbm5lY3Rpb24sIGNyZWF0ZUZha2VFZGl0b3IgfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcclxuXHJcbmRlc2NyaWJlKCdMaW50ZXJQdXNoVjJBZGFwdGVyJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgKGdsb2JhbCBhcyBhbnkpLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgKGdsb2JhbCBhcyBhbnkpLnNpbm9uLnJlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgaXQoJ3N1YnNjcmliZXMgdG8gb25QdWJsaXNoRGlhZ25vc3RpY3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxhbmd1YWdlQ2xpZW50ID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbihjcmVhdGVTcHlDb25uZWN0aW9uKCkpO1xyXG4gICAgICBzaW5vbi5zcHkobGFuZ3VhZ2VDbGllbnQsICdvblB1Ymxpc2hEaWFnbm9zdGljcycpO1xyXG4gICAgICBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihsYW5ndWFnZUNsaWVudCk7XHJcbiAgICAgIGV4cGVjdCgobGFuZ3VhZ2VDbGllbnQgYXMgYW55KS5vblB1Ymxpc2hEaWFnbm9zdGljcy5jYWxsZWQpLmVxdWFscyh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGlhZ25vc3RpY1RvTWVzc2FnZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBEaWFnbm9zdGljIGFuZCBwYXRoIHRvIGEgbGludGVyJE1lc3NhZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gJy9hL2IvYy9kJztcclxuICAgICAgY29uc3QgZGlhZ25vc3RpYzogbHMuRGlhZ25vc3RpYyA9IHtcclxuICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhIG1lc3NhZ2UnLFxyXG4gICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICBzdGFydDoge2xpbmU6IDEsIGNoYXJhY3RlcjogMn0sXHJcbiAgICAgICAgICBlbmQ6IHtsaW5lOiAzLCBjaGFyYWN0ZXI6IDR9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc291cmNlOiAnc291cmNlJyxcclxuICAgICAgICBjb2RlOiAnY29kZScsXHJcbiAgICAgICAgc2V2ZXJpdHk6IGxzLkRpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbixcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb246IGFueSA9IHtvblB1Ymxpc2hEaWFnbm9zdGljcygpIHt9fTtcclxuICAgICAgY29uc3QgYWRhcHRlciA9IG5ldyBMaW50ZXJQdXNoVjJBZGFwdGVyKGNvbm5lY3Rpb24pO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhZGFwdGVyLmRpYWdub3N0aWNUb1YyTWVzc2FnZShmaWxlUGF0aCwgZGlhZ25vc3RpYyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LmV4Y2VycHQpLmVxdWFscyhkaWFnbm9zdGljLm1lc3NhZ2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmxpbnRlck5hbWUpLmVxdWFscyhkaWFnbm9zdGljLnNvdXJjZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubG9jYXRpb24uZmlsZSkuZXF1YWxzKGZpbGVQYXRoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5sb2NhdGlvbi5wb3NpdGlvbikuZGVlcC5lcXVhbHMobmV3IFJhbmdlKG5ldyBQb2ludCgxLCAyKSwgbmV3IFBvaW50KDMsIDQpKSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLmVxdWFscygnaW5mbycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkaWFnbm9zdGljU2V2ZXJpdHlUb1NldmVyaXR5JywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIERpYWdub3N0aWNTZXZlcml0eS5FcnJvciB0byBcImVycm9yXCInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNldmVyaXR5ID0gTGludGVyUHVzaFYyQWRhcHRlci5kaWFnbm9zdGljU2V2ZXJpdHlUb1NldmVyaXR5KGxzLkRpYWdub3N0aWNTZXZlcml0eS5FcnJvcik7XHJcbiAgICAgIGV4cGVjdChzZXZlcml0eSkuZXF1YWxzKCdlcnJvcicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIERpYWdub3N0aWNTZXZlcml0eS5XYXJuaW5nIHRvIFwid2FybmluZ1wiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZXZlcml0eSA9IExpbnRlclB1c2hWMkFkYXB0ZXIuZGlhZ25vc3RpY1NldmVyaXR5VG9TZXZlcml0eShscy5EaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZyk7XHJcbiAgICAgIGV4cGVjdChzZXZlcml0eSkuZXF1YWxzKCd3YXJuaW5nJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgRGlhZ25vc3RpY1NldmVyaXR5LkluZm9ybWF0aW9uIHRvIFwiaW5mb1wiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZXZlcml0eSA9IExpbnRlclB1c2hWMkFkYXB0ZXIuZGlhZ25vc3RpY1NldmVyaXR5VG9TZXZlcml0eShscy5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb24pO1xyXG4gICAgICBleHBlY3Qoc2V2ZXJpdHkpLmVxdWFscygnaW5mbycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIERpYWdub3N0aWNTZXZlcml0eS5IaW50IHRvIFwiaW5mb1wiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZXZlcml0eSA9IExpbnRlclB1c2hWMkFkYXB0ZXIuZGlhZ25vc3RpY1NldmVyaXR5VG9TZXZlcml0eShscy5EaWFnbm9zdGljU2V2ZXJpdHkuSGludCk7XHJcbiAgICAgIGV4cGVjdChzZXZlcml0eSkuZXF1YWxzKCdpbmZvJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NhcHR1cmVEaWFnbm9zdGljcycsICgpID0+IHtcclxuICAgIGl0KCdzdG9yZXMgZGlhZ25vc3RpYyBjb2RlcyBhbmQgYWxsb3dzIHRoZWlyIHJldHJpdmFsJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsYW5ndWFnZUNsaWVudCA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcclxuICAgICAgY29uc3QgYWRhcHRlciA9IG5ldyBMaW50ZXJQdXNoVjJBZGFwdGVyKGxhbmd1YWdlQ2xpZW50KTtcclxuICAgICAgY29uc3QgdGVzdFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAndGVzdC50eHQnKTtcclxuICAgICAgYWRhcHRlci5jYXB0dXJlRGlhZ25vc3RpY3Moe1xyXG4gICAgICAgIHVyaTogQ29udmVydC5wYXRoVG9VcmkodGVzdFBhdGgpLFxyXG4gICAgICAgIGRpYWdub3N0aWNzOiBbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUZXN0IG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICByYW5nZToge1xyXG4gICAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMSwgY2hhcmFjdGVyOiAyfSxcclxuICAgICAgICAgICAgICBlbmQ6IHtsaW5lOiAzLCBjaGFyYWN0ZXI6IDR9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzb3VyY2U6ICdzb3VyY2UnLFxyXG4gICAgICAgICAgICBjb2RlOiAndGVzdCBjb2RlJyxcclxuICAgICAgICAgICAgc2V2ZXJpdHk6IGxzLkRpYWdub3N0aWNTZXZlcml0eS5JbmZvcm1hdGlvbixcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgXSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrRWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcih0ZXN0UGF0aCk7XHJcbiAgICAgIGV4cGVjdChhZGFwdGVyLmdldERpYWdub3N0aWNDb2RlKG1vY2tFZGl0b3IsIG5ldyBSYW5nZShbMSwgMl0sIFszLCA0XSksICdUZXN0IG1lc3NhZ2UnKSkudG8uZXF1YWwoJ3Rlc3QgY29kZScpO1xyXG4gICAgICBleHBlY3QoYWRhcHRlci5nZXREaWFnbm9zdGljQ29kZShtb2NrRWRpdG9yLCBuZXcgUmFuZ2UoWzEsIDJdLCBbMywgNF0pLCAnVGVzdCBtZXNzYWdlMicpKS50by5ub3QuZXhpc3Q7XHJcbiAgICAgIGV4cGVjdChhZGFwdGVyLmdldERpYWdub3N0aWNDb2RlKG1vY2tFZGl0b3IsIG5ldyBSYW5nZShbMSwgMl0sIFszLCA1XSksICdUZXN0IG1lc3NhZ2UnKSkudG8ubm90LmV4aXN0O1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=