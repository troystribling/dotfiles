var _outlineViewAdapter = require('../../lib/adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _chai = require('chai');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('OutlineViewAdapter', () => {
  const createLocation = (a, b, c, d) => ({
    uri: '',
    range: { start: { line: a, character: b }, end: { line: c, character: d } }
  });

  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  describe('canAdapt', () => {
    it('returns true if documentSymbolProvider is supported', () => {
      const result = _outlineViewAdapter2.default.canAdapt({ documentSymbolProvider: true });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns false if documentSymbolProvider not supported', () => {
      const result = _outlineViewAdapter2.default.canAdapt({});
      (0, _chai.expect)(result).to.be.false;
    });
  });

  describe('createOutlineTrees', () => {
    it('creates an empty array given an empty array', () => {
      const result = _outlineViewAdapter2.default.createOutlineTrees([]);
      (0, _chai.expect)(result).to.deep.equal([]);
    });

    it('creates a single converted root item from a single source item', () => {
      const sourceItem = { kind: ls.SymbolKind.Namespace, name: 'R', location: createLocation(5, 6, 7, 8) };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      const result = _outlineViewAdapter2.default.createOutlineTrees([sourceItem]);
      (0, _chai.expect)(result).to.deep.equal([expected]);
    });

    it('creates an empty root container with a single source item when containerName missing', () => {
      const sourceItem = { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(1, 2, 3, 4) };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      const missingContainerSource = Object.assign(sourceItem, { containerName: 'missing' });
      const result = _outlineViewAdapter2.default.createOutlineTrees([missingContainerSource]);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].representativeName).to.equal('missing');
      (0, _chai.expect)(result[0].startPosition.row).to.equal(0);
      (0, _chai.expect)(result[0].startPosition.column).to.equal(0);
      (0, _chai.expect)(result[0].children).to.deep.equal([expected]);
    });

    it('creates an empty root container with a single source item when containerName is missing and matches own name', () => {
      const sourceItem = { kind: ls.SymbolKind.Class, name: 'simple', location: createLocation(1, 2, 3, 4) };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      const missingContainerSource = Object.assign(sourceItem, { containerName: 'simple' });
      const result = _outlineViewAdapter2.default.createOutlineTrees([missingContainerSource]);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].representativeName).to.equal('simple');
      (0, _chai.expect)(result[0].startPosition.row).to.equal(0);
      (0, _chai.expect)(result[0].startPosition.column).to.equal(0);
      (0, _chai.expect)(result[0].children).to.deep.equal([expected]);
    });

    it('creates a simple named hierarchy', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'java.com', location: createLocation(1, 0, 10, 0) }, { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(2, 0, 7, 0), containerName: 'java.com' }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(4, 0, 5, 0), containerName: 'Program' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].children.length).to.equal(1);
      (0, _chai.expect)(result[0].children[0].representativeName).to.equal('Program');
      (0, _chai.expect)(result[0].children[0].children.length).to.equal(1);
      (0, _chai.expect)(result[0].children[0].children[0].representativeName).to.equal('main');
    });

    it('retains duplicate named items', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) }, { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(2);
      (0, _chai.expect)(result[0].representativeName).to.equal('duplicate');
      (0, _chai.expect)(result[1].representativeName).to.equal('duplicate');
    });

    it('disambiguates containerName based on range', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) }, { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result[1].children.length).to.equal(1);
      (0, _chai.expect)(result[1].children[0].representativeName).to.equal('main');
    });

    it("does not become it's own parent", () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 10, 0) }, {
        kind: ls.SymbolKind.Namespace,
        name: 'duplicate',
        location: createLocation(6, 0, 7, 0),
        containerName: 'duplicate'
      }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      const r = result;
      (0, _chai.expect)(r[0].endPosition.row).to.equal(10);
      (0, _chai.expect)(r[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].endPosition.row).to.equal(7);
    });

    it('parents to the innnermost named container', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'turtles', location: createLocation(1, 0, 10, 0) }, {
        kind: ls.SymbolKind.Namespace,
        name: 'turtles',
        location: createLocation(4, 0, 8, 0),
        containerName: 'turtles'
      }, { kind: ls.SymbolKind.Class, name: 'disc', location: createLocation(4, 0, 5, 0), containerName: 'turtles' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      const r = result;
      (0, _chai.expect)(r[0].endPosition.row).to.equal(10);
      (0, _chai.expect)(r[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].endPosition.row).to.equal(8);
      (0, _chai.expect)(r[0].children[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].children[0].endPosition.row).to.equal(5);
    });
  });

  describe('symbolToOutline', () => {
    it('converts an individual item', () => {
      const sourceItem = { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(1, 2, 3, 4) };
      const result = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      (0, _chai.expect)(result.icon).to.equal('type-class');
      (0, _chai.expect)(result.representativeName).to.equal('Program');
      (0, _chai.expect)(result.children).to.deep.equal([]);
      const r = result;
      (0, _chai.expect)(r.tokenizedText[0].kind).to.equal('type');
      (0, _chai.expect)(r.tokenizedText[0].value).to.equal('Program');
      (0, _chai.expect)(r.startPosition.row).to.equal(1);
      (0, _chai.expect)(r.startPosition.column).to.equal(2);
      (0, _chai.expect)(r.endPosition.row).to.equal(3);
      (0, _chai.expect)(r.endPosition.column).to.equal(4);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvb3V0bGluZS12aWV3LWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiY3JlYXRlTG9jYXRpb24iLCJhIiwiYiIsImMiLCJkIiwidXJpIiwicmFuZ2UiLCJzdGFydCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJlbmQiLCJiZWZvcmVFYWNoIiwiZ2xvYmFsIiwic2lub24iLCJzYW5kYm94IiwiY3JlYXRlIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsIml0IiwicmVzdWx0IiwiY2FuQWRhcHQiLCJkb2N1bWVudFN5bWJvbFByb3ZpZGVyIiwidG8iLCJiZSIsInRydWUiLCJmYWxzZSIsImNyZWF0ZU91dGxpbmVUcmVlcyIsImRlZXAiLCJlcXVhbCIsInNvdXJjZUl0ZW0iLCJraW5kIiwiU3ltYm9sS2luZCIsIk5hbWVzcGFjZSIsIm5hbWUiLCJsb2NhdGlvbiIsImV4cGVjdGVkIiwic3ltYm9sVG9PdXRsaW5lIiwiQ2xhc3MiLCJtaXNzaW5nQ29udGFpbmVyU291cmNlIiwiT2JqZWN0IiwiYXNzaWduIiwiY29udGFpbmVyTmFtZSIsImxlbmd0aCIsInJlcHJlc2VudGF0aXZlTmFtZSIsInN0YXJ0UG9zaXRpb24iLCJyb3ciLCJjb2x1bW4iLCJjaGlsZHJlbiIsInNvdXJjZUl0ZW1zIiwiRnVuY3Rpb24iLCJyIiwiZW5kUG9zaXRpb24iLCJpY29uIiwidG9rZW5pemVkVGV4dCIsInZhbHVlIl0sIm1hcHBpbmdzIjoiQUFFQTs7OztBQUNBOztJQUFZQSxFOztBQUNaOzs7O0FBQ0E7Ozs7OztBQUVBQyxTQUFTLG9CQUFULEVBQStCLE1BQU07QUFDbkMsUUFBTUMsaUJBQWlCLENBQUNDLENBQUQsRUFBSUMsQ0FBSixFQUFPQyxDQUFQLEVBQVVDLENBQVYsTUFBaUI7QUFDdENDLFNBQUssRUFEaUM7QUFFdENDLFdBQU8sRUFBQ0MsT0FBTyxFQUFDQyxNQUFNUCxDQUFQLEVBQVVRLFdBQVdQLENBQXJCLEVB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RCxDQTNKRCIsImZpbGUiOiJvdXRsaW5lLXZpZXctYWRhcHRlci50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCBPdXRsaW5lVmlld0FkYXB0ZXIgZnJvbSAnLi4vLi4vbGliL2FkYXB0ZXJzL291dGxpbmUtdmlldy1hZGFwdGVyJztcclxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi4vLi4vbGliL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcclxuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknO1xyXG5cclxuZGVzY3JpYmUoJ091dGxpbmVWaWV3QWRhcHRlcicsICgpID0+IHtcclxuICBjb25zdCBjcmVhdGVMb2NhdGlvbiA9IChhLCBiLCBjLCBkKSA9PiAoe1xyXG4gICAgdXJpOiAnJyxcclxuICAgIHJhbmdlOiB7c3RhcnQ6IHtsaW5lOiBhLCBjaGFyYWN0ZXI6IGJ9LCBlbmQ6IHtsaW5lOiBjLCBjaGFyYWN0ZXI6IGR9fSxcclxuICB9KTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBnbG9iYWwuc2lub24gPSBzaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xyXG4gIH0pO1xyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBnbG9iYWwuc2lub24ucmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY2FuQWRhcHQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIGRvY3VtZW50U3ltYm9sUHJvdmlkZXIgaXMgc3VwcG9ydGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoe2RvY3VtZW50U3ltYm9sUHJvdmlkZXI6IHRydWV9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUudHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIGRvY3VtZW50U3ltYm9sUHJvdmlkZXIgbm90IHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNhbkFkYXB0KHt9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZmFsc2U7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZU91dGxpbmVUcmVlcycsICgpID0+IHtcclxuICAgIGl0KCdjcmVhdGVzIGFuIGVtcHR5IGFycmF5IGdpdmVuIGFuIGVtcHR5IGFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKFtdKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uZGVlcC5lcXVhbChbXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY3JlYXRlcyBhIHNpbmdsZSBjb252ZXJ0ZWQgcm9vdCBpdGVtIGZyb20gYSBzaW5nbGUgc291cmNlIGl0ZW0nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW0gPSB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdSJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDUsIDYsIDcsIDgpfTtcclxuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKFtzb3VyY2VJdGVtXSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoW2V4cGVjdGVkXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY3JlYXRlcyBhbiBlbXB0eSByb290IGNvbnRhaW5lciB3aXRoIGEgc2luZ2xlIHNvdXJjZSBpdGVtIHdoZW4gY29udGFpbmVyTmFtZSBtaXNzaW5nJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2VJdGVtID0ge2tpbmQ6IGxzLlN5bWJvbEtpbmQuQ2xhc3MsIG5hbWU6ICdQcm9ncmFtJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDIsIDMsIDQpfTtcclxuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xyXG4gICAgICBjb25zdCBtaXNzaW5nQ29udGFpbmVyU291cmNlID0gT2JqZWN0LmFzc2lnbihzb3VyY2VJdGVtLCB7Y29udGFpbmVyTmFtZTogJ21pc3NpbmcnfSk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jcmVhdGVPdXRsaW5lVHJlZXMoW21pc3NpbmdDb250YWluZXJTb3VyY2VdKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ21pc3NpbmcnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zdGFydFBvc2l0aW9uLnJvdykudG8uZXF1YWwoMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc3RhcnRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFtleHBlY3RlZF0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NyZWF0ZXMgYW4gZW1wdHkgcm9vdCBjb250YWluZXIgd2l0aCBhIHNpbmdsZSBzb3VyY2UgaXRlbSB3aGVuIGNvbnRhaW5lck5hbWUgaXMgbWlzc2luZyBhbmQgbWF0Y2hlcyBvd24gbmFtZScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbSA9IHtraW5kOiBscy5TeW1ib2xLaW5kLkNsYXNzLCBuYW1lOiAnc2ltcGxlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDIsIDMsIDQpfTtcclxuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xyXG4gICAgICBjb25zdCBtaXNzaW5nQ29udGFpbmVyU291cmNlID0gT2JqZWN0LmFzc2lnbihzb3VyY2VJdGVtLCB7Y29udGFpbmVyTmFtZTogJ3NpbXBsZSd9KTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbbWlzc2luZ0NvbnRhaW5lclNvdXJjZV0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnc2ltcGxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc3RhcnRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0YXJ0UG9zaXRpb24uY29sdW1uKS50by5lcXVhbCgwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbZXhwZWN0ZWRdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjcmVhdGVzIGEgc2ltcGxlIG5hbWVkIGhpZXJhcmNoeScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnamF2YS5jb20nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMSwgMCwgMTAsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5DbGFzcywgbmFtZTogJ1Byb2dyYW0nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMiwgMCwgNywgMCksIGNvbnRhaW5lck5hbWU6ICdqYXZhLmNvbSd9LFxyXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLkZ1bmN0aW9uLCBuYW1lOiAnbWFpbicsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig0LCAwLCA1LCAwKSwgY29udGFpbmVyTmFtZTogJ1Byb2dyYW0nfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbi5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ21haW4nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRhaW5zIGR1cGxpY2F0ZSBuYW1lZCBpdGVtcycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDAsIDUsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdkdXBsaWNhdGUnLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNiwgMCwgMTAsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5GdW5jdGlvbiwgbmFtZTogJ21haW4nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNywgMCwgOCwgMCksIGNvbnRhaW5lck5hbWU6ICdkdXBsaWNhdGUnfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgyKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5yZXByZXNlbnRhdGl2ZU5hbWUpLnRvLmVxdWFsKCdkdXBsaWNhdGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFsxXS5yZXByZXNlbnRhdGl2ZU5hbWUpLnRvLmVxdWFsKCdkdXBsaWNhdGUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkaXNhbWJpZ3VhdGVzIGNvbnRhaW5lck5hbWUgYmFzZWQgb24gcmFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW1zID0gW1xyXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSwgbmFtZTogJ2R1cGxpY2F0ZScsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCA1LCAwKX0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDYsIDAsIDEwLCAwKX0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuRnVuY3Rpb24sIG5hbWU6ICdtYWluJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDcsIDAsIDgsIDApLCBjb250YWluZXJOYW1lOiAnZHVwbGljYXRlJ30sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jcmVhdGVPdXRsaW5lVHJlZXMoc291cmNlSXRlbXMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzFdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0uY2hpbGRyZW5bMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnbWFpbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJkb2VzIG5vdCBiZWNvbWUgaXQncyBvd24gcGFyZW50XCIsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDAsIDEwLCAwKX0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsXHJcbiAgICAgICAgICBuYW1lOiAnZHVwbGljYXRlJyxcclxuICAgICAgICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig2LCAwLCA3LCAwKSxcclxuICAgICAgICAgIGNvbnRhaW5lck5hbWU6ICdkdXBsaWNhdGUnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jcmVhdGVPdXRsaW5lVHJlZXMoc291cmNlSXRlbXMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGNvbnN0IHIgPSAocmVzdWx0OiBhbnkpO1xyXG4gICAgICBleHBlY3QoclswXS5lbmRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDEwKTtcclxuICAgICAgZXhwZWN0KHJbMF0uY2hpbGRyZW4ubGVuZ3RoKS50by5lcXVhbCgxKTtcclxuICAgICAgZXhwZWN0KHJbMF0uY2hpbGRyZW5bMF0uZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCg3KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwYXJlbnRzIHRvIHRoZSBpbm5uZXJtb3N0IG5hbWVkIGNvbnRhaW5lcicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAndHVydGxlcycsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCAxMCwgMCl9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGtpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLFxyXG4gICAgICAgICAgbmFtZTogJ3R1cnRsZXMnLFxyXG4gICAgICAgICAgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDQsIDAsIDgsIDApLFxyXG4gICAgICAgICAgY29udGFpbmVyTmFtZTogJ3R1cnRsZXMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuQ2xhc3MsIG5hbWU6ICdkaXNjJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDQsIDAsIDUsIDApLCBjb250YWluZXJOYW1lOiAndHVydGxlcyd9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKHNvdXJjZUl0ZW1zKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBjb25zdCByID0gKHJlc3VsdDogYW55KTtcclxuICAgICAgZXhwZWN0KHJbMF0uZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCgxMCk7XHJcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuWzBdLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoOCk7XHJcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoNSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3N5bWJvbFRvT3V0bGluZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhbiBpbmRpdmlkdWFsIGl0ZW0nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW0gPSB7a2luZDogbHMuU3ltYm9sS2luZC5DbGFzcywgbmFtZTogJ1Byb2dyYW0nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMSwgMiwgMywgNCl9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lmljb24pLnRvLmVxdWFsKCd0eXBlLWNsYXNzJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnUHJvZ3JhbScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFtdKTtcclxuICAgICAgY29uc3QgciA9IChyZXN1bHQ6IGFueSk7XHJcbiAgICAgIGV4cGVjdChyLnRva2VuaXplZFRleHRbMF0ua2luZCkudG8uZXF1YWwoJ3R5cGUnKTtcclxuICAgICAgZXhwZWN0KHIudG9rZW5pemVkVGV4dFswXS52YWx1ZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcclxuICAgICAgZXhwZWN0KHIuc3RhcnRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3Qoci5zdGFydFBvc2l0aW9uLmNvbHVtbikudG8uZXF1YWwoMik7XHJcbiAgICAgIGV4cGVjdChyLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoMyk7XHJcbiAgICAgIGV4cGVjdChyLmVuZFBvc2l0aW9uLmNvbHVtbikudG8uZXF1YWwoNCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==