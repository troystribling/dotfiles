Object.defineProperty(exports, "__esModule", {
  value: true
});

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _atom = require('atom');

var _logger = require('./logger');

var _serverManager = require('./server-manager.js');

var _convert = require('./convert.js');

var _convert2 = _interopRequireDefault(_convert);

var _applyEditAdapter = require('./adapters/apply-edit-adapter');

var _applyEditAdapter2 = _interopRequireDefault(_applyEditAdapter);

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _codeActionAdapter = require('./adapters/code-action-adapter');

var _codeActionAdapter2 = _interopRequireDefault(_codeActionAdapter);

var _codeFormatAdapter = require('./adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _codeHighlightAdapter = require('./adapters/code-highlight-adapter');

var _codeHighlightAdapter2 = _interopRequireDefault(_codeHighlightAdapter);

var _datatipAdapter = require('./adapters/datatip-adapter');

var _datatipAdapter2 = _interopRequireDefault(_datatipAdapter);

var _definitionAdapter = require('./adapters/definition-adapter');

var _definitionAdapter2 = _interopRequireDefault(_definitionAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _findReferencesAdapter = require('./adapters/find-references-adapter');

var _findReferencesAdapter2 = _interopRequireDefault(_findReferencesAdapter);

var _linterPushV2Adapter = require('./adapters/linter-push-v2-adapter');

var _linterPushV2Adapter2 = _interopRequireDefault(_linterPushV2Adapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _outlineViewAdapter = require('./adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

var _signatureHelpAdapter = require('./adapters/signature-help-adapter');

var _signatureHelpAdapter2 = _interopRequireDefault(_signatureHelpAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// Public: AutoLanguageClient provides a simple way to have all the supported
// Atom-IDE services wired up entirely for you by just subclassing it and
// implementing startServerProcess/getGrammarScopes/getLanguageName and
// getServerName.
class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
    this.processStdErr = '';
  }

  // Shared adapters that can take the RPC connection as required


  // You must implement these so we know how to deal with your language and server
  // -------------------------------------------------------------------------

  // Return an array of the grammar scopes you handle, e.g. [ 'source.js' ]
  getGrammarScopes() {
    throw Error('Must implement getGrammarScopes when extending AutoLanguageClient');
  }

  // Return the name of the language you support, e.g. 'JavaScript'
  getLanguageName() {
    throw Error('Must implement getLanguageName when extending AutoLanguageClient');
  }

  // Return the name of your server, e.g. 'Eclipse JDT'
  getServerName() {
    throw Error('Must implement getServerName when extending AutoLanguageClient');
  }

  // Start your server process
  startServerProcess(projectPath) {
    throw Error('Must override startServerProcess to start language server process when extending AutoLanguageClient');
  }

  // You might want to override these for different behavior
  // ---------------------------------------------------------------------------

  // Determine whether we should start a server for a given editor if we don't have one yet
  shouldStartForEditor(editor) {
    return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
  }

  // Return the parameters used to initialize a client - you may want to extend capabilities
  getInitializeParams(projectPath, process) {
    return {
      processId: process.pid,
      capabilities: {},
      rootPath: projectPath,
      rootUri: _convert2.default.pathToUri(projectPath)
    };
  }

  // Early wire-up of listeners before initialize method is sent
  preInitialization(connection) {}

  // Late wire-up of listeners after initialize method has been sent
  postInitialization(server) {}

  // Determine whether to use ipc, stdio or socket to connect to the server
  getConnectionType() {
    const hasSocket = this.socket != null;
    return hasSocket ? 'socket' : 'stdio';
  }

  // Default implementation of the rest of the AutoLanguageClient
  // ---------------------------------------------------------------------------

  // Activate does very little for perf reasons - hooks in via ServerManager for later 'activation'
  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = this.getLogger();
    this._serverManager = new _serverManager.ServerManager(p => this.startServer(p), this.logger, e => this.shouldStartForEditor(e), path => this.filterChangeWatchedFiles(path));
    this._serverManager.startListening();
    process.on('exit', () => this.exitCleanup.bind(this));
  }

  exitCleanup() {
    this._serverManager.terminate();
  }

  // Deactivate disposes the resources we're using
  async deactivate() {
    this._disposable.dispose();
    this._serverManager.stopListening();
    await this._serverManager.stopAllServers();
  }

  spawnChildNode(args, options = {}) {
    this.logger.debug(`starting child Node "${args.join(' ')}"`);
    options.env = options.env || Object.create(process.env);
    options.env.ELECTRON_RUN_AS_NODE = '1';
    options.env.ELECTRON_NO_ATTACH_CONSOLE = '1';
    return cp.spawn(process.execPath, args, options);
  }

  // By default LSP logging is switched off but you can switch it on via the core.debugLSP setting
  getLogger() {
    return atom.config.get('core.debugLSP') ? new _logger.ConsoleLogger(this.name) : new _logger.NullLogger();
  }

  // Starts the server by starting the process, then initializing the language server and starting adapters
  async startServer(projectPath) {
    const process = await this.startServerProcess(projectPath);
    const connection = new ls.LanguageClientConnection(this.createRpcConnection(process), this.logger);
    this.preInitialization(connection);
    const initializeParams = this.getInitializeParams(projectPath, process);
    const initializeResponse = await connection.initialize(initializeParams);
    const newServer = {
      projectPath,
      process,
      connection,
      capabilities: initializeResponse.capabilities,
      disposable: new _atom.CompositeDisposable()
    };
    this.postInitialization(newServer);
    this.startExclusiveAdapters(newServer);
    return newServer;
  }

  captureServerErrors(childProcess) {
    childProcess.on('error', err => this.handleSpawnFailure(err));
    childProcess.on('exit', (code, signal) => this.logger.debug(`exited code ${code}`));
    childProcess.stderr.setEncoding('utf8');
    childProcess.stderr.on('data', chunk => {
      const errorString = chunk.toString();
      this.logger.warn('stderr', errorString);
      // Keep the last 5 lines for packages to use in messages
      this.processStdErr = (this.processStdErr + errorString).split('\n').slice(-5).join('\n');
    });
  }

  handleSpawnFailure(err) {
    atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} unable to start`, {
      dismissable: true,
      description: err.toString()
    });
  }

  // Creates the RPC connection which can be ipc, socket or stdio
  createRpcConnection(process) {
    let reader, writer;
    const connectionType = this.getConnectionType();
    switch (connectionType) {
      case 'ipc':
        reader = new rpc.IPCMessageReader(process);
        writer = new rpc.IPCMessageWriter(process);
        break;
      case 'socket':
        reader = new rpc.SocketMessageReader(this.socket);
        writer = new rpc.SocketMessageWriter(this.socket);
        break;
      case 'stdio':
        reader = new rpc.StreamMessageReader(process.stdout);
        writer = new rpc.StreamMessageWriter(process.stdin);
        break;
    }

    return rpc.createMessageConnection(reader, writer, {
      error: m => {
        this.logger.error(m);
      }
    });
  }

  // Start adapters that are not shared between servers
  startExclusiveAdapters(server) {
    _applyEditAdapter2.default.attach(server.connection);
    _notificationsAdapter2.default.attach(server.connection, this.name);

    if (_documentSyncAdapter2.default.canAdapt(server.capabilities)) {
      server.docSyncAdapter = new _documentSyncAdapter2.default(server.connection, server.capabilities.textDocumentSync, editor => this.shouldSyncForEditor(editor, server.projectPath));
      server.disposable.add(server.docSyncAdapter);
    }

    server.linterPushV2 = new _linterPushV2Adapter2.default(server.connection);
    if (this._linterDelegate != null) {
      server.linterPushV2.attach(this._linterDelegate);
    }

    if (_signatureHelpAdapter2.default.canAdapt(server.capabilities)) {
      server.signatureHelpAdapter = new _signatureHelpAdapter2.default(server, this.getGrammarScopes());
      if (this._signatureHelpRegistry != null) {
        server.signatureHelpAdapter.attach(this._signatureHelpRegistry);
      }
    }
  }

  shouldSyncForEditor(editor, projectPath) {
    return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
  }

  isFileInProject(editor, projectPath) {
    return (editor.getURI() || '').startsWith(projectPath);
  }

  // Autocomplete+ via LS completion---------------------------------------
  provideAutocomplete() {
    return {
      selector: this.getGrammarScopes().map(g => '.' + g).join(', '),
      inclusionPriority: 1,
      suggestionPriority: 2,
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  async getSuggestions(request) {
    const server = await this._serverManager.getServer(request.editor);
    if (server == null || !_autocompleteAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    this.autoComplete = this.autoComplete || new _autocompleteAdapter2.default();
    return this.autoComplete.getSuggestions(server.connection, request);
  }

  // Definitions via LS documentHighlight and gotoDefinition------------
  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this)
    };
  }

  async getDefinition(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_definitionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.definitions = this.definitions || new _definitionAdapter2.default();
    return this.definitions.getDefinition(server.connection, server.capabilities, this.getLanguageName(), editor, point);
  }

  // Outline View via LS documentSymbol---------------------------------
  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  async getOutline(editor) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_outlineViewAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.outlineView = this.outlineView || new _outlineViewAdapter2.default();
    return this.outlineView.getOutline(server.connection, editor);
  }

  // Linter push v2 API via LS publishDiagnostics
  consumeLinterV2(registerIndie) {
    this._linterDelegate = registerIndie({ name: this.name });
    if (this._linterDelegate == null) {
      return;
    }

    for (const server of this._serverManager.getActiveServers()) {
      if (server.linterPushV2 != null) {
        server.linterPushV2.attach(this._linterDelegate);
      }
    }
  }

  // Find References via LS findReferences------------------------------
  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  async getReferences(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_findReferencesAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.findReferences = this.findReferences || new _findReferencesAdapter2.default();
    return this.findReferences.getReferences(server.connection, editor, point, server.projectPath);
  }

  // Datatip via LS textDocument/hover----------------------------------
  consumeDatatip(service) {
    this._disposable.add(service.addProvider({
      providerName: this.name,
      priority: 1,
      grammarScopes: this.getGrammarScopes(),
      validForScope: scopeName => {
        return this.getGrammarScopes().includes(scopeName);
      },
      datatip: this.getDatatip.bind(this)
    }));
  }

  async getDatatip(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_datatipAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.datatip = this.datatip || new _datatipAdapter2.default();
    return this.datatip.getDatatip(server.connection, editor, point);
  }

  // Code Format via LS formatDocument & formatDocumentRange------------
  provideCodeFormat() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      formatCode: this.getCodeFormat.bind(this)
    };
  }

  async getCodeFormat(editor, range) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeFormatAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    return _codeFormatAdapter2.default.format(server.connection, server.capabilities, editor, range);
  }

  provideCodeHighlight() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      highlight: (editor, position) => {
        return this.getCodeHighlight(editor, position);
      }
    };
  }

  async getCodeHighlight(editor, position) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeHighlightAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeHighlightAdapter2.default.highlight(server.connection, server.capabilities, editor, position);
  }

  provideCodeActions() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getCodeActions: (editor, range, diagnostics) => {
        return this.getCodeActions(editor, range, diagnostics);
      }
    };
  }

  async getCodeActions(editor, range, diagnostics) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeActionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeActionAdapter2.default.getCodeActions(server.connection, server.capabilities, server.linterPushV2, editor, range, diagnostics);
  }

  consumeSignatureHelp(registry) {
    this._signatureHelpRegistry = registry;
    for (const server of this._serverManager.getActiveServers()) {
      if (server.signatureHelpAdapter != null) {
        server.signatureHelpAdapter.attach(registry);
      }
    }
    return new _atom.Disposable(() => {
      this._signatureHelpRegistry = null;
    });
  }

  /**
   * `didChangeWatchedFiles` message filtering, override for custom logic.
   * @param filePath path of a file that has changed in the project path
   * @return false => message will not be sent to the language server
   */
  filterChangeWatchedFiles(filePath) {
    return true;
  }
}
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsInByb2Nlc3NTdGRFcnIiLCJnZXRHcmFtbWFyU2NvcGVzIiwiRXJyb3IiLCJnZXRMYW5ndWFnZU5hbWUiLCJnZXRTZXJ2ZXJOYW1lIiwic3RhcnRTZXJ2ZXJQcm9jZXNzIiwicHJvamVjdFBhdGgiLCJzaG91bGRTdGFydEZvckVkaXRvciIsImVkaXRvciIsImluY2x1ZGVzIiwiZ2V0R3JhbW1hciIsInNjb3BlTmFtZSIsImdldEluaXRpYWxpemVQYXJhbXMiLCJwcm9jZXNzIiwicHJvY2Vzc0lkIiwicGlkIiwiY2FwYWJpbGl0aWVzIiwicm9vdFBhdGgiLCJyb290VXJpIiwicGF0aFRvVXJpIiwicHJlSW5pdGlhbGl6YXRpb24iLCJjb25uZWN0aW9uIiwicG9zdEluaXRpYWxpemF0aW9uIiwic2VydmVyIiwiZ2V0Q29ubmVjdGlvblR5cGUiLCJoYXNTb2NrZXQiLCJzb2NrZXQiLCJhY3RpdmF0ZSIsIm5hbWUiLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJfc2VydmVyTWFuYWdlciIsInAiLCJzdGFydFNlcnZlciIsImUiLCJwYXRoIiwiZmlsdGVyQ2hhbmdlV2F0Y2hlZEZpbGVzIiwic3RhcnRMaXN0ZW5pbmciLCJvbiIsImV4aXRDbGVhbnVwIiwiYmluZCIsInRlcm1pbmF0ZSIsImRlYWN0aXZhdGUiLCJkaXNwb3NlIiwic3RvcExpc3RlbmluZyIsInN0b3BBbGxTZXJ2ZXJzIiwic3Bhd25DaGlsZE5vZGUiLCJhcmdzIiwib3B0aW9ucyIsImRlYnVnIiwiam9pbiIsImVudiIsIk9iamVjdCIsImNyZWF0ZSIsIkVMRUNUUk9OX1JVTl9BU19OT0RFIiwiRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUiLCJzcGF3biIsImV4ZWNQYXRoIiwiYXRvbSIsImNvbmZpZyIsImdldCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsImNyZWF0ZVJwY0Nvbm5lY3Rpb24iLCJpbml0aWFsaXplUGFyYW1zIiwiaW5pdGlhbGl6ZVJlc3BvbnNlIiwiaW5pdGlhbGl6ZSIsIm5ld1NlcnZlciIsImRpc3Bvc2FibGUiLCJzdGFydEV4Y2x1c2l2ZUFkYXB0ZXJzIiwiY2FwdHVyZVNlcnZlckVycm9ycyIsImNoaWxkUHJvY2VzcyIsImVyciIsImhhbmRsZVNwYXduRmFpbHVyZSIsImNvZGUiLCJzaWduYWwiLCJzdGRlcnIiLCJzZXRFbmNvZGluZyIsImNodW5rIiwiZXJyb3JTdHJpbmciLCJ0b1N0cmluZyIsIndhcm4iLCJzcGxpdCIsInNsaWNlIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGlzbWlzc2FibGUiLCJkZXNjcmlwdGlvbiIsInJlYWRlciIsIndyaXRlciIsImNvbm5lY3Rpb25UeXBlIiwiSVBDTWVzc2FnZVJlYWRlciIsIklQQ01lc3NhZ2VXcml0ZXIiLCJTb2NrZXRNZXNzYWdlUmVhZGVyIiwiU29ja2V0TWVzc2FnZVdyaXRlciIsIlN0cmVhbU1lc3NhZ2VSZWFkZXIiLCJzdGRvdXQiLCJTdHJlYW1NZXNzYWdlV3JpdGVyIiwic3RkaW4iLCJjcmVhdGVNZXNzYWdlQ29ubmVjdGlvbiIsImVycm9yIiwibSIsImF0dGFjaCIsImNhbkFkYXB0IiwiZG9jU3luY0FkYXB0ZXIiLCJ0ZXh0RG9jdW1lbnRTeW5jIiwic2hvdWxkU3luY0ZvckVkaXRvciIsImFkZCIsImxpbnRlclB1c2hWMiIsIl9saW50ZXJEZWxlZ2F0ZSIsInNpZ25hdHVyZUhlbHBBZGFwdGVyIiwiX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSIsImlzRmlsZUluUHJvamVjdCIsImdldFVSSSIsInN0YXJ0c1dpdGgiLCJwcm92aWRlQXV0b2NvbXBsZXRlIiwic2VsZWN0b3IiLCJtYXAiLCJnIiwiaW5jbHVzaW9uUHJpb3JpdHkiLCJzdWdnZXN0aW9uUHJpb3JpdHkiLCJleGNsdWRlTG93ZXJQcmlvcml0eSIsImdldFN1Z2dlc3Rpb25zIiwicmVxdWVzdCIsImdldFNlcnZlciIsImF1dG9Db21wbGV0ZSIsInByb3ZpZGVEZWZpbml0aW9ucyIsInByaW9yaXR5IiwiZ3JhbW1hclNjb3BlcyIsImdldERlZmluaXRpb24iLCJwb2ludCIsImRlZmluaXRpb25zIiwicHJvdmlkZU91dGxpbmVzIiwiZ2V0T3V0bGluZSIsIm91dGxpbmVWaWV3IiwiY29uc3VtZUxpbnRlclYyIiwicmVnaXN0ZXJJbmRpZSIsImdldEFjdGl2ZVNlcnZlcnMiLCJwcm92aWRlRmluZFJlZmVyZW5jZXMiLCJpc0VkaXRvclN1cHBvcnRlZCIsImZpbmRSZWZlcmVuY2VzIiwiZ2V0UmVmZXJlbmNlcyIsImNvbnN1bWVEYXRhdGlwIiwic2VydmljZSIsImFkZFByb3ZpZGVyIiwicHJvdmlkZXJOYW1lIiwidmFsaWRGb3JTY29wZSIsImRhdGF0aXAiLCJnZXREYXRhdGlwIiwicHJvdmlkZUNvZGVGb3JtYXQiLCJmb3JtYXRDb2RlIiwiZ2V0Q29kZUZvcm1hdCIsInJhbmdlIiwiZm9ybWF0IiwicHJvdmlkZUNvZGVIaWdobGlnaHQiLCJoaWdobGlnaHQiLCJwb3NpdGlvbiIsImdldENvZGVIaWdobGlnaHQiLCJwcm92aWRlQ29kZUFjdGlvbnMiLCJnZXRDb2RlQWN0aW9ucyIsImRpYWdub3N0aWNzIiwiY29uc3VtZVNpZ25hdHVyZUhlbHAiLCJyZWdpc3RyeSIsImZpbGVQYXRoIl0sIm1hcHBpbmdzIjoiOzs7O0FBRUE7O0lBQVlBLEU7O0FBQ1o7O0lBQVlDLEU7O0FBQ1o7O0lBQVlDLEc7O0FBQ1o7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNlLE1BQU1DLGtCQUFOLENBQXlCO0FBQUE7QUFBQSxTQUN0Q0MsV0FEc0MsR0FDeEIsK0JBRHdCO0FB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b0Q7QUFDbEQsV0FBTyxJQUFQO0FBQ0Q7QUF2YXFDO2tCQUFuQnBLLGtCIiwiZmlsZSI6ImF1dG8tbGFuZ3VhZ2VjbGllbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xyXG5cclxuaW1wb3J0ICogYXMgY3AgZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4vbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgKiBhcyBycGMgZnJvbSAndnNjb2RlLWpzb25ycGMnO1xyXG5pbXBvcnQge0NvbXBvc2l0ZURpc3Bvc2FibGUsIERpc3Bvc2FibGV9IGZyb20gJ2F0b20nO1xyXG5pbXBvcnQge0NvbnNvbGVMb2dnZXIsIE51bGxMb2dnZXIsIHR5cGUgTG9nZ2VyfSBmcm9tICcuL2xvZ2dlcic7XHJcbmltcG9ydCB7U2VydmVyTWFuYWdlciwgdHlwZSBBY3RpdmVTZXJ2ZXJ9IGZyb20gJy4vc2VydmVyLW1hbmFnZXIuanMnO1xyXG5pbXBvcnQgQ29udmVydCBmcm9tICcuL2NvbnZlcnQuanMnO1xyXG5cclxuaW1wb3J0IEFwcGx5RWRpdEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9hcHBseS1lZGl0LWFkYXB0ZXInO1xyXG5pbXBvcnQgQXV0b2NvbXBsZXRlQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2F1dG9jb21wbGV0ZS1hZGFwdGVyJztcclxuaW1wb3J0IENvZGVBY3Rpb25BZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvY29kZS1hY3Rpb24tYWRhcHRlcic7XHJcbmltcG9ydCBDb2RlRm9ybWF0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2NvZGUtZm9ybWF0LWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29kZUhpZ2hsaWdodEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9jb2RlLWhpZ2hsaWdodC1hZGFwdGVyJztcclxuaW1wb3J0IERhdGF0aXBBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZGF0YXRpcC1hZGFwdGVyJztcclxuaW1wb3J0IERlZmluaXRpb25BZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZGVmaW5pdGlvbi1hZGFwdGVyJztcclxuaW1wb3J0IERvY3VtZW50U3luY0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kb2N1bWVudC1zeW5jLWFkYXB0ZXInO1xyXG5pbXBvcnQgRmluZFJlZmVyZW5jZXNBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvZmluZC1yZWZlcmVuY2VzLWFkYXB0ZXInO1xyXG5pbXBvcnQgTGludGVyUHVzaFYyQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2xpbnRlci1wdXNoLXYyLWFkYXB0ZXInO1xyXG5pbXBvcnQgTm90aWZpY2F0aW9uc0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9ub3RpZmljYXRpb25zLWFkYXB0ZXInO1xyXG5pbXBvcnQgT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvb3V0bGluZS12aWV3LWFkYXB0ZXInO1xyXG5pbXBvcnQgU2lnbmF0dXJlSGVscEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9zaWduYXR1cmUtaGVscC1hZGFwdGVyJztcclxuXHJcbnR5cGUgQ29ubmVjdGlvblR5cGUgPSAnc3RkaW8nIHwgJ3NvY2tldCcgfCAnaXBjJztcclxuXHJcbi8vIFB1YmxpYzogQXV0b0xhbmd1YWdlQ2xpZW50IHByb3ZpZGVzIGEgc2ltcGxlIHdheSB0byBoYXZlIGFsbCB0aGUgc3VwcG9ydGVkXHJcbi8vIEF0b20tSURFIHNlcnZpY2VzIHdpcmVkIHVwIGVudGlyZWx5IGZvciB5b3UgYnkganVzdCBzdWJjbGFzc2luZyBpdCBhbmRcclxuLy8gaW1wbGVtZW50aW5nIHN0YXJ0U2VydmVyUHJvY2Vzcy9nZXRHcmFtbWFyU2NvcGVzL2dldExhbmd1YWdlTmFtZSBhbmRcclxuLy8gZ2V0U2VydmVyTmFtZS5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXV0b0xhbmd1YWdlQ2xpZW50IHtcclxuICBfZGlzcG9zYWJsZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XHJcbiAgX3NlcnZlck1hbmFnZXI6IFNlcnZlck1hbmFnZXI7XHJcbiAgX2xpbnRlckRlbGVnYXRlOiBsaW50ZXIkVjJJbmRpZURlbGVnYXRlO1xyXG4gIF9zaWduYXR1cmVIZWxwUmVnaXN0cnk6ID9hdG9tSWRlJFNpZ25hdHVyZUhlbHBSZWdpc3RyeTtcclxuXHJcbiAgcHJvY2Vzc1N0ZEVycjogc3RyaW5nID0gJyc7XHJcbiAgbG9nZ2VyOiBMb2dnZXI7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIHNvY2tldDogbmV0JFNvY2tldDtcclxuXHJcbiAgLy8gU2hhcmVkIGFkYXB0ZXJzIHRoYXQgY2FuIHRha2UgdGhlIFJQQyBjb25uZWN0aW9uIGFzIHJlcXVpcmVkXHJcbiAgYXV0b0NvbXBsZXRlOiA/QXV0b2NvbXBsZXRlQWRhcHRlcjtcclxuICBkYXRhdGlwOiA/RGF0YXRpcEFkYXB0ZXI7XHJcbiAgZGVmaW5pdGlvbnM6ID9EZWZpbml0aW9uQWRhcHRlcjtcclxuICBmaW5kUmVmZXJlbmNlczogP0ZpbmRSZWZlcmVuY2VzQWRhcHRlcjtcclxuICBvdXRsaW5lVmlldzogP091dGxpbmVWaWV3QWRhcHRlcjtcclxuXHJcbiAgLy8gWW91IG11c3QgaW1wbGVtZW50IHRoZXNlIHNvIHdlIGtub3cgaG93IHRvIGRlYWwgd2l0aCB5b3VyIGxhbmd1YWdlIGFuZCBzZXJ2ZXJcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIFJldHVybiBhbiBhcnJheSBvZiB0aGUgZ3JhbW1hciBzY29wZXMgeW91IGhhbmRsZSwgZS5nLiBbICdzb3VyY2UuanMnIF1cclxuICBnZXRHcmFtbWFyU2NvcGVzKCk6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3QgaW1wbGVtZW50IGdldEdyYW1tYXJTY29wZXMgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGxhbmd1YWdlIHlvdSBzdXBwb3J0LCBlLmcuICdKYXZhU2NyaXB0J1xyXG4gIGdldExhbmd1YWdlTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3QgaW1wbGVtZW50IGdldExhbmd1YWdlTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnQnKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgbmFtZSBvZiB5b3VyIHNlcnZlciwgZS5nLiAnRWNsaXBzZSBKRFQnXHJcbiAgZ2V0U2VydmVyTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3QgaW1wbGVtZW50IGdldFNlcnZlck5hbWUgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBTdGFydCB5b3VyIHNlcnZlciBwcm9jZXNzXHJcbiAgc3RhcnRTZXJ2ZXJQcm9jZXNzKHByb2plY3RQYXRoOiBzdHJpbmcpOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2VzcyB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3Mgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBZb3UgbWlnaHQgd2FudCB0byBvdmVycmlkZSB0aGVzZSBmb3IgZGlmZmVyZW50IGJlaGF2aW9yXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIERldGVybWluZSB3aGV0aGVyIHdlIHNob3VsZCBzdGFydCBhIHNlcnZlciBmb3IgYSBnaXZlbiBlZGl0b3IgaWYgd2UgZG9uJ3QgaGF2ZSBvbmUgeWV0XHJcbiAgc2hvdWxkU3RhcnRGb3JFZGl0b3IoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhlZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIHBhcmFtZXRlcnMgdXNlZCB0byBpbml0aWFsaXplIGEgY2xpZW50IC0geW91IG1heSB3YW50IHRvIGV4dGVuZCBjYXBhYmlsaXRpZXNcclxuICBnZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoOiBzdHJpbmcsIHByb2Nlc3M6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzKTogbHMuSW5pdGlhbGl6ZVBhcmFtcyB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBwcm9jZXNzSWQ6IHByb2Nlc3MucGlkLFxyXG4gICAgICBjYXBhYmlsaXRpZXM6IHt9LFxyXG4gICAgICByb290UGF0aDogcHJvamVjdFBhdGgsXHJcbiAgICAgIHJvb3RVcmk6IENvbnZlcnQucGF0aFRvVXJpKHByb2plY3RQYXRoKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBFYXJseSB3aXJlLXVwIG9mIGxpc3RlbmVycyBiZWZvcmUgaW5pdGlhbGl6ZSBtZXRob2QgaXMgc2VudFxyXG4gIHByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb246IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbik6IHZvaWQge31cclxuXHJcbiAgLy8gTGF0ZSB3aXJlLXVwIG9mIGxpc3RlbmVycyBhZnRlciBpbml0aWFsaXplIG1ldGhvZCBoYXMgYmVlbiBzZW50XHJcbiAgcG9zdEluaXRpYWxpemF0aW9uKHNlcnZlcjogQWN0aXZlU2VydmVyKTogdm9pZCB7fVxyXG5cclxuICAvLyBEZXRlcm1pbmUgd2hldGhlciB0byB1c2UgaXBjLCBzdGRpbyBvciBzb2NrZXQgdG8gY29ubmVjdCB0byB0aGUgc2VydmVyXHJcbiAgZ2V0Q29ubmVjdGlvblR5cGUoKTogQ29ubmVjdGlvblR5cGUge1xyXG4gICAgY29uc3QgaGFzU29ja2V0ID0gdGhpcy5zb2NrZXQgIT0gbnVsbDtcclxuICAgIHJldHVybiBoYXNTb2NrZXQgPyAnc29ja2V0JyA6ICdzdGRpbyc7XHJcbiAgfVxyXG5cclxuICAvLyBEZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIHRoZSByZXN0IG9mIHRoZSBBdXRvTGFuZ3VhZ2VDbGllbnRcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLy8gQWN0aXZhdGUgZG9lcyB2ZXJ5IGxpdHRsZSBmb3IgcGVyZiByZWFzb25zIC0gaG9va3MgaW4gdmlhIFNlcnZlck1hbmFnZXIgZm9yIGxhdGVyICdhY3RpdmF0aW9uJ1xyXG4gIGFjdGl2YXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5uYW1lID0gYCR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gKCR7dGhpcy5nZXRTZXJ2ZXJOYW1lKCl9KWA7XHJcbiAgICB0aGlzLmxvZ2dlciA9IHRoaXMuZ2V0TG9nZ2VyKCk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyID0gbmV3IFNlcnZlck1hbmFnZXIoXHJcbiAgICAgIHAgPT4gdGhpcy5zdGFydFNlcnZlcihwKSxcclxuICAgICAgdGhpcy5sb2dnZXIsXHJcbiAgICAgIGUgPT4gdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlKSxcclxuICAgICAgcGF0aCA9PiB0aGlzLmZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhwYXRoKSxcclxuICAgICk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0YXJ0TGlzdGVuaW5nKCk7XHJcbiAgICBwcm9jZXNzLm9uKCdleGl0JywgKCkgPT4gdGhpcy5leGl0Q2xlYW51cC5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIGV4aXRDbGVhbnVwKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlci50ZXJtaW5hdGUoKTtcclxuICB9XHJcblxyXG4gIC8vIERlYWN0aXZhdGUgZGlzcG9zZXMgdGhlIHJlc291cmNlcyB3ZSdyZSB1c2luZ1xyXG4gIGFzeW5jIGRlYWN0aXZhdGUoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlci5zdG9wTGlzdGVuaW5nKCk7XHJcbiAgICBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BBbGxTZXJ2ZXJzKCk7XHJcbiAgfVxyXG5cclxuICBzcGF3bkNoaWxkTm9kZShhcmdzOiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogY2hpbGRfcHJvY2VzcyRzcGF3bk9wdHMgPSB7fSk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHtcclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBzdGFydGluZyBjaGlsZCBOb2RlIFwiJHthcmdzLmpvaW4oJyAnKX1cImApO1xyXG4gICAgb3B0aW9ucy5lbnYgPSBvcHRpb25zLmVudiB8fCBPYmplY3QuY3JlYXRlKHByb2Nlc3MuZW52KTtcclxuICAgIG9wdGlvbnMuZW52LkVMRUNUUk9OX1JVTl9BU19OT0RFID0gJzEnO1xyXG4gICAgb3B0aW9ucy5lbnYuRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUgPSAnMSc7XHJcbiAgICByZXR1cm4gY3Auc3Bhd24ocHJvY2Vzcy5leGVjUGF0aCwgYXJncywgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvLyBCeSBkZWZhdWx0IExTUCBsb2dnaW5nIGlzIHN3aXRjaGVkIG9mZiBidXQgeW91IGNhbiBzd2l0Y2ggaXQgb24gdmlhIHRoZSBjb3JlLmRlYnVnTFNQIHNldHRpbmdcclxuICBnZXRMb2dnZXIoKTogTG9nZ2VyIHtcclxuICAgIHJldHVybiBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuZGVidWdMU1AnKSA/IG5ldyBDb25zb2xlTG9nZ2VyKHRoaXMubmFtZSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnRzIHRoZSBzZXJ2ZXIgYnkgc3RhcnRpbmcgdGhlIHByb2Nlc3MsIHRoZW4gaW5pdGlhbGl6aW5nIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgYW5kIHN0YXJ0aW5nIGFkYXB0ZXJzXHJcbiAgYXN5bmMgc3RhcnRTZXJ2ZXIocHJvamVjdFBhdGg6IHN0cmluZyk6IFByb21pc2U8QWN0aXZlU2VydmVyPiB7XHJcbiAgICBjb25zdCBwcm9jZXNzID0gYXdhaXQgdGhpcy5zdGFydFNlcnZlclByb2Nlc3MocHJvamVjdFBhdGgpO1xyXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24odGhpcy5jcmVhdGVScGNDb25uZWN0aW9uKHByb2Nlc3MpLCB0aGlzLmxvZ2dlcik7XHJcbiAgICB0aGlzLnByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb24pO1xyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVBhcmFtcyA9IHRoaXMuZ2V0SW5pdGlhbGl6ZVBhcmFtcyhwcm9qZWN0UGF0aCwgcHJvY2Vzcyk7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUmVzcG9uc2UgPSBhd2FpdCBjb25uZWN0aW9uLmluaXRpYWxpemUoaW5pdGlhbGl6ZVBhcmFtcyk7XHJcbiAgICBjb25zdCBuZXdTZXJ2ZXIgPSB7XHJcbiAgICAgIHByb2plY3RQYXRoLFxyXG4gICAgICBwcm9jZXNzLFxyXG4gICAgICBjb25uZWN0aW9uLFxyXG4gICAgICBjYXBhYmlsaXRpZXM6IGluaXRpYWxpemVSZXNwb25zZS5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIGRpc3Bvc2FibGU6IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXHJcbiAgICB9O1xyXG4gICAgdGhpcy5wb3N0SW5pdGlhbGl6YXRpb24obmV3U2VydmVyKTtcclxuICAgIHRoaXMuc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhuZXdTZXJ2ZXIpO1xyXG4gICAgcmV0dXJuIG5ld1NlcnZlcjtcclxuICB9XHJcblxyXG4gIGNhcHR1cmVTZXJ2ZXJFcnJvcnMoY2hpbGRQcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IHZvaWQge1xyXG4gICAgY2hpbGRQcm9jZXNzLm9uKCdlcnJvcicsIGVyciA9PiB0aGlzLmhhbmRsZVNwYXduRmFpbHVyZShlcnIpKTtcclxuICAgIGNoaWxkUHJvY2Vzcy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHRoaXMubG9nZ2VyLmRlYnVnKGBleGl0ZWQgY29kZSAke2NvZGV9YCkpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5zZXRFbmNvZGluZygndXRmOCcpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5vbignZGF0YScsIChjaHVuazogQnVmZmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yU3RyaW5nID0gY2h1bmsudG9TdHJpbmcoKTtcclxuICAgICAgdGhpcy5sb2dnZXIud2Fybignc3RkZXJyJywgZXJyb3JTdHJpbmcpO1xyXG4gICAgICAvLyBLZWVwIHRoZSBsYXN0IDUgbGluZXMgZm9yIHBhY2thZ2VzIHRvIHVzZSBpbiBtZXNzYWdlc1xyXG4gICAgICB0aGlzLnByb2Nlc3NTdGRFcnIgPSAodGhpcy5wcm9jZXNzU3RkRXJyICsgZXJyb3JTdHJpbmcpXHJcbiAgICAgICAgLnNwbGl0KCdcXG4nKVxyXG4gICAgICAgIC5zbGljZSgtNSlcclxuICAgICAgICAuam9pbignXFxuJyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZVNwYXduRmFpbHVyZShlcnI6IGFueSk6IHZvaWQge1xyXG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFxyXG4gICAgICBgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gbGFuZ3VhZ2Ugc2VydmVyIGZvciAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9IHVuYWJsZSB0byBzdGFydGAsXHJcbiAgICAgIHtcclxuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogZXJyLnRvU3RyaW5nKCksXHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlcyB0aGUgUlBDIGNvbm5lY3Rpb24gd2hpY2ggY2FuIGJlIGlwYywgc29ja2V0IG9yIHN0ZGlvXHJcbiAgY3JlYXRlUnBjQ29ubmVjdGlvbihwcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IHJwYy5Db25uZWN0aW9uIHtcclxuICAgIGxldCByZWFkZXIsIHdyaXRlcjtcclxuICAgIGNvbnN0IGNvbm5lY3Rpb25UeXBlID0gdGhpcy5nZXRDb25uZWN0aW9uVHlwZSgpO1xyXG4gICAgc3dpdGNoIChjb25uZWN0aW9uVHlwZSkge1xyXG4gICAgICBjYXNlICdpcGMnOlxyXG4gICAgICAgIHJlYWRlciA9IG5ldyBycGMuSVBDTWVzc2FnZVJlYWRlcihwcm9jZXNzKTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLklQQ01lc3NhZ2VXcml0ZXIocHJvY2Vzcyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3NvY2tldCc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5Tb2NrZXRNZXNzYWdlUmVhZGVyKHRoaXMuc29ja2V0KTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLlNvY2tldE1lc3NhZ2VXcml0ZXIodGhpcy5zb2NrZXQpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdzdGRpbyc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5TdHJlYW1NZXNzYWdlUmVhZGVyKHByb2Nlc3Muc3Rkb3V0KTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VXcml0ZXIocHJvY2Vzcy5zdGRpbik7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJwYy5jcmVhdGVNZXNzYWdlQ29ubmVjdGlvbihyZWFkZXIsIHdyaXRlciwge1xyXG4gICAgICBlcnJvcjogbSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IobSk7XHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXJ0IGFkYXB0ZXJzIHRoYXQgYXJlIG5vdCBzaGFyZWQgYmV0d2VlbiBzZXJ2ZXJzXHJcbiAgc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhzZXJ2ZXI6IEFjdGl2ZVNlcnZlcik6IHZvaWQge1xyXG4gICAgQXBwbHlFZGl0QWRhcHRlci5hdHRhY2goc2VydmVyLmNvbm5lY3Rpb24pO1xyXG4gICAgTm90aWZpY2F0aW9uc0FkYXB0ZXIuYXR0YWNoKHNlcnZlci5jb25uZWN0aW9uLCB0aGlzLm5hbWUpO1xyXG5cclxuICAgIGlmIChEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5kb2NTeW5jQWRhcHRlciA9IG5ldyBEb2N1bWVudFN5bmNBZGFwdGVyKHNlcnZlci5jb25uZWN0aW9uLCBzZXJ2ZXIuY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMsIGVkaXRvciA9PlxyXG4gICAgICAgIHRoaXMuc2hvdWxkU3luY0ZvckVkaXRvcihlZGl0b3IsIHNlcnZlci5wcm9qZWN0UGF0aCksXHJcbiAgICAgICk7XHJcbiAgICAgIHNlcnZlci5kaXNwb3NhYmxlLmFkZChzZXJ2ZXIuZG9jU3luY0FkYXB0ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlcnZlci5saW50ZXJQdXNoVjIgPSBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihzZXJ2ZXIuY29ubmVjdGlvbik7XHJcbiAgICBpZiAodGhpcy5fbGludGVyRGVsZWdhdGUgIT0gbnVsbCkge1xyXG4gICAgICBzZXJ2ZXIubGludGVyUHVzaFYyLmF0dGFjaCh0aGlzLl9saW50ZXJEZWxlZ2F0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKFNpZ25hdHVyZUhlbHBBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlciA9IG5ldyBTaWduYXR1cmVIZWxwQWRhcHRlcihzZXJ2ZXIsIHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpKTtcclxuICAgICAgaWYgKHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaCh0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzaG91bGRTeW5jRm9yRWRpdG9yKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5pc0ZpbGVJblByb2plY3QoZWRpdG9yLCBwcm9qZWN0UGF0aCkgJiYgdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlZGl0b3IpO1xyXG4gIH1cclxuXHJcbiAgaXNGaWxlSW5Qcm9qZWN0KGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGVkaXRvci5nZXRVUkkoKSB8fCAnJykuc3RhcnRzV2l0aChwcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZUF1dG9jb21wbGV0ZSgpOiBhdG9tJEF1dG9jb21wbGV0ZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNlbGVjdG9yOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKVxyXG4gICAgICAgIC5tYXAoZyA9PiAnLicgKyBnKVxyXG4gICAgICAgIC5qb2luKCcsICcpLFxyXG4gICAgICBpbmNsdXNpb25Qcmlvcml0eTogMSxcclxuICAgICAgc3VnZ2VzdGlvblByaW9yaXR5OiAyLFxyXG4gICAgICBleGNsdWRlTG93ZXJQcmlvcml0eTogZmFsc2UsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiB0aGlzLmdldFN1Z2dlc3Rpb25zLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U3VnZ2VzdGlvbnMocmVxdWVzdDogYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0KTogUHJvbWlzZTxBcnJheTxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+PiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihyZXF1ZXN0LmVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUF1dG9jb21wbGV0ZUFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYXV0b0NvbXBsZXRlID0gdGhpcy5hdXRvQ29tcGxldGUgfHwgbmV3IEF1dG9jb21wbGV0ZUFkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5nZXRTdWdnZXN0aW9ucyhzZXJ2ZXIuY29ubmVjdGlvbiwgcmVxdWVzdCk7XHJcbiAgfVxyXG5cclxuICAvLyBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZURlZmluaXRpb25zKCk6IGF0b21JZGUkRGVmaW5pdGlvblByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgcHJpb3JpdHk6IDIwLFxyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgZ2V0RGVmaW5pdGlvbjogdGhpcy5nZXREZWZpbml0aW9uLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0RGVmaW5pdGlvbihlZGl0b3I6IFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/YXRvbUlkZSREZWZpbml0aW9uUXVlcnlSZXN1bHQ+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIURlZmluaXRpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGVmaW5pdGlvbnMgPSB0aGlzLmRlZmluaXRpb25zIHx8IG5ldyBEZWZpbml0aW9uQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbnMuZ2V0RGVmaW5pdGlvbihcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHRoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCksXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcG9pbnQsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gT3V0bGluZSBWaWV3IHZpYSBMUyBkb2N1bWVudFN5bWJvbC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVPdXRsaW5lcygpOiBhdG9tSWRlJE91dGxpbmVQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZ2V0T3V0bGluZTogdGhpcy5nZXRPdXRsaW5lLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0T3V0bGluZShlZGl0b3I6IGF0b20kVGV4dEVkaXRvcik6IFByb21pc2U8P2F0b21JZGUkT3V0bGluZT4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhT3V0bGluZVZpZXdBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3V0bGluZVZpZXcgPSB0aGlzLm91dGxpbmVWaWV3IHx8IG5ldyBPdXRsaW5lVmlld0FkYXB0ZXIoKTtcclxuICAgIHJldHVybiB0aGlzLm91dGxpbmVWaWV3LmdldE91dGxpbmUoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvcik7XHJcbiAgfVxyXG5cclxuICAvLyBMaW50ZXIgcHVzaCB2MiBBUEkgdmlhIExTIHB1Ymxpc2hEaWFnbm9zdGljc1xyXG4gIGNvbnN1bWVMaW50ZXJWMihyZWdpc3RlckluZGllOiAoe25hbWU6IHN0cmluZ30pID0+IGxpbnRlciRWMkluZGllRGVsZWdhdGUpOiB2b2lkIHtcclxuICAgIHRoaXMuX2xpbnRlckRlbGVnYXRlID0gcmVnaXN0ZXJJbmRpZSh7bmFtZTogdGhpcy5uYW1lfSk7XHJcbiAgICBpZiAodGhpcy5fbGludGVyRGVsZWdhdGUgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRBY3RpdmVTZXJ2ZXJzKCkpIHtcclxuICAgICAgaWYgKHNlcnZlci5saW50ZXJQdXNoVjIgIT0gbnVsbCkge1xyXG4gICAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIuYXR0YWNoKHRoaXMuX2xpbnRlckRlbGVnYXRlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRmluZCBSZWZlcmVuY2VzIHZpYSBMUyBmaW5kUmVmZXJlbmNlcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVGaW5kUmVmZXJlbmNlcygpOiBhdG9tSWRlJEZpbmRSZWZlcmVuY2VzUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNFZGl0b3JTdXBwb3J0ZWQ6IChlZGl0b3I6IGF0b20kVGV4dEVkaXRvcikgPT4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpLFxyXG4gICAgICBmaW5kUmVmZXJlbmNlczogdGhpcy5nZXRSZWZlcmVuY2VzLmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0UmVmZXJlbmNlcyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9hdG9tSWRlJEZpbmRSZWZlcmVuY2VzUmV0dXJuPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFGaW5kUmVmZXJlbmNlc0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5maW5kUmVmZXJlbmNlcyA9IHRoaXMuZmluZFJlZmVyZW5jZXMgfHwgbmV3IEZpbmRSZWZlcmVuY2VzQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZFJlZmVyZW5jZXMuZ2V0UmVmZXJlbmNlcyhzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb2ludCwgc2VydmVyLnByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIERhdGF0aXAgdmlhIExTIHRleHREb2N1bWVudC9ob3Zlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICBjb25zdW1lRGF0YXRpcChzZXJ2aWNlOiBhdG9tSWRlJERhdGF0aXBTZXJ2aWNlKTogdm9pZCB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlLmFkZChcclxuICAgICAgc2VydmljZS5hZGRQcm92aWRlcih7XHJcbiAgICAgICAgcHJvdmlkZXJOYW1lOiB0aGlzLm5hbWUsXHJcbiAgICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgICAgdmFsaWRGb3JTY29wZTogKHNjb3BlTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoc2NvcGVOYW1lKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRhdGF0aXA6IHRoaXMuZ2V0RGF0YXRpcC5iaW5kKHRoaXMpLFxyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXREYXRhdGlwKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P2F0b21JZGUkRGF0YXRpcD4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhRGF0YXRpcEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kYXRhdGlwID0gdGhpcy5kYXRhdGlwIHx8IG5ldyBEYXRhdGlwQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YXRpcC5nZXREYXRhdGlwKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50KTtcclxuICB9XHJcblxyXG4gIC8vIENvZGUgRm9ybWF0IHZpYSBMUyBmb3JtYXREb2N1bWVudCAmIGZvcm1hdERvY3VtZW50UmFuZ2UtLS0tLS0tLS0tLS1cclxuICBwcm92aWRlQ29kZUZvcm1hdCgpOiBhdG9tSWRlJFJhbmdlQ29kZUZvcm1hdFByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZm9ybWF0Q29kZTogdGhpcy5nZXRDb2RlRm9ybWF0LmJpbmQodGhpcyksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q29kZUZvcm1hdChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcmFuZ2U6IGF0b20kUmFuZ2UpOiBQcm9taXNlPEFycmF5PGF0b21JZGUkVGV4dEVkaXQ+PiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdChzZXJ2ZXIuY29ubmVjdGlvbiwgc2VydmVyLmNhcGFiaWxpdGllcywgZWRpdG9yLCByYW5nZSk7XHJcbiAgfVxyXG5cclxuICBwcm92aWRlQ29kZUhpZ2hsaWdodCgpOiBhdG9tSWRlJENvZGVIaWdobGlnaHRQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgcHJpb3JpdHk6IDEsXHJcbiAgICAgIGhpZ2hsaWdodDogKGVkaXRvciwgcG9zaXRpb24pID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2RlSGlnaGxpZ2h0KGVkaXRvciwgcG9zaXRpb24pO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENvZGVIaWdobGlnaHQoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvc2l0aW9uOiBhdG9tJFBvaW50KTogUHJvbWlzZTw/QXJyYXk8YXRvbSRSYW5nZT4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVIaWdobGlnaHRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlSGlnaGxpZ2h0QWRhcHRlci5oaWdobGlnaHQoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMsIGVkaXRvciwgcG9zaXRpb24pO1xyXG4gIH1cclxuXHJcbiAgcHJvdmlkZUNvZGVBY3Rpb25zKCk6IGF0b21JZGUkQ29kZUFjdGlvblByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgZ2V0Q29kZUFjdGlvbnM6IChlZGl0b3IsIHJhbmdlLCBkaWFnbm9zdGljcykgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENvZGVBY3Rpb25zKGVkaXRvciwgcmFuZ2UsIGRpYWdub3N0aWNzKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDb2RlQWN0aW9ucyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcmFuZ2U6IGF0b20kUmFuZ2UsIGRpYWdub3N0aWNzOiBBcnJheTxhdG9tSWRlJERpYWdub3N0aWM+KSB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFDb2RlQWN0aW9uQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gQ29kZUFjdGlvbkFkYXB0ZXIuZ2V0Q29kZUFjdGlvbnMoXHJcbiAgICAgIHNlcnZlci5jb25uZWN0aW9uLFxyXG4gICAgICBzZXJ2ZXIuY2FwYWJpbGl0aWVzLFxyXG4gICAgICBzZXJ2ZXIubGludGVyUHVzaFYyLFxyXG4gICAgICBlZGl0b3IsXHJcbiAgICAgIHJhbmdlLFxyXG4gICAgICBkaWFnbm9zdGljcyxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdW1lU2lnbmF0dXJlSGVscChyZWdpc3RyeTogYXRvbUlkZSRTaWduYXR1cmVIZWxwUmVnaXN0cnkpOiBJRGlzcG9zYWJsZSB7XHJcbiAgICB0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkgPSByZWdpc3RyeTtcclxuICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0QWN0aXZlU2VydmVycygpKSB7XHJcbiAgICAgIGlmIChzZXJ2ZXIuc2lnbmF0dXJlSGVscEFkYXB0ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgIHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlci5hdHRhY2gocmVnaXN0cnkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xyXG4gICAgICB0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkgPSBudWxsO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBgZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzYCBtZXNzYWdlIGZpbHRlcmluZywgb3ZlcnJpZGUgZm9yIGN1c3RvbSBsb2dpYy5cclxuICAgKiBAcGFyYW0gZmlsZVBhdGggcGF0aCBvZiBhIGZpbGUgdGhhdCBoYXMgY2hhbmdlZCBpbiB0aGUgcHJvamVjdCBwYXRoXHJcbiAgICogQHJldHVybiBmYWxzZSA9PiBtZXNzYWdlIHdpbGwgbm90IGJlIHNlbnQgdG8gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gICAqL1xyXG4gIGZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuIl19