Object.defineProperty(exports, "__esModule", {
  value: true
});

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _atom = require('atom');

var _logger = require('./logger');

var _serverManager = require('./server-manager.js');

var _convert = require('./convert.js');

var _convert2 = _interopRequireDefault(_convert);

var _applyEditAdapter = require('./adapters/apply-edit-adapter');

var _applyEditAdapter2 = _interopRequireDefault(_applyEditAdapter);

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _codeActionAdapter = require('./adapters/code-action-adapter');

var _codeActionAdapter2 = _interopRequireDefault(_codeActionAdapter);

var _codeFormatAdapter = require('./adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _codeHighlightAdapter = require('./adapters/code-highlight-adapter');

var _codeHighlightAdapter2 = _interopRequireDefault(_codeHighlightAdapter);

var _datatipAdapter = require('./adapters/datatip-adapter');

var _datatipAdapter2 = _interopRequireDefault(_datatipAdapter);

var _definitionAdapter = require('./adapters/definition-adapter');

var _definitionAdapter2 = _interopRequireDefault(_definitionAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _findReferencesAdapter = require('./adapters/find-references-adapter');

var _findReferencesAdapter2 = _interopRequireDefault(_findReferencesAdapter);

var _linterPushV2Adapter = require('./adapters/linter-push-v2-adapter');

var _linterPushV2Adapter2 = _interopRequireDefault(_linterPushV2Adapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _outlineViewAdapter = require('./adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

var _signatureHelpAdapter = require('./adapters/signature-help-adapter');

var _signatureHelpAdapter2 = _interopRequireDefault(_signatureHelpAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// Public: AutoLanguageClient provides a simple way to have all the supported
// Atom-IDE services wired up entirely for you by just subclassing it and
// implementing startServerProcess/getGrammarScopes/getLanguageName and
// getServerName.
class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
    this.processStdErr = '';
  }

  // Available if consumeBusySignal is setup


  // Shared adapters that can take the RPC connection as required


  // You must implement these so we know how to deal with your language and server
  // -------------------------------------------------------------------------

  // Return an array of the grammar scopes you handle, e.g. [ 'source.js' ]
  getGrammarScopes() {
    throw Error('Must implement getGrammarScopes when extending AutoLanguageClient');
  }

  // Return the name of the language you support, e.g. 'JavaScript'
  getLanguageName() {
    throw Error('Must implement getLanguageName when extending AutoLanguageClient');
  }

  // Return the name of your server, e.g. 'Eclipse JDT'
  getServerName() {
    throw Error('Must implement getServerName when extending AutoLanguageClient');
  }

  // Start your server process
  startServerProcess(projectPath) {
    throw Error('Must override startServerProcess to start language server process when extending AutoLanguageClient');
  }

  // You might want to override these for different behavior
  // ---------------------------------------------------------------------------

  // Determine whether we should start a server for a given editor if we don't have one yet
  shouldStartForEditor(editor) {
    return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
  }

  // Return the parameters used to initialize a client - you may want to extend capabilities
  getInitializeParams(projectPath, process) {
    return {
      processId: process.pid,
      rootPath: projectPath,
      rootUri: _convert2.default.pathToUri(projectPath),
      capabilities: {
        workspace: {
          applyEdit: true,
          workspaceEdit: {
            documentChanges: true
          },
          didChangeConfiguration: {
            dynamicRegistration: false
          },
          didChangeWatchedFiles: {
            dynamicRegistration: false
          },
          symbol: {
            dynamicRegistration: false
          },
          executeCommand: {
            dynamicRegistration: false
          }
        },
        textDocument: {
          synchronization: {
            dynamicRegistration: false,
            willSave: true,
            willSaveWaitUntil: false,
            didSave: true
          },
          completion: {
            dynamicRegistration: false,
            completionItem: {
              snippetSupport: true,
              commitCharactersSupport: false
            },
            contextSupport: false
          },
          hover: {
            dynamicRegistration: false
          },
          signatureHelp: {
            dynamicRegistration: false
          },
          references: {
            dynamicRegistration: false
          },
          documentHighlight: {
            dynamicRegistration: false
          },
          documentSymbol: {
            dynamicRegistration: false
          },
          formatting: {
            dynamicRegistration: false
          },
          rangeFormatting: {
            dynamicRegistration: false
          },
          onTypeFormatting: {
            dynamicRegistration: false
          },
          definition: {
            dynamicRegistration: false
          },
          codeAction: {
            dynamicRegistration: false
          },
          codeLens: {
            dynamicRegistration: false
          },
          documentLink: {
            dynamicRegistration: false
          },
          rename: {
            dynamicRegistration: false
          }
        },
        experimental: {}
      }
    };
  }

  // Early wire-up of listeners before initialize method is sent
  preInitialization(connection) {}

  // Late wire-up of listeners after initialize method has been sent
  postInitialization(server) {}

  // Determine whether to use ipc, stdio or socket to connect to the server
  getConnectionType() {
    return this.socket != null ? 'socket' : 'stdio';
  }

  // Default implementation of the rest of the AutoLanguageClient
  // ---------------------------------------------------------------------------

  // Activate does very little for perf reasons - hooks in via ServerManager for later 'activation'
  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = this.getLogger();
    this._serverManager = new _serverManager.ServerManager(p => this.startServer(p), this.logger, e => this.shouldStartForEditor(e), filepath => this.filterChangeWatchedFiles(filepath), () => this.busySignalService, this.getServerName());
    this._serverManager.startListening();
    process.on('exit', () => this.exitCleanup.bind(this));
  }

  exitCleanup() {
    this._serverManager.terminate();
  }

  // Deactivate disposes the resources we're using
  async deactivate() {
    this._disposable.dispose();
    this._serverManager.stopListening();
    await this._serverManager.stopAllServers();
  }

  spawnChildNode(args, options = {}) {
    this.logger.debug(`starting child Node "${args.join(' ')}"`);
    options.env = options.env || Object.create(process.env);
    options.env.ELECTRON_RUN_AS_NODE = '1';
    options.env.ELECTRON_NO_ATTACH_CONSOLE = '1';
    return cp.spawn(process.execPath, args, options);
  }

  // By default LSP logging is switched off but you can switch it on via the core.debugLSP setting
  getLogger() {
    return atom.config.get('core.debugLSP') ? new _logger.ConsoleLogger(this.name) : new _logger.NullLogger();
  }

  // Starts the server by starting the process, then initializing the language server and starting adapters
  async startServer(projectPath) {
    const startingSignal = this.busySignalService && this.busySignalService.reportBusy(`Starting ${this.getServerName()} for ${_path2.default.basename(projectPath)}`);
    let process;
    try {
      process = await this.startServerProcess(projectPath);
    } finally {
      startingSignal && startingSignal.dispose();
    }

    const connection = new ls.LanguageClientConnection(this.createRpcConnection(process), this.logger);
    this.preInitialization(connection);
    const initializeParams = this.getInitializeParams(projectPath, process);
    const initialization = connection.initialize(initializeParams);
    this.busySignalService && this.busySignalService.reportBusyWhile(`${this.getServerName()} initializing for ${_path2.default.basename(projectPath)}`, () => initialization);
    const initializeResponse = await initialization;
    const newServer = {
      projectPath,
      process,
      connection,
      capabilities: initializeResponse.capabilities,
      disposable: new _atom.CompositeDisposable()
    };
    this.postInitialization(newServer);
    connection.initialized();
    this.startExclusiveAdapters(newServer);
    return newServer;
  }

  captureServerErrors(childProcess) {
    childProcess.on('error', err => this.handleSpawnFailure(err));
    childProcess.on('exit', (code, signal) => this.logger.debug(`exited code ${code}`));
    childProcess.stderr.setEncoding('utf8');
    childProcess.stderr.on('data', chunk => {
      const errorString = chunk.toString();
      this.logger.warn('stderr', errorString);
      // Keep the last 5 lines for packages to use in messages
      this.processStdErr = (this.processStdErr + errorString).split('\n').slice(-5).join('\n');
    });
  }

  handleSpawnFailure(err) {
    atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} unable to start`, {
      dismissable: true,
      description: err.toString()
    });
  }

  // Creates the RPC connection which can be ipc, socket or stdio
  createRpcConnection(process) {
    let reader, writer;
    const connectionType = this.getConnectionType();
    switch (connectionType) {
      case 'ipc':
        reader = new rpc.IPCMessageReader(process);
        writer = new rpc.IPCMessageWriter(process);
        break;
      case 'socket':
        reader = new rpc.SocketMessageReader(this.socket);
        writer = new rpc.SocketMessageWriter(this.socket);
        break;
      case 'stdio':
        reader = new rpc.StreamMessageReader(process.stdout);
        writer = new rpc.StreamMessageWriter(process.stdin);
        break;
    }

    return rpc.createMessageConnection(reader, writer, {
      error: m => {
        this.logger.error(m);
      }
    });
  }

  // Start adapters that are not shared between servers
  startExclusiveAdapters(server) {
    _applyEditAdapter2.default.attach(server.connection);
    _notificationsAdapter2.default.attach(server.connection, this.name);

    if (_documentSyncAdapter2.default.canAdapt(server.capabilities)) {
      server.docSyncAdapter = new _documentSyncAdapter2.default(server.connection, server.capabilities.textDocumentSync, editor => this.shouldSyncForEditor(editor, server.projectPath));
      server.disposable.add(server.docSyncAdapter);
    }

    server.linterPushV2 = new _linterPushV2Adapter2.default(server.connection);
    if (this._linterDelegate != null) {
      server.linterPushV2.attach(this._linterDelegate);
    }

    if (_signatureHelpAdapter2.default.canAdapt(server.capabilities)) {
      server.signatureHelpAdapter = new _signatureHelpAdapter2.default(server, this.getGrammarScopes());
      if (this._signatureHelpRegistry != null) {
        server.signatureHelpAdapter.attach(this._signatureHelpRegistry);
      }
    }
  }

  shouldSyncForEditor(editor, projectPath) {
    return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
  }

  isFileInProject(editor, projectPath) {
    return (editor.getURI() || '').startsWith(projectPath);
  }

  // Autocomplete+ via LS completion---------------------------------------
  provideAutocomplete() {
    return {
      selector: this.getGrammarScopes().map(g => '.' + g).join(', '),
      inclusionPriority: 1,
      suggestionPriority: 2,
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this),
      getSuggestionDetailsOnSelect: this.getSuggestionDetailsOnSelect.bind(this)
    };
  }

  async getSuggestions(request) {
    this._lastAutocompleteRequest = request;
    const server = await this._serverManager.getServer(request.editor);
    if (server == null || !_autocompleteAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    this.autoComplete = this.autoComplete || new _autocompleteAdapter2.default();
    return this.autoComplete.getSuggestions(server.connection, request);
  }

  async getSuggestionDetailsOnSelect(suggestion) {
    if (this._lastAutocompleteRequest == null || this.autoComplete == null) {
      return null;
    }

    const server = await this._serverManager.getServer(this._lastAutocompleteRequest.editor);
    if (server == null || !_autocompleteAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    if (this._lastAutocompleteRequest != null && this.autoComplete != null) {
      return this.autoComplete.completeSuggestion(server.connection, suggestion, this._lastAutocompleteRequest);
    }

    return null;
  }

  // Definitions via LS documentHighlight and gotoDefinition------------
  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this)
    };
  }

  async getDefinition(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_definitionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.definitions = this.definitions || new _definitionAdapter2.default();
    return this.definitions.getDefinition(server.connection, server.capabilities, this.getLanguageName(), editor, point);
  }

  // Outline View via LS documentSymbol---------------------------------
  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  async getOutline(editor) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_outlineViewAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.outlineView = this.outlineView || new _outlineViewAdapter2.default();
    return this.outlineView.getOutline(server.connection, editor);
  }

  // Linter push v2 API via LS publishDiagnostics
  consumeLinterV2(registerIndie) {
    this._linterDelegate = registerIndie({ name: this.name });
    if (this._linterDelegate == null) {
      return;
    }

    for (const server of this._serverManager.getActiveServers()) {
      if (server.linterPushV2 != null) {
        server.linterPushV2.attach(this._linterDelegate);
      }
    }
  }

  // Find References via LS findReferences------------------------------
  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  async getReferences(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_findReferencesAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.findReferences = this.findReferences || new _findReferencesAdapter2.default();
    return this.findReferences.getReferences(server.connection, editor, point, server.projectPath);
  }

  // Datatip via LS textDocument/hover----------------------------------
  consumeDatatip(service) {
    this._disposable.add(service.addProvider({
      providerName: this.name,
      priority: 1,
      grammarScopes: this.getGrammarScopes(),
      validForScope: scopeName => {
        return this.getGrammarScopes().includes(scopeName);
      },
      datatip: this.getDatatip.bind(this)
    }));
  }

  async getDatatip(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_datatipAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.datatip = this.datatip || new _datatipAdapter2.default();
    return this.datatip.getDatatip(server.connection, editor, point);
  }

  // Code Format via LS formatDocument & formatDocumentRange------------
  provideCodeFormat() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      formatCode: this.getCodeFormat.bind(this)
    };
  }

  async getCodeFormat(editor, range) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeFormatAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    return _codeFormatAdapter2.default.format(server.connection, server.capabilities, editor, range);
  }

  provideCodeHighlight() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      highlight: (editor, position) => {
        return this.getCodeHighlight(editor, position);
      }
    };
  }

  async getCodeHighlight(editor, position) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeHighlightAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeHighlightAdapter2.default.highlight(server.connection, server.capabilities, editor, position);
  }

  provideCodeActions() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getCodeActions: (editor, range, diagnostics) => {
        return this.getCodeActions(editor, range, diagnostics);
      }
    };
  }

  async getCodeActions(editor, range, diagnostics) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeActionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeActionAdapter2.default.getCodeActions(server.connection, server.capabilities, server.linterPushV2, editor, range, diagnostics);
  }

  consumeSignatureHelp(registry) {
    this._signatureHelpRegistry = registry;
    for (const server of this._serverManager.getActiveServers()) {
      if (server.signatureHelpAdapter != null) {
        server.signatureHelpAdapter.attach(registry);
      }
    }
    return new _atom.Disposable(() => {
      this._signatureHelpRegistry = null;
    });
  }

  consumeBusySignal(service) {
    this.busySignalService = service;
    return new _atom.Disposable(() => delete this.busySignalService);
  }

  /**
   * `didChangeWatchedFiles` message filtering, override for custom logic.
   * @param filePath path of a file that has changed in the project path
   * @return false => message will not be sent to the language server
   */
  filterChangeWatchedFiles(filePath) {
    return true;
  }
}
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsInByb2Nlc3NTdGRFcnIiLCJnZXRHcmFtbWFyU2NvcGVzIiwiRXJyb3IiLCJnZXRMYW5ndWFnZU5hbWUiLCJnZXRTZXJ2ZXJOYW1lIiwic3RhcnRTZXJ2ZXJQcm9jZXNzIiwicHJvamVjdFBhdGgiLCJzaG91bGRTdGFydEZvckVkaXRvciIsImVkaXRvciIsImluY2x1ZGVzIiwiZ2V0R3JhbW1hciIsInNjb3BlTmFtZSIsImdldEluaXRpYWxpemVQYXJhbXMiLCJwcm9jZXNzIiwicHJvY2Vzc0lkIiwicGlkIiwicm9vdFBhdGgiLCJyb290VXJpIiwicGF0aFRvVXJpIiwiY2FwYWJpbGl0aWVzIiwid29ya3NwYWNlIiwiYXBwbHlFZGl0Iiwid29ya3NwYWNlRWRpdCIsImRvY3VtZW50Q2hhbmdlcyIsImRpZENoYW5nZUNvbmZpZ3VyYXRpb24iLCJkeW5hbWljUmVnaXN0cmF0aW9uIiwiZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzIiwic3ltYm9sIiwiZXhlY3V0ZUNvbW1hbmQiLCJ0ZXh0RG9jdW1lbnQiLCJzeW5jaHJvbml6YXRpb24iLCJ3aWxsU2F2ZSIsIndpbGxTYXZlV2FpdFVudGlsIiwiZGlkU2F2ZSIsImNvbXBsZXRpb24iLCJjb21wbGV0aW9uSXRlbSIsInNuaXBwZXRTdXBwb3J0IiwiY29tbWl0Q2hhcmFjdGVyc1N1cHBvcnQiLCJjb250ZXh0U3VwcG9ydCIsImhvdmVyIiwic2lnbmF0dXJlSGVscCIsInJlZmVyZW5jZXMiLCJkb2N1bWVudEhpZ2hsaWdodCIsImRvY3VtZW50U3ltYm9sIiwiZm9ybWF0dGluZyIsInJhbmdlRm9ybWF0dGluZyIsIm9uVHlwZUZvcm1hdHRpbmciLCJkZWZpbml0aW9uIiwiY29kZUFjdGlvbiIsImNvZGVMZW5zIiwiZG9jdW1lbnRMaW5rIiwicmVuYW1lIiwiZXhwZXJpbWVudGFsIiwicHJlSW5pdGlhbGl6YXRpb24iLCJjb25uZWN0aW9uIiwicG9zdEluaXRpYWxpemF0aW9uIiwic2VydmVyIiwiZ2V0Q29ubmVjdGlvblR5cGUiLCJzb2NrZXQiLCJhY3RpdmF0ZSIsIm5hbWUiLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJfc2VydmVyTWFuYWdlciIsInAiLCJzdGFydFNlcnZlciIsImUiLCJmaWxlcGF0aCIsImZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyIsImJ1c3lTaWduYWxTZXJ2aWNlIiwic3RhcnRMaXN0ZW5pbmciLCJvbiIsImV4aXRDbGVhbnVwIiwiYmluZCIsInRlcm1pbmF0ZSIsImRlYWN0aXZhdGUiLCJkaXNwb3NlIiwic3RvcExpc3RlbmluZyIsInN0b3BBbGxTZXJ2ZXJzIiwic3Bhd25DaGlsZE5vZGUiLCJhcmdzIiwib3B0aW9ucyIsImRlYnVnIiwiam9pbiIsImVudiIsIk9iamVjdCIsImNyZWF0ZSIsIkVMRUNUUk9OX1JVTl9BU19OT0RFIiwiRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUiLCJzcGF3biIsImV4ZWNQYXRoIiwiYXRvbSIsImNvbmZpZyIsImdldCIsInN0YXJ0aW5nU2lnbmFsIiwicmVwb3J0QnVzeSIsImJhc2VuYW1lIiwiTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uIiwiY3JlYXRlUnBjQ29ubmVjdGlvbiIsImluaXRpYWxpemVQYXJhbXMiLCJpbml0aWFsaXphdGlvbiIsImluaXRpYWxpemUiLCJyZXBvcnRCdXN5V2hpbGUiLCJpbml0aWFsaXplUmVzcG9uc2UiLCJuZXdTZXJ2ZXIiLCJkaXNwb3NhYmxlIiwiaW5pdGlhbGl6ZWQiLCJzdGFydEV4Y2x1c2l2ZUFkYXB0ZXJzIiwiY2FwdHVyZVNlcnZlckVycm9ycyIsImNoaWxkUHJvY2VzcyIsImVyciIsImhhbmRsZVNwYXduRmFpbHVyZSIsImNvZGUiLCJzaWduYWwiLCJzdGRlcnIiLCJzZXRFbmNvZGluZyIsImNodW5rIiwiZXJyb3JTdHJpbmciLCJ0b1N0cmluZyIsIndhcm4iLCJzcGxpdCIsInNsaWNlIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGlzbWlzc2FibGUiLCJkZXNjcmlwdGlvbiIsInJlYWRlciIsIndyaXRlciIsImNvbm5lY3Rpb25UeXBlIiwiSVBDTWVzc2FnZVJlYWRlciIsIklQQ01lc3NhZ2VXcml0ZXIiLCJTb2NrZXRNZXNzYWdlUmVhZGVyIiwiU29ja2V0TWVzc2FnZVdyaXRlciIsIlN0cmVhbU1lc3NhZ2VSZWFkZXIiLCJzdGRvdXQiLCJTdHJlYW1NZXNzYWdlV3JpdGVyIiwic3RkaW4iLCJjcmVhdGVNZXNzYWdlQ29ubmVjdGlvbiIsImVycm9yIiwibSIsImF0dGFjaCIsImNhbkFkYXB0IiwiZG9jU3luY0FkYXB0ZXIiLCJ0ZXh0RG9jdW1lbnRTeW5jIiwic2hvdWxkU3luY0ZvckVkaXRvciIsImFkZCIsImxpbnRlclB1c2hWMiIsIl9saW50ZXJEZWxlZ2F0ZSIsInNpZ25hdHVyZUhlbHBBZGFwdGVyIiwiX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSIsImlzRmlsZUluUHJvamVjdCIsImdldFVSSSIsInN0YXJ0c1dpdGgiLCJwcm92aWRlQXV0b2NvbXBsZXRlIiwic2VsZWN0b3IiLCJtYXAiLCJnIiwiaW5jbHVzaW9uUHJpb3JpdHkiLCJzdWdnZXN0aW9uUHJpb3JpdHkiLCJleGNsdWRlTG93ZXJQcmlvcml0eSIsImdldFN1Z2dlc3Rpb25zIiwiZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdCIsInJlcXVlc3QiLCJfbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3QiLCJnZXRTZXJ2ZXIiLCJhdXRvQ29tcGxldGUiLCJzdWdnZXN0aW9uIiwiY29tcGxldGVTdWdnZXN0aW9uIiwicHJvdmlkZURlZmluaXRpb25zIiwicHJpb3JpdHkiLCJncmFtbWFyU2NvcGVzIiwiZ2V0RGVmaW5pdGlvbiIsInBvaW50IiwiZGVmaW5pdGlvbnMiLCJwcm92aWRlT3V0bGluZXMiLCJnZXRPdXRsaW5lIiwib3V0bGluZVZpZXciLCJjb25zdW1lTGludGVyVjIiLCJyZWdpc3RlckluZGllIiwiZ2V0QWN0aXZlU2VydmVycyIsInByb3ZpZGVGaW5kUmVmZXJlbmNlcyIsImlzRWRpdG9yU3VwcG9ydGVkIiwiZmluZFJlZmVyZW5jZXMiLCJnZXRSZWZlcmVuY2VzIiwiY29uc3VtZURhdGF0aXAiLCJzZXJ2aWNlIiwiYWRkUHJvdmlkZXIiLCJwcm92aWRlck5hbWUiLCJ2YWxpZEZvclNjb3BlIiwiZGF0YXRpcCIsImdldERhdGF0aXAiLCJwcm92aWRlQ29kZUZvcm1hdCIsImZvcm1hdENvZGUiLCJnZXRDb2RlRm9ybWF0IiwicmFuZ2UiLCJmb3JtYXQiLCJwcm92aWRlQ29kZUhpZ2hsaWdodCIsImhpZ2hsaWdodCIsInBvc2l0aW9uIiwiZ2V0Q29kZUhpZ2hsaWdodCIsInByb3ZpZGVDb2RlQWN0aW9ucyIsImdldENvZGVBY3Rpb25zIiwiZGlhZ25vc3RpY3MiLCJjb25zdW1lU2lnbmF0dXJlSGVscCIsInJlZ2lzdHJ5IiwiY29uc3VtZUJ1c3lTaWduYWwiLCJmaWxlUGF0aCJdLCJtYXBwaW5ncyI6Ijs7OztBQUVBOztJQUFZQSxFOztBQUNaOztJQUFZQyxFOztBQUNaOztJQUFZQyxHOztBQUNaOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNlLE1BQU1DLGtCQUFOLENBQXlCO0FBQUE7QUFBQSxTQUN0Q0MsV0FEc0MsR0FDeEIsK0JBRHdCO0FBQUEsU0FVdENDLGFBVnNDLEdBVWQsRUFWYztBQUFBOztBQU90Qzs7O0FBUUE7OztBQU9BO0FBQ0E7O0FBRUE7QUFDQUMscUJBQWtDO0FBQ2hDLFVBQU1DLE1BQU0sbUVBQU4sQ0FBTjtBQUNEOztBQUVEO0FBQ0FDLG9CQUEwQjtBQUN4QixVQUFNRCxNQUFNLGtFQUFOLENBQU47QUFD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RCxzQkFBTCxHQUE4QixJQUE5QjtBQUNELEtBRk0sQ0FBUDtBQUdEOztBQUVEd0Qsb0JBQWtCcEIsT0FBbEIsRUFBbUU7QUFDakUsU0FBS3BILGlCQUFMLEdBQXlCb0gsT0FBekI7QUFDQSxXQUFPLHFCQUFlLE1BQU0sT0FBTyxLQUFLcEgsaUJBQWpDLENBQVA7QUFDRDs7QUFFRDs7Ozs7QUFLQUQsMkJBQXlCMEksUUFBekIsRUFBb0Q7QUFDbEQsV0FBTyxJQUFQO0FBQ0Q7QUE5aEJxQztrQkFBbkJoTixrQiIsImZpbGUiOiJhdXRvLWxhbmd1YWdlY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCAqIGFzIGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0ICogYXMgcnBjIGZyb20gJ3ZzY29kZS1qc29ucnBjJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRGlzcG9zYWJsZX0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7Q29uc29sZUxvZ2dlciwgTnVsbExvZ2dlciwgdHlwZSBMb2dnZXJ9IGZyb20gJy4vbG9nZ2VyJztcclxuaW1wb3J0IHtTZXJ2ZXJNYW5hZ2VyLCB0eXBlIEFjdGl2ZVNlcnZlcn0gZnJvbSAnLi9zZXJ2ZXItbWFuYWdlci5qcyc7XHJcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4vY29udmVydC5qcyc7XHJcblxyXG5pbXBvcnQgQXBwbHlFZGl0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2FwcGx5LWVkaXQtYWRhcHRlcic7XHJcbmltcG9ydCBBdXRvY29tcGxldGVBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29kZUFjdGlvbkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9jb2RlLWFjdGlvbi1hZGFwdGVyJztcclxuaW1wb3J0IENvZGVGb3JtYXRBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlcic7XHJcbmltcG9ydCBDb2RlSGlnaGxpZ2h0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2NvZGUtaGlnaGxpZ2h0LWFkYXB0ZXInO1xyXG5pbXBvcnQgRGF0YXRpcEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kYXRhdGlwLWFkYXB0ZXInO1xyXG5pbXBvcnQgRGVmaW5pdGlvbkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kZWZpbml0aW9uLWFkYXB0ZXInO1xyXG5pbXBvcnQgRG9jdW1lbnRTeW5jQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2RvY3VtZW50LXN5bmMtYWRhcHRlcic7XHJcbmltcG9ydCBGaW5kUmVmZXJlbmNlc0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9maW5kLXJlZmVyZW5jZXMtYWRhcHRlcic7XHJcbmltcG9ydCBMaW50ZXJQdXNoVjJBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbGludGVyLXB1c2gtdjItYWRhcHRlcic7XHJcbmltcG9ydCBOb3RpZmljYXRpb25zQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlcic7XHJcbmltcG9ydCBPdXRsaW5lVmlld0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9vdXRsaW5lLXZpZXctYWRhcHRlcic7XHJcbmltcG9ydCBTaWduYXR1cmVIZWxwQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL3NpZ25hdHVyZS1oZWxwLWFkYXB0ZXInO1xyXG5cclxudHlwZSBDb25uZWN0aW9uVHlwZSA9ICdzdGRpbycgfCAnc29ja2V0JyB8ICdpcGMnO1xyXG5cclxuLy8gUHVibGljOiBBdXRvTGFuZ3VhZ2VDbGllbnQgcHJvdmlkZXMgYSBzaW1wbGUgd2F5IHRvIGhhdmUgYWxsIHRoZSBzdXBwb3J0ZWRcclxuLy8gQXRvbS1JREUgc2VydmljZXMgd2lyZWQgdXAgZW50aXJlbHkgZm9yIHlvdSBieSBqdXN0IHN1YmNsYXNzaW5nIGl0IGFuZFxyXG4vLyBpbXBsZW1lbnRpbmcgc3RhcnRTZXJ2ZXJQcm9jZXNzL2dldEdyYW1tYXJTY29wZXMvZ2V0TGFuZ3VhZ2VOYW1lIGFuZFxyXG4vLyBnZXRTZXJ2ZXJOYW1lLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvTGFuZ3VhZ2VDbGllbnQge1xyXG4gIF9kaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcclxuICBfc2VydmVyTWFuYWdlcjogU2VydmVyTWFuYWdlcjtcclxuICBfbGludGVyRGVsZWdhdGU6IGxpbnRlciRWMkluZGllRGVsZWdhdGU7XHJcbiAgX3NpZ25hdHVyZUhlbHBSZWdpc3RyeTogP2F0b21JZGUkU2lnbmF0dXJlSGVscFJlZ2lzdHJ5O1xyXG4gIF9sYXN0QXV0b2NvbXBsZXRlUmVxdWVzdDogP2F0b20kQXV0b2NvbXBsZXRlUmVxdWVzdDtcclxuXHJcbiAgLy8gQXZhaWxhYmxlIGlmIGNvbnN1bWVCdXN5U2lnbmFsIGlzIHNldHVwXHJcbiAgYnVzeVNpZ25hbFNlcnZpY2U6ID9hdG9tSWRlJEJ1c3lTaWduYWxTZXJ2aWNlO1xyXG5cclxuICBwcm9jZXNzU3RkRXJyOiBzdHJpbmcgPSAnJztcclxuICBsb2dnZXI6IExvZ2dlcjtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgc29ja2V0OiBuZXQkU29ja2V0O1xyXG5cclxuICAvLyBTaGFyZWQgYWRhcHRlcnMgdGhhdCBjYW4gdGFrZSB0aGUgUlBDIGNvbm5lY3Rpb24gYXMgcmVxdWlyZWRcclxuICBhdXRvQ29tcGxldGU6ID9BdXRvY29tcGxldGVBZGFwdGVyO1xyXG4gIGRhdGF0aXA6ID9EYXRhdGlwQWRhcHRlcjtcclxuICBkZWZpbml0aW9uczogP0RlZmluaXRpb25BZGFwdGVyO1xyXG4gIGZpbmRSZWZlcmVuY2VzOiA/RmluZFJlZmVyZW5jZXNBZGFwdGVyO1xyXG4gIG91dGxpbmVWaWV3OiA/T3V0bGluZVZpZXdBZGFwdGVyO1xyXG5cclxuICAvLyBZb3UgbXVzdCBpbXBsZW1lbnQgdGhlc2Ugc28gd2Uga25vdyBob3cgdG8gZGVhbCB3aXRoIHlvdXIgbGFuZ3VhZ2UgYW5kIHNlcnZlclxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLy8gUmV0dXJuIGFuIGFycmF5IG9mIHRoZSBncmFtbWFyIHNjb3BlcyB5b3UgaGFuZGxlLCBlLmcuIFsgJ3NvdXJjZS5qcycgXVxyXG4gIGdldEdyYW1tYXJTY29wZXMoKTogQXJyYXk8c3RyaW5nPiB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBpbXBsZW1lbnQgZ2V0R3JhbW1hclNjb3BlcyB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnQnKTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybiB0aGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgeW91IHN1cHBvcnQsIGUuZy4gJ0phdmFTY3JpcHQnXHJcbiAgZ2V0TGFuZ3VhZ2VOYW1lKCk6IHN0cmluZyB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBpbXBsZW1lbnQgZ2V0TGFuZ3VhZ2VOYW1lIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBuYW1lIG9mIHlvdXIgc2VydmVyLCBlLmcuICdFY2xpcHNlIEpEVCdcclxuICBnZXRTZXJ2ZXJOYW1lKCk6IHN0cmluZyB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBpbXBsZW1lbnQgZ2V0U2VydmVyTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnQnKTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXJ0IHlvdXIgc2VydmVyIHByb2Nlc3NcclxuICBzdGFydFNlcnZlclByb2Nlc3MocHJvamVjdFBhdGg6IHN0cmluZyk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHwgUHJvbWlzZTxjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcz4ge1xyXG4gICAgdGhyb3cgRXJyb3IoJ011c3Qgb3ZlcnJpZGUgc3RhcnRTZXJ2ZXJQcm9jZXNzIHRvIHN0YXJ0IGxhbmd1YWdlIHNlcnZlciBwcm9jZXNzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gWW91IG1pZ2h0IHdhbnQgdG8gb3ZlcnJpZGUgdGhlc2UgZm9yIGRpZmZlcmVudCBiZWhhdmlvclxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBEZXRlcm1pbmUgd2hldGhlciB3ZSBzaG91bGQgc3RhcnQgYSBzZXJ2ZXIgZm9yIGEgZ2l2ZW4gZWRpdG9yIGlmIHdlIGRvbid0IGhhdmUgb25lIHlldFxyXG4gIHNob3VsZFN0YXJ0Rm9yRWRpdG9yKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBwYXJhbWV0ZXJzIHVzZWQgdG8gaW5pdGlhbGl6ZSBhIGNsaWVudCAtIHlvdSBtYXkgd2FudCB0byBleHRlbmQgY2FwYWJpbGl0aWVzXHJcbiAgZ2V0SW5pdGlhbGl6ZVBhcmFtcyhwcm9qZWN0UGF0aDogc3RyaW5nLCBwcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IGxzLkluaXRpYWxpemVQYXJhbXMge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJvY2Vzc0lkOiBwcm9jZXNzLnBpZCxcclxuICAgICAgcm9vdFBhdGg6IHByb2plY3RQYXRoLFxyXG4gICAgICByb290VXJpOiBDb252ZXJ0LnBhdGhUb1VyaShwcm9qZWN0UGF0aCksXHJcbiAgICAgIGNhcGFiaWxpdGllczoge1xyXG4gICAgICAgIHdvcmtzcGFjZToge1xyXG4gICAgICAgICAgYXBwbHlFZGl0OiB0cnVlLFxyXG4gICAgICAgICAgd29ya3NwYWNlRWRpdDoge1xyXG4gICAgICAgICAgICBkb2N1bWVudENoYW5nZXM6IHRydWUsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGlkQ2hhbmdlQ29uZmlndXJhdGlvbjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBkaWRDaGFuZ2VXYXRjaGVkRmlsZXM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc3ltYm9sOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGV4ZWN1dGVDb21tYW5kOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRleHREb2N1bWVudDoge1xyXG4gICAgICAgICAgc3luY2hyb25pemF0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWxsU2F2ZTogdHJ1ZSxcclxuICAgICAgICAgICAgd2lsbFNhdmVXYWl0VW50aWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBkaWRTYXZlOiB0cnVlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNvbXBsZXRpb246IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbXBsZXRpb25JdGVtOiB7XHJcbiAgICAgICAgICAgICAgc25pcHBldFN1cHBvcnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgY29tbWl0Q2hhcmFjdGVyc1N1cHBvcnQ6IGZhbHNlLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250ZXh0U3VwcG9ydDogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgaG92ZXI6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2lnbmF0dXJlSGVscDoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByZWZlcmVuY2VzOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGRvY3VtZW50SGlnaGxpZ2h0OiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGRvY3VtZW50U3ltYm9sOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGZvcm1hdHRpbmc6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcmFuZ2VGb3JtYXR0aW5nOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG9uVHlwZUZvcm1hdHRpbmc6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGVmaW5pdGlvbjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjb2RlQWN0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNvZGVMZW5zOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGRvY3VtZW50TGluazoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByZW5hbWU6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXhwZXJpbWVudGFsOiB7fSxcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBFYXJseSB3aXJlLXVwIG9mIGxpc3RlbmVycyBiZWZvcmUgaW5pdGlhbGl6ZSBtZXRob2QgaXMgc2VudFxyXG4gIHByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb246IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbik6IHZvaWQge31cclxuXHJcbiAgLy8gTGF0ZSB3aXJlLXVwIG9mIGxpc3RlbmVycyBhZnRlciBpbml0aWFsaXplIG1ldGhvZCBoYXMgYmVlbiBzZW50XHJcbiAgcG9zdEluaXRpYWxpemF0aW9uKHNlcnZlcjogQWN0aXZlU2VydmVyKTogdm9pZCB7fVxyXG5cclxuICAvLyBEZXRlcm1pbmUgd2hldGhlciB0byB1c2UgaXBjLCBzdGRpbyBvciBzb2NrZXQgdG8gY29ubmVjdCB0byB0aGUgc2VydmVyXHJcbiAgZ2V0Q29ubmVjdGlvblR5cGUoKTogQ29ubmVjdGlvblR5cGUge1xyXG4gICAgcmV0dXJuIHRoaXMuc29ja2V0ICE9IG51bGwgPyAnc29ja2V0JyA6ICdzdGRpbyc7XHJcbiAgfVxyXG5cclxuICAvLyBEZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIHRoZSByZXN0IG9mIHRoZSBBdXRvTGFuZ3VhZ2VDbGllbnRcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLy8gQWN0aXZhdGUgZG9lcyB2ZXJ5IGxpdHRsZSBmb3IgcGVyZiByZWFzb25zIC0gaG9va3MgaW4gdmlhIFNlcnZlck1hbmFnZXIgZm9yIGxhdGVyICdhY3RpdmF0aW9uJ1xyXG4gIGFjdGl2YXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5uYW1lID0gYCR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gKCR7dGhpcy5nZXRTZXJ2ZXJOYW1lKCl9KWA7XHJcbiAgICB0aGlzLmxvZ2dlciA9IHRoaXMuZ2V0TG9nZ2VyKCk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyID0gbmV3IFNlcnZlck1hbmFnZXIoXHJcbiAgICAgIHAgPT4gdGhpcy5zdGFydFNlcnZlcihwKSxcclxuICAgICAgdGhpcy5sb2dnZXIsXHJcbiAgICAgIGUgPT4gdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlKSxcclxuICAgICAgZmlsZXBhdGggPT4gdGhpcy5maWx0ZXJDaGFuZ2VXYXRjaGVkRmlsZXMoZmlsZXBhdGgpLFxyXG4gICAgICAoKSA9PiB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlLFxyXG4gICAgICB0aGlzLmdldFNlcnZlck5hbWUoKSxcclxuICAgICk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0YXJ0TGlzdGVuaW5nKCk7XHJcbiAgICBwcm9jZXNzLm9uKCdleGl0JywgKCkgPT4gdGhpcy5leGl0Q2xlYW51cC5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIGV4aXRDbGVhbnVwKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlci50ZXJtaW5hdGUoKTtcclxuICB9XHJcblxyXG4gIC8vIERlYWN0aXZhdGUgZGlzcG9zZXMgdGhlIHJlc291cmNlcyB3ZSdyZSB1c2luZ1xyXG4gIGFzeW5jIGRlYWN0aXZhdGUoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlci5zdG9wTGlzdGVuaW5nKCk7XHJcbiAgICBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BBbGxTZXJ2ZXJzKCk7XHJcbiAgfVxyXG5cclxuICBzcGF3bkNoaWxkTm9kZShhcmdzOiBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogY2hpbGRfcHJvY2VzcyRzcGF3bk9wdHMgPSB7fSk6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzIHtcclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBzdGFydGluZyBjaGlsZCBOb2RlIFwiJHthcmdzLmpvaW4oJyAnKX1cImApO1xyXG4gICAgb3B0aW9ucy5lbnYgPSBvcHRpb25zLmVudiB8fCBPYmplY3QuY3JlYXRlKHByb2Nlc3MuZW52KTtcclxuICAgIG9wdGlvbnMuZW52LkVMRUNUUk9OX1JVTl9BU19OT0RFID0gJzEnO1xyXG4gICAgb3B0aW9ucy5lbnYuRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUgPSAnMSc7XHJcbiAgICByZXR1cm4gY3Auc3Bhd24ocHJvY2Vzcy5leGVjUGF0aCwgYXJncywgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvLyBCeSBkZWZhdWx0IExTUCBsb2dnaW5nIGlzIHN3aXRjaGVkIG9mZiBidXQgeW91IGNhbiBzd2l0Y2ggaXQgb24gdmlhIHRoZSBjb3JlLmRlYnVnTFNQIHNldHRpbmdcclxuICBnZXRMb2dnZXIoKTogTG9nZ2VyIHtcclxuICAgIHJldHVybiBhdG9tLmNvbmZpZy5nZXQoJ2NvcmUuZGVidWdMU1AnKSA/IG5ldyBDb25zb2xlTG9nZ2VyKHRoaXMubmFtZSkgOiBuZXcgTnVsbExvZ2dlcigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnRzIHRoZSBzZXJ2ZXIgYnkgc3RhcnRpbmcgdGhlIHByb2Nlc3MsIHRoZW4gaW5pdGlhbGl6aW5nIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgYW5kIHN0YXJ0aW5nIGFkYXB0ZXJzXHJcbiAgYXN5bmMgc3RhcnRTZXJ2ZXIocHJvamVjdFBhdGg6IHN0cmluZyk6IFByb21pc2U8QWN0aXZlU2VydmVyPiB7XHJcbiAgICBjb25zdCBzdGFydGluZ1NpZ25hbCA9IHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UgJiYgdGhpcy5idXN5U2lnbmFsU2VydmljZS5yZXBvcnRCdXN5KFxyXG4gICAgICBgU3RhcnRpbmcgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gZm9yICR7cGF0aC5iYXNlbmFtZShwcm9qZWN0UGF0aCl9YCxcclxuICAgICk7XHJcbiAgICBsZXQgcHJvY2VzcztcclxuICAgIHRyeSB7XHJcbiAgICAgIHByb2Nlc3MgPSBhd2FpdCB0aGlzLnN0YXJ0U2VydmVyUHJvY2Vzcyhwcm9qZWN0UGF0aCk7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBzdGFydGluZ1NpZ25hbCAmJiBzdGFydGluZ1NpZ25hbC5kaXNwb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24odGhpcy5jcmVhdGVScGNDb25uZWN0aW9uKHByb2Nlc3MpLCB0aGlzLmxvZ2dlcik7XHJcbiAgICB0aGlzLnByZUluaXRpYWxpemF0aW9uKGNvbm5lY3Rpb24pO1xyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVBhcmFtcyA9IHRoaXMuZ2V0SW5pdGlhbGl6ZVBhcmFtcyhwcm9qZWN0UGF0aCwgcHJvY2Vzcyk7XHJcbiAgICBjb25zdCBpbml0aWFsaXphdGlvbiA9IGNvbm5lY3Rpb24uaW5pdGlhbGl6ZShpbml0aWFsaXplUGFyYW1zKTtcclxuICAgIHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UgJiYgdGhpcy5idXN5U2lnbmFsU2VydmljZS5yZXBvcnRCdXN5V2hpbGUoXHJcbiAgICAgIGAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBpbml0aWFsaXppbmcgZm9yICR7cGF0aC5iYXNlbmFtZShwcm9qZWN0UGF0aCl9YCxcclxuICAgICAgKCkgPT4gaW5pdGlhbGl6YXRpb24sXHJcbiAgICApO1xyXG4gICAgY29uc3QgaW5pdGlhbGl6ZVJlc3BvbnNlID0gYXdhaXQgaW5pdGlhbGl6YXRpb247XHJcbiAgICBjb25zdCBuZXdTZXJ2ZXIgPSB7XHJcbiAgICAgIHByb2plY3RQYXRoLFxyXG4gICAgICBwcm9jZXNzLFxyXG4gICAgICBjb25uZWN0aW9uLFxyXG4gICAgICBjYXBhYmlsaXRpZXM6IGluaXRpYWxpemVSZXNwb25zZS5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIGRpc3Bvc2FibGU6IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXHJcbiAgICB9O1xyXG4gICAgdGhpcy5wb3N0SW5pdGlhbGl6YXRpb24obmV3U2VydmVyKTtcclxuICAgIGNvbm5lY3Rpb24uaW5pdGlhbGl6ZWQoKTtcclxuICAgIHRoaXMuc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhuZXdTZXJ2ZXIpO1xyXG4gICAgcmV0dXJuIG5ld1NlcnZlcjtcclxuICB9XHJcblxyXG4gIGNhcHR1cmVTZXJ2ZXJFcnJvcnMoY2hpbGRQcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IHZvaWQge1xyXG4gICAgY2hpbGRQcm9jZXNzLm9uKCdlcnJvcicsIGVyciA9PiB0aGlzLmhhbmRsZVNwYXduRmFpbHVyZShlcnIpKTtcclxuICAgIGNoaWxkUHJvY2Vzcy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHRoaXMubG9nZ2VyLmRlYnVnKGBleGl0ZWQgY29kZSAke2NvZGV9YCkpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5zZXRFbmNvZGluZygndXRmOCcpO1xyXG4gICAgY2hpbGRQcm9jZXNzLnN0ZGVyci5vbignZGF0YScsIChjaHVuazogQnVmZmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yU3RyaW5nID0gY2h1bmsudG9TdHJpbmcoKTtcclxuICAgICAgdGhpcy5sb2dnZXIud2Fybignc3RkZXJyJywgZXJyb3JTdHJpbmcpO1xyXG4gICAgICAvLyBLZWVwIHRoZSBsYXN0IDUgbGluZXMgZm9yIHBhY2thZ2VzIHRvIHVzZSBpbiBtZXNzYWdlc1xyXG4gICAgICB0aGlzLnByb2Nlc3NTdGRFcnIgPSAodGhpcy5wcm9jZXNzU3RkRXJyICsgZXJyb3JTdHJpbmcpXHJcbiAgICAgICAgLnNwbGl0KCdcXG4nKVxyXG4gICAgICAgIC5zbGljZSgtNSlcclxuICAgICAgICAuam9pbignXFxuJyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZVNwYXduRmFpbHVyZShlcnI6IGFueSk6IHZvaWQge1xyXG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFxyXG4gICAgICBgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gbGFuZ3VhZ2Ugc2VydmVyIGZvciAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9IHVuYWJsZSB0byBzdGFydGAsXHJcbiAgICAgIHtcclxuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogZXJyLnRvU3RyaW5nKCksXHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlcyB0aGUgUlBDIGNvbm5lY3Rpb24gd2hpY2ggY2FuIGJlIGlwYywgc29ja2V0IG9yIHN0ZGlvXHJcbiAgY3JlYXRlUnBjQ29ubmVjdGlvbihwcm9jZXNzOiBjaGlsZF9wcm9jZXNzJENoaWxkUHJvY2Vzcyk6IHJwYy5Db25uZWN0aW9uIHtcclxuICAgIGxldCByZWFkZXIsIHdyaXRlcjtcclxuICAgIGNvbnN0IGNvbm5lY3Rpb25UeXBlID0gdGhpcy5nZXRDb25uZWN0aW9uVHlwZSgpO1xyXG4gICAgc3dpdGNoIChjb25uZWN0aW9uVHlwZSkge1xyXG4gICAgICBjYXNlICdpcGMnOlxyXG4gICAgICAgIHJlYWRlciA9IG5ldyBycGMuSVBDTWVzc2FnZVJlYWRlcihwcm9jZXNzKTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLklQQ01lc3NhZ2VXcml0ZXIocHJvY2Vzcyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3NvY2tldCc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5Tb2NrZXRNZXNzYWdlUmVhZGVyKHRoaXMuc29ja2V0KTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLlNvY2tldE1lc3NhZ2VXcml0ZXIodGhpcy5zb2NrZXQpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdzdGRpbyc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5TdHJlYW1NZXNzYWdlUmVhZGVyKHByb2Nlc3Muc3Rkb3V0KTtcclxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VXcml0ZXIocHJvY2Vzcy5zdGRpbik7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJwYy5jcmVhdGVNZXNzYWdlQ29ubmVjdGlvbihyZWFkZXIsIHdyaXRlciwge1xyXG4gICAgICBlcnJvcjogbSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IobSk7XHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXJ0IGFkYXB0ZXJzIHRoYXQgYXJlIG5vdCBzaGFyZWQgYmV0d2VlbiBzZXJ2ZXJzXHJcbiAgc3RhcnRFeGNsdXNpdmVBZGFwdGVycyhzZXJ2ZXI6IEFjdGl2ZVNlcnZlcik6IHZvaWQge1xyXG4gICAgQXBwbHlFZGl0QWRhcHRlci5hdHRhY2goc2VydmVyLmNvbm5lY3Rpb24pO1xyXG4gICAgTm90aWZpY2F0aW9uc0FkYXB0ZXIuYXR0YWNoKHNlcnZlci5jb25uZWN0aW9uLCB0aGlzLm5hbWUpO1xyXG5cclxuICAgIGlmIChEb2N1bWVudFN5bmNBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5kb2NTeW5jQWRhcHRlciA9IG5ldyBEb2N1bWVudFN5bmNBZGFwdGVyKHNlcnZlci5jb25uZWN0aW9uLCBzZXJ2ZXIuY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMsIGVkaXRvciA9PlxyXG4gICAgICAgIHRoaXMuc2hvdWxkU3luY0ZvckVkaXRvcihlZGl0b3IsIHNlcnZlci5wcm9qZWN0UGF0aCksXHJcbiAgICAgICk7XHJcbiAgICAgIHNlcnZlci5kaXNwb3NhYmxlLmFkZChzZXJ2ZXIuZG9jU3luY0FkYXB0ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlcnZlci5saW50ZXJQdXNoVjIgPSBuZXcgTGludGVyUHVzaFYyQWRhcHRlcihzZXJ2ZXIuY29ubmVjdGlvbik7XHJcbiAgICBpZiAodGhpcy5fbGludGVyRGVsZWdhdGUgIT0gbnVsbCkge1xyXG4gICAgICBzZXJ2ZXIubGludGVyUHVzaFYyLmF0dGFjaCh0aGlzLl9saW50ZXJEZWxlZ2F0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKFNpZ25hdHVyZUhlbHBBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlciA9IG5ldyBTaWduYXR1cmVIZWxwQWRhcHRlcihzZXJ2ZXIsIHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpKTtcclxuICAgICAgaWYgKHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaCh0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzaG91bGRTeW5jRm9yRWRpdG9yKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5pc0ZpbGVJblByb2plY3QoZWRpdG9yLCBwcm9qZWN0UGF0aCkgJiYgdGhpcy5zaG91bGRTdGFydEZvckVkaXRvcihlZGl0b3IpO1xyXG4gIH1cclxuXHJcbiAgaXNGaWxlSW5Qcm9qZWN0KGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGVkaXRvci5nZXRVUkkoKSB8fCAnJykuc3RhcnRzV2l0aChwcm9qZWN0UGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyBBdXRvY29tcGxldGUrIHZpYSBMUyBjb21wbGV0aW9uLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZUF1dG9jb21wbGV0ZSgpOiBhdG9tJEF1dG9jb21wbGV0ZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNlbGVjdG9yOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKVxyXG4gICAgICAgIC5tYXAoZyA9PiAnLicgKyBnKVxyXG4gICAgICAgIC5qb2luKCcsICcpLFxyXG4gICAgICBpbmNsdXNpb25Qcmlvcml0eTogMSxcclxuICAgICAgc3VnZ2VzdGlvblByaW9yaXR5OiAyLFxyXG4gICAgICBleGNsdWRlTG93ZXJQcmlvcml0eTogZmFsc2UsXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25zOiB0aGlzLmdldFN1Z2dlc3Rpb25zLmJpbmQodGhpcyksXHJcbiAgICAgIGdldFN1Z2dlc3Rpb25EZXRhaWxzT25TZWxlY3Q6IHRoaXMuZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdC5iaW5kKHRoaXMpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFN1Z2dlc3Rpb25zKHJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCk6IFByb21pc2U8QXJyYXk8YXRvbSRBdXRvY29tcGxldGVTdWdnZXN0aW9uPj4ge1xyXG4gICAgdGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3QgPSByZXF1ZXN0O1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIocmVxdWVzdC5lZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFBdXRvY29tcGxldGVBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmF1dG9Db21wbGV0ZSA9IHRoaXMuYXV0b0NvbXBsZXRlIHx8IG5ldyBBdXRvY29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5hdXRvQ29tcGxldGUuZ2V0U3VnZ2VzdGlvbnMoc2VydmVyLmNvbm5lY3Rpb24sIHJlcXVlc3QpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdChzdWdnZXN0aW9uOiBhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24pOiBQcm9taXNlPD9hdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+IHtcclxuICAgIGlmICh0aGlzLl9sYXN0QXV0b2NvbXBsZXRlUmVxdWVzdCA9PSBudWxsIHx8IHRoaXMuYXV0b0NvbXBsZXRlID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIodGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQXV0b2NvbXBsZXRlQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3QgIT0gbnVsbCAmJiB0aGlzLmF1dG9Db21wbGV0ZSAhPSBudWxsKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5jb21wbGV0ZVN1Z2dlc3Rpb24oc2VydmVyLmNvbm5lY3Rpb24sIHN1Z2dlc3Rpb24sIHRoaXMuX2xhc3RBdXRvY29tcGxldGVSZXF1ZXN0KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8vIERlZmluaXRpb25zIHZpYSBMUyBkb2N1bWVudEhpZ2hsaWdodCBhbmQgZ290b0RlZmluaXRpb24tLS0tLS0tLS0tLS1cclxuICBwcm92aWRlRGVmaW5pdGlvbnMoKTogYXRvbUlkZSREZWZpbml0aW9uUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICBwcmlvcml0eTogMjAsXHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBnZXREZWZpbml0aW9uOiB0aGlzLmdldERlZmluaXRpb24uYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXREZWZpbml0aW9uKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9hdG9tSWRlJERlZmluaXRpb25RdWVyeVJlc3VsdD4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhRGVmaW5pdGlvbkFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kZWZpbml0aW9ucyA9IHRoaXMuZGVmaW5pdGlvbnMgfHwgbmV3IERlZmluaXRpb25BZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9ucy5nZXREZWZpbml0aW9uKFxyXG4gICAgICBzZXJ2ZXIuY29ubmVjdGlvbixcclxuICAgICAgc2VydmVyLmNhcGFiaWxpdGllcyxcclxuICAgICAgdGhpcy5nZXRMYW5ndWFnZU5hbWUoKSxcclxuICAgICAgZWRpdG9yLFxyXG4gICAgICBwb2ludCxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBPdXRsaW5lIFZpZXcgdmlhIExTIGRvY3VtZW50U3ltYm9sLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZU91dGxpbmVzKCk6IGF0b21JZGUkT3V0bGluZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBnZXRPdXRsaW5lOiB0aGlzLmdldE91dGxpbmUuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRPdXRsaW5lKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogUHJvbWlzZTw/YXRvbUlkZSRPdXRsaW5lPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5vdXRsaW5lVmlldyA9IHRoaXMub3V0bGluZVZpZXcgfHwgbmV3IE91dGxpbmVWaWV3QWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMub3V0bGluZVZpZXcuZ2V0T3V0bGluZShzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yKTtcclxuICB9XHJcblxyXG4gIC8vIExpbnRlciBwdXNoIHYyIEFQSSB2aWEgTFMgcHVibGlzaERpYWdub3N0aWNzXHJcbiAgY29uc3VtZUxpbnRlclYyKHJlZ2lzdGVySW5kaWU6ICh7bmFtZTogc3RyaW5nfSkgPT4gbGludGVyJFYySW5kaWVEZWxlZ2F0ZSk6IHZvaWQge1xyXG4gICAgdGhpcy5fbGludGVyRGVsZWdhdGUgPSByZWdpc3RlckluZGllKHtuYW1lOiB0aGlzLm5hbWV9KTtcclxuICAgIGlmICh0aGlzLl9saW50ZXJEZWxlZ2F0ZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IHNlcnZlciBvZiB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldEFjdGl2ZVNlcnZlcnMoKSkge1xyXG4gICAgICBpZiAoc2VydmVyLmxpbnRlclB1c2hWMiAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLmxpbnRlclB1c2hWMi5hdHRhY2godGhpcy5fbGludGVyRGVsZWdhdGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBGaW5kIFJlZmVyZW5jZXMgdmlhIExTIGZpbmRSZWZlcmVuY2VzLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZUZpbmRSZWZlcmVuY2VzKCk6IGF0b21JZGUkRmluZFJlZmVyZW5jZXNQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKSA9PiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhlZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSksXHJcbiAgICAgIGZpbmRSZWZlcmVuY2VzOiB0aGlzLmdldFJlZmVyZW5jZXMuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRSZWZlcmVuY2VzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P2F0b21JZGUkRmluZFJlZmVyZW5jZXNSZXR1cm4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUZpbmRSZWZlcmVuY2VzQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmZpbmRSZWZlcmVuY2VzID0gdGhpcy5maW5kUmVmZXJlbmNlcyB8fCBuZXcgRmluZFJlZmVyZW5jZXNBZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5maW5kUmVmZXJlbmNlcy5nZXRSZWZlcmVuY2VzKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50LCBzZXJ2ZXIucHJvamVjdFBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGF0YXRpcCB2aWEgTFMgdGV4dERvY3VtZW50L2hvdmVyLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIGNvbnN1bWVEYXRhdGlwKHNlcnZpY2U6IGF0b21JZGUkRGF0YXRpcFNlcnZpY2UpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuYWRkKFxyXG4gICAgICBzZXJ2aWNlLmFkZFByb3ZpZGVyKHtcclxuICAgICAgICBwcm92aWRlck5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgICBwcmlvcml0eTogMSxcclxuICAgICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgICB2YWxpZEZvclNjb3BlOiAoc2NvcGVOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhzY29wZU5hbWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YXRpcDogdGhpcy5nZXREYXRhdGlwLmJpbmQodGhpcyksXHJcbiAgICAgIH0pLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldERhdGF0aXAoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/YXRvbUlkZSREYXRhdGlwPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFEYXRhdGlwQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGF0aXAgPSB0aGlzLmRhdGF0aXAgfHwgbmV3IERhdGF0aXBBZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhdGlwLmdldERhdGF0aXAoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvciwgcG9pbnQpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29kZSBGb3JtYXQgdmlhIExTIGZvcm1hdERvY3VtZW50ICYgZm9ybWF0RG9jdW1lbnRSYW5nZS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVDb2RlRm9ybWF0KCk6IGF0b21JZGUkUmFuZ2VDb2RlRm9ybWF0UHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBmb3JtYXRDb2RlOiB0aGlzLmdldENvZGVGb3JtYXQuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDb2RlRm9ybWF0KGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCByYW5nZTogYXRvbSRSYW5nZSk6IFByb21pc2U8QXJyYXk8YXRvbUlkZSRUZXh0RWRpdD4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KHNlcnZlci5jb25uZWN0aW9uLCBzZXJ2ZXIuY2FwYWJpbGl0aWVzLCBlZGl0b3IsIHJhbmdlKTtcclxuICB9XHJcblxyXG4gIHByb3ZpZGVDb2RlSGlnaGxpZ2h0KCk6IGF0b21JZGUkQ29kZUhpZ2hsaWdodFByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgaGlnaGxpZ2h0OiAoZWRpdG9yLCBwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENvZGVIaWdobGlnaHQoZWRpdG9yLCBwb3NpdGlvbik7XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q29kZUhpZ2hsaWdodChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9zaXRpb246IGF0b20kUG9pbnQpOiBQcm9taXNlPD9BcnJheTxhdG9tJFJhbmdlPj4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQ29kZUhpZ2hsaWdodEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIENvZGVIaWdobGlnaHRBZGFwdGVyLmhpZ2hsaWdodChzZXJ2ZXIuY29ubmVjdGlvbiwgc2VydmVyLmNhcGFiaWxpdGllcywgZWRpdG9yLCBwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcm92aWRlQ29kZUFjdGlvbnMoKTogYXRvbUlkZSRDb2RlQWN0aW9uUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBnZXRDb2RlQWN0aW9uczogKGVkaXRvciwgcmFuZ2UsIGRpYWdub3N0aWNzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29kZUFjdGlvbnMoZWRpdG9yLCByYW5nZSwgZGlhZ25vc3RpY3MpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENvZGVBY3Rpb25zKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCByYW5nZTogYXRvbSRSYW5nZSwgZGlhZ25vc3RpY3M6IEFycmF5PGF0b21JZGUkRGlhZ25vc3RpYz4pIHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVBY3Rpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlQWN0aW9uQWRhcHRlci5nZXRDb2RlQWN0aW9ucyhcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIsXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcmFuZ2UsXHJcbiAgICAgIGRpYWdub3N0aWNzLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN1bWVTaWduYXR1cmVIZWxwKHJlZ2lzdHJ5OiBhdG9tSWRlJFNpZ25hdHVyZUhlbHBSZWdpc3RyeSk6IElEaXNwb3NhYmxlIHtcclxuICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IHJlZ2lzdHJ5O1xyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRBY3RpdmVTZXJ2ZXJzKCkpIHtcclxuICAgICAgaWYgKHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaChyZWdpc3RyeSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IG51bGw7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN1bWVCdXN5U2lnbmFsKHNlcnZpY2U6IGF0b21JZGUkQnVzeVNpZ25hbFNlcnZpY2UpOiBJRGlzcG9zYWJsZSB7XHJcbiAgICB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlID0gc2VydmljZTtcclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiBkZWxldGUgdGhpcy5idXN5U2lnbmFsU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBgZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzYCBtZXNzYWdlIGZpbHRlcmluZywgb3ZlcnJpZGUgZm9yIGN1c3RvbSBsb2dpYy5cclxuICAgKiBAcGFyYW0gZmlsZVBhdGggcGF0aCBvZiBhIGZpbGUgdGhhdCBoYXMgY2hhbmdlZCBpbiB0aGUgcHJvamVjdCBwYXRoXHJcbiAgICogQHJldHVybiBmYWxzZSA9PiBtZXNzYWdlIHdpbGwgbm90IGJlIHNlbnQgdG8gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gICAqL1xyXG4gIGZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuIl19