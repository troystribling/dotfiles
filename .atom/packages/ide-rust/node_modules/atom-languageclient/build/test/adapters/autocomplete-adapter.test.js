var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _autocompleteAdapter = require('../../lib/adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _atom = require('atom');

var _chai = require('chai');

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('AutoCompleteAdapter', () => {
  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  const request = {
    editor: (0, _helpers.createFakeEditor)(),
    bufferPosition: new _atom.Point(123, 456),
    prefix: 'def',
    scopeDescriptor: 'some.scope'
  };

  const completionItems = [{
    label: 'label1',
    kind: ls.CompletionItemKind.Keyword,
    detail: 'description1',
    documentation: 'a very exciting keyword'
  }, {
    label: 'label2',
    kind: ls.CompletionItemKind.Field,
    detail: 'description2',
    documentation: 'a very exciting field'
  }, {
    label: 'label3',
    kind: ls.CompletionItemKind.Variable,
    detail: 'description3',
    documentation: 'a very exciting variable'
  }];

  describe('getSuggestions', () => {
    const fakeLanguageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    _sinon2.default.stub(fakeLanguageClient, 'completion').resolves(completionItems);

    it('gets AutoComplete suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const suggestions = await autoCompleteAdapter.getSuggestions(fakeLanguageClient, request);
      (0, _chai.expect)(suggestions.length).equals(3);
      (0, _chai.expect)(suggestions[0].text).equals('label1');
      (0, _chai.expect)(suggestions[1].description).equals('a very exciting field');
      (0, _chai.expect)(suggestions[2].type).equals('variable');
    });
  });

  describe('requestToTextDocumentPositionParams', () => {
    it('creates a TextDocumentPositionParams from an AutocompleteRequest', () => {
      const result = _autocompleteAdapter2.default.requestToTextDocumentPositionParams(request);
      (0, _chai.expect)(result.textDocument.uri).equals('file:///a/b/c/d.js');
      (0, _chai.expect)(result.position).deep.equals({ line: 123, character: 456 });
    });
  });

  describe('completionItemsToSuggestions', () => {
    it('converts LSP CompletionItem array to AutoComplete Suggestions array', () => {
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions(completionItems, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].text).equals('label1');
      (0, _chai.expect)(results[1].description).equals('a very exciting field');
      (0, _chai.expect)(results[2].type).equals('variable');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions(completionList, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].description).equals('a very exciting keyword');
      (0, _chai.expect)(results[1].text).equals('label2');
    });

    it('converts empty array into an empty AutoComplete Suggestions array', () => {
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions([], request);
      (0, _chai.expect)(results.length).equals(0);
    });
  });

  describe('completionItemToSuggestion', () => {
    it('converts LSP CompletionItem to AutoComplete Suggestion without textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'keyword',
        documentation: 'a truly useful keyword'
      };
      const result = _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, request);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.leftLabel).equals('keyword');
      (0, _chai.expect)(result.description).equals('a truly useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful keyword');
    });

    it('converts LSP CompletionItem to AutoComplete Suggestion with textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Variable,
        detail: 'number',
        documentation: 'a truly useful variable',
        textEdit: {
          range: {
            start: { line: 10, character: 20 },
            end: { line: 30, character: 40 }
          },
          newText: 'newText'
        }
      };
      const autocompleteRequest = {
        editor: (0, _helpers.createFakeEditor)(),
        bufferPosition: new _atom.Point(123, 456),
        prefix: 'def',
        scopeDescriptor: 'some.scope'
      };
      _sinon2.default.stub(autocompleteRequest.editor, 'getTextInBufferRange').returns('replacementPrefix');
      const result = _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, autocompleteRequest);
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('variable');
      (0, _chai.expect)(result.leftLabel).equals('number');
      (0, _chai.expect)(result.description).equals('a truly useful variable');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful variable');
      (0, _chai.expect)(result.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(result.text).equals('newText');
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(10, 20), new _atom.Point(30, 40))]);
    });
  });

  describe('basicCompletionItemToSuggestion', () => {
    it('converts LSP CompletionItem with insertText and filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'a very exciting keyword'
      };
      const result = _autocompleteAdapter2.default.basicCompletionItemToSuggestion(completionItem);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.leftLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('a very exciting keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a very exciting keyword');
    });

    it('converts LSP CompletionItem without insertText or filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        label: 'label',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'A very useful keyword'
      };
      const result = _autocompleteAdapter2.default.basicCompletionItemToSuggestion(completionItem);
      (0, _chai.expect)(result.text).equals('label');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.leftLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('A very useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('A very useful keyword');
    });
  });

  describe('applyTextEditToSuggestion', () => {
    const basicCompletionItem = {
      label: 'label',
      kind: ls.CompletionItemKind.Keyword,
      detail: 'detail',
      documentation: 'An incredible keyword'
    };

    it('does not do anything if there is no textEdit', () => {
      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(null, new _atom.TextEditor(), completionItem);
      (0, _chai.expect)(completionItem).deep.equals(basicCompletionItem);
    });

    it('applies changes from TextEdit to replacementPrefix and text', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 2 },
          end: { line: 3, character: 4 }
        },
        newText: 'newText'
      };
      const editor = new _atom.TextEditor();
      _sinon2.default.stub(editor, 'getTextInBufferRange').returns('replacementPrefix');

      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(textEdit, editor, completionItem);
      (0, _chai.expect)(completionItem.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(completionItem.text).equals('newText');
      (0, _chai.expect)(editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(1, 2), new _atom.Point(3, 4))]);
    });
  });

  describe('completionKindToSuggestionType', () => {
    it('converts LSP CompletionKinds to AutoComplete SuggestionTypes', () => {
      const variable = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Variable);
      const constructor = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Constructor);
      const module = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Module);
      (0, _chai.expect)(variable).equals('variable');
      (0, _chai.expect)(constructor).equals('function');
      (0, _chai.expect)(module).equals('module');
    });

    it('defaults to "value"', () => {
      const result = _autocompleteAdapter2.default.completionKindToSuggestionType(null);
      (0, _chai.expect)(result).equals('value');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImdsb2JhbCIsInNpbm9uIiwic2FuZGJveCIsImNyZWF0ZSIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJyZXF1ZXN0IiwiZWRpdG9yIiwiYnVmZmVyUG9zaXRpb24iLCJwcmVmaXgiLCJzY29wZURlc2NyaXB0b3IiLCJjb21wbGV0aW9uSXRlbXMiLCJsYWJlbCIsImtpbmQiLCJDb21wbGV0aW9uSXRlbUtpbmQiLCJLZXl3b3JkIiwiZGV0YWlsIiwiZG9jdW1lbnRhdGlvbiIsIkZpZWxkIiwiVmFyaWFibGUiLCJmYWtlTGFuZ3VhZ2VDbGllbnQiLCJMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24iLCJzdHViIiwicmVzb2x2ZXMiLCJpdCIsImF1dG9Db21wbGV0ZUFkYXB0ZXIiLCJzdWdnZXN0aW9ucyIsImdldFN1Z2dlc3Rpb25zIiwibGVuZ3RoIiwiZXF1YWxzIiwidGV4dCIsImRlc2NyaXB0aW9uIiwidHlwZSIsInJlc3VsdCIsInJlcXVlc3RUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zIiwidGV4dERvY3VtZW50IiwidXJpIiwicG9zaXRpb24iLCJkZWVwIiwibGluZSIsImNoYXJhY3RlciIsInJlc3VsdHMiLCJjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zIiwiY29tcGxldGlvbkxpc3QiLCJpdGVtcyIsImlzSW5jb21wbGV0ZSIsImNvbXBsZXRpb25JdGVtIiwiaW5zZXJ0VGV4dCIsImZpbHRlclRleHQiLCJjb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImRpc3BsYXlUZXh0IiwibGVmdExhYmVsIiwiZGVzY3JpcHRpb25NYXJrZG93biIsInRleHRFZGl0IiwicmFuZ2UiLCJzdGFydCIsImVuZCIsIm5ld1RleHQiLCJhdXRvY29tcGxldGVSZXF1ZXN0IiwicmV0dXJucyIsInJlcGxhY2VtZW50UHJlZml4IiwiZ2V0VGV4dEluQnVmZmVyUmFuZ2UiLCJjYWxsZWRPbmNlIiwiZ2V0Q2FsbCIsImFyZ3MiLCJiYXNpY0NvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uIiwiYmFzaWNDb21wbGV0aW9uSXRlbSIsImFwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24iLCJ2YXJpYWJsZSIsImNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZSIsImNvbnN0cnVjdG9yIiwiQ29uc3RydWN0b3IiLCJtb2R1bGUiLCJNb2R1bGUiXSwibWFwcGluZ3MiOiI7O0FBRUE7Ozs7QUFDQTs7SUFBWUEsRTs7QUFDWjs7OztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQUMsU0FBUyxxQkFBVCxFQUFnQyxNQUFNO0FBQ3BDQyxhQUFXLE1BQU07QUFDZkMsV0FBT0MsS0FBUCxHQUFlLGdCQUFNQyxPQUFOLENBQWNDLE1BQWQsRUFBZjtBQUNELEdBRkQ7QUFHQUMsWUFBVSxNQUFNO0FBQ2RKLFdBQU9DLEtBQVAsQ0FBYUksT0FBYjtBQUNELEdBRkQ7O0FBSUEsUUFBTUMsVUFBb0M7QUFDeENDLFlBQVEsZ0NBRGdDO0FBRXhDQyxvQkFBZ0IsZ0JBQVUsR0FBVixFQUFlLEdBQWYsQ0FGd0I7QUFHeENDLFlBQVEsS0FIZ0M7QUFJeENDLHFCQUFpQjtBQUp1QixHQUExQzs7QUFPQSxRQUFNQyxrQkFBa0IsQ0FDdEI7QUFDRUMsV0FBTyxRQURUO0FBRUVDLFVBQU1oQixHQUFHaUIsa0JBQUgsQ0FBc0JDLE9BRjlCO0FBR0VDLFlBQVEsY0FIVjtBQUlFQyxtQkFBZTtBQUpqQixHQURzQixFQU90QjtBQUNFTCxXQUFPLFFBRFQ7QUFFRUMsVUFBTWhCLEdBQUdpQixrQkFBSCxDQUFzQkksS0FGOUI7QUFHRUYsWUFBUSxjQUhWO0FBSUVDLG1CQUFlO0FBSmpCLEdBUHNCLEVBYXRCO0FBQ0VMLFdBQU8sUUFEVDtBQUVFQyxVQUFNaEIsR0FBR2lCLGtCQUFILENBQXNCSyxRQUY5QjtBQUdFSCxZQUFRLGNBSFY7QUFJRUMsbUJB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RDtBQUlELEdBZEQ7QUFlRCxDQS9ORCIsImZpbGUiOiJhdXRvY29tcGxldGUtYWRhcHRlci50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCBBdXRvQ29tcGxldGVBZGFwdGVyIGZyb20gJy4uLy4uL2xpYi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlcic7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4uLy4uL2xpYi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XHJcbmltcG9ydCB7UG9pbnQsIFJhbmdlLCBUZXh0RWRpdG9yfSBmcm9tICdhdG9tJztcclxuaW1wb3J0IHtleHBlY3R9IGZyb20gJ2NoYWknO1xyXG5pbXBvcnQge2NyZWF0ZVNweUNvbm5lY3Rpb24sIGNyZWF0ZUZha2VFZGl0b3J9IGZyb20gJy4uL2hlbHBlcnMuanMnO1xyXG5cclxuZGVzY3JpYmUoJ0F1dG9Db21wbGV0ZUFkYXB0ZXInLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBnbG9iYWwuc2lub24gPSBzaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xyXG4gIH0pO1xyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBnbG9iYWwuc2lub24ucmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QgPSB7XHJcbiAgICBlZGl0b3I6IGNyZWF0ZUZha2VFZGl0b3IoKSxcclxuICAgIGJ1ZmZlclBvc2l0aW9uOiBuZXcgUG9pbnQoMTIzLCA0NTYpLFxyXG4gICAgcHJlZml4OiAnZGVmJyxcclxuICAgIHNjb3BlRGVzY3JpcHRvcjogJ3NvbWUuc2NvcGUnLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNvbXBsZXRpb25JdGVtcyA9IFtcclxuICAgIHtcclxuICAgICAgbGFiZWw6ICdsYWJlbDEnLFxyXG4gICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZCxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24xJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGxhYmVsOiAnbGFiZWwyJyxcclxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLkZpZWxkLFxyXG4gICAgICBkZXRhaWw6ICdkZXNjcmlwdGlvbjInLFxyXG4gICAgICBkb2N1bWVudGF0aW9uOiAnYSB2ZXJ5IGV4Y2l0aW5nIGZpZWxkJyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGxhYmVsOiAnbGFiZWwzJyxcclxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLlZhcmlhYmxlLFxyXG4gICAgICBkZXRhaWw6ICdkZXNjcmlwdGlvbjMnLFxyXG4gICAgICBkb2N1bWVudGF0aW9uOiAnYSB2ZXJ5IGV4Y2l0aW5nIHZhcmlhYmxlJyxcclxuICAgIH0sXHJcbiAgXTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFN1Z2dlc3Rpb25zJywgKCkgPT4ge1xyXG4gICAgY29uc3QgZmFrZUxhbmd1YWdlQ2xpZW50ID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbihjcmVhdGVTcHlDb25uZWN0aW9uKCkpO1xyXG4gICAgc2lub24uc3R1YihmYWtlTGFuZ3VhZ2VDbGllbnQsICdjb21wbGV0aW9uJykucmVzb2x2ZXMoY29tcGxldGlvbkl0ZW1zKTtcclxuXHJcbiAgICBpdCgnZ2V0cyBBdXRvQ29tcGxldGUgc3VnZ2VzdGlvbnMgdmlhIExTUCBnaXZlbiBhbiBBdXRvQ29tcGxldGVSZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcclxuICAgICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSBhd2FpdCBhdXRvQ29tcGxldGVBZGFwdGVyLmdldFN1Z2dlc3Rpb25zKGZha2VMYW5ndWFnZUNsaWVudCwgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChzdWdnZXN0aW9ucy5sZW5ndGgpLmVxdWFscygzKTtcclxuICAgICAgZXhwZWN0KHN1Z2dlc3Rpb25zWzBdLnRleHQpLmVxdWFscygnbGFiZWwxJyk7XHJcbiAgICAgIGV4cGVjdChzdWdnZXN0aW9uc1sxXS5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcgZmllbGQnKTtcclxuICAgICAgZXhwZWN0KHN1Z2dlc3Rpb25zWzJdLnR5cGUpLmVxdWFscygndmFyaWFibGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncmVxdWVzdFRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnY3JlYXRlcyBhIFRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zIGZyb20gYW4gQXV0b2NvbXBsZXRlUmVxdWVzdCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5yZXF1ZXN0VG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhyZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0RG9jdW1lbnQudXJpKS5lcXVhbHMoJ2ZpbGU6Ly8vYS9iL2MvZC5qcycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogMTIzLCBjaGFyYWN0ZXI6IDQ1Nn0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uSXRlbSBhcnJheSB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbnMgYXJyYXknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoY29tcGxldGlvbkl0ZW1zLCByZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS5lcXVhbHMoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdLnRleHQpLmVxdWFscygnbGFiZWwxJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyBmaWVsZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1syXS50eXBlKS5lcXVhbHMoJ3ZhcmlhYmxlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25MaXN0IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkxpc3QgPSB7aXRlbXM6IGNvbXBsZXRpb25JdGVtcywgaXNJbmNvbXBsZXRlOiBmYWxzZX07XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoY29tcGxldGlvbkxpc3QsIHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygzKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uZGVzY3JpcHRpb24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMV0udGV4dCkuZXF1YWxzKCdsYWJlbDInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBlbXB0eSBhcnJheSBpbnRvIGFuIGVtcHR5IEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0cyA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhbXSwgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24gd2l0aG91dCB0ZXh0RWRpdCcsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW0gPSB7XHJcbiAgICAgICAgaW5zZXJ0VGV4dDogJ2luc2VydCcsXHJcbiAgICAgICAgbGFiZWw6ICdsYWJlbCcsXHJcbiAgICAgICAgZmlsdGVyVGV4dDogJ2ZpbHRlcicsXHJcbiAgICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXHJcbiAgICAgICAgZGV0YWlsOiAna2V5d29yZCcsXHJcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdHJ1bHkgdXNlZnVsIGtleXdvcmQnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtLCByZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2luc2VydCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVmdExhYmVsKS5lcXVhbHMoJ2tleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uIHdpdGggdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgICBpbnNlcnRUZXh0OiAnaW5zZXJ0JyxcclxuICAgICAgICBsYWJlbDogJ2xhYmVsJyxcclxuICAgICAgICBmaWx0ZXJUZXh0OiAnZmlsdGVyJyxcclxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUsXHJcbiAgICAgICAgZGV0YWlsOiAnbnVtYmVyJyxcclxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnYSB0cnVseSB1c2VmdWwgdmFyaWFibGUnLFxyXG4gICAgICAgIHRleHRFZGl0OiB7XHJcbiAgICAgICAgICByYW5nZToge1xyXG4gICAgICAgICAgICBzdGFydDoge2xpbmU6IDEwLCBjaGFyYWN0ZXI6IDIwfSxcclxuICAgICAgICAgICAgZW5kOiB7bGluZTogMzAsIGNoYXJhY3RlcjogNDB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG5ld1RleHQ6ICduZXdUZXh0JyxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBhdXRvY29tcGxldGVSZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QgPSB7XHJcbiAgICAgICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXHJcbiAgICAgICAgYnVmZmVyUG9zaXRpb246IG5ldyBQb2ludCgxMjMsIDQ1NiksXHJcbiAgICAgICAgcHJlZml4OiAnZGVmJyxcclxuICAgICAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcclxuICAgICAgfTtcclxuICAgICAgc2lub24uc3R1YihhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvciwgJ2dldFRleHRJbkJ1ZmZlclJhbmdlJykucmV0dXJucygncmVwbGFjZW1lbnRQcmVmaXgnKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgYXV0b2NvbXBsZXRlUmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50eXBlKS5lcXVhbHMoJ3ZhcmlhYmxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVmdExhYmVsKS5lcXVhbHMoJ251bWJlcicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIHZhcmlhYmxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCB2YXJpYWJsZScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlcGxhY2VtZW50UHJlZml4KS5lcXVhbHMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCduZXdUZXh0Jyk7XHJcbiAgICAgIGV4cGVjdChhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5jYWxsZWRPbmNlKS5lcXVhbHModHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5nZXRDYWxsKDApLmFyZ3MpLmRlZXAuZXF1YWxzKFtcclxuICAgICAgICBuZXcgUmFuZ2UobmV3IFBvaW50KDEwLCAyMCksIG5ldyBQb2ludCgzMCwgNDApKSxcclxuICAgICAgXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Jhc2ljQ29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHdpdGggaW5zZXJ0VGV4dCBhbmQgZmlsdGVyVGV4dCB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICAgIGRldGFpbDogJ2RldGFpbCcsXHJcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5iYXNpY0NvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2luc2VydCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVmdExhYmVsKS5lcXVhbHMoJ2RldGFpbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcga2V5d29yZCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uSXRlbSB3aXRob3V0IGluc2VydFRleHQgb3IgZmlsdGVyVGV4dCB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICAgIGRldGFpbDogJ2RldGFpbCcsXHJcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ0EgdmVyeSB1c2VmdWwga2V5d29yZCcsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuYmFzaWNDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCdsYWJlbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVmdExhYmVsKS5lcXVhbHMoJ2RldGFpbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ0EgdmVyeSB1c2VmdWwga2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnQSB2ZXJ5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2FwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBjb25zdCBiYXNpY0NvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgbGFiZWw6ICdsYWJlbCcsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICBkZXRhaWw6ICdkZXRhaWwnLFxyXG4gICAgICBkb2N1bWVudGF0aW9uOiAnQW4gaW5jcmVkaWJsZSBrZXl3b3JkJyxcclxuICAgIH07XHJcblxyXG4gICAgaXQoJ2RvZXMgbm90IGRvIGFueXRoaW5nIGlmIHRoZXJlIGlzIG5vIHRleHRFZGl0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbSA9IHsuLi5iYXNpY0NvbXBsZXRpb25JdGVtfTtcclxuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5hcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKG51bGwsIG5ldyBUZXh0RWRpdG9yKCksIGNvbXBsZXRpb25JdGVtKTtcclxuICAgICAgZXhwZWN0KGNvbXBsZXRpb25JdGVtKS5kZWVwLmVxdWFscyhiYXNpY0NvbXBsZXRpb25JdGVtKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdhcHBsaWVzIGNoYW5nZXMgZnJvbSBUZXh0RWRpdCB0byByZXBsYWNlbWVudFByZWZpeCBhbmQgdGV4dCcsICgpID0+IHtcclxuICAgICAgY29uc3QgdGV4dEVkaXQgPSB7XHJcbiAgICAgICAgcmFuZ2U6IHtcclxuICAgICAgICAgIHN0YXJ0OiB7bGluZTogMSwgY2hhcmFjdGVyOiAyfSxcclxuICAgICAgICAgIGVuZDoge2xpbmU6IDMsIGNoYXJhY3RlcjogNH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBuZXdUZXh0OiAnbmV3VGV4dCcsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IGVkaXRvciA9IG5ldyBUZXh0RWRpdG9yKCk7XHJcbiAgICAgIHNpbm9uLnN0dWIoZWRpdG9yLCAnZ2V0VGV4dEluQnVmZmVyUmFuZ2UnKS5yZXR1cm5zKCdyZXBsYWNlbWVudFByZWZpeCcpO1xyXG5cclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW0gPSB7Li4uYmFzaWNDb21wbGV0aW9uSXRlbX07XHJcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbih0ZXh0RWRpdCwgZWRpdG9yLCBjb21wbGV0aW9uSXRlbSk7XHJcbiAgICAgIGV4cGVjdChjb21wbGV0aW9uSXRlbS5yZXBsYWNlbWVudFByZWZpeCkuZXF1YWxzKCdyZXBsYWNlbWVudFByZWZpeCcpO1xyXG4gICAgICBleHBlY3QoY29tcGxldGlvbkl0ZW0udGV4dCkuZXF1YWxzKCduZXdUZXh0Jyk7XHJcbiAgICAgIGV4cGVjdChlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UuY2FsbGVkT25jZSkuZXF1YWxzKHRydWUpO1xyXG4gICAgICBleHBlY3QoZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmdldENhbGwoMCkuYXJncykuZGVlcC5lcXVhbHMoW25ldyBSYW5nZShuZXcgUG9pbnQoMSwgMiksIG5ldyBQb2ludCgzLCA0KSldKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uS2luZHMgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb25UeXBlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgdmFyaWFibGUgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUpO1xyXG4gICAgICBjb25zdCBjb25zdHJ1Y3RvciA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGxzLkNvbXBsZXRpb25JdGVtS2luZC5Db25zdHJ1Y3Rvcik7XHJcbiAgICAgIGNvbnN0IG1vZHVsZSA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGxzLkNvbXBsZXRpb25JdGVtS2luZC5Nb2R1bGUpO1xyXG4gICAgICBleHBlY3QodmFyaWFibGUpLmVxdWFscygndmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KGNvbnN0cnVjdG9yKS5lcXVhbHMoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdChtb2R1bGUpLmVxdWFscygnbW9kdWxlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGVmYXVsdHMgdG8gXCJ2YWx1ZVwiJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShudWxsKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkuZXF1YWxzKCd2YWx1ZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=