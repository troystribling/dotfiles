var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _autocompleteAdapter = require('../../lib/adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

require('../../lib/server-manager.js');

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _atom = require('atom');

var _chai = require('chai');

var _helpers = require('../helpers.js');

var _child_process = require('child_process');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('AutoCompleteAdapter', () => {
  function createActiveServerSpy() {
    return {
      capabilities: { completionProvider: {} },
      connection: new ls.LanguageClientConnection((0, _helpers.createSpyConnection)()),
      disposable: new _atom.CompositeDisposable(),
      process: new _child_process.ChildProcess(),
      projectPath: '/'
    };
  }

  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  const request = {
    editor: (0, _helpers.createFakeEditor)(),
    bufferPosition: new _atom.Point(123, 456),
    prefix: 'def',
    scopeDescriptor: 'some.scope',
    activatedManually: true
  };

  const completionItems = [{
    label: 'label1',
    kind: ls.CompletionItemKind.Keyword,
    detail: 'description1',
    documentation: 'a very exciting keyword',
    sortText: 'z'
  }, {
    label: 'label2',
    kind: ls.CompletionItemKind.Field,
    detail: 'description2',
    documentation: 'a very exciting field',
    sortText: 'a'
  }, {
    label: 'label3',
    kind: ls.CompletionItemKind.Variable,
    detail: 'description3',
    documentation: 'a very exciting variable'
  }];

  describe('getSuggestions', () => {
    const server = createActiveServerSpy();
    _sinon2.default.stub(server.connection, 'completion').resolves(completionItems);

    it('gets AutoComplete suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = await autoCompleteAdapter.getSuggestions(server, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].text).equals('label2');
      (0, _chai.expect)(results[1].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2].type).equals('keyword');
    });
  });

  describe('completeSuggestion', () => {
    const partialItems = [{
      label: 'label1',
      kind: ls.CompletionItemKind.Keyword,
      sortText: 'z'
    }, {
      label: 'label2',
      kind: ls.CompletionItemKind.Field,
      sortText: 'a'
    }, {
      label: 'label3',
      kind: ls.CompletionItemKind.Variable
    }];

    const server = createActiveServerSpy();
    _sinon2.default.stub(server.connection, 'completion').resolves(partialItems);
    _sinon2.default.stub(server.connection, 'completionItemResolve').resolves({
      label: 'label3',
      kind: ls.CompletionItemKind.Variable,
      detail: 'description3',
      documentation: 'a very exciting variable'
    });

    it('resolves suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = await autoCompleteAdapter.getSuggestions(server, request);
      (0, _chai.expect)(results[2].description).equals(undefined);
      const resolvedItem = await autoCompleteAdapter.completeSuggestion(server, results[2], request);
      (0, _chai.expect)(resolvedItem && resolvedItem.description).equals('a very exciting variable');
    });
  });

  describe('createCompletionParams', () => {
    it('creates CompletionParams from an AutocompleteRequest with no trigger', () => {
      const result = _autocompleteAdapter2.default.createCompletionParams(request, null);
      (0, _chai.expect)(result.textDocument.uri).equals('file:///a/b/c/d.js');
      (0, _chai.expect)(result.position).deep.equals({ line: 123, character: 456 });
      (0, _chai.expect)(result.context && result.context.triggerKind === ls.CompletionTriggerKind.Invoked);
      (0, _chai.expect)(result.context && result.context.triggerCharacter === undefined);
    });

    it('creates CompletionParams from an AutocompleteRequest with a trigger', () => {
      const result = _autocompleteAdapter2.default.createCompletionParams(request, '.');
      (0, _chai.expect)(result.textDocument.uri).equals('file:///a/b/c/d.js');
      (0, _chai.expect)(result.position).deep.equals({ line: 123, character: 456 });
      (0, _chai.expect)(result.context && result.context.triggerKind === ls.CompletionTriggerKind.TriggerCharacter);
      (0, _chai.expect)(result.context && result.context.triggerCharacter === '.');
    });
  });

  describe('completionItemsToSuggestions', () => {
    it('converts LSP CompletionItem array to AutoComplete Suggestions array', () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionItems, request));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].text).equals('label2');
      (0, _chai.expect)(results[1][0].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2][0].type).equals('keyword');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionList, request));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].description).equals('a very exciting field');
      (0, _chai.expect)(results[1][0].text).equals('label3');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array using the onDidConvertCompletionItem', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions(completionList, request, (c, a, r) => {
        a.text = c.label + ' ok';
        a.displayText = r.scopeDescriptor;
      }));
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0][0].displayText).equals('some.scope');
      (0, _chai.expect)(results[1][0].text).equals('label3 ok');
    });

    it('converts empty array into an empty AutoComplete Suggestions array', () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = Array.from(autoCompleteAdapter.completionItemsToSuggestions([], request));
      (0, _chai.expect)(results.length).equals(0);
    });
  });

  describe('completionItemToSuggestion', () => {
    it('converts LSP CompletionItem to AutoComplete Suggestion without textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'keyword',
        documentation: 'a truly useful keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, result, request);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('keyword');
      (0, _chai.expect)(result.description).equals('a truly useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful keyword');
    });

    it('converts LSP CompletionItem to AutoComplete Suggestion with textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Variable,
        detail: 'number',
        documentation: 'a truly useful variable',
        textEdit: {
          range: {
            start: { line: 10, character: 20 },
            end: { line: 30, character: 40 }
          },
          newText: 'newText'
        }
      };
      const autocompleteRequest = {
        editor: (0, _helpers.createFakeEditor)(),
        bufferPosition: new _atom.Point(123, 456),
        prefix: 'def',
        scopeDescriptor: 'some.scope'
      };
      _sinon2.default.stub(autocompleteRequest.editor, 'getTextInBufferRange').returns('replacementPrefix');
      const result = {};
      _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, result, autocompleteRequest);
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('variable');
      (0, _chai.expect)(result.rightLabel).equals('number');
      (0, _chai.expect)(result.description).equals('a truly useful variable');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful variable');
      (0, _chai.expect)(result.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(result.text).equals('newText');
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(10, 20), new _atom.Point(30, 40))]);
    });
  });

  describe('basicCompletionItemToSuggestion', () => {
    it('converts LSP CompletionItem with insertText and filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'a very exciting keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.applyCompletionItemToSuggestion(completionItem, result);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('a very exciting keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a very exciting keyword');
    });

    it('converts LSP CompletionItem without insertText or filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        label: 'label',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'A very useful keyword'
      };
      const result = {};
      _autocompleteAdapter2.default.applyCompletionItemToSuggestion(completionItem, result);
      (0, _chai.expect)(result.text).equals('label');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('A very useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('A very useful keyword');
    });
  });

  describe('applyTextEditToSuggestion', () => {
    const basicCompletionItem = {
      label: 'label',
      kind: ls.CompletionItemKind.Keyword,
      detail: 'detail',
      documentation: 'An incredible keyword'
    };

    it('does not do anything if there is no textEdit', () => {
      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(null, new _atom.TextEditor(), completionItem);
      (0, _chai.expect)(completionItem).deep.equals(basicCompletionItem);
    });

    it('applies changes from TextEdit to replacementPrefix and text', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 2 },
          end: { line: 3, character: 4 }
        },
        newText: 'newText'
      };
      const editor = new _atom.TextEditor();
      _sinon2.default.stub(editor, 'getTextInBufferRange').returns('replacementPrefix');

      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(textEdit, editor, completionItem);
      (0, _chai.expect)(completionItem.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(completionItem.text).equals('newText');
      (0, _chai.expect)(editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(1, 2), new _atom.Point(3, 4))]);
    });
  });

  describe('completionKindToSuggestionType', () => {
    it('converts LSP CompletionKinds to AutoComplete SuggestionTypes', () => {
      const variable = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Variable);
      const constructor = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Constructor);
      const module = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Module);
      (0, _chai.expect)(variable).equals('variable');
      (0, _chai.expect)(constructor).equals('function');
      (0, _chai.expect)(module).equals('module');
    });

    it('defaults to "value"', () => {
      const result = _autocompleteAdapter2.default.completionKindToSuggestionType(null);
      (0, _chai.expect)(result).equals('value');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiY3JlYXRlQWN0aXZlU2VydmVyU3B5IiwiY2FwYWJpbGl0aWVzIiwiY29tcGxldGlvblByb3ZpZGVyIiwiY29ubmVjdGlvbiIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsImRpc3Bvc2FibGUiLCJwcm9jZXNzIiwicHJvamVjdFBhdGgiLCJiZWZvcmVFYWNoIiwiZ2xvYmFsIiwic2lub24iLCJzYW5kYm94IiwiY3JlYXRlIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsInJlcXVlc3QiLCJlZGl0b3IiLCJidWZmZXJQb3NpdGlvbiIsInByZWZpeCIsInNjb3BlRGVzY3JpcHRvciIsImFjdGl2YXRlZE1hbnVhbGx5IiwiY29tcGxldGlvbkl0ZW1zIiwibGFiZWwiLCJraW5kIiwiQ29tcGxldGlvbkl0ZW1LaW5kIiwiS2V5d29yZCIsImRldGFpbCIsImRvY3VtZW50YXRpb24iLCJzb3J0VGV4dCIsIkZpZWxkIiwiVmFyaWFibGUiLCJzZXJ2ZXIiLCJzdHViIiwicmVzb2x2ZXMiLCJpdCIsImF1dG9Db21wbGV0ZUFkYXB0ZXIiLCJyZXN1bHRzIiwiZ2V0U3VnZ2VzdGlvbnMiLCJsZW5ndGgiLCJlcXVhbHMiLCJ0ZXh0IiwiZGVzY3JpcHRpb24iLCJ0eXBlIiwicGFydGlhbEl0ZW1zIiwidW5kZWZpbmVkIiwicmVzb2x2ZWRJdGVtIiwiY29tcGxldGVTdWdnZXN0aW9uIiwicmVzdWx0IiwiY3JlYXRlQ29tcGxldGlvblBhcmFtcyIsInRleHREb2N1bWVudCIsInVyaSIsInBvc2l0aW9uIiwiZGVlcCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJjb250ZXh0IiwidHJpZ2dlcktpbmQiLCJDb21wbGV0aW9uVHJpZ2dlcktpbmQiLCJJbnZva2VkIiwidHJpZ2dlckNoYXJhY3RlciIsIlRyaWdnZXJDaGFyYWN0ZXIiLCJBcnJheSIsImZyb20iLCJjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zIiwiY29tcGxldGlvbkxpc3QiLCJpdGVtcyIsImlzSW5jb21wbGV0ZSIsImMiLCJhIiwiciIsImRpc3BsYXlUZXh0IiwiY29tcGxldGlvbkl0ZW0iLCJpbnNlcnRUZXh0IiwiZmlsdGVyVGV4dCIsImNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uIiwicmlnaHRMYWJlbCIsImRlc2NyaXB0aW9uTWFya2Rvd24iLCJ0ZXh0RWRpdCIsInJhbmdlIiwic3RhcnQiLCJlbmQiLCJuZXdUZXh0IiwiYXV0b2NvbXBsZXRlUmVxdWVzdCIsInJldHVybnMiLCJyZXBsYWNlbWVudFByZWZpeCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiY2FsbGVkT25jZSIsImdldENhbGwiLCJhcmdzIiwiYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImJhc2ljQ29tcGxldGlvbkl0ZW0iLCJhcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uIiwidmFyaWFibGUiLCJjb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUiLCJjb25zdHJ1Y3RvciIsIkNvbnN0cnVjdG9yIiwibW9kdWxlIiwiTW9kdWxlIl0sIm1hcHBpbmdzIjoiOztBQUVBOzs7O0FBQ0E7O0FBQ0E7O0lBQVlBLEU7O0FBQ1o7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUFDLFNBQVMscUJBQVQsRUFBZ0MsTUFBTTtBQUNwQyxXQUFTQyxxQkFBVCxHQUFpQztBQUMvQixXQUFPO0FBQ0xDLG9CQUFjLEVBQUNDLG9CQUFvQixFQUFyQixFQURUO0FBRUxDLGtCQUFZLElBQUlMLEdBQUdNLHdCQUFQLENBQWdDLG1DQUFoQyxDQUZQO0FBR0xDLGtCQUFZLCtCQUhQO0FBSUxDLGVBQVMsaUNBSko7QUFLTEMsbUJBQWE7QUFMUixLQUFQO0FBT0Q7O0FBRURDLGFBQVcsTUFBTTtBQUNmQyxXQUFPQyxLQUFQLEdBQWUsZ0JBQU1DLE9BQU4sQ0FBY0MsTUFBZCxFQUFmO0FBQ0QsR0FGRDtB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c0IsUUFBdEI7QUFDRCxLQVBEOztBQVNBTCxPQUFHLHFCQUFILEVBQTBCLE1BQU07QUFDOUIsWUFBTWEsU0FBUyw4QkFBb0I4Qyw4QkFBcEIsQ0FBbUQsSUFBbkQsQ0FBZjtBQUNBLHdCQUFPOUMsTUFBUCxFQUFlUixNQUFmLENBQXNCLE9BQXRCO0FBQ0QsS0FIRDtBQUlELEdBZEQ7QUFlRCxDQTdTRCIsImZpbGUiOiJhdXRvY29tcGxldGUtYWRhcHRlci50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcblxuaW1wb3J0IEF1dG9Db21wbGV0ZUFkYXB0ZXIgZnJvbSAnLi4vLi4vbGliL2FkYXB0ZXJzL2F1dG9jb21wbGV0ZS1hZGFwdGVyJztcbmltcG9ydCB7dHlwZSBBY3RpdmVTZXJ2ZXJ9IGZyb20gJy4uLy4uL2xpYi9zZXJ2ZXItbWFuYWdlci5qcyc7XG5pbXBvcnQgKiBhcyBscyBmcm9tICcuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgUG9pbnQsIFJhbmdlLCBUZXh0RWRpdG9yfSBmcm9tICdhdG9tJztcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcbmltcG9ydCB7Y3JlYXRlU3B5Q29ubmVjdGlvbiwgY3JlYXRlRmFrZUVkaXRvcn0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5pbXBvcnQge0NoaWxkUHJvY2Vzc30gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5cbmRlc2NyaWJlKCdBdXRvQ29tcGxldGVBZGFwdGVyJywgKCkgPT4ge1xuICBmdW5jdGlvbiBjcmVhdGVBY3RpdmVTZXJ2ZXJTcHkoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNhcGFiaWxpdGllczoge2NvbXBsZXRpb25Qcm92aWRlcjogeyB9fSxcbiAgICAgIGNvbm5lY3Rpb246IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKSxcbiAgICAgIGRpc3Bvc2FibGU6IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXG4gICAgICBwcm9jZXNzOiBuZXcgQ2hpbGRQcm9jZXNzKCksXG4gICAgICBwcm9qZWN0UGF0aDogJy8nLFxuICAgIH07XG4gIH1cblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBnbG9iYWwuc2lub24gPSBzaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xuICB9KTtcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBnbG9iYWwuc2lub24ucmVzdG9yZSgpO1xuICB9KTtcblxuICBjb25zdCByZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QgPSB7XG4gICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXG4gICAgYnVmZmVyUG9zaXRpb246IG5ldyBQb2ludCgxMjMsIDQ1NiksXG4gICAgcHJlZml4OiAnZGVmJyxcbiAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcbiAgICBhY3RpdmF0ZWRNYW51YWxseTogdHJ1ZSxcbiAgfTtcblxuICBjb25zdCBjb21wbGV0aW9uSXRlbXMgPSBbXG4gICAge1xuICAgICAgbGFiZWw6ICdsYWJlbDEnLFxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXG4gICAgICBkZXRhaWw6ICdkZXNjcmlwdGlvbjEnLFxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyxcbiAgICAgIHNvcnRUZXh0OiAneicsXG4gICAgfSxcbiAgICB7XG4gICAgICBsYWJlbDogJ2xhYmVsMicsXG4gICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuRmllbGQsXG4gICAgICBkZXRhaWw6ICdkZXNjcmlwdGlvbjInLFxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBmaWVsZCcsXG4gICAgICBzb3J0VGV4dDogJ2EnLFxuICAgIH0sXG4gICAge1xuICAgICAgbGFiZWw6ICdsYWJlbDMnLFxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLlZhcmlhYmxlLFxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24zJyxcbiAgICAgIGRvY3VtZW50YXRpb246ICdhIHZlcnkgZXhjaXRpbmcgdmFyaWFibGUnLFxuICAgIH0sXG4gIF07XG5cbiAgZGVzY3JpYmUoJ2dldFN1Z2dlc3Rpb25zJywgKCkgPT4ge1xuICAgIGNvbnN0IHNlcnZlcjogQWN0aXZlU2VydmVyID0gY3JlYXRlQWN0aXZlU2VydmVyU3B5KCk7XG4gICAgc2lub24uc3R1YihzZXJ2ZXIuY29ubmVjdGlvbiwgJ2NvbXBsZXRpb24nKS5yZXNvbHZlcyhjb21wbGV0aW9uSXRlbXMpO1xuXG4gICAgaXQoJ2dldHMgQXV0b0NvbXBsZXRlIHN1Z2dlc3Rpb25zIHZpYSBMU1AgZ2l2ZW4gYW4gQXV0b0NvbXBsZXRlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGF1dG9Db21wbGV0ZUFkYXB0ZXIgPSBuZXcgQXV0b0NvbXBsZXRlQWRhcHRlcigpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGF1dG9Db21wbGV0ZUFkYXB0ZXIuZ2V0U3VnZ2VzdGlvbnMoc2VydmVyLCByZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0udGV4dCkuZXF1YWxzKCdsYWJlbDInKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0udHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb21wbGV0ZVN1Z2dlc3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgcGFydGlhbEl0ZW1zID0gW1xuICAgICAge1xuICAgICAgICBsYWJlbDogJ2xhYmVsMScsXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxuICAgICAgICBzb3J0VGV4dDogJ3onLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdsYWJlbDInLFxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuRmllbGQsXG4gICAgICAgIHNvcnRUZXh0OiAnYScsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ2xhYmVsMycsXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGNvbnN0IHNlcnZlcjogQWN0aXZlU2VydmVyID0gY3JlYXRlQWN0aXZlU2VydmVyU3B5KCk7XG4gICAgc2lub24uc3R1YihzZXJ2ZXIuY29ubmVjdGlvbiwgJ2NvbXBsZXRpb24nKS5yZXNvbHZlcyhwYXJ0aWFsSXRlbXMpO1xuICAgIHNpbm9uLnN0dWIoc2VydmVyLmNvbm5lY3Rpb24sICdjb21wbGV0aW9uSXRlbVJlc29sdmUnKS5yZXNvbHZlcyh7XG4gICAgICBsYWJlbDogJ2xhYmVsMycsXG4gICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUsXG4gICAgICBkZXRhaWw6ICdkZXNjcmlwdGlvbjMnLFxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScsXG4gICAgfSk7XG5cbiAgICBpdCgncmVzb2x2ZXMgc3VnZ2VzdGlvbnMgdmlhIExTUCBnaXZlbiBhbiBBdXRvQ29tcGxldGVSZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XG4gICAgICBjb25zdCByZXN1bHRzOiBBcnJheTxhdG9tJEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb24+ID0gYXdhaXQgYXV0b0NvbXBsZXRlQWRhcHRlci5nZXRTdWdnZXN0aW9ucyhzZXJ2ZXIsIHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0uZGVzY3JpcHRpb24pLmVxdWFscyh1bmRlZmluZWQpO1xuICAgICAgY29uc3QgcmVzb2x2ZWRJdGVtID0gYXdhaXQgYXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0ZVN1Z2dlc3Rpb24oc2VydmVyLCByZXN1bHRzWzJdLCByZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChyZXNvbHZlZEl0ZW0gJiYgcmVzb2x2ZWRJdGVtLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlQ29tcGxldGlvblBhcmFtcycsICgpID0+IHtcbiAgICBpdCgnY3JlYXRlcyBDb21wbGV0aW9uUGFyYW1zIGZyb20gYW4gQXV0b2NvbXBsZXRlUmVxdWVzdCB3aXRoIG5vIHRyaWdnZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNyZWF0ZUNvbXBsZXRpb25QYXJhbXMocmVxdWVzdCwgbnVsbCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLmpzJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogMTIzLCBjaGFyYWN0ZXI6IDQ1Nn0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250ZXh0ICYmIHJlc3VsdC5jb250ZXh0LnRyaWdnZXJLaW5kID09PSBscy5Db21wbGV0aW9uVHJpZ2dlcktpbmQuSW52b2tlZCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbnRleHQgJiYgcmVzdWx0LmNvbnRleHQudHJpZ2dlckNoYXJhY3RlciA9PT0gdW5kZWZpbmVkKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIENvbXBsZXRpb25QYXJhbXMgZnJvbSBhbiBBdXRvY29tcGxldGVSZXF1ZXN0IHdpdGggYSB0cmlnZ2VyJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jcmVhdGVDb21wbGV0aW9uUGFyYW1zKHJlcXVlc3QsICcuJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLmpzJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogMTIzLCBjaGFyYWN0ZXI6IDQ1Nn0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250ZXh0ICYmIHJlc3VsdC5jb250ZXh0LnRyaWdnZXJLaW5kID09PSBscy5Db21wbGV0aW9uVHJpZ2dlcktpbmQuVHJpZ2dlckNoYXJhY3Rlcik7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbnRleHQgJiYgcmVzdWx0LmNvbnRleHQudHJpZ2dlckNoYXJhY3RlciA9PT0gJy4nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uSXRlbSBhcnJheSB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbnMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhjb21wbGV0aW9uSXRlbXMsIHJlcXVlc3QpKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF1bMF0udGV4dCkuZXF1YWxzKCdsYWJlbDInKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdWzBdLmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMl1bMF0udHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25MaXN0IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25MaXN0ID0ge2l0ZW1zOiBjb21wbGV0aW9uSXRlbXMsIGlzSW5jb21wbGV0ZTogZmFsc2V9O1xuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XG4gICAgICBjb25zdCByZXN1bHRzID0gQXJyYXkuZnJvbShhdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoY29tcGxldGlvbkxpc3QsIHJlcXVlc3QpKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF1bMF0uZGVzY3JpcHRpb24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGZpZWxkJyk7XG4gICAgICBleHBlY3QocmVzdWx0c1sxXVswXS50ZXh0KS5lcXVhbHMoJ2xhYmVsMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uTGlzdCB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbnMgYXJyYXkgdXNpbmcgdGhlIG9uRGlkQ29udmVydENvbXBsZXRpb25JdGVtJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcGxldGlvbkxpc3QgPSB7aXRlbXM6IGNvbXBsZXRpb25JdGVtcywgaXNJbmNvbXBsZXRlOiBmYWxzZX07XG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhjb21wbGV0aW9uTGlzdCwgcmVxdWVzdCwgKGMsIGEsIHIpID0+IHtcbiAgICAgICAgYS50ZXh0ID0gYy5sYWJlbCArICcgb2snO1xuICAgICAgICBhLmRpc3BsYXlUZXh0ID0gci5zY29wZURlc2NyaXB0b3I7XG4gICAgICB9KSk7XG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygzKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdWzBdLmRpc3BsYXlUZXh0KS5lcXVhbHMoJ3NvbWUuc2NvcGUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdWzBdLnRleHQpLmVxdWFscygnbGFiZWwzIG9rJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnY29udmVydHMgZW1wdHkgYXJyYXkgaW50byBhbiBlbXB0eSBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbnMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhdXRvQ29tcGxldGVBZGFwdGVyID0gbmV3IEF1dG9Db21wbGV0ZUFkYXB0ZXIoKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBcnJheS5mcm9tKGF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucyhbXSwgcmVxdWVzdCkpO1xuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS5lcXVhbHMoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbicsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uIHdpdGhvdXQgdGV4dEVkaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbSA9IHtcbiAgICAgICAgaW5zZXJ0VGV4dDogJ2luc2VydCcsXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxuICAgICAgICBmaWx0ZXJUZXh0OiAnZmlsdGVyJyxcbiAgICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXG4gICAgICAgIGRldGFpbDogJ2tleXdvcmQnLFxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnYSB0cnVseSB1c2VmdWwga2V5d29yZCcsXG4gICAgICB9O1xuICAgICAgY29uc3QgcmVzdWx0ID0geyB9O1xuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVzdWx0LCByZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCdpbnNlcnQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJpZ2h0TGFiZWwpLmVxdWFscygna2V5d29yZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnYSB0cnVseSB1c2VmdWwga2V5d29yZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uSXRlbSB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbiB3aXRoIHRleHRFZGl0JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xuICAgICAgICBpbnNlcnRUZXh0OiAnaW5zZXJ0JyxcbiAgICAgICAgbGFiZWw6ICdsYWJlbCcsXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUsXG4gICAgICAgIGRldGFpbDogJ251bWJlcicsXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdhIHRydWx5IHVzZWZ1bCB2YXJpYWJsZScsXG4gICAgICAgIHRleHRFZGl0OiB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMTAsIGNoYXJhY3RlcjogMjB9LFxuICAgICAgICAgICAgZW5kOiB7bGluZTogMzAsIGNoYXJhY3RlcjogNDB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbmV3VGV4dDogJ25ld1RleHQnLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGF1dG9jb21wbGV0ZVJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCA9IHtcbiAgICAgICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXG4gICAgICAgIGJ1ZmZlclBvc2l0aW9uOiBuZXcgUG9pbnQoMTIzLCA0NTYpLFxuICAgICAgICBwcmVmaXg6ICdkZWYnLFxuICAgICAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcbiAgICAgIH07XG4gICAgICBzaW5vbi5zdHViKGF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yLCAnZ2V0VGV4dEluQnVmZmVyUmFuZ2UnKS5yZXR1cm5zKCdyZXBsYWNlbWVudFByZWZpeCcpO1xuICAgICAgY29uc3QgcmVzdWx0ID0geyB9O1xuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVzdWx0LCBhdXRvY29tcGxldGVSZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCd2YXJpYWJsZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yaWdodExhYmVsKS5lcXVhbHMoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCB2YXJpYWJsZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbk1hcmtkb3duKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIHZhcmlhYmxlJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlcGxhY2VtZW50UHJlZml4KS5lcXVhbHMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRleHQpLmVxdWFscygnbmV3VGV4dCcpO1xuICAgICAgZXhwZWN0KGF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmNhbGxlZE9uY2UpLmVxdWFscyh0cnVlKTtcbiAgICAgIGV4cGVjdChhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5nZXRDYWxsKDApLmFyZ3MpLmRlZXAuZXF1YWxzKFtcbiAgICAgICAgbmV3IFJhbmdlKG5ldyBQb2ludCgxMCwgMjApLCBuZXcgUG9pbnQoMzAsIDQwKSksXG4gICAgICBdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Jhc2ljQ29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIExTUCBDb21wbGV0aW9uSXRlbSB3aXRoIGluc2VydFRleHQgYW5kIGZpbHRlclRleHQgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbTogbHMuQ29tcGxldGlvbkl0ZW0gPSB7XG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxuICAgICAgICBsYWJlbDogJ2xhYmVsJyxcbiAgICAgICAgZmlsdGVyVGV4dDogJ2ZpbHRlcicsXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxuICAgICAgICBkZXRhaWw6ICdkZXRhaWwnLFxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHsgfTtcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVzdWx0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCdpbnNlcnQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzcGxheVRleHQpLmVxdWFscygnbGFiZWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJpZ2h0TGFiZWwpLmVxdWFscygnZGV0YWlsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gd2l0aG91dCBpbnNlcnRUZXh0IG9yIGZpbHRlclRleHQgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbTogbHMuQ29tcGxldGlvbkl0ZW0gPSB7XG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZCxcbiAgICAgICAgZGV0YWlsOiAnZGV0YWlsJyxcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ0EgdmVyeSB1c2VmdWwga2V5d29yZCcsXG4gICAgICB9O1xuICAgICAgY29uc3QgcmVzdWx0ID0geyB9O1xuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5hcHBseUNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtLCByZXN1bHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnR5cGUpLmVxdWFscygna2V5d29yZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yaWdodExhYmVsKS5lcXVhbHMoJ2RldGFpbCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdBIHZlcnkgdXNlZnVsIGtleXdvcmQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdBIHZlcnkgdXNlZnVsIGtleXdvcmQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgYmFzaWNDb21wbGV0aW9uSXRlbTogbHMuQ29tcGxldGlvbkl0ZW0gPSB7XG4gICAgICBsYWJlbDogJ2xhYmVsJyxcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxuICAgICAgZGV0YWlsOiAnZGV0YWlsJyxcbiAgICAgIGRvY3VtZW50YXRpb246ICdBbiBpbmNyZWRpYmxlIGtleXdvcmQnLFxuICAgIH07XG5cbiAgICBpdCgnZG9lcyBub3QgZG8gYW55dGhpbmcgaWYgdGhlcmUgaXMgbm8gdGV4dEVkaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbSA9IHsuLi5iYXNpY0NvbXBsZXRpb25JdGVtfTtcbiAgICAgIEF1dG9Db21wbGV0ZUFkYXB0ZXIuYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbihudWxsLCBuZXcgVGV4dEVkaXRvcigpLCBjb21wbGV0aW9uSXRlbSk7XG4gICAgICBleHBlY3QoY29tcGxldGlvbkl0ZW0pLmRlZXAuZXF1YWxzKGJhc2ljQ29tcGxldGlvbkl0ZW0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2FwcGxpZXMgY2hhbmdlcyBmcm9tIFRleHRFZGl0IHRvIHJlcGxhY2VtZW50UHJlZml4IGFuZCB0ZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dEVkaXQgPSB7XG4gICAgICAgIHJhbmdlOiB7XG4gICAgICAgICAgc3RhcnQ6IHtsaW5lOiAxLCBjaGFyYWN0ZXI6IDJ9LFxuICAgICAgICAgIGVuZDoge2xpbmU6IDMsIGNoYXJhY3RlcjogNH0sXG4gICAgICAgIH0sXG4gICAgICAgIG5ld1RleHQ6ICduZXdUZXh0JyxcbiAgICAgIH07XG4gICAgICBjb25zdCBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvcigpO1xuICAgICAgc2lub24uc3R1YihlZGl0b3IsICdnZXRUZXh0SW5CdWZmZXJSYW5nZScpLnJldHVybnMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XG5cbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtID0gey4uLmJhc2ljQ29tcGxldGlvbkl0ZW19O1xuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5hcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKHRleHRFZGl0LCBlZGl0b3IsIGNvbXBsZXRpb25JdGVtKTtcbiAgICAgIGV4cGVjdChjb21wbGV0aW9uSXRlbS5yZXBsYWNlbWVudFByZWZpeCkuZXF1YWxzKCdyZXBsYWNlbWVudFByZWZpeCcpO1xuICAgICAgZXhwZWN0KGNvbXBsZXRpb25JdGVtLnRleHQpLmVxdWFscygnbmV3VGV4dCcpO1xuICAgICAgZXhwZWN0KGVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5jYWxsZWRPbmNlKS5lcXVhbHModHJ1ZSk7XG4gICAgICBleHBlY3QoZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlLmdldENhbGwoMCkuYXJncykuZGVlcC5lcXVhbHMoW25ldyBSYW5nZShuZXcgUG9pbnQoMSwgMiksIG5ldyBQb2ludCgzLCA0KSldKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZScsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25LaW5kcyB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvblR5cGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFyaWFibGUgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShscy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGUpO1xuICAgICAgY29uc3QgY29uc3RydWN0b3IgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShscy5Db21wbGV0aW9uSXRlbUtpbmQuQ29uc3RydWN0b3IpO1xuICAgICAgY29uc3QgbW9kdWxlID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUobHMuQ29tcGxldGlvbkl0ZW1LaW5kLk1vZHVsZSk7XG4gICAgICBleHBlY3QodmFyaWFibGUpLmVxdWFscygndmFyaWFibGUnKTtcbiAgICAgIGV4cGVjdChjb25zdHJ1Y3RvcikuZXF1YWxzKCdmdW5jdGlvbicpO1xuICAgICAgZXhwZWN0KG1vZHVsZSkuZXF1YWxzKCdtb2R1bGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWZhdWx0cyB0byBcInZhbHVlXCInLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25LaW5kVG9TdWdnZXN0aW9uVHlwZShudWxsKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLmVxdWFscygndmFsdWUnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==