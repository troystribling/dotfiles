var _assert = require('assert');

var _assert2 = _interopRequireDefault(_assert);

var _atom = require('atom');

var _chai = require('chai');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _codeFormatAdapter = require('../../lib/adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

describe('CodeFormatAdapter', () => {
  let fakeEditor;
  let connection;
  let range;

  beforeEach(() => {
    connection = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    fakeEditor = (0, _helpers.createFakeEditor)();
    range = new _atom.Range([0, 0], [100, 100]);
  });

  describe('canAdapt', () => {
    it('returns true if range formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({ documentRangeFormattingProvider: true });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns true if document formatting is supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({ documentFormattingProvider: true });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns false it no formatting supported', () => {
      const result = _codeFormatAdapter2.default.canAdapt({});
      (0, _chai.expect)(result).to.be.false;
    });
  });

  describe('format', () => {
    it('prefers range formatting if available', _asyncToGenerator(function* () {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, { documentRangeFormattingProvider: true, documentFormattingProvider: true }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.true;
      (0, _chai.expect)(docStub.called).to.be.false;
    }));

    it('falls back to document formatting if range formatting not available', _asyncToGenerator(function* () {
      const rangeStub = _sinon2.default.spy(connection, 'documentRangeFormatting');
      const docStub = _sinon2.default.spy(connection, 'documentFormatting');
      _codeFormatAdapter2.default.format(connection, { documentFormattingProvider: true }, fakeEditor, range);
      (0, _chai.expect)(rangeStub.called).to.be.false;
      (0, _chai.expect)(docStub.called).to.be.true;
    }));

    it('throws if neither range or document formatting are supported', _asyncToGenerator(function* () {
      (0, _chai.expect)(function () {
        return _codeFormatAdapter2.default.format(connection, {}, fakeEditor, range);
      }).to.throw();
    }));
  });

  describe('formatDocument', () => {
    it('converts the results from the connection', _asyncToGenerator(function* () {
      _sinon2.default.stub(connection, 'documentFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = yield _codeFormatAdapter2.default.formatDocument(connection, fakeEditor);
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    }));
  });

  describe('createDocumentFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentFormattingParams(fakeEditor);

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('formatRange', () => {
    it('converts the results from the connection', _asyncToGenerator(function* () {
      _sinon2.default.stub(connection, 'documentRangeFormatting').resolves([{
        range: {
          start: { line: 0, character: 1 },
          end: { line: 0, character: 2 }
        },
        newText: 'abc'
      }, {
        range: {
          start: { line: 5, character: 10 },
          end: { line: 15, character: 20 }
        },
        newText: 'def'
      }]);
      const actual = yield _codeFormatAdapter2.default.formatRange(connection, fakeEditor, new _atom.Range([0, 0], [1, 1]));
      (0, _chai.expect)(actual.length).to.equal(2);
      (0, _chai.expect)(actual[0].newText).to.equal('abc');
      (0, _chai.expect)(actual[1].oldRange.start.row).to.equal(5);
      (0, _chai.expect)(actual[1].oldRange.start.column).to.equal(10);
      (0, _chai.expect)(actual[1].oldRange.end.row).to.equal(15);
      (0, _chai.expect)(actual[1].oldRange.end.column).to.equal(20);
      (0, _chai.expect)(actual[1].newText).to.equal('def');
    }));
  });

  describe('createDocumentRangeFormattingParams', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(1);
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(false);

      const actual = _codeFormatAdapter2.default.createDocumentRangeFormattingParams(fakeEditor, new _atom.Range([1, 0], [2, 3]));

      (0, _chai.expect)(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
      (0, _chai.expect)(actual.range).to.eql({ start: { line: 1, character: 0 },
        end: { line: 2, character: 3 } });
      (0, _chai.expect)(actual.options.tabSize).to.equal(1);
      (0, _chai.expect)(actual.options.insertSpaces).to.equal(false);
    });
  });

  describe('getFormatOptions', () => {
    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getTabLength').returns(17);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.tabSize).to.equal(17);
    });

    it('returns the tab size from the editor', () => {
      _sinon2.default.stub(fakeEditor, 'getSoftTabs').returns(true);
      const options = _codeFormatAdapter2.default.getFormatOptions(fakeEditor);
      (0, _chai.expect)(options.insertSpaces).to.be.true;
    });
  });

  describe('convertLsTextEdit', () => {
    it('returns oldRange and newText from a textEdit', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 0 },
          end: { line: 2, character: 3 }
        },
        newText: 'abc-def'
      };
      const actual = _codeFormatAdapter2.default.convertLsTextEdit(textEdit);
      (0, _chai.expect)(actual.oldRange).to.eql(new _atom.Range([1, 0], [2, 3]));
      (0, _chai.expect)(actual.newText).to.equal('abc-def');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlci50ZXN0LmpzIl0sIm5hbWVzIjpbImxzIiwiZGVzY3JpYmUiLCJmYWtlRWRpdG9yIiwiY29ubmVjdGlvbiIsInJhbmdlIiwiYmVmb3JlRWFjaCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsIml0IiwicmVzdWx0IiwiY2FuQWRhcHQiLCJkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyIiwidG8iLCJiZSIsInRydWUiLCJkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlciIsImZhbHNlIiwicmFuZ2VTdHViIiwic3B5IiwiZG9jU3R1YiIsImZvcm1hdCIsImNhbGxlZCIsInRocm93Iiwic3R1YiIsInJlc29sdmVzIiwic3RhcnQiLCJsaW5lIiwiY2hhcmFjdGVyIiwiZW5kIiwibmV3VGV4dCIsImFjdHVhbCIsImZvcm1hdERvY3VtZW50IiwibGVuZ3RoIiwiZXF1YWwiLCJvbGRSYW5nZSIsInJvdyIsImNvbHVtbiIsInJldHVybnMiLCJjcmVhdGVEb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMiLCJ0ZXh0RG9jdW1lbnQiLCJlcWwiLCJ1cmkiLCJvcHRpb25zIiwidGFiU2l6ZSIsImluc2VydFNwYWNlcyIsImZvcm1hdFJhbmdlIiwiY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMiLCJnZXRGb3JtYXRPcHRpb25zIiwidGV4dEVkaXQiLCJjb252ZXJ0THNUZXh0RWRpdCJdLCJtYXBwaW5ncyI6IkFBRUE7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBOztJQUFZQSxFOztBQUNaOzs7O0FBQ0E7Ozs7Ozs7O0FBRUFDLFNBQVMsbUJBQVQsRUFBOEIsTUFBTTtBQUNsQyxNQUFJQyxVQUFKO0FBQ0EsTUFBSUMsVUFBSjtBQUNBLE1BQUlDLEtBQUo7O0FBRUFDLGFBQVcsTUFBTTtBQUNmRixpQkFBYSxJQUFJSCxHQUFHTSx3QkFBUCxDQUFnQyxtQ0FBaEMsQ0FBYjtB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XG5cbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcbmltcG9ydCB7UG9pbnQsIFJhbmdlfSBmcm9tICdhdG9tJztcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgKiBhcyBscyBmcm9tICcuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xuaW1wb3J0IENvZGVGb3JtYXRBZGFwdGVyIGZyb20gJy4uLy4uL2xpYi9hZGFwdGVycy9jb2RlLWZvcm1hdC1hZGFwdGVyJztcbmltcG9ydCB7Y3JlYXRlU3B5Q29ubmVjdGlvbiwgY3JlYXRlRmFrZUVkaXRvcn0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5cbmRlc2NyaWJlKCdDb2RlRm9ybWF0QWRhcHRlcicsICgpID0+IHtcbiAgbGV0IGZha2VFZGl0b3I7XG4gIGxldCBjb25uZWN0aW9uO1xuICBsZXQgcmFuZ2U7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcbiAgICBmYWtlRWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcigpO1xuICAgIHJhbmdlID0gbmV3IFJhbmdlKFswLCAwXSwgWzEwMCwxMDBdKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbkFkYXB0JywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHRydWUgaWYgcmFuZ2UgZm9ybWF0dGluZyBpcyBzdXBwb3J0ZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdCh7IGRvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBkb2N1bWVudCBmb3JtYXR0aW5nIGlzIHN1cHBvcnRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IENvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHsgZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgZmFsc2UgaXQgbm8gZm9ybWF0dGluZyBzdXBwb3J0ZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBDb2RlRm9ybWF0QWRhcHRlci5jYW5BZGFwdCh7IH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb3JtYXQnLCAoKSA9PiB7XG4gICAgaXQoJ3ByZWZlcnMgcmFuZ2UgZm9ybWF0dGluZyBpZiBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByYW5nZVN0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nJyk7XG4gICAgICBjb25zdCBkb2NTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudEZvcm1hdHRpbmcnKTtcbiAgICAgIENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdChjb25uZWN0aW9uLCB7IGRvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsIGRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlIH0sIGZha2VFZGl0b3IsIHJhbmdlKTtcbiAgICAgIGV4cGVjdChyYW5nZVN0dWIuY2FsbGVkKS50by5iZS50cnVlO1xuICAgICAgZXhwZWN0KGRvY1N0dWIuY2FsbGVkKS50by5iZS5mYWxzZTtcbiAgICB9KTtcblxuICAgIGl0KCdmYWxscyBiYWNrIHRvIGRvY3VtZW50IGZvcm1hdHRpbmcgaWYgcmFuZ2UgZm9ybWF0dGluZyBub3QgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmFuZ2VTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudFJhbmdlRm9ybWF0dGluZycpO1xuICAgICAgY29uc3QgZG9jU3R1YiA9IHNpbm9uLnNweShjb25uZWN0aW9uLCAnZG9jdW1lbnRGb3JtYXR0aW5nJyk7XG4gICAgICBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoY29ubmVjdGlvbiwgeyBkb2N1bWVudEZvcm1hdHRpbmdQcm92aWRlcjogdHJ1ZSB9LCBmYWtlRWRpdG9yLCByYW5nZSk7XG4gICAgICBleHBlY3QocmFuZ2VTdHViLmNhbGxlZCkudG8uYmUuZmFsc2U7XG4gICAgICBleHBlY3QoZG9jU3R1Yi5jYWxsZWQpLnRvLmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgndGhyb3dzIGlmIG5laXRoZXIgcmFuZ2Ugb3IgZG9jdW1lbnQgZm9ybWF0dGluZyBhcmUgc3VwcG9ydGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdChjb25uZWN0aW9uLCB7IH0sIGZha2VFZGl0b3IsIHJhbmdlKSkudG8udGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Zvcm1hdERvY3VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyB0aGUgcmVzdWx0cyBmcm9tIHRoZSBjb25uZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc2lub24uc3R1Yihjb25uZWN0aW9uLCAnZG9jdW1lbnRGb3JtYXR0aW5nJykucmVzb2x2ZXMoW1xuICAgICAgICB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMCwgY2hhcmFjdGVyOiAxfSxcbiAgICAgICAgICAgIGVuZDoge2xpbmU6IDAsIGNoYXJhY3RlcjogMn0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdUZXh0OiAnYWJjJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogNSwgY2hhcmFjdGVyOiAxMH0sXG4gICAgICAgICAgICBlbmQ6IHtsaW5lOiAxNSwgY2hhcmFjdGVyOiAyMH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdUZXh0OiAnZGVmJ1xuICAgICAgICB9XG4gICAgICBdKTtcbiAgICAgIGNvbnN0IGFjdHVhbCA9IGF3YWl0IENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdERvY3VtZW50KGNvbm5lY3Rpb24sIGZha2VFZGl0b3IpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5sZW5ndGgpLnRvLmVxdWFsKDIpO1xuICAgICAgZXhwZWN0KGFjdHVhbFswXS5uZXdUZXh0KS50by5lcXVhbCgnYWJjJyk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LnJvdykudG8uZXF1YWwoNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LmNvbHVtbikudG8uZXF1YWwoMTApO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQucm93KS50by5lcXVhbCgxNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLmVuZC5jb2x1bW4pLnRvLmVxdWFsKDIwKTtcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ubmV3VGV4dCkudG8uZXF1YWwoJ2RlZicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlRG9jdW1lbnRGb3JtYXR0aW5nUGFyYW1zJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHRoZSB0YWIgc2l6ZSBmcm9tIHRoZSBlZGl0b3InLCAoKSA9PiB7XG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRQYXRoJykucmV0dXJucygnL2EvYi9jL2QudHh0Jyk7XG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRUYWJMZW5ndGgnKS5yZXR1cm5zKDEpO1xuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0U29mdFRhYnMnKS5yZXR1cm5zKGZhbHNlKTtcblxuICAgICAgY29uc3QgYWN0dWFsID0gQ29kZUZvcm1hdEFkYXB0ZXIuY3JlYXRlRG9jdW1lbnRGb3JtYXR0aW5nUGFyYW1zKGZha2VFZGl0b3IpO1xuXG4gICAgICBleHBlY3QoYWN0dWFsLnRleHREb2N1bWVudCkudG8uZXFsKHsgdXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcgfSk7XG4gICAgICBleHBlY3QoYWN0dWFsLm9wdGlvbnMudGFiU2l6ZSkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3QoYWN0dWFsLm9wdGlvbnMuaW5zZXJ0U3BhY2VzKS50by5lcXVhbChmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb3JtYXRSYW5nZScsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgdGhlIHJlc3VsdHMgZnJvbSB0aGUgY29ubmVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHNpbm9uLnN0dWIoY29ubmVjdGlvbiwgJ2RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nJykucmVzb2x2ZXMoW1xuICAgICAgICB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMCwgY2hhcmFjdGVyOiAxfSxcbiAgICAgICAgICAgIGVuZDoge2xpbmU6IDAsIGNoYXJhY3RlcjogMn0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdUZXh0OiAnYWJjJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogNSwgY2hhcmFjdGVyOiAxMH0sXG4gICAgICAgICAgICBlbmQ6IHtsaW5lOiAxNSwgY2hhcmFjdGVyOiAyMH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdUZXh0OiAnZGVmJ1xuICAgICAgICB9XG4gICAgICBdKTtcbiAgICAgIGNvbnN0IGFjdHVhbCA9IGF3YWl0IENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdFJhbmdlKGNvbm5lY3Rpb24sIGZha2VFZGl0b3IsIG5ldyBSYW5nZShbMCwgMF0sIFsxLCAxXSkpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5sZW5ndGgpLnRvLmVxdWFsKDIpO1xuICAgICAgZXhwZWN0KGFjdHVhbFswXS5uZXdUZXh0KS50by5lcXVhbCgnYWJjJyk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LnJvdykudG8uZXF1YWwoNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LmNvbHVtbikudG8uZXF1YWwoMTApO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQucm93KS50by5lcXVhbCgxNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLmVuZC5jb2x1bW4pLnRvLmVxdWFsKDIwKTtcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ubmV3VGV4dCkudG8uZXF1YWwoJ2RlZicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgdGhlIHRhYiBzaXplIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFBhdGgnKS5yZXR1cm5zKCcvYS9iL2MvZC50eHQnKTtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMSk7XG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRTb2Z0VGFicycpLnJldHVybnMoZmFsc2UpO1xuXG4gICAgICBjb25zdCBhY3R1YWwgPSBDb2RlRm9ybWF0QWRhcHRlclxuICAgICAgICAuY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMoZmFrZUVkaXRvciwgbmV3IFJhbmdlKFsxLCAwXSwgWzIsIDNdKSk7XG5cbiAgICAgIGV4cGVjdChhY3R1YWwudGV4dERvY3VtZW50KS50by5lcWwoeyB1cmk6ICdmaWxlOi8vL2EvYi9jL2QudHh0JyB9KTtcbiAgICAgIGV4cGVjdChhY3R1YWwucmFuZ2UpLnRvLmVxbCh7IHN0YXJ0OiB7IGxpbmU6IDEsIGNoYXJhY3RlcjogMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHsgbGluZTogMiwgY2hhcmFjdGVyOiAzIH19KTtcbiAgICAgIGV4cGVjdChhY3R1YWwub3B0aW9ucy50YWJTaXplKS50by5lcXVhbCgxKTtcbiAgICAgIGV4cGVjdChhY3R1YWwub3B0aW9ucy5pbnNlcnRTcGFjZXMpLnRvLmVxdWFsKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEZvcm1hdE9wdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgdGhlIHRhYiBzaXplIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMTcpO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IENvZGVGb3JtYXRBZGFwdGVyLmdldEZvcm1hdE9wdGlvbnMoZmFrZUVkaXRvcik7XG4gICAgICBleHBlY3Qob3B0aW9ucy50YWJTaXplKS50by5lcXVhbCgxNyk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyB0aGUgdGFiIHNpemUgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0U29mdFRhYnMnKS5yZXR1cm5zKHRydWUpO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IENvZGVGb3JtYXRBZGFwdGVyLmdldEZvcm1hdE9wdGlvbnMoZmFrZUVkaXRvcik7XG4gICAgICBleHBlY3Qob3B0aW9ucy5pbnNlcnRTcGFjZXMpLnRvLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb252ZXJ0THNUZXh0RWRpdCcsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyBvbGRSYW5nZSBhbmQgbmV3VGV4dCBmcm9tIGEgdGV4dEVkaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0RWRpdCA9IHtcbiAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICBzdGFydDogeyBsaW5lOiAxLCBjaGFyYWN0ZXI6IDAgfSxcbiAgICAgICAgICBlbmQ6IHsgbGluZTogMiwgY2hhcmFjdGVyOiAzIH1cbiAgICAgICAgfSxcbiAgICAgICAgbmV3VGV4dDogJ2FiYy1kZWYnXG4gICAgICB9O1xuICAgICAgY29uc3QgYWN0dWFsID0gQ29kZUZvcm1hdEFkYXB0ZXIuY29udmVydExzVGV4dEVkaXQodGV4dEVkaXQpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5vbGRSYW5nZSkudG8uZXFsKG5ldyBSYW5nZShbMSwgMF0sIFsyLCAzXSkpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5uZXdUZXh0KS50by5lcXVhbCgnYWJjLWRlZicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19