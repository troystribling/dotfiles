var _outlineViewAdapter = require('../../lib/adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _chai = require('chai');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('OutlineViewAdapter', () => {
  const createLocation = (a, b, c, d) => ({
    uri: '',
    range: { start: { line: a, character: b }, end: { line: c, character: d } }
  });

  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  describe('canAdapt', () => {
    it('returns true if documentSymbolProvider is supported', () => {
      const result = _outlineViewAdapter2.default.canAdapt({ documentSymbolProvider: true });
      (0, _chai.expect)(result).to.be.true;
    });

    it('returns false if documentSymbolProvider not supported', () => {
      const result = _outlineViewAdapter2.default.canAdapt({});
      (0, _chai.expect)(result).to.be.false;
    });
  });

  describe('createOutlineTrees', () => {
    it('creates an empty array given an empty array', () => {
      const result = _outlineViewAdapter2.default.createOutlineTrees([]);
      (0, _chai.expect)(result).to.deep.equal([]);
    });

    it('creates a single converted root item from a single source item', () => {
      const sourceItem = { kind: ls.SymbolKind.Namespace, name: 'R', location: createLocation(5, 6, 7, 8) };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      const result = _outlineViewAdapter2.default.createOutlineTrees([sourceItem]);
      (0, _chai.expect)(result).to.deep.equal([expected]);
    });

    it('creates an empty root container with a single source item when containerName missing', () => {
      const sourceItem = {
        kind: ls.SymbolKind.Class,
        name: 'Program',
        location: createLocation(1, 2, 3, 4)
      };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      sourceItem.containerName = 'missing';
      const result = _outlineViewAdapter2.default.createOutlineTrees([sourceItem]);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].representativeName).to.equal('missing');
      (0, _chai.expect)(result[0].startPosition.row).to.equal(0);
      (0, _chai.expect)(result[0].startPosition.column).to.equal(0);
      (0, _chai.expect)(result[0].children).to.deep.equal([expected]);
    });

    it('creates an empty root container with a single source item when containerName is missing and matches own name', () => {
      const sourceItem = {
        kind: ls.SymbolKind.Class,
        name: 'simple',
        location: createLocation(1, 2, 3, 4)
      };
      const expected = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      sourceItem.containerName = 'simple';
      const result = _outlineViewAdapter2.default.createOutlineTrees([sourceItem]);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].representativeName).to.equal('simple');
      (0, _chai.expect)(result[0].startPosition.row).to.equal(0);
      (0, _chai.expect)(result[0].startPosition.column).to.equal(0);
      (0, _chai.expect)(result[0].children).to.deep.equal([expected]);
    });

    it('creates a simple named hierarchy', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'java.com', location: createLocation(1, 0, 10, 0) }, { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(2, 0, 7, 0), containerName: 'java.com' }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(4, 0, 5, 0), containerName: 'Program' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      (0, _chai.expect)(result[0].children.length).to.equal(1);
      (0, _chai.expect)(result[0].children[0].representativeName).to.equal('Program');
      (0, _chai.expect)(result[0].children[0].children.length).to.equal(1);
      (0, _chai.expect)(result[0].children[0].children[0].representativeName).to.equal('main');
    });

    it('retains duplicate named items', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) }, { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(2);
      (0, _chai.expect)(result[0].representativeName).to.equal('duplicate');
      (0, _chai.expect)(result[1].representativeName).to.equal('duplicate');
    });

    it('disambiguates containerName based on range', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) }, { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) }, { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result[1].children.length).to.equal(1);
      (0, _chai.expect)(result[1].children[0].representativeName).to.equal('main');
    });

    it("does not become it's own parent", () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 10, 0) }, {
        kind: ls.SymbolKind.Namespace,
        name: 'duplicate',
        location: createLocation(6, 0, 7, 0),
        containerName: 'duplicate'
      }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      const r = result;
      (0, _chai.expect)(r[0].endPosition.row).to.equal(10);
      (0, _chai.expect)(r[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].endPosition.row).to.equal(7);
    });

    it('parents to the innnermost named container', () => {
      const sourceItems = [{ kind: ls.SymbolKind.Namespace, name: 'turtles', location: createLocation(1, 0, 10, 0) }, {
        kind: ls.SymbolKind.Namespace,
        name: 'turtles',
        location: createLocation(4, 0, 8, 0),
        containerName: 'turtles'
      }, { kind: ls.SymbolKind.Class, name: 'disc', location: createLocation(4, 0, 5, 0), containerName: 'turtles' }];
      const result = _outlineViewAdapter2.default.createOutlineTrees(sourceItems);
      (0, _chai.expect)(result.length).to.equal(1);
      const r = result;
      (0, _chai.expect)(r[0].endPosition.row).to.equal(10);
      (0, _chai.expect)(r[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].endPosition.row).to.equal(8);
      (0, _chai.expect)(r[0].children[0].children.length).to.equal(1);
      (0, _chai.expect)(r[0].children[0].children[0].endPosition.row).to.equal(5);
    });
  });

  describe('symbolToOutline', () => {
    it('converts an individual item', () => {
      const sourceItem = { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(1, 2, 3, 4) };
      const result = _outlineViewAdapter2.default.symbolToOutline(sourceItem);
      (0, _chai.expect)(result.icon).to.equal('type-class');
      (0, _chai.expect)(result.representativeName).to.equal('Program');
      (0, _chai.expect)(result.children).to.deep.equal([]);
      const r = result;
      (0, _chai.expect)(r.tokenizedText[0].kind).to.equal('type');
      (0, _chai.expect)(r.tokenizedText[0].value).to.equal('Program');
      (0, _chai.expect)(r.startPosition.row).to.equal(1);
      (0, _chai.expect)(r.startPosition.column).to.equal(2);
      (0, _chai.expect)(r.endPosition.row).to.equal(3);
      (0, _chai.expect)(r.endPosition.column).to.equal(4);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvb3V0bGluZS12aWV3LWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiY3JlYXRlTG9jYXRpb24iLCJhIiwiYiIsImMiLCJkIiwidXJpIiwicmFuZ2UiLCJzdGFydCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJlbmQiLCJiZWZvcmVFYWNoIiwiZ2xvYmFsIiwic2lub24iLCJzYW5kYm94IiwiY3JlYXRlIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsIml0IiwicmVzdWx0IiwiY2FuQWRhcHQiLCJkb2N1bWVudFN5bWJvbFByb3ZpZGVyIiwidG8iLCJiZSIsInRydWUiLCJmYWxzZSIsImNyZWF0ZU91dGxpbmVUcmVlcyIsImRlZXAiLCJlcXVhbCIsInNvdXJjZUl0ZW0iLCJraW5kIiwiU3ltYm9sS2luZCIsIk5hbWVzcGFjZSIsIm5hbWUiLCJsb2NhdGlvbiIsImV4cGVjdGVkIiwic3ltYm9sVG9PdXRsaW5lIiwiQ2xhc3MiLCJjb250YWluZXJOYW1lIiwibGVuZ3RoIiwicmVwcmVzZW50YXRpdmVOYW1lIiwic3RhcnRQb3NpdGlvbiIsInJvdyIsImNvbHVtbiIsImNoaWxkcmVuIiwic291cmNlSXRlbXMiLCJGdW5jdGlvbiIsInIiLCJlbmRQb3NpdGlvbiIsImljb24iLCJ0b2tlbml6ZWRUZXh0IiwidmFsdWUiXSwibWFwcGluZ3MiOiJBQUVBOzs7O0FBQ0E7O0lBQVlBLEU7O0FBQ1o7Ozs7QUFDQTs7Ozs7O0FBRUFDLFNBQVMsb0JBQVQsRUFBK0IsTUFBTTtBQUNuQyxRQUFNQyxpQkFBaUIsQ0FBQ0MsQ0FBRCxFQUFJQyxDQUFKLEVBQU9DLENBQVAsRUFBVUMsQ0FBVixNQUFpQjtBQUN0Q0MsU0FBSyxFQURpQztBQUV0Q0MsV0FBTyxFQUFDQyxPQUFPLEVBQUNDLE1BQU1QLENBQVAsRUFBVVEsV0FBV1AsQ0FBckIsRUFBUixFQUFpQ1EsS0FBSyxFQUFDRixNQUFNTCxDQUFQLEVBQVVNLFdBQVdM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bUJpQixlQUFuQixDQUFtQ1AsVUFBbkMsQ0FBZjtBQUNBLHdCQUFPVixPQUFPOEIsSUFBZCxFQUFvQjNCLEVBQXBCLENBQXVCTSxLQUF2QixDQUE2QixZQUE3QjtBQUNBLHdCQUFPVCxPQUFPcUIsa0JBQWQsRUFBa0NsQixFQUFsQyxDQUFxQ00sS0FBckMsQ0FBMkMsU0FBM0M7QUFDQSx3QkFBT1QsT0FBT3lCLFFBQWQsRUFBd0J0QixFQUF4QixDQUEyQkssSUFBM0IsQ0FBZ0NDLEtBQWhDLENBQXNDLEVBQXRDO0FBQ0EsWUFBTW1CLElBQUs1QixNQUFYO0FBQ0Esd0JBQU80QixFQUFFRyxhQUFGLENBQWdCLENBQWhCLEVBQW1CcEIsSUFBMUIsRUFBZ0NSLEVBQWhDLENBQW1DTSxLQUFuQyxDQUF5QyxNQUF6QztBQUNBLHdCQUFPbUIsRUFBRUcsYUFBRixDQUFnQixDQUFoQixFQUFtQkMsS0FBMUIsRUFBaUM3QixFQUFqQyxDQUFvQ00sS0FBcEMsQ0FBMEMsU0FBMUM7QUFDQSx3QkFBT21CLEVBQUVOLGFBQUYsQ0FBZ0JDLEdBQXZCLEVBQTRCcEIsRUFBNUIsQ0FBK0JNLEtBQS9CLENBQXFDLENBQXJDO0FBQ0Esd0JBQU9tQixFQUFFTixhQUFGLENBQWdCRSxNQUF2QixFQUErQnJCLEVBQS9CLENBQWtDTSxLQUFsQyxDQUF3QyxDQUF4QztBQUNBLHdCQUFPbUIsRUFBRUMsV0FBRixDQUFjTixHQUFyQixFQUEwQnBCLEVBQTFCLENBQTZCTSxLQUE3QixDQUFtQyxDQUFuQztBQUNBLHdCQUFPbUIsRUFBRUMsV0FBRixDQUFjTCxNQUFyQixFQUE2QnJCLEVBQTdCLENBQWdDTSxLQUFoQyxDQUFzQyxDQUF0QztBQUNELEtBYkQ7QUFjRCxHQWZEO0FBZ0JELENBbktEIiwiZmlsZSI6Im91dGxpbmUtdmlldy1hZGFwdGVyLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gJy4uLy4uL2xpYi9hZGFwdGVycy9vdXRsaW5lLXZpZXctYWRhcHRlcic7XG5pbXBvcnQgKiBhcyBscyBmcm9tICcuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcblxuZGVzY3JpYmUoJ091dGxpbmVWaWV3QWRhcHRlcicsICgpID0+IHtcbiAgY29uc3QgY3JlYXRlTG9jYXRpb24gPSAoYSwgYiwgYywgZCkgPT4gKHtcbiAgICB1cmk6ICcnLFxuICAgIHJhbmdlOiB7c3RhcnQ6IHtsaW5lOiBhLCBjaGFyYWN0ZXI6IGJ9LCBlbmQ6IHtsaW5lOiBjLCBjaGFyYWN0ZXI6IGR9fSxcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgZ2xvYmFsLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcbiAgfSk7XG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgZ2xvYmFsLnNpbm9uLnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbkFkYXB0JywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHRydWUgaWYgZG9jdW1lbnRTeW1ib2xQcm92aWRlciBpcyBzdXBwb3J0ZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoe2RvY3VtZW50U3ltYm9sUHJvdmlkZXI6IHRydWV9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBmYWxzZSBpZiBkb2N1bWVudFN5bWJvbFByb3ZpZGVyIG5vdCBzdXBwb3J0ZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoe30pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uYmUuZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVPdXRsaW5lVHJlZXMnLCAoKSA9PiB7XG4gICAgaXQoJ2NyZWF0ZXMgYW4gZW1wdHkgYXJyYXkgZ2l2ZW4gYW4gZW1wdHkgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKFtdKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NyZWF0ZXMgYSBzaW5nbGUgY29udmVydGVkIHJvb3QgaXRlbSBmcm9tIGEgc2luZ2xlIHNvdXJjZSBpdGVtJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc291cmNlSXRlbSA9IHtraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSwgbmFtZTogJ1InLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNSwgNiwgNywgOCl9O1xuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbc291cmNlSXRlbV0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG8uZGVlcC5lcXVhbChbZXhwZWN0ZWRdKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIGFuIGVtcHR5IHJvb3QgY29udGFpbmVyIHdpdGggYSBzaW5nbGUgc291cmNlIGl0ZW0gd2hlbiBjb250YWluZXJOYW1lIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VJdGVtOiBscy5TeW1ib2xJbmZvcm1hdGlvbiA9IHtcbiAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5DbGFzcyxcbiAgICAgICAgbmFtZTogJ1Byb2dyYW0nLFxuICAgICAgICBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMSwgMiwgMywgNCksXG4gICAgICB9O1xuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xuICAgICAgc291cmNlSXRlbS5jb250YWluZXJOYW1lID0gJ21pc3NpbmcnO1xuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbc291cmNlSXRlbV0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvLmVxdWFsKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5yZXByZXNlbnRhdGl2ZU5hbWUpLnRvLmVxdWFsKCdtaXNzaW5nJyk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0YXJ0UG9zaXRpb24ucm93KS50by5lcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc3RhcnRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbZXhwZWN0ZWRdKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIGFuIGVtcHR5IHJvb3QgY29udGFpbmVyIHdpdGggYSBzaW5nbGUgc291cmNlIGl0ZW0gd2hlbiBjb250YWluZXJOYW1lIGlzIG1pc3NpbmcgYW5kIG1hdGNoZXMgb3duIG5hbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VJdGVtOiBscy5TeW1ib2xJbmZvcm1hdGlvbiA9IHtcbiAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5DbGFzcyxcbiAgICAgICAgbmFtZTogJ3NpbXBsZScsXG4gICAgICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAyLCAzLCA0KSxcbiAgICAgIH07XG4gICAgICBjb25zdCBleHBlY3RlZCA9IE91dGxpbmVWaWV3QWRhcHRlci5zeW1ib2xUb091dGxpbmUoc291cmNlSXRlbSk7XG4gICAgICBzb3VyY2VJdGVtLmNvbnRhaW5lck5hbWUgPSAnc2ltcGxlJztcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jcmVhdGVPdXRsaW5lVHJlZXMoW3NvdXJjZUl0ZW1dKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnc2ltcGxlJyk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0YXJ0UG9zaXRpb24ucm93KS50by5lcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc3RhcnRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbZXhwZWN0ZWRdKTtcbiAgICB9KTtcblxuICAgIGl0KCdjcmVhdGVzIGEgc2ltcGxlIG5hbWVkIGhpZXJhcmNoeScsICgpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW1zID0gW1xuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdqYXZhLmNvbScsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCAxMCwgMCl9LFxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5DbGFzcywgbmFtZTogJ1Byb2dyYW0nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMiwgMCwgNywgMCksIGNvbnRhaW5lck5hbWU6ICdqYXZhLmNvbSd9LFxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5GdW5jdGlvbiwgbmFtZTogJ21haW4nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNCwgMCwgNSwgMCksIGNvbnRhaW5lck5hbWU6ICdQcm9ncmFtJ30sXG4gICAgICBdO1xuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW4ubGVuZ3RoKS50by5lcXVhbCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnbWFpbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldGFpbnMgZHVwbGljYXRlIG5hbWVkIGl0ZW1zJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSwgbmFtZTogJ2R1cGxpY2F0ZScsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCA1LCAwKX0sXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSwgbmFtZTogJ2R1cGxpY2F0ZScsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig2LCAwLCAxMCwgMCl9LFxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5GdW5jdGlvbiwgbmFtZTogJ21haW4nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNywgMCwgOCwgMCksIGNvbnRhaW5lck5hbWU6ICdkdXBsaWNhdGUnfSxcbiAgICAgIF07XG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKHNvdXJjZUl0ZW1zKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnZHVwbGljYXRlJyk7XG4gICAgICBleHBlY3QocmVzdWx0WzFdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ2R1cGxpY2F0ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2Rpc2FtYmlndWF0ZXMgY29udGFpbmVyTmFtZSBiYXNlZCBvbiByYW5nZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW1zID0gW1xuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdkdXBsaWNhdGUnLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMSwgMCwgNSwgMCl9LFxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdkdXBsaWNhdGUnLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNiwgMCwgMTAsIDApfSxcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuRnVuY3Rpb24sIG5hbWU6ICdtYWluJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDcsIDAsIDgsIDApLCBjb250YWluZXJOYW1lOiAnZHVwbGljYXRlJ30sXG4gICAgICBdO1xuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XG4gICAgICBleHBlY3QocmVzdWx0WzFdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzFdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ21haW4nKTtcbiAgICB9KTtcblxuICAgIGl0KFwiZG9lcyBub3QgYmVjb21lIGl0J3Mgb3duIHBhcmVudFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VJdGVtcyA9IFtcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDAsIDEwLCAwKX0sXG4gICAgICAgIHtcbiAgICAgICAgICBraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSxcbiAgICAgICAgICBuYW1lOiAnZHVwbGljYXRlJyxcbiAgICAgICAgICBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNiwgMCwgNywgMCksXG4gICAgICAgICAgY29udGFpbmVyTmFtZTogJ2R1cGxpY2F0ZScsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XG4gICAgICBjb25zdCByID0gKHJlc3VsdDogYW55KTtcbiAgICAgIGV4cGVjdChyWzBdLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoMTApO1xuICAgICAgZXhwZWN0KHJbMF0uY2hpbGRyZW4ubGVuZ3RoKS50by5lcXVhbCgxKTtcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuWzBdLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoNyk7XG4gICAgfSk7XG5cbiAgICBpdCgncGFyZW50cyB0byB0aGUgaW5ubmVybW9zdCBuYW1lZCBjb250YWluZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VJdGVtcyA9IFtcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAndHVydGxlcycsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCAxMCwgMCl9LFxuICAgICAgICB7XG4gICAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsXG4gICAgICAgICAgbmFtZTogJ3R1cnRsZXMnLFxuICAgICAgICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig0LCAwLCA4LCAwKSxcbiAgICAgICAgICBjb250YWluZXJOYW1lOiAndHVydGxlcycsXG4gICAgICAgIH0sXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLkNsYXNzLCBuYW1lOiAnZGlzYycsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig0LCAwLCA1LCAwKSwgY29udGFpbmVyTmFtZTogJ3R1cnRsZXMnfSxcbiAgICAgIF07XG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKHNvdXJjZUl0ZW1zKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgxKTtcbiAgICAgIGNvbnN0IHIgPSAocmVzdWx0OiBhbnkpO1xuICAgICAgZXhwZWN0KHJbMF0uZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCgxMCk7XG4gICAgICBleHBlY3QoclswXS5jaGlsZHJlbi5sZW5ndGgpLnRvLmVxdWFsKDEpO1xuICAgICAgZXhwZWN0KHJbMF0uY2hpbGRyZW5bMF0uZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCg4KTtcbiAgICAgIGV4cGVjdChyWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3QoclswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5lbmRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3ltYm9sVG9PdXRsaW5lJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhbiBpbmRpdmlkdWFsIGl0ZW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VJdGVtID0ge2tpbmQ6IGxzLlN5bWJvbEtpbmQuQ2xhc3MsIG5hbWU6ICdQcm9ncmFtJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDIsIDMsIDQpfTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5zeW1ib2xUb091dGxpbmUoc291cmNlSXRlbSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmljb24pLnRvLmVxdWFsKCd0eXBlLWNsYXNzJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW10pO1xuICAgICAgY29uc3QgciA9IChyZXN1bHQ6IGFueSk7XG4gICAgICBleHBlY3Qoci50b2tlbml6ZWRUZXh0WzBdLmtpbmQpLnRvLmVxdWFsKCd0eXBlJyk7XG4gICAgICBleHBlY3Qoci50b2tlbml6ZWRUZXh0WzBdLnZhbHVlKS50by5lcXVhbCgnUHJvZ3JhbScpO1xuICAgICAgZXhwZWN0KHIuc3RhcnRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDEpO1xuICAgICAgZXhwZWN0KHIuc3RhcnRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDIpO1xuICAgICAgZXhwZWN0KHIuZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCgzKTtcbiAgICAgIGV4cGVjdChyLmVuZFBvc2l0aW9uLmNvbHVtbikudG8uZXF1YWwoNCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=