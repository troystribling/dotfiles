"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ls = require("../lib/languageclient");
const convert_1 = require("../lib/convert");
const chai_1 = require("chai");
const atom_1 = require("atom");
let originalPlatform;
const setProcessPlatform = (platform) => {
    Object.defineProperty(process, 'platform', { value: platform });
};
const createFakeEditor = (path, text) => {
    const editor = new atom_1.TextEditor();
    editor.getBuffer().setPath(path);
    if (text != null) {
        editor.setText(text);
    }
    return editor;
};
describe('Convert', () => {
    beforeEach(() => {
        originalPlatform = process.platform;
    });
    afterEach(() => {
        Object.defineProperty(process, 'platform', { value: originalPlatform });
    });
    describe('pathToUri', () => {
        it('prefixes an absolute path with file://', () => {
            chai_1.expect(convert_1.default.pathToUri('/a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
        });
        it('prefixes an relative path with file:///', () => {
            chai_1.expect(convert_1.default.pathToUri('a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
        }); // TODO: Maybe don't do this in the function - should never be called with relative
        it('replaces backslashes with forward slashes', () => {
            chai_1.expect(convert_1.default.pathToUri('a\\b\\c\\d.txt')).equals('file:///a/b/c/d.txt');
        });
        it('does not encode Windows drive specifiers', () => {
            chai_1.expect(convert_1.default.pathToUri('d:\\ee\\ff.txt')).equals('file:///d:/ee/ff.txt');
        });
        it('URI encodes special characters', () => {
            chai_1.expect(convert_1.default.pathToUri('/a/sp ace/do$lar')).equals('file:///a/sp%20ace/do$lar');
        });
    });
    describe('uriToPath', () => {
        it("does not convert http: and https: uri's", () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('http://atom.io/a')).equals('http://atom.io/a');
            chai_1.expect(convert_1.default.uriToPath('https://atom.io/b')).equals('https://atom.io/b');
        });
        it('converts a file:// path to an absolute path', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:///a/b/c/d.txt')).equals('/a/b/c/d.txt');
        });
        it('converts forward slashes to backslashes on Windows', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:///a/b/c/d.txt')).equals('a\\b\\c\\d.txt');
        });
        it('decodes Windows drive specifiers', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:///d:/ee/ff.txt')).equals('d:\\ee\\ff.txt');
        });
        it('URI decodes special characters', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:///a/sp%20ace/do$lar')).equals('/a/sp ace/do$lar');
        });
        it('parses URI without double slash in the beginning', () => {
            setProcessPlatform('darwin');
            chai_1.expect(convert_1.default.uriToPath('file:/a/b/c/d.txt')).equals('/a/b/c/d.txt');
        });
        it('parses URI without double slash in the beginning on Windows', () => {
            setProcessPlatform('win32');
            chai_1.expect(convert_1.default.uriToPath('file:/x:/a/b/c/d.txt')).equals('x:\\a\\b\\c\\d.txt');
        });
    });
    describe('pointToPosition', () => {
        it('converts an Atom Point to a LSP position', () => {
            const point = new atom_1.Point(1, 2);
            const position = convert_1.default.pointToPosition(point);
            chai_1.expect(position.line).equals(point.row);
            chai_1.expect(position.character).equals(point.column);
        });
    });
    describe('positionToPoint', () => {
        it('converts a LSP position to an Atom Point-array', () => {
            const position = { line: 3, character: 4 };
            const point = convert_1.default.positionToPoint(position);
            chai_1.expect(point.row).equals(position.line);
            chai_1.expect(point.column).equals(position.character);
        });
    });
    describe('lsRangeToAtomRange', () => {
        it('converts a LSP range to an Atom Range-array', () => {
            const lspRange = {
                start: { character: 5, line: 6 },
                end: { line: 7, character: 8 },
            };
            const atomRange = convert_1.default.lsRangeToAtomRange(lspRange);
            chai_1.expect(atomRange.start.row).equals(lspRange.start.line);
            chai_1.expect(atomRange.start.column).equals(lspRange.start.character);
            chai_1.expect(atomRange.end.row).equals(lspRange.end.line);
            chai_1.expect(atomRange.end.column).equals(lspRange.end.character);
        });
    });
    describe('atomRangeToLSRange', () => {
        it('converts an Atom range to a LSP Range-array', () => {
            const atomRange = new atom_1.Range(new atom_1.Point(9, 10), new atom_1.Point(11, 12));
            const lspRange = convert_1.default.atomRangeToLSRange(atomRange);
            chai_1.expect(lspRange.start.line).equals(atomRange.start.row);
            chai_1.expect(lspRange.start.character).equals(atomRange.start.column);
            chai_1.expect(lspRange.end.line).equals(atomRange.end.row);
            chai_1.expect(lspRange.end.character).equals(atomRange.end.column);
        });
    });
    describe('editorToTextDocumentIdentifier', () => {
        it('uses getath which returns a path to create the URI', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const identifier = convert_1.default.editorToTextDocumentIdentifier(createFakeEditor(path));
            chai_1.expect(identifier.uri).equals('file://' + path);
        });
    });
    describe('editorToTextDocumentPositionParams', () => {
        it('uses the editor cursor position when none specified', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const editor = createFakeEditor(path, 'abc\ndefgh\nijkl');
            editor.setCursorBufferPosition(new atom_1.Point(1, 2));
            const params = convert_1.default.editorToTextDocumentPositionParams(editor);
            chai_1.expect(params.textDocument.uri).equals('file://' + path);
            chai_1.expect(params.position).deep.equals({ line: 1, character: 2 });
        });
        it('uses the cursor position parameter when specified', () => {
            const path = '/c/d/e/f/g/h/i/j.txt';
            const specifiedPoint = new atom_1.Point(911, 112);
            const editor = createFakeEditor(path, 'abcdef\nghijkl\nmnopq');
            editor.setCursorBufferPosition(new atom_1.Point(1, 1));
            const params = convert_1.default.editorToTextDocumentPositionParams(editor, specifiedPoint);
            chai_1.expect(params.textDocument.uri).equals('file://' + path);
            chai_1.expect(params.position).deep.equals({ line: 911, character: 112 });
        });
    });
    describe('grammarScopesToTextEditorScopes', () => {
        it('converts a single grammarScope to an atom-text-editor scope', () => {
            const grammarScopes = ['abc.def'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"]');
        });
        it('converts a multiple grammarScopes to a comma-seperated list of atom-text-editor scopes', () => {
            const grammarScopes = ['abc.def', 'ghi.jkl'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"], atom-text-editor[data-grammar="ghi jkl"]');
        });
        it('converts grammarScopes containing HTML sensitive characters to escaped sequences', () => {
            const grammarScopes = ['abc<def', 'ghi"jkl'];
            const textEditorScopes = convert_1.default.grammarScopesToTextEditorScopes(grammarScopes);
            chai_1.expect(textEditorScopes).equals('atom-text-editor[data-grammar="abc&lt;def"], atom-text-editor[data-grammar="ghi&quot;jkl"]');
        });
    });
    describe('encodeHTMLAttribute', () => {
        it('encodes characters that are not safe inside a HTML attribute', () => {
            const stringToEncode = 'a"b\'c&d>e<f';
            const encoded = convert_1.default.encodeHTMLAttribute(stringToEncode);
            chai_1.expect(encoded).equals('a&quot;b&apos;c&amp;d&gt;e&lt;f');
        });
    });
    describe('atomFileEventToLSFileEvents', () => {
        it('converts a created event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'created' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
        });
        it('converts a modified event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'modified' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Changed });
        });
        it('converts a deleted event', () => {
            const source = { path: '/a/b/c/d.txt', action: 'deleted' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Deleted });
        });
        it('converts a renamed event', () => {
            const source = { path: '/a/b/c/d.txt', oldPath: '/a/z/e.lst', action: 'renamed' };
            const converted = convert_1.default.atomFileEventToLSFileEvents(source);
            chai_1.expect(converted[0]).deep.equals({ uri: 'file:///a/z/e.lst', type: ls.FileChangeType.Deleted });
            chai_1.expect(converted[1]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdGVzdC9jb252ZXJ0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBNEM7QUFDNUMsNENBQXFDO0FBQ3JDLCtCQUE4QjtBQUM5QiwrQkFLYztBQUVkLElBQUksZ0JBQWlDLENBQUM7QUFDdEMsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLFFBQWEsRUFBRSxFQUFFO0lBQzNDLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFDLEtBQUssRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDO0FBQ2hFLENBQUMsQ0FBQztBQUVGLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxJQUFZLEVBQUUsSUFBYSxFQUFjLEVBQUU7SUFDbkUsTUFBTSxNQUFNLEdBQUcsSUFBSSxpQkFBVSxFQUFFLENBQUM7SUFDaEMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqQyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO0FBQ2hCLENBQUMsQ0FBQztBQUVGLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBQyxDQUFDLENBQUM7SUFDeEUsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsV0FBVyxFQUFFLEdB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Q0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBQyxHQUFHLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUNsRyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBscyBmcm9tICcuLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi9saWIvY29udmVydCc7XHJcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xyXG5pbXBvcnQge1xyXG4gIFBvaW50LFxyXG4gIFByb2plY3RGaWxlRXZlbnQsXHJcbiAgUmFuZ2UsXHJcbiAgVGV4dEVkaXRvcixcclxufSBmcm9tICdhdG9tJztcclxuXHJcbmxldCBvcmlnaW5hbFBsYXRmb3JtOiBOb2RlSlMuUGxhdGZvcm07XHJcbmNvbnN0IHNldFByb2Nlc3NQbGF0Zm9ybSA9IChwbGF0Zm9ybTogYW55KSA9PiB7XHJcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogcGxhdGZvcm19KTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUZha2VFZGl0b3IgPSAocGF0aDogc3RyaW5nLCB0ZXh0Pzogc3RyaW5nKTogVGV4dEVkaXRvciA9PiB7XHJcbiAgY29uc3QgZWRpdG9yID0gbmV3IFRleHRFZGl0b3IoKTtcclxuICBlZGl0b3IuZ2V0QnVmZmVyKCkuc2V0UGF0aChwYXRoKTtcclxuICBpZiAodGV4dCAhPSBudWxsKSB7XHJcbiAgICBlZGl0b3Iuc2V0VGV4dCh0ZXh0KTtcclxuICB9XHJcbiAgcmV0dXJuIGVkaXRvcjtcclxufTtcclxuXHJcbmRlc2NyaWJlKCdDb252ZXJ0JywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgb3JpZ2luYWxQbGF0Zm9ybSA9IHByb2Nlc3MucGxhdGZvcm07XHJcbiAgfSk7XHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7dmFsdWU6IG9yaWdpbmFsUGxhdGZvcm19KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3BhdGhUb1VyaScsICgpID0+IHtcclxuICAgIGl0KCdwcmVmaXhlcyBhbiBhYnNvbHV0ZSBwYXRoIHdpdGggZmlsZTovLycsICgpID0+IHtcclxuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCcvYS9iL2MvZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncHJlZml4ZXMgYW4gcmVsYXRpdmUgcGF0aCB3aXRoIGZpbGU6Ly8vJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2EvYi9jL2QudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xyXG4gICAgfSk7IC8vIFRPRE86IE1heWJlIGRvbid0IGRvIHRoaXMgaW4gdGhlIGZ1bmN0aW9uIC0gc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCB3aXRoIHJlbGF0aXZlXHJcblxyXG4gICAgaXQoJ3JlcGxhY2VzIGJhY2tzbGFzaGVzIHdpdGggZm9yd2FyZCBzbGFzaGVzJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2FcXFxcYlxcXFxjXFxcXGQudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RvZXMgbm90IGVuY29kZSBXaW5kb3dzIGRyaXZlIHNwZWNpZmllcnMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnZDpcXFxcZWVcXFxcZmYudHh0JykpLmVxdWFscygnZmlsZTovLy9kOi9lZS9mZi50eHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdVUkkgZW5jb2RlcyBzcGVjaWFsIGNoYXJhY3RlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnL2Evc3AgYWNlL2RvJGxhcicpKS5lcXVhbHMoJ2ZpbGU6Ly8vYS9zcCUyMGFjZS9kbyRsYXInKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXJpVG9QYXRoJywgKCkgPT4ge1xyXG4gICAgaXQoXCJkb2VzIG5vdCBjb252ZXJ0IGh0dHA6IGFuZCBodHRwczogdXJpJ3NcIiwgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xyXG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2h0dHA6Ly9hdG9tLmlvL2EnKSkuZXF1YWxzKCdodHRwOi8vYXRvbS5pby9hJyk7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnaHR0cHM6Ly9hdG9tLmlvL2InKSkuZXF1YWxzKCdodHRwczovL2F0b20uaW8vYicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGEgZmlsZTovLyBwYXRoIHRvIGFuIGFic29sdXRlIHBhdGgnLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnZGFyd2luJyk7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJy9hL2IvYy9kLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGZvcndhcmQgc2xhc2hlcyB0byBiYWNrc2xhc2hlcyBvbiBXaW5kb3dzJywgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ3dpbjMyJyk7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJ2FcXFxcYlxcXFxjXFxcXGQudHh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGVjb2RlcyBXaW5kb3dzIGRyaXZlIHNwZWNpZmllcnMnLCAoKSA9PiB7XHJcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2Q6L2VlL2ZmLnR4dCcpKS5lcXVhbHMoJ2Q6XFxcXGVlXFxcXGZmLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ1VSSSBkZWNvZGVzIHNwZWNpYWwgY2hhcmFjdGVycycsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2Evc3AlMjBhY2UvZG8kbGFyJykpLmVxdWFscygnL2Evc3AgYWNlL2RvJGxhcicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3BhcnNlcyBVUkkgd2l0aG91dCBkb3VibGUgc2xhc2ggaW4gdGhlIGJlZ2lubmluZycsICgpID0+IHtcclxuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcclxuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJy9hL2IvYy9kLnR4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3BhcnNlcyBVUkkgd2l0aG91dCBkb3VibGUgc2xhc2ggaW4gdGhlIGJlZ2lubmluZyBvbiBXaW5kb3dzJywgKCkgPT4ge1xyXG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ3dpbjMyJyk7XHJcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZToveDovYS9iL2MvZC50eHQnKSkuZXF1YWxzKCd4OlxcXFxhXFxcXGJcXFxcY1xcXFxkLnR4dCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwb2ludFRvUG9zaXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYW4gQXRvbSBQb2ludCB0byBhIExTUCBwb3NpdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgcG9pbnQgPSBuZXcgUG9pbnQoMSwgMik7XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gQ29udmVydC5wb2ludFRvUG9zaXRpb24ocG9pbnQpO1xyXG4gICAgICBleHBlY3QocG9zaXRpb24ubGluZSkuZXF1YWxzKHBvaW50LnJvdyk7XHJcbiAgICAgIGV4cGVjdChwb3NpdGlvbi5jaGFyYWN0ZXIpLmVxdWFscyhwb2ludC5jb2x1bW4pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwb3NpdGlvblRvUG9pbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYSBMU1AgcG9zaXRpb24gdG8gYW4gQXRvbSBQb2ludC1hcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgcG9zaXRpb24gPSB7bGluZTogMywgY2hhcmFjdGVyOiA0fTtcclxuICAgICAgY29uc3QgcG9pbnQgPSBDb252ZXJ0LnBvc2l0aW9uVG9Qb2ludChwb3NpdGlvbik7XHJcbiAgICAgIGV4cGVjdChwb2ludC5yb3cpLmVxdWFscyhwb3NpdGlvbi5saW5lKTtcclxuICAgICAgZXhwZWN0KHBvaW50LmNvbHVtbikuZXF1YWxzKHBvc2l0aW9uLmNoYXJhY3Rlcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2xzUmFuZ2VUb0F0b21SYW5nZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhIExTUCByYW5nZSB0byBhbiBBdG9tIFJhbmdlLWFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsc3BSYW5nZSA9IHtcclxuICAgICAgICBzdGFydDoge2NoYXJhY3RlcjogNSwgbGluZTogNn0sXHJcbiAgICAgICAgZW5kOiB7bGluZTogNywgY2hhcmFjdGVyOiA4fSxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgYXRvbVJhbmdlID0gQ29udmVydC5sc1JhbmdlVG9BdG9tUmFuZ2UobHNwUmFuZ2UpO1xyXG4gICAgICBleHBlY3QoYXRvbVJhbmdlLnN0YXJ0LnJvdykuZXF1YWxzKGxzcFJhbmdlLnN0YXJ0LmxpbmUpO1xyXG4gICAgICBleHBlY3QoYXRvbVJhbmdlLnN0YXJ0LmNvbHVtbikuZXF1YWxzKGxzcFJhbmdlLnN0YXJ0LmNoYXJhY3Rlcik7XHJcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2UuZW5kLnJvdykuZXF1YWxzKGxzcFJhbmdlLmVuZC5saW5lKTtcclxuICAgICAgZXhwZWN0KGF0b21SYW5nZS5lbmQuY29sdW1uKS5lcXVhbHMobHNwUmFuZ2UuZW5kLmNoYXJhY3Rlcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2F0b21SYW5nZVRvTFNSYW5nZScsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIHJhbmdlIHRvIGEgTFNQIFJhbmdlLWFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhdG9tUmFuZ2UgPSBuZXcgUmFuZ2UobmV3IFBvaW50KDksIDEwKSwgbmV3IFBvaW50KDExLCAxMikpO1xyXG4gICAgICBjb25zdCBsc3BSYW5nZSA9IENvbnZlcnQuYXRvbVJhbmdlVG9MU1JhbmdlKGF0b21SYW5nZSk7XHJcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5saW5lKS5lcXVhbHMoYXRvbVJhbmdlLnN0YXJ0LnJvdyk7XHJcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5jaGFyYWN0ZXIpLmVxdWFscyhhdG9tUmFuZ2Uuc3RhcnQuY29sdW1uKTtcclxuICAgICAgZXhwZWN0KGxzcFJhbmdlLmVuZC5saW5lKS5lcXVhbHMoYXRvbVJhbmdlLmVuZC5yb3cpO1xyXG4gICAgICBleHBlY3QobHNwUmFuZ2UuZW5kLmNoYXJhY3RlcikuZXF1YWxzKGF0b21SYW5nZS5lbmQuY29sdW1uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3VzZXMgZ2V0YXRoIHdoaWNoIHJldHVybnMgYSBwYXRoIHRvIGNyZWF0ZSB0aGUgVVJJJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXRoID0gJy9jL2QvZS9mL2cvaC9pL2oudHh0JztcclxuICAgICAgY29uc3QgaWRlbnRpZmllciA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKGNyZWF0ZUZha2VFZGl0b3IocGF0aCkpO1xyXG4gICAgICBleHBlY3QoaWRlbnRpZmllci51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcycsICgpID0+IHtcclxuICAgIGl0KCd1c2VzIHRoZSBlZGl0b3IgY3Vyc29yIHBvc2l0aW9uIHdoZW4gbm9uZSBzcGVjaWZpZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xyXG4gICAgICBjb25zdCBlZGl0b3IgPSBjcmVhdGVGYWtlRWRpdG9yKHBhdGgsICdhYmNcXG5kZWZnaFxcbmlqa2wnKTtcclxuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKG5ldyBQb2ludCgxLCAyKSk7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhlZGl0b3IpO1xyXG4gICAgICBleHBlY3QocGFyYW1zLnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcclxuICAgICAgZXhwZWN0KHBhcmFtcy5wb3NpdGlvbikuZGVlcC5lcXVhbHMoe2xpbmU6IDEsIGNoYXJhY3RlcjogMn0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3VzZXMgdGhlIGN1cnNvciBwb3NpdGlvbiBwYXJhbWV0ZXIgd2hlbiBzcGVjaWZpZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xyXG4gICAgICBjb25zdCBzcGVjaWZpZWRQb2ludCA9IG5ldyBQb2ludCg5MTEsIDExMik7XHJcbiAgICAgIGNvbnN0IGVkaXRvciA9IGNyZWF0ZUZha2VFZGl0b3IocGF0aCwgJ2FiY2RlZlxcbmdoaWprbFxcbm1ub3BxJyk7XHJcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihuZXcgUG9pbnQoMSwgMSkpO1xyXG4gICAgICBjb25zdCBwYXJhbXMgPSBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMoZWRpdG9yLCBzcGVjaWZpZWRQb2ludCk7XHJcbiAgICAgIGV4cGVjdChwYXJhbXMudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xyXG4gICAgICBleHBlY3QocGFyYW1zLnBvc2l0aW9uKS5kZWVwLmVxdWFscyh7bGluZTogOTExLCBjaGFyYWN0ZXI6IDExMn0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NvbnZlcnRzIGEgc2luZ2xlIGdyYW1tYXJTY29wZSB0byBhbiBhdG9tLXRleHQtZWRpdG9yIHNjb3BlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmMuZGVmJ107XHJcbiAgICAgIGNvbnN0IHRleHRFZGl0b3JTY29wZXMgPSBDb252ZXJ0LmdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blcyk7XHJcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjIGRlZlwiXScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGEgbXVsdGlwbGUgZ3JhbW1hclNjb3BlcyB0byBhIGNvbW1hLXNlcGVyYXRlZCBsaXN0IG9mIGF0b20tdGV4dC1lZGl0b3Igc2NvcGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmMuZGVmJywgJ2doaS5qa2wnXTtcclxuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcclxuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpLmVxdWFscyhcclxuICAgICAgICAnYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJhYmMgZGVmXCJdLCBhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImdoaSBqa2xcIl0nLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbnZlcnRzIGdyYW1tYXJTY29wZXMgY29udGFpbmluZyBIVE1MIHNlbnNpdGl2ZSBjaGFyYWN0ZXJzIHRvIGVzY2FwZWQgc2VxdWVuY2VzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmM8ZGVmJywgJ2doaVwiamtsJ107XHJcbiAgICAgIGNvbnN0IHRleHRFZGl0b3JTY29wZXMgPSBDb252ZXJ0LmdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blcyk7XHJcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoXHJcbiAgICAgICAgJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjJmx0O2RlZlwiXSwgYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJnaGkmcXVvdDtqa2xcIl0nLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlbmNvZGVIVE1MQXR0cmlidXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ2VuY29kZXMgY2hhcmFjdGVycyB0aGF0IGFyZSBub3Qgc2FmZSBpbnNpZGUgYSBIVE1MIGF0dHJpYnV0ZScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3RyaW5nVG9FbmNvZGUgPSAnYVwiYlxcJ2MmZD5lPGYnO1xyXG4gICAgICBjb25zdCBlbmNvZGVkID0gQ29udmVydC5lbmNvZGVIVE1MQXR0cmlidXRlKHN0cmluZ1RvRW5jb2RlKTtcclxuICAgICAgZXhwZWN0KGVuY29kZWQpLmVxdWFscygnYSZxdW90O2ImYXBvcztjJmFtcDtkJmd0O2UmbHQ7ZicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdhdG9tRmlsZUV2ZW50VG9MU0ZpbGVFdmVudHMnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYSBjcmVhdGVkIGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2U6IFByb2plY3RGaWxlRXZlbnQgPSB7cGF0aDogJy9hL2IvYy9kLnR4dCcsIGFjdGlvbjogJ2NyZWF0ZWQnfTtcclxuICAgICAgY29uc3QgY29udmVydGVkID0gQ29udmVydC5hdG9tRmlsZUV2ZW50VG9MU0ZpbGVFdmVudHMoc291cmNlKTtcclxuICAgICAgZXhwZWN0KGNvbnZlcnRlZFswXSkuZGVlcC5lcXVhbHMoe3VyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5DcmVhdGVkfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgYSBtb2RpZmllZCBldmVudCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlOiBQcm9qZWN0RmlsZUV2ZW50ID0ge3BhdGg6ICcvYS9iL2MvZC50eHQnLCBhY3Rpb246ICdtb2RpZmllZCd9O1xyXG4gICAgICBjb25zdCBjb252ZXJ0ZWQgPSBDb252ZXJ0LmF0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cyhzb3VyY2UpO1xyXG4gICAgICBleHBlY3QoY29udmVydGVkWzBdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNoYW5nZWR9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBhIGRlbGV0ZWQgZXZlbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZTogUHJvamVjdEZpbGVFdmVudCA9IHtwYXRoOiAnL2EvYi9jL2QudHh0JywgYWN0aW9uOiAnZGVsZXRlZCd9O1xyXG4gICAgICBjb25zdCBjb252ZXJ0ZWQgPSBDb252ZXJ0LmF0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cyhzb3VyY2UpO1xyXG4gICAgICBleHBlY3QoY29udmVydGVkWzBdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBhIHJlbmFtZWQgZXZlbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZTogUHJvamVjdEZpbGVFdmVudCA9IHtwYXRoOiAnL2EvYi9jL2QudHh0Jywgb2xkUGF0aDogJy9hL3ovZS5sc3QnLCBhY3Rpb246ICdyZW5hbWVkJ307XHJcbiAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IENvbnZlcnQuYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKHNvdXJjZSk7XHJcbiAgICAgIGV4cGVjdChjb252ZXJ0ZWRbMF0pLmRlZXAuZXF1YWxzKHt1cmk6ICdmaWxlOi8vL2Evei9lLmxzdCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9KTtcclxuICAgICAgZXhwZWN0KGNvbnZlcnRlZFsxXSkuZGVlcC5lcXVhbHMoe3VyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5DcmVhdGVkfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==