var _languageclient = require('../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _convert = require('../lib/convert');

var _convert2 = _interopRequireDefault(_convert);

var _atom = require('atom');

var _chai = require('chai');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

let originalPlatform;
const setProcessPlatform = platform => {
  Object.defineProperty(process, 'platform', { value: platform });
};

const createFakeEditor = (path, text) => {
  const editor = new _atom.TextEditor();
  editor.getBuffer().setPath(path);
  if (text != null) {
    editor.setText(text);
  }
  return editor;
};

describe('Convert', () => {
  beforeEach(() => {
    originalPlatform = process.platform;
  });
  afterEach(() => {
    Object.defineProperty(process, 'platform', { value: originalPlatform });
  });

  describe('pathToUri', () => {
    it('prefixes an absolute path with file://', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('prefixes an relative path with file:///', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    }); // TODO: Maybe don't do this in the function - should never be called with relative

    it('replaces backslashes with forward slashes', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a\\b\\c\\d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('does not encode Windows drive specifiers', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('d:\\ee\\ff.txt')).equals('file:///d:/ee/ff.txt');
    });

    it('URI encodes special characters', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/sp ace/do$lar')).equals('file:///a/sp%20ace/do$lar');
    });
  });

  describe('uriToPath', () => {
    it("does not convert http: and https: uri's", () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('http://atom.io/a')).equals('http://atom.io/a');
      (0, _chai.expect)(_convert2.default.uriToPath('https://atom.io/b')).equals('https://atom.io/b');
    });

    it('converts a file:// path to an absolute path', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('/a/b/c/d.txt');
    });

    it('converts forward slashes to backslashes on Windows', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('a\\b\\c\\d.txt');
    });

    it('decodes Windows drive specifiers', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///d:/ee/ff.txt')).equals('d:\\ee\\ff.txt');
    });

    it('URI decodes special characters', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/sp%20ace/do$lar')).equals('/a/sp ace/do$lar');
    });

    it('parses URI without double slash in the beginning', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:/a/b/c/d.txt')).equals('/a/b/c/d.txt');
    });

    it('parses URI without double slash in the beginning on Windows', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:/x:/a/b/c/d.txt')).equals('x:\\a\\b\\c\\d.txt');
    });
  });

  describe('pointToPosition', () => {
    it('converts an Atom Point to a LSP position', () => {
      const point = { row: 1, column: 2 };
      const position = _convert2.default.pointToPosition(point);
      (0, _chai.expect)(position.line).equals(point.row);
      (0, _chai.expect)(position.character).equals(point.column);
    });
  });

  describe('positionToPoint', () => {
    it('converts a LSP position to an Atom Point-array', () => {
      const position = { line: 3, character: 4 };
      const point = _convert2.default.positionToPoint(position);
      (0, _chai.expect)(point.row).equals(position.line);
      (0, _chai.expect)(point.column).equals(position.character);
    });
  });

  describe('lsRangeToAtomRange', () => {
    it('converts a LSP range to an Atom Range-array', () => {
      const lspRange = {
        start: { character: 5, line: 6 },
        end: { line: 7, character: 8 }
      };
      const atomRange = _convert2.default.lsRangeToAtomRange(lspRange);
      (0, _chai.expect)(atomRange.start.row).equals(lspRange.start.line);
      (0, _chai.expect)(atomRange.start.column).equals(lspRange.start.character);
      (0, _chai.expect)(atomRange.end.row).equals(lspRange.end.line);
      (0, _chai.expect)(atomRange.end.column).equals(lspRange.end.character);
    });
  });

  describe('atomRangeToLSRange', () => {
    it('converts an Atom range to a LSP Range-array', () => {
      const atomRange = new _atom.Range(new _atom.Point(9, 10), new _atom.Point(11, 12));
      const lspRange = _convert2.default.atomRangeToLSRange(atomRange);
      (0, _chai.expect)(lspRange.start.line).equals(atomRange.start.row);
      (0, _chai.expect)(lspRange.start.character).equals(atomRange.start.column);
      (0, _chai.expect)(lspRange.end.line).equals(atomRange.end.row);
      (0, _chai.expect)(lspRange.end.character).equals(atomRange.end.column);
    });
  });

  describe('editorToTextDocumentIdentifier', () => {
    it('uses getath which returns a path to create the URI', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const identifier = _convert2.default.editorToTextDocumentIdentifier(createFakeEditor(path));
      (0, _chai.expect)(identifier.uri).equals('file://' + path);
    });
  });

  describe('editorToTextDocumentPositionParams', () => {
    it('uses the editor cursor position when none specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const editor = createFakeEditor(path, 'abc\ndefgh\nijkl');
      editor.setCursorBufferPosition(new _atom.Point(1, 2));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 1, character: 2 });
    });

    it('uses the cursor position parameter when specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const specifiedPoint = new _atom.Point(911, 112);
      const editor = createFakeEditor(path, 'abcdef\nghijkl\nmnopq');
      editor.setCursorBufferPosition(new _atom.Point(1, 1));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor, specifiedPoint);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 911, character: 112 });
    });
  });

  describe('grammarScopesToTextEditorScopes', () => {
    it('converts a single grammarScope to an atom-text-editor scope', () => {
      const grammarScopes = ['abc.def'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"]');
    });

    it('converts a multiple grammarScopes to a comma-seperated list of atom-text-editor scopes', () => {
      const grammarScopes = ['abc.def', 'ghi.jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"], atom-text-editor[data-grammar="ghi jkl"]');
    });

    it('converts grammarScopes containing HTML sensitive characters to escaped sequences', () => {
      const grammarScopes = ['abc<def', 'ghi"jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc&lt;def"], atom-text-editor[data-grammar="ghi&quot;jkl"]');
    });
  });

  describe('encodeHTMLAttribute', () => {
    it('encodes characters that are not safe inside a HTML attribute', () => {
      const stringToEncode = 'a"b\'c&d>e<f';
      const encoded = _convert2.default.encodeHTMLAttribute(stringToEncode);
      (0, _chai.expect)(encoded).equals('a&quot;b&apos;c&amp;d&gt;e&lt;f');
    });
  });

  describe('atomFileEventToLSFileEvents', () => {
    it('converts a created event', () => {
      const source = { path: '/a/b/c/d.txt', action: 'created' };
      const converted = _convert2.default.atomFileEventToLSFileEvents(source);
      (0, _chai.expect)(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
    });

    it('converts a modified event', () => {
      const source = { path: '/a/b/c/d.txt', action: 'modified' };
      const converted = _convert2.default.atomFileEventToLSFileEvents(source);
      (0, _chai.expect)(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Changed });
    });

    it('converts a deleted event', () => {
      const source = { path: '/a/b/c/d.txt', action: 'deleted' };
      const converted = _convert2.default.atomFileEventToLSFileEvents(source);
      (0, _chai.expect)(converted[0]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Deleted });
    });

    it('converts a renamed event', () => {
      const source = { path: '/a/b/c/d.txt', oldPath: '/a/z/e.lst', action: 'renamed' };
      const converted = _convert2.default.atomFileEventToLSFileEvents(source);
      (0, _chai.expect)(converted[0]).deep.equals({ uri: 'file:///a/z/e.lst', type: ls.FileChangeType.Deleted });
      (0, _chai.expect)(converted[1]).deep.equals({ uri: 'file:///a/b/c/d.txt', type: ls.FileChangeType.Created });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvY29udmVydC50ZXN0LmpzIl0sIm5hbWVzIjpbImxzIiwib3JpZ2luYWxQbGF0Zm9ybSIsInNldFByb2Nlc3NQbGF0Zm9ybSIsInBsYXRmb3JtIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm9jZXNzIiwidmFsdWUiLCJjcmVhdGVGYWtlRWRpdG9yIiwicGF0aCIsInRleHQiLCJlZGl0b3IiLCJnZXRCdWZmZXIiLCJzZXRQYXRoIiwic2V0VGV4dCIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImFmdGVyRWFjaCIsIml0IiwicGF0aFRvVXJpIiwiZXF1YWxzIiwidXJpVG9QYXRoIiwicG9pbnQiLCJyb3ciLCJjb2x1bW4iLCJwb3NpdGlvbiIsInBvaW50VG9Qb3NpdGlvbiIsImxpbmUiLCJjaGFyYWN0ZXIiLCJwb3NpdGlvblRvUG9pbnQiLCJsc3BSYW5nZSIsInN0YXJ0IiwiZW5kIiwiYXRvbVJhbmdlIiwibHNSYW5nZVRvQXRvbVJhbmdlIiwiYXRvbVJhbmdlVG9MU1JhbmdlIiwiaWRlbnRpZmllciIsImVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllciIsInVyaSIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwicGFyYW1zIiwiZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyIsInRleHREb2N1bWVudCIsImRlZXAiLCJzcGVjaWZpZWRQb2ludCIsImdyYW1tYXJTY29wZXMiLCJ0ZXh0RWRpdG9yU2NvcGVzIiwiZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyIsInN0cmluZ1RvRW5jb2RlIiwiZW5jb2RlZCIsImVuY29kZUhUTUxBdHRyaWJ1dGUiLCJzb3VyY2UiLCJhY3Rpb24iLCJjb252ZXJ0ZWQiLCJhdG9tRmlsZUV2ZW50VG9MU0ZpbGVFdmVudHMiLCJ0eXBlIiwiRmlsZUNoYW5nZVR5cGUiLCJDcmVhdGVkIiwiQ2hhbmdlZCIsIkRlbGV0ZWQiLCJvbGRQYXRoIl0sIm1hcHBpbmdzIjoiQUFF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QUFNQyxZQUFZLGtCQUFRQywyQkFBUixDQUFvQ0gsTUFBcEMsQ0FBbEI7QUFDQSx3QkFBT0UsVUFBVSxDQUFWLENBQVAsRUFBcUJWLElBQXJCLENBQTBCdkIsTUFBMUIsQ0FBaUMsRUFBQ2tCLEtBQUsscUJBQU4sRUFBNkJpQixNQUFNdkQsR0FBR3dELGNBQUgsQ0FBa0JHLE9BQXJELEVBQWpDO0FBQ0QsS0FKRDs7QUFNQXpDLE9BQUcsMEJBQUgsRUFBK0IsTUFBTTtBQUNuQyxZQUFNaUMsU0FBUyxFQUFDMUMsTUFBTSxjQUFQLEVBQXVCbUQsU0FBUyxZQUFoQyxFQUE4Q1IsUUFBUSxTQUF0RCxFQUFmO0FBQ0EsWUFBTUMsWUFBWSxrQkFBUUMsMkJBQVIsQ0FBb0NILE1BQXBDLENBQWxCO0FBQ0Esd0JBQU9FLFVBQVUsQ0FBVixDQUFQLEVBQXFCVixJQUFyQixDQUEwQnZCLE1BQTFCLENBQWlDLEVBQUNrQixLQUFLLG1CQUFOLEVBQTJCaUIsTUFBTXZELEdBQUd3RCxjQUFILENBQWtCRyxPQUFuRCxFQUFqQztBQUNBLHdCQUFPTixVQUFVLENBQVYsQ0FBUCxFQUFxQlYsSUFBckIsQ0FBMEJ2QixNQUExQixDQUFpQyxFQUFDa0IsS0FBSyxxQkFBTixFQUE2QmlCLE1BQU12RCxHQUFHd0QsY0FBSCxDQUFrQkMsT0FBckQsRUFBakM7QUFDRCxLQUxEO0FBTUQsR0F6QkQ7QUEwQkQsQ0F0TUQiLCJmaWxlIjoiY29udmVydC50ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcblxuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi4vbGliL2xhbmd1YWdlY2xpZW50JztcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4uL2xpYi9jb252ZXJ0JztcbmltcG9ydCB7UG9pbnQsIFJhbmdlLCBUZXh0RWRpdG9yfSBmcm9tICdhdG9tJztcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcblxubGV0IG9yaWdpbmFsUGxhdGZvcm07XG5jb25zdCBzZXRQcm9jZXNzUGxhdGZvcm0gPSBwbGF0Zm9ybSA9PiB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7dmFsdWU6IHBsYXRmb3JtfSk7XG59O1xuXG5jb25zdCBjcmVhdGVGYWtlRWRpdG9yID0gKHBhdGg6IHN0cmluZywgdGV4dDogP3N0cmluZyk6IGF0b20kVGV4dEVkaXRvciA9PiB7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBUZXh0RWRpdG9yKCk7XG4gIGVkaXRvci5nZXRCdWZmZXIoKS5zZXRQYXRoKHBhdGgpO1xuICBpZiAodGV4dCAhPSBudWxsKSB7XG4gICAgZWRpdG9yLnNldFRleHQodGV4dCk7XG4gIH1cbiAgcmV0dXJuIGVkaXRvcjtcbn07XG5cbmRlc2NyaWJlKCdDb252ZXJ0JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBvcmlnaW5hbFBsYXRmb3JtID0gcHJvY2Vzcy5wbGF0Zm9ybTtcbiAgfSk7XG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogb3JpZ2luYWxQbGF0Zm9ybX0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncGF0aFRvVXJpJywgKCkgPT4ge1xuICAgIGl0KCdwcmVmaXhlcyBhbiBhYnNvbHV0ZSBwYXRoIHdpdGggZmlsZTovLycsICgpID0+IHtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnL2EvYi9jL2QudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3ByZWZpeGVzIGFuIHJlbGF0aXZlIHBhdGggd2l0aCBmaWxlOi8vLycsICgpID0+IHtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYS9iL2MvZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XG4gICAgfSk7IC8vIFRPRE86IE1heWJlIGRvbid0IGRvIHRoaXMgaW4gdGhlIGZ1bmN0aW9uIC0gc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCB3aXRoIHJlbGF0aXZlXG5cbiAgICBpdCgncmVwbGFjZXMgYmFja3NsYXNoZXMgd2l0aCBmb3J3YXJkIHNsYXNoZXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2FcXFxcYlxcXFxjXFxcXGQudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RvZXMgbm90IGVuY29kZSBXaW5kb3dzIGRyaXZlIHNwZWNpZmllcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2Q6XFxcXGVlXFxcXGZmLnR4dCcpKS5lcXVhbHMoJ2ZpbGU6Ly8vZDovZWUvZmYudHh0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnVVJJIGVuY29kZXMgc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCcvYS9zcCBhY2UvZG8kbGFyJykpLmVxdWFscygnZmlsZTovLy9hL3NwJTIwYWNlL2RvJGxhcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXJpVG9QYXRoJywgKCkgPT4ge1xuICAgIGl0KFwiZG9lcyBub3QgY29udmVydCBodHRwOiBhbmQgaHR0cHM6IHVyaSdzXCIsICgpID0+IHtcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnZGFyd2luJyk7XG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2h0dHA6Ly9hdG9tLmlvL2EnKSkuZXF1YWxzKCdodHRwOi8vYXRvbS5pby9hJyk7XG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2h0dHBzOi8vYXRvbS5pby9iJykpLmVxdWFscygnaHR0cHM6Ly9hdG9tLmlvL2InKTtcbiAgICB9KTtcblxuICAgIGl0KCdjb252ZXJ0cyBhIGZpbGU6Ly8gcGF0aCB0byBhbiBhYnNvbHV0ZSBwYXRoJywgKCkgPT4ge1xuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIGZvcndhcmQgc2xhc2hlcyB0byBiYWNrc2xhc2hlcyBvbiBXaW5kb3dzJywgKCkgPT4ge1xuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCd3aW4zMicpO1xuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnYVxcXFxiXFxcXGNcXFxcZC50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWNvZGVzIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9kOi9lZS9mZi50eHQnKSkuZXF1YWxzKCdkOlxcXFxlZVxcXFxmZi50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdVUkkgZGVjb2RlcyBzcGVjaWFsIGNoYXJhY3RlcnMnLCAoKSA9PiB7XG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2Evc3AlMjBhY2UvZG8kbGFyJykpLmVxdWFscygnL2Evc3AgYWNlL2RvJGxhcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3BhcnNlcyBVUkkgd2l0aG91dCBkb3VibGUgc2xhc2ggaW4gdGhlIGJlZ2lubmluZycsICgpID0+IHtcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnZGFyd2luJyk7XG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6L2EvYi9jL2QudHh0JykpLmVxdWFscygnL2EvYi9jL2QudHh0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgncGFyc2VzIFVSSSB3aXRob3V0IGRvdWJsZSBzbGFzaCBpbiB0aGUgYmVnaW5uaW5nIG9uIFdpbmRvd3MnLCAoKSA9PiB7XG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ3dpbjMyJyk7XG4gICAgICBleHBlY3QoQ29udmVydC51cmlUb1BhdGgoJ2ZpbGU6L3g6L2EvYi9jL2QudHh0JykpLmVxdWFscygneDpcXFxcYVxcXFxiXFxcXGNcXFxcZC50eHQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BvaW50VG9Qb3NpdGlvbicsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgYW4gQXRvbSBQb2ludCB0byBhIExTUCBwb3NpdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBvaW50ID0ge3JvdzogMSwgY29sdW1uOiAyfTtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gQ29udmVydC5wb2ludFRvUG9zaXRpb24ocG9pbnQpO1xuICAgICAgZXhwZWN0KHBvc2l0aW9uLmxpbmUpLmVxdWFscyhwb2ludC5yb3cpO1xuICAgICAgZXhwZWN0KHBvc2l0aW9uLmNoYXJhY3RlcikuZXF1YWxzKHBvaW50LmNvbHVtbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwb3NpdGlvblRvUG9pbnQnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIGEgTFNQIHBvc2l0aW9uIHRvIGFuIEF0b20gUG9pbnQtYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IHtsaW5lOiAzLCBjaGFyYWN0ZXI6IDR9O1xuICAgICAgY29uc3QgcG9pbnQgPSBDb252ZXJ0LnBvc2l0aW9uVG9Qb2ludChwb3NpdGlvbik7XG4gICAgICBleHBlY3QocG9pbnQucm93KS5lcXVhbHMocG9zaXRpb24ubGluZSk7XG4gICAgICBleHBlY3QocG9pbnQuY29sdW1uKS5lcXVhbHMocG9zaXRpb24uY2hhcmFjdGVyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xzUmFuZ2VUb0F0b21SYW5nZScsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgYSBMU1AgcmFuZ2UgdG8gYW4gQXRvbSBSYW5nZS1hcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IGxzcFJhbmdlID0ge1xuICAgICAgICBzdGFydDoge2NoYXJhY3RlcjogNSwgbGluZTogNn0sXG4gICAgICAgIGVuZDoge2xpbmU6IDcsIGNoYXJhY3RlcjogOH0sXG4gICAgICB9O1xuICAgICAgY29uc3QgYXRvbVJhbmdlID0gQ29udmVydC5sc1JhbmdlVG9BdG9tUmFuZ2UobHNwUmFuZ2UpO1xuICAgICAgZXhwZWN0KGF0b21SYW5nZS5zdGFydC5yb3cpLmVxdWFscyhsc3BSYW5nZS5zdGFydC5saW5lKTtcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2Uuc3RhcnQuY29sdW1uKS5lcXVhbHMobHNwUmFuZ2Uuc3RhcnQuY2hhcmFjdGVyKTtcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2UuZW5kLnJvdykuZXF1YWxzKGxzcFJhbmdlLmVuZC5saW5lKTtcbiAgICAgIGV4cGVjdChhdG9tUmFuZ2UuZW5kLmNvbHVtbikuZXF1YWxzKGxzcFJhbmdlLmVuZC5jaGFyYWN0ZXIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXRvbVJhbmdlVG9MU1JhbmdlJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIHJhbmdlIHRvIGEgTFNQIFJhbmdlLWFycmF5JywgKCkgPT4ge1xuICAgICAgY29uc3QgYXRvbVJhbmdlID0gbmV3IFJhbmdlKG5ldyBQb2ludCg5LCAxMCksIG5ldyBQb2ludCgxMSwgMTIpKTtcbiAgICAgIGNvbnN0IGxzcFJhbmdlID0gQ29udmVydC5hdG9tUmFuZ2VUb0xTUmFuZ2UoYXRvbVJhbmdlKTtcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5saW5lKS5lcXVhbHMoYXRvbVJhbmdlLnN0YXJ0LnJvdyk7XG4gICAgICBleHBlY3QobHNwUmFuZ2Uuc3RhcnQuY2hhcmFjdGVyKS5lcXVhbHMoYXRvbVJhbmdlLnN0YXJ0LmNvbHVtbik7XG4gICAgICBleHBlY3QobHNwUmFuZ2UuZW5kLmxpbmUpLmVxdWFscyhhdG9tUmFuZ2UuZW5kLnJvdyk7XG4gICAgICBleHBlY3QobHNwUmFuZ2UuZW5kLmNoYXJhY3RlcikuZXF1YWxzKGF0b21SYW5nZS5lbmQuY29sdW1uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcicsICgpID0+IHtcbiAgICBpdCgndXNlcyBnZXRhdGggd2hpY2ggcmV0dXJucyBhIHBhdGggdG8gY3JlYXRlIHRoZSBVUkknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXRoID0gJy9jL2QvZS9mL2cvaC9pL2oudHh0JztcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50SWRlbnRpZmllcihjcmVhdGVGYWtlRWRpdG9yKHBhdGgpKTtcbiAgICAgIGV4cGVjdChpZGVudGlmaWVyLnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcycsICgpID0+IHtcbiAgICBpdCgndXNlcyB0aGUgZWRpdG9yIGN1cnNvciBwb3NpdGlvbiB3aGVuIG5vbmUgc3BlY2lmaWVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0aCA9ICcvYy9kL2UvZi9nL2gvaS9qLnR4dCc7XG4gICAgICBjb25zdCBlZGl0b3IgPSBjcmVhdGVGYWtlRWRpdG9yKHBhdGgsICdhYmNcXG5kZWZnaFxcbmlqa2wnKTtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihuZXcgUG9pbnQoMSwgMikpO1xuICAgICAgY29uc3QgcGFyYW1zID0gQ29udmVydC5lZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKGVkaXRvcik7XG4gICAgICBleHBlY3QocGFyYW1zLnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcbiAgICAgIGV4cGVjdChwYXJhbXMucG9zaXRpb24pLmRlZXAuZXF1YWxzKHtsaW5lOiAxLCBjaGFyYWN0ZXI6IDJ9KTtcbiAgICB9KTtcblxuICAgIGl0KCd1c2VzIHRoZSBjdXJzb3IgcG9zaXRpb24gcGFyYW1ldGVyIHdoZW4gc3BlY2lmaWVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0aCA9ICcvYy9kL2UvZi9nL2gvaS9qLnR4dCc7XG4gICAgICBjb25zdCBzcGVjaWZpZWRQb2ludCA9IG5ldyBQb2ludCg5MTEsIDExMik7XG4gICAgICBjb25zdCBlZGl0b3IgPSBjcmVhdGVGYWtlRWRpdG9yKHBhdGgsICdhYmNkZWZcXG5naGlqa2xcXG5tbm9wcScpO1xuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKG5ldyBQb2ludCgxLCAxKSk7XG4gICAgICBjb25zdCBwYXJhbXMgPSBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMoZWRpdG9yLCBzcGVjaWZpZWRQb2ludCk7XG4gICAgICBleHBlY3QocGFyYW1zLnRleHREb2N1bWVudC51cmkpLmVxdWFscygnZmlsZTovLycgKyBwYXRoKTtcbiAgICAgIGV4cGVjdChwYXJhbXMucG9zaXRpb24pLmRlZXAuZXF1YWxzKHtsaW5lOiA5MTEsIGNoYXJhY3RlcjogMTEyfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhIHNpbmdsZSBncmFtbWFyU2NvcGUgdG8gYW4gYXRvbS10ZXh0LWVkaXRvciBzY29wZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGdyYW1tYXJTY29wZXMgPSBbJ2FiYy5kZWYnXTtcbiAgICAgIGNvbnN0IHRleHRFZGl0b3JTY29wZXMgPSBDb252ZXJ0LmdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMoZ3JhbW1hclNjb3Blcyk7XG4gICAgICBleHBlY3QodGV4dEVkaXRvclNjb3BlcykuZXF1YWxzKCdhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImFiYyBkZWZcIl0nKTtcbiAgICB9KTtcblxuICAgIGl0KCdjb252ZXJ0cyBhIG11bHRpcGxlIGdyYW1tYXJTY29wZXMgdG8gYSBjb21tYS1zZXBlcmF0ZWQgbGlzdCBvZiBhdG9tLXRleHQtZWRpdG9yIHNjb3BlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGdyYW1tYXJTY29wZXMgPSBbJ2FiYy5kZWYnLCAnZ2hpLmprbCddO1xuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoXG4gICAgICAgICdhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImFiYyBkZWZcIl0sIGF0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiZ2hpIGprbFwiXScsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIGdyYW1tYXJTY29wZXMgY29udGFpbmluZyBIVE1MIHNlbnNpdGl2ZSBjaGFyYWN0ZXJzIHRvIGVzY2FwZWQgc2VxdWVuY2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ3JhbW1hclNjb3BlcyA9IFsnYWJjPGRlZicsICdnaGlcImprbCddO1xuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoXG4gICAgICAgICdhdG9tLXRleHQtZWRpdG9yW2RhdGEtZ3JhbW1hcj1cImFiYyZsdDtkZWZcIl0sIGF0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiZ2hpJnF1b3Q7amtsXCJdJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlbmNvZGVIVE1MQXR0cmlidXRlJywgKCkgPT4ge1xuICAgIGl0KCdlbmNvZGVzIGNoYXJhY3RlcnMgdGhhdCBhcmUgbm90IHNhZmUgaW5zaWRlIGEgSFRNTCBhdHRyaWJ1dGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdHJpbmdUb0VuY29kZSA9ICdhXCJiXFwnYyZkPmU8Zic7XG4gICAgICBjb25zdCBlbmNvZGVkID0gQ29udmVydC5lbmNvZGVIVE1MQXR0cmlidXRlKHN0cmluZ1RvRW5jb2RlKTtcbiAgICAgIGV4cGVjdChlbmNvZGVkKS5lcXVhbHMoJ2EmcXVvdDtiJmFwb3M7YyZhbXA7ZCZndDtlJmx0O2YnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2F0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cycsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgYSBjcmVhdGVkIGV2ZW50JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc291cmNlID0ge3BhdGg6ICcvYS9iL2MvZC50eHQnLCBhY3Rpb246ICdjcmVhdGVkJ307XG4gICAgICBjb25zdCBjb252ZXJ0ZWQgPSBDb252ZXJ0LmF0b21GaWxlRXZlbnRUb0xTRmlsZUV2ZW50cyhzb3VyY2UpO1xuICAgICAgZXhwZWN0KGNvbnZlcnRlZFswXSkuZGVlcC5lcXVhbHMoe3VyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnLCB0eXBlOiBscy5GaWxlQ2hhbmdlVHlwZS5DcmVhdGVkfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnY29udmVydHMgYSBtb2RpZmllZCBldmVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZSA9IHtwYXRoOiAnL2EvYi9jL2QudHh0JywgYWN0aW9uOiAnbW9kaWZpZWQnfTtcbiAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IENvbnZlcnQuYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKHNvdXJjZSk7XG4gICAgICBleHBlY3QoY29udmVydGVkWzBdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkNoYW5nZWR9KTtcbiAgICB9KTtcblxuICAgIGl0KCdjb252ZXJ0cyBhIGRlbGV0ZWQgZXZlbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2UgPSB7cGF0aDogJy9hL2IvYy9kLnR4dCcsIGFjdGlvbjogJ2RlbGV0ZWQnfTtcbiAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IENvbnZlcnQuYXRvbUZpbGVFdmVudFRvTFNGaWxlRXZlbnRzKHNvdXJjZSk7XG4gICAgICBleHBlY3QoY29udmVydGVkWzBdKS5kZWVwLmVxdWFscyh7dXJpOiAnZmlsZTovLy9hL2IvYy9kLnR4dCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9KTtcbiAgICB9KTtcblxuICAgIGl0KCdjb252ZXJ0cyBhIHJlbmFtZWQgZXZlbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2UgPSB7cGF0aDogJy9hL2IvYy9kLnR4dCcsIG9sZFBhdGg6ICcvYS96L2UubHN0JywgYWN0aW9uOiAncmVuYW1lZCd9O1xuICAgICAgY29uc3QgY29udmVydGVkID0gQ29udmVydC5hdG9tRmlsZUV2ZW50VG9MU0ZpbGVFdmVudHMoc291cmNlKTtcbiAgICAgIGV4cGVjdChjb252ZXJ0ZWRbMF0pLmRlZXAuZXF1YWxzKHt1cmk6ICdmaWxlOi8vL2Evei9lLmxzdCcsIHR5cGU6IGxzLkZpbGVDaGFuZ2VUeXBlLkRlbGV0ZWR9KTtcbiAgICAgIGV4cGVjdChjb252ZXJ0ZWRbMV0pLmRlZXAuZXF1YWxzKHt1cmk6ICdmaWxlOi8vL2EvYi9jL2QudHh0JywgdHlwZTogbHMuRmlsZUNoYW5nZVR5cGUuQ3JlYXRlZH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19