var _convert = require('../lib/convert');

var _convert2 = _interopRequireDefault(_convert);

var _atom = require('atom');

var _chai = require('chai');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let originalPlatform;

const setProcessPlatform = platform => {
  Object.defineProperty(process, 'platform', { value: platform });
};

const createFakeEditor = (path, text) => {
  const editor = new _atom.TextEditor();
  editor.getBuffer().setPath(path);
  if (text != null) {
    editor.setText(text);
  }
  return editor;
};

describe('Convert', () => {
  beforeEach(() => {
    originalPlatform = process.platform;
  });
  afterEach(() => {
    Object.defineProperty(process, 'platform', { value: originalPlatform });
  });

  describe('pathToUri', () => {
    it('prefixes an absolute path with file://', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('prefixes an relative path with file:///', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a/b/c/d.txt')).equals('file:///a/b/c/d.txt');
    }); // TODO: Maybe don't do this in the function - should never be called with relative

    it('replaces backslashes with forward slashes', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('a\\b\\c\\d.txt')).equals('file:///a/b/c/d.txt');
    });

    it('does not encode Windows drive specifiers', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('d:\\ee\\ff.txt')).equals('file:///d:/ee/ff.txt');
    });

    it('URI encodes special characters', () => {
      (0, _chai.expect)(_convert2.default.pathToUri('/a/sp ace/do$lar')).equals('file:///a/sp%20ace/do$lar');
    });
  });

  describe('uriToPath', () => {
    it('converts a file:// path to an absolute path', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('/a/b/c/d.txt');
    });

    it('converts forward slashes to backslashes on Windows', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/b/c/d.txt')).equals('a\\b\\c\\d.txt');
    });

    it('decodes Windows drive specifiers', () => {
      setProcessPlatform('win32');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///d:/ee/ff.txt')).equals('d:\\ee\\ff.txt');
    });

    it('URI decodes special characters', () => {
      setProcessPlatform('darwin');
      (0, _chai.expect)(_convert2.default.uriToPath('file:///a/sp%20ace/do$lar')).equals('/a/sp ace/do$lar');
    });
  });

  describe('pointToPosition', () => {
    it('converts an Atom Point to a LSP position', () => {
      const point = { row: 1, column: 2 };
      const position = _convert2.default.pointToPosition(point);
      (0, _chai.expect)(position.line).equals(point.row);
      (0, _chai.expect)(position.character).equals(point.column);
    });
  });

  describe('positionToPoint', () => {
    it('converts a LSP position to an Atom Point-array', () => {
      const position = { line: 3, character: 4 };
      const point = _convert2.default.positionToPoint(position);
      (0, _chai.expect)(point.row).equals(position.line);
      (0, _chai.expect)(point.column).equals(position.character);
    });
  });

  describe('lsRangeToAtomRange', () => {
    it('converts a LSP range to an Atom Range-array', () => {
      const lspRange = {
        start: { character: 5, line: 6 },
        end: { line: 7, character: 8 }
      };
      const atomRange = _convert2.default.lsRangeToAtomRange(lspRange);
      (0, _chai.expect)(atomRange.start.row).equals(lspRange.start.line);
      (0, _chai.expect)(atomRange.start.column).equals(lspRange.start.character);
      (0, _chai.expect)(atomRange.end.row).equals(lspRange.end.line);
      (0, _chai.expect)(atomRange.end.column).equals(lspRange.end.character);
    });
  });

  describe('atomRangeToLSRange', () => {
    it('converts an Atom range to a LSP Range-array', () => {
      const atomRange = new _atom.Range(new _atom.Point(9, 10), new _atom.Point(11, 12));
      const lspRange = _convert2.default.atomRangeToLSRange(atomRange);
      (0, _chai.expect)(lspRange.start.line).equals(atomRange.start.row);
      (0, _chai.expect)(lspRange.start.character).equals(atomRange.start.column);
      (0, _chai.expect)(lspRange.end.line).equals(atomRange.end.row);
      (0, _chai.expect)(lspRange.end.character).equals(atomRange.end.column);
    });
  });

  describe('editorToTextDocumentIdentifier', () => {
    it('uses getath which returns a path to create the URI', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const identifier = _convert2.default.editorToTextDocumentIdentifier(createFakeEditor(path));
      (0, _chai.expect)(identifier.uri).equals('file://' + path);
    });
  });

  describe('editorToTextDocumentPositionParams', () => {
    it('uses the editor cursor position when none specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const editor = createFakeEditor(path, 'abc\ndefgh\nijkl');
      editor.setCursorBufferPosition(new _atom.Point(1, 2));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 1, character: 2 });
    });

    it('uses the cursor position parameter when specified', () => {
      const path = '/c/d/e/f/g/h/i/j.txt';
      const specifiedPoint = new _atom.Point(911, 112);
      const editor = createFakeEditor(path, 'abcdef\nghijkl\nmnopq');
      editor.setCursorBufferPosition(new _atom.Point(1, 1));
      const params = _convert2.default.editorToTextDocumentPositionParams(editor, specifiedPoint);
      (0, _chai.expect)(params.textDocument.uri).equals('file://' + path);
      (0, _chai.expect)(params.position).deep.equals({ line: 911, character: 112 });
    });
  });

  describe('grammarScopesToTextEditorScopes', () => {
    it('converts a single grammarScope to an atom-text-editor scope', () => {
      const grammarScopes = ['abc.def'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"]');
    });

    it('converts a multiple grammarScopes to a comma-seperated list of atom-text-editor scopes', () => {
      const grammarScopes = ['abc.def', 'ghi.jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc def"], atom-text-editor[data-grammar="ghi jkl"]');
    });

    it('converts grammarScopes containing HTML sensitive characters to escaped sequences', () => {
      const grammarScopes = ['abc<def', 'ghi"jkl'];
      const textEditorScopes = _convert2.default.grammarScopesToTextEditorScopes(grammarScopes);
      (0, _chai.expect)(textEditorScopes).equals('atom-text-editor[data-grammar="abc&lt;def"], atom-text-editor[data-grammar="ghi&quot;jkl"]');
    });
  });

  describe('encodeHTMLAttribute', () => {
    it('encodes characters that are not safe inside a HTML attribute', () => {
      const stringToEncode = 'a"b\'c&d>e<f';
      const encoded = _convert2.default.encodeHTMLAttribute(stringToEncode);
      (0, _chai.expect)(encoded).equals('a&quot;b&apos;c&amp;d&gt;e&lt;f');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvY29udmVydC50ZXN0LmpzIl0sIm5hbWVzIjpbIm9yaWdpbmFsUGxhdGZvcm0iLCJzZXRQcm9jZXNzUGxhdGZvcm0iLCJwbGF0Zm9ybSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwicHJvY2VzcyIsInZhbHVlIiwiY3JlYXRlRmFrZUVkaXRvciIsInBhdGgiLCJ0ZXh0IiwiZWRpdG9yIiwiZ2V0QnVmZmVyIiwic2V0UGF0aCIsInNldFRleHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJhZnRlckVhY2giLCJpdCIsInBhdGhUb1VyaSIsImVxdWFscyIsInVyaVRvUGF0aCIsInBvaW50Iiwicm93IiwiY29sdW1uIiwicG9zaXRpb24iLCJwb2ludFRvUG9zaXRpb24iLCJsaW5lIiwiY2hhcmFjdGVyIiwicG9zaXRpb25Ub1BvaW50IiwibHNwUmFuZ2UiLCJzdGFydCIsImVuZCIsImF0b21SYW5nZSIsImxzUmFuZ2VUb0F0b21SYW5nZSIsImF0b21SYW5nZVRvTFNSYW5nZSIsImlkZW50aWZpZXIiLCJlZGl0b3JUb1RleHREb2N1bWVudElkZW50aWZpZXIiLCJ1cmkiLCJzZXRDdXJzb3JCdWZmZXJQb3NpdGlvbiIsInBhcmFtcyIsImVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMiLCJ0ZXh0RG9jdW1lbnQiLCJkZWVwIiwic3BlY2lmaWVkUG9pbnQiLCJncmFtbWFyU2NvcGVzIiwidGV4dEVkaXRvclNjb3BlcyIsImdyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMiLCJzdHJpbmdUb0VuY29kZSIsImVuY29kZWQiLCJlbmNvZGVIVE1MQXR0cmlidXRlIl0sIm1hcHBpbmdzIjoiQUFFQTs7OztBQUNBOztBQUNBOzs7O0FBRUEsSUFBSUEsZ0JBQUo7O0FBQ0EsTUFBTUMscUJBQXFCQyxZQUFZO0FBQ3JDQyxTQUFPQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixVQUEvQixFQUEyQyxFQUFDQyxPQUFPSixRQUFSLEVB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QTZGLE1BQU07QUFDakcsWUFBTTJCLGdCQUFnQixDQUFDLFNBQUQsRUFBWSxTQUFaLENBQXRCO0FBQ0EsWUFBTUMsbUJBQW1CLGtCQUFRQywrQkFBUixDQUF3Q0YsYUFBeEMsQ0FBekI7QUFDQSx3QkFBT0MsZ0JBQVAsRUFDRzFCLE1BREgsQ0FDVSxvRkFEVjtBQUVELEtBTEQ7O0FBT0FGLE9BQUcsa0ZBQUgsRUFBdUYsTUFBTTtBQUMzRixZQUFNMkIsZ0JBQWdCLENBQUMsU0FBRCxFQUFZLFNBQVosQ0FBdEI7QUFDQSxZQUFNQyxtQkFBbUIsa0JBQVFDLCtCQUFSLENBQXdDRixhQUF4QyxDQUF6QjtBQUNBLHdCQUFPQyxnQkFBUCxFQUNHMUIsTUFESCxDQUNVLDRGQURWO0FBRUQsS0FMRDtBQU1ELEdBcEJEOztBQXNCQUwsV0FBUyxxQkFBVCxFQUFnQyxNQUFNO0FBQ3BDRyxPQUFHLDhEQUFILEVBQW1FLE1BQU07QUFDdkUsWUFBTThCLGlCQUFpQixjQUF2QjtBQUNBLFlBQU1DLFVBQVUsa0JBQVFDLG1CQUFSLENBQTRCRixjQUE1QixDQUFoQjtBQUNBLHdCQUFPQyxPQUFQLEVBQWdCN0IsTUFBaEIsQ0FBdUIsaUNBQXZCO0FBQ0QsS0FKRDtBQUtELEdBTkQ7QUFPRCxDQXJKRCIsImZpbGUiOiJjb252ZXJ0LnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgQ29udmVydCBmcm9tICcuLi9saWIvY29udmVydCc7XG5pbXBvcnQge1BvaW50LCBSYW5nZSwgVGV4dEVkaXRvcn0gZnJvbSAnYXRvbSc7XG5pbXBvcnQge2V4cGVjdH0gZnJvbSAnY2hhaSc7XG5cbmxldCBvcmlnaW5hbFBsYXRmb3JtO1xuY29uc3Qgc2V0UHJvY2Vzc1BsYXRmb3JtID0gcGxhdGZvcm0gPT4ge1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvY2VzcywgJ3BsYXRmb3JtJywge3ZhbHVlOiBwbGF0Zm9ybX0pO1xufTtcblxuY29uc3QgY3JlYXRlRmFrZUVkaXRvciA9IChwYXRoOiBzdHJpbmcsIHRleHQ6ID9zdHJpbmcpOiBhdG9tJFRleHRFZGl0b3IgPT4ge1xuICBjb25zdCBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvcigpO1xuICBlZGl0b3IuZ2V0QnVmZmVyKCkuc2V0UGF0aChwYXRoKTtcbiAgaWYgKHRleHQgIT0gbnVsbCkge1xuICAgIGVkaXRvci5zZXRUZXh0KHRleHQpO1xuICB9XG4gIHJldHVybiBlZGl0b3I7XG59O1xuXG5kZXNjcmliZSgnQ29udmVydCcsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7IG9yaWdpbmFsUGxhdGZvcm0gPSBwcm9jZXNzLnBsYXRmb3JtOyB9KTtcbiAgYWZ0ZXJFYWNoKCgpID0+IHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHt2YWx1ZTogb3JpZ2luYWxQbGF0Zm9ybX0pOyB9KTtcblxuICBkZXNjcmliZSgncGF0aFRvVXJpJywgKCkgPT4ge1xuICAgIGl0KCdwcmVmaXhlcyBhbiBhYnNvbHV0ZSBwYXRoIHdpdGggZmlsZTovLycsICgpID0+IHtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnL2EvYi9jL2QudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3ByZWZpeGVzIGFuIHJlbGF0aXZlIHBhdGggd2l0aCBmaWxlOi8vLycsICgpID0+IHtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnBhdGhUb1VyaSgnYS9iL2MvZC50eHQnKSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QudHh0Jyk7XG4gICAgfSk7IC8vIFRPRE86IE1heWJlIGRvbid0IGRvIHRoaXMgaW4gdGhlIGZ1bmN0aW9uIC0gc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCB3aXRoIHJlbGF0aXZlXG5cbiAgICBpdCgncmVwbGFjZXMgYmFja3NsYXNoZXMgd2l0aCBmb3J3YXJkIHNsYXNoZXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2FcXFxcYlxcXFxjXFxcXGQudHh0JykpLmVxdWFscygnZmlsZTovLy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RvZXMgbm90IGVuY29kZSBXaW5kb3dzIGRyaXZlIHNwZWNpZmllcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQ29udmVydC5wYXRoVG9VcmkoJ2Q6XFxcXGVlXFxcXGZmLnR4dCcpKS5lcXVhbHMoJ2ZpbGU6Ly8vZDovZWUvZmYudHh0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnVVJJIGVuY29kZXMgc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KENvbnZlcnQucGF0aFRvVXJpKCcvYS9zcCBhY2UvZG8kbGFyJykpLmVxdWFscygnZmlsZTovLy9hL3NwJTIwYWNlL2RvJGxhcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXJpVG9QYXRoJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhIGZpbGU6Ly8gcGF0aCB0byBhbiBhYnNvbHV0ZSBwYXRoJywgKCkgPT4ge1xuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCdkYXJ3aW4nKTtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9hL2IvYy9kLnR4dCcpKS5lcXVhbHMoJy9hL2IvYy9kLnR4dCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIGZvcndhcmQgc2xhc2hlcyB0byBiYWNrc2xhc2hlcyBvbiBXaW5kb3dzJywgKCkgPT4ge1xuICAgICAgc2V0UHJvY2Vzc1BsYXRmb3JtKCd3aW4zMicpO1xuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2EvYi9jL2QudHh0JykpLmVxdWFscygnYVxcXFxiXFxcXGNcXFxcZC50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWNvZGVzIFdpbmRvd3MgZHJpdmUgc3BlY2lmaWVycycsICgpID0+IHtcbiAgICAgIHNldFByb2Nlc3NQbGF0Zm9ybSgnd2luMzInKTtcbiAgICAgIGV4cGVjdChDb252ZXJ0LnVyaVRvUGF0aCgnZmlsZTovLy9kOi9lZS9mZi50eHQnKSkuZXF1YWxzKCdkOlxcXFxlZVxcXFxmZi50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdVUkkgZGVjb2RlcyBzcGVjaWFsIGNoYXJhY3RlcnMnLCAoKSA9PiB7XG4gICAgICBzZXRQcm9jZXNzUGxhdGZvcm0oJ2RhcndpbicpO1xuICAgICAgZXhwZWN0KENvbnZlcnQudXJpVG9QYXRoKCdmaWxlOi8vL2Evc3AlMjBhY2UvZG8kbGFyJykpLmVxdWFscygnL2Evc3AgYWNlL2RvJGxhcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncG9pbnRUb1Bvc2l0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhbiBBdG9tIFBvaW50IHRvIGEgTFNQIHBvc2l0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgcG9pbnQgPSB7cm93OiAxLCBjb2x1bW46IDJ9O1xuICAgICAgY29uc3QgcG9zaXRpb24gPSBDb252ZXJ0LnBvaW50VG9Qb3NpdGlvbihwb2ludCk7XG4gICAgICBleHBlY3QocG9zaXRpb24ubGluZSkuZXF1YWxzKHBvaW50LnJvdyk7XG4gICAgICBleHBlY3QocG9zaXRpb24uY2hhcmFjdGVyKS5lcXVhbHMocG9pbnQuY29sdW1uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Bvc2l0aW9uVG9Qb2ludCcsICgpID0+IHtcbiAgICBpdCgnY29udmVydHMgYSBMU1AgcG9zaXRpb24gdG8gYW4gQXRvbSBQb2ludC1hcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0ge2xpbmU6IDMsIGNoYXJhY3RlcjogNH07XG4gICAgICBjb25zdCBwb2ludCA9IENvbnZlcnQucG9zaXRpb25Ub1BvaW50KHBvc2l0aW9uKTtcbiAgICAgIGV4cGVjdChwb2ludC5yb3cpLmVxdWFscyhwb3NpdGlvbi5saW5lKTtcbiAgICAgIGV4cGVjdChwb2ludC5jb2x1bW4pLmVxdWFscyhwb3NpdGlvbi5jaGFyYWN0ZXIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbHNSYW5nZVRvQXRvbVJhbmdlJywgKCkgPT4ge1xuICAgIGl0KCdjb252ZXJ0cyBhIExTUCByYW5nZSB0byBhbiBBdG9tIFJhbmdlLWFycmF5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbHNwUmFuZ2UgPSB7XG4gICAgICAgIHN0YXJ0OiB7Y2hhcmFjdGVyOiA1LCBsaW5lOiA2fSxcbiAgICAgICAgZW5kOiB7bGluZTogNywgY2hhcmFjdGVyOiA4fSxcbiAgICAgIH07XG4gICAgICBjb25zdCBhdG9tUmFuZ2UgPSBDb252ZXJ0LmxzUmFuZ2VUb0F0b21SYW5nZShsc3BSYW5nZSk7XG4gICAgICBleHBlY3QoYXRvbVJhbmdlLnN0YXJ0LnJvdykuZXF1YWxzKGxzcFJhbmdlLnN0YXJ0LmxpbmUpO1xuICAgICAgZXhwZWN0KGF0b21SYW5nZS5zdGFydC5jb2x1bW4pLmVxdWFscyhsc3BSYW5nZS5zdGFydC5jaGFyYWN0ZXIpO1xuICAgICAgZXhwZWN0KGF0b21SYW5nZS5lbmQucm93KS5lcXVhbHMobHNwUmFuZ2UuZW5kLmxpbmUpO1xuICAgICAgZXhwZWN0KGF0b21SYW5nZS5lbmQuY29sdW1uKS5lcXVhbHMobHNwUmFuZ2UuZW5kLmNoYXJhY3Rlcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhdG9tUmFuZ2VUb0xTUmFuZ2UnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIGFuIEF0b20gcmFuZ2UgdG8gYSBMU1AgUmFuZ2UtYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhdG9tUmFuZ2UgPSBuZXcgUmFuZ2UobmV3IFBvaW50KDksIDEwKSwgbmV3IFBvaW50KDExLCAxMikpO1xuICAgICAgY29uc3QgbHNwUmFuZ2UgPSBDb252ZXJ0LmF0b21SYW5nZVRvTFNSYW5nZShhdG9tUmFuZ2UpO1xuICAgICAgZXhwZWN0KGxzcFJhbmdlLnN0YXJ0LmxpbmUpLmVxdWFscyhhdG9tUmFuZ2Uuc3RhcnQucm93KTtcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5zdGFydC5jaGFyYWN0ZXIpLmVxdWFscyhhdG9tUmFuZ2Uuc3RhcnQuY29sdW1uKTtcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5lbmQubGluZSkuZXF1YWxzKGF0b21SYW5nZS5lbmQucm93KTtcbiAgICAgIGV4cGVjdChsc3BSYW5nZS5lbmQuY2hhcmFjdGVyKS5lcXVhbHMoYXRvbVJhbmdlLmVuZC5jb2x1bW4pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyJywgKCkgPT4ge1xuICAgIGl0KCd1c2VzIGdldGF0aCB3aGljaCByZXR1cm5zIGEgcGF0aCB0byBjcmVhdGUgdGhlIFVSSScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdGggPSAnL2MvZC9lL2YvZy9oL2kvai50eHQnO1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRJZGVudGlmaWVyKGNyZWF0ZUZha2VFZGl0b3IocGF0aCkpO1xuICAgICAgZXhwZWN0KGlkZW50aWZpZXIudXJpKS5lcXVhbHMoJ2ZpbGU6Ly8nICsgcGF0aCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlZGl0b3JUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zJywgKCkgPT4ge1xuICAgIGl0KCd1c2VzIHRoZSBlZGl0b3IgY3Vyc29yIHBvc2l0aW9uIHdoZW4gbm9uZSBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXRoID0gJy9jL2QvZS9mL2cvaC9pL2oudHh0JztcbiAgICAgIGNvbnN0IGVkaXRvciA9IGNyZWF0ZUZha2VFZGl0b3IocGF0aCwgJ2FiY1xcbmRlZmdoXFxuaWprbCcpO1xuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKG5ldyBQb2ludCgxLCAyKSk7XG4gICAgICBjb25zdCBwYXJhbXMgPSBDb252ZXJ0LmVkaXRvclRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMoZWRpdG9yKTtcbiAgICAgIGV4cGVjdChwYXJhbXMudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xuICAgICAgZXhwZWN0KHBhcmFtcy5wb3NpdGlvbikuZGVlcC5lcXVhbHMoe2xpbmU6IDEsIGNoYXJhY3RlcjogMn0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3VzZXMgdGhlIGN1cnNvciBwb3NpdGlvbiBwYXJhbWV0ZXIgd2hlbiBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXRoID0gJy9jL2QvZS9mL2cvaC9pL2oudHh0JztcbiAgICAgIGNvbnN0IHNwZWNpZmllZFBvaW50ID0gbmV3IFBvaW50KDkxMSwgMTEyKTtcbiAgICAgIGNvbnN0IGVkaXRvciA9IGNyZWF0ZUZha2VFZGl0b3IocGF0aCwgJ2FiY2RlZlxcbmdoaWprbFxcbm1ub3BxJyk7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24obmV3IFBvaW50KDEsIDEpKTtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IENvbnZlcnQuZWRpdG9yVG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyhlZGl0b3IsIHNwZWNpZmllZFBvaW50KTtcbiAgICAgIGV4cGVjdChwYXJhbXMudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vJyArIHBhdGgpO1xuICAgICAgZXhwZWN0KHBhcmFtcy5wb3NpdGlvbikuZGVlcC5lcXVhbHMoe2xpbmU6IDkxMSwgY2hhcmFjdGVyOiAxMTJ9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dyYW1tYXJTY29wZXNUb1RleHRFZGl0b3JTY29wZXMnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIGEgc2luZ2xlIGdyYW1tYXJTY29wZSB0byBhbiBhdG9tLXRleHQtZWRpdG9yIHNjb3BlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ3JhbW1hclNjb3BlcyA9IFsnYWJjLmRlZiddO1xuICAgICAgY29uc3QgdGV4dEVkaXRvclNjb3BlcyA9IENvbnZlcnQuZ3JhbW1hclNjb3Blc1RvVGV4dEVkaXRvclNjb3BlcyhncmFtbWFyU2NvcGVzKTtcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yU2NvcGVzKS5lcXVhbHMoJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjIGRlZlwiXScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NvbnZlcnRzIGEgbXVsdGlwbGUgZ3JhbW1hclNjb3BlcyB0byBhIGNvbW1hLXNlcGVyYXRlZCBsaXN0IG9mIGF0b20tdGV4dC1lZGl0b3Igc2NvcGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ3JhbW1hclNjb3BlcyA9IFsnYWJjLmRlZicsICdnaGkuamtsJ107XG4gICAgICBjb25zdCB0ZXh0RWRpdG9yU2NvcGVzID0gQ29udmVydC5ncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzKGdyYW1tYXJTY29wZXMpO1xuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpXG4gICAgICAgIC5lcXVhbHMoJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjIGRlZlwiXSwgYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJnaGkgamtsXCJdJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnY29udmVydHMgZ3JhbW1hclNjb3BlcyBjb250YWluaW5nIEhUTUwgc2Vuc2l0aXZlIGNoYXJhY3RlcnMgdG8gZXNjYXBlZCBzZXF1ZW5jZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBncmFtbWFyU2NvcGVzID0gWydhYmM8ZGVmJywgJ2doaVwiamtsJ107XG4gICAgICBjb25zdCB0ZXh0RWRpdG9yU2NvcGVzID0gQ29udmVydC5ncmFtbWFyU2NvcGVzVG9UZXh0RWRpdG9yU2NvcGVzKGdyYW1tYXJTY29wZXMpO1xuICAgICAgZXhwZWN0KHRleHRFZGl0b3JTY29wZXMpXG4gICAgICAgIC5lcXVhbHMoJ2F0b20tdGV4dC1lZGl0b3JbZGF0YS1ncmFtbWFyPVwiYWJjJmx0O2RlZlwiXSwgYXRvbS10ZXh0LWVkaXRvcltkYXRhLWdyYW1tYXI9XCJnaGkmcXVvdDtqa2xcIl0nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VuY29kZUhUTUxBdHRyaWJ1dGUnLCAoKSA9PiB7XG4gICAgaXQoJ2VuY29kZXMgY2hhcmFjdGVycyB0aGF0IGFyZSBub3Qgc2FmZSBpbnNpZGUgYSBIVE1MIGF0dHJpYnV0ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0cmluZ1RvRW5jb2RlID0gJ2FcImJcXCdjJmQ+ZTxmJztcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBDb252ZXJ0LmVuY29kZUhUTUxBdHRyaWJ1dGUoc3RyaW5nVG9FbmNvZGUpO1xuICAgICAgZXhwZWN0KGVuY29kZWQpLmVxdWFscygnYSZxdW90O2ImYXBvcztjJmFtcDtkJmd0O2UmbHQ7ZicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19